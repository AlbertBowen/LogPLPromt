<!DOCTYPE html>
<html class="client-nojs" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<title>Advanced Format (Русский) - ArchWiki</title>
<link rel="stylesheet" href="../ArchWikiOffline.css">
<meta name="ResourceLoaderDynamicStyles" content="">
<meta name="generator" content="MediaWiki 1.39.4">
<meta name="referrer" content="no-referrer-when-downgrade">
<meta name="format-detection" content="telephone=no">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes, minimum-scale=0.25, maximum-scale=5.0">
<link rel="icon" href="/favicon.ico">
<link rel="search" type="application/opensearchdescription+xml" href="/opensearch_desc.php" title="ArchWiki (en)">
<link rel="EditURI" type="application/rsd+xml" href="https://wiki.archlinux.org/api.php?action=rsd">
<link rel="license" href="https://www.gnu.org/copyleft/fdl.html">
<link rel="alternate" type="application/atom+xml" title="ArchWiki Atom feed" href="/index.php?title=Special:RecentChanges&amp;feed=atom">
</head>
<body class="skin-vector skin-vector-search-vue mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-Advanced_Format_Русский rootpage-Advanced_Format_Русский skin-vector-2022 action-view skin--responsive vector-feature-language-in-header-enabled vector-feature-language-in-main-page-header-disabled vector-feature-language-alert-in-sidebar-disabled vector-feature-sticky-header-disabled vector-feature-sticky-header-edit-disabled vector-feature-table-of-contents-disabled vector-feature-visual-enhancement-next-disabled">
<div class="mw-page-container">
	<span id="top-page"></span>
	<a class="mw-jump-link" href="#content">Jump to content</a>
	<div class="mw-page-container-inner">
		<input type="checkbox" id="mw-sidebar-checkbox" class="mw-checkbox-hack-checkbox">
		<div class="vector-sidebar-container ">
			</div>
		<div class="vector-sitenotice-container">
			<div id="siteNotice"></div>
		</div>
		<input type="checkbox" id="vector-toc-collapsed-checkbox" class="mw-checkbox-hack-checkbox">
		<div class="mw-table-of-contents-container">
			<div class="vector-sticky-toc-container mw-sticky-header-element">
				<nav id="mw-panel-toc" class="sidebar-toc" role="navigation" aria-labelledby="sidebar-toc-label" data-event-name="ui.sidebar-toc">
	<div id="sidebar-toc-label" class="sidebar-toc-header">
		<p class="sidebar-toc-title">
		Contents
		<button class="vector-toc-uncollapse-button">move to sidebar</button>
		<button class="vector-toc-collapse-button">hide</button>
		</p>
	</div>
	<ul class="sidebar-toc-contents" id="mw-panel-toc-list">
		<li id="toc-mw-content-text" class="sidebar-toc-list-item sidebar-toc-level-1">
			<a href="#top-page" class="sidebar-toc-link">
				<div class="sidebar-toc-text">Beginning</div>
			</a>
		</li>
		<li id="toc-Расширенный_формат_жёстких_дисков" class="sidebar-toc-list-item sidebar-toc-level-1 sidebar-toc-list-item-expanded">
			<a class="sidebar-toc-link" href="#%D0%A0%D0%B0%D1%81%D1%88%D0%B8%D1%80%D0%B5%D0%BD%D0%BD%D1%8B%D0%B9_%D1%84%D0%BE%D1%80%D0%BC%D0%B0%D1%82_%D0%B6%D1%91%D1%81%D1%82%D0%BA%D0%B8%D1%85_%D0%B4%D0%B8%D1%81%D0%BA%D0%BE%D0%B2">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">1</span>Расширенный формат жёстких дисков</div>
			</a>
			
				<button aria-controls="toc-Расширенный_формат_жёстких_дисков-sublist" class="mw-ui-icon mw-ui-icon-wikimedia-expand mw-ui-icon-small sidebar-toc-toggle">
					Toggle Расширенный формат жёстких дисков subsection
				</button>
			
			<ul id="toc-Расширенный_формат_жёстких_дисков-sublist" class="sidebar-toc-list">
				<li id="toc-Проверка_поддерживаемых_размеров_сектора" class="sidebar-toc-list-item sidebar-toc-level-2">
			<a class="sidebar-toc-link" href="#%D0%9F%D1%80%D0%BE%D0%B2%D0%B5%D1%80%D0%BA%D0%B0_%D0%BF%D0%BE%D0%B4%D0%B4%D0%B5%D1%80%D0%B6%D0%B8%D0%B2%D0%B0%D0%B5%D0%BC%D1%8B%D1%85_%D1%80%D0%B0%D0%B7%D0%BC%D0%B5%D1%80%D0%BE%D0%B2_%D1%81%D0%B5%D0%BA%D1%82%D0%BE%D1%80%D0%B0">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">1.1</span>Проверка поддерживаемых размеров сектора</div>
			</a>
			
			<ul id="toc-Проверка_поддерживаемых_размеров_сектора-sublist" class="sidebar-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id="toc-Твердотельные_накопители" class="sidebar-toc-list-item sidebar-toc-level-1 sidebar-toc-list-item-expanded">
			<a class="sidebar-toc-link" href="#%D0%A2%D0%B2%D0%B5%D1%80%D0%B4%D0%BE%D1%82%D0%B5%D0%BB%D1%8C%D0%BD%D1%8B%D0%B5_%D0%BD%D0%B0%D0%BA%D0%BE%D0%BF%D0%B8%D1%82%D0%B5%D0%BB%D0%B8">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">2</span>Твердотельные накопители</div>
			</a>
			
				<button aria-controls="toc-Твердотельные_накопители-sublist" class="mw-ui-icon mw-ui-icon-wikimedia-expand mw-ui-icon-small sidebar-toc-toggle">
					Toggle Твердотельные накопители subsection
				</button>
			
			<ul id="toc-Твердотельные_накопители-sublist" class="sidebar-toc-list">
				<li id="toc-Просмотр_размеров_сектора,_поддерживаемых_NVMe-накопителем" class="sidebar-toc-list-item sidebar-toc-level-2">
			<a class="sidebar-toc-link" href="#%D0%9F%D1%80%D0%BE%D1%81%D0%BC%D0%BE%D1%82%D1%80_%D1%80%D0%B0%D0%B7%D0%BC%D0%B5%D1%80%D0%BE%D0%B2_%D1%81%D0%B5%D0%BA%D1%82%D0%BE%D1%80%D0%B0,_%D0%BF%D0%BE%D0%B4%D0%B4%D0%B5%D1%80%D0%B6%D0%B8%D0%B2%D0%B0%D0%B5%D0%BC%D1%8B%D1%85_NVMe-%D0%BD%D0%B0%D0%BA%D0%BE%D0%BF%D0%B8%D1%82%D0%B5%D0%BB%D0%B5%D0%BC">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">2.1</span>Просмотр размеров сектора, поддерживаемых NVMe-накопителем</div>
			</a>
			
			<ul id="toc-Просмотр_размеров_сектора,_поддерживаемых_NVMe-накопителем-sublist" class="sidebar-toc-list">
			</ul>
		</li>
		<li id="toc-Установка_размера_сектора_устройства" class="sidebar-toc-list-item sidebar-toc-level-2">
			<a class="sidebar-toc-link" href="#%D0%A3%D1%81%D1%82%D0%B0%D0%BD%D0%BE%D0%B2%D0%BA%D0%B0_%D1%80%D0%B0%D0%B7%D0%BC%D0%B5%D1%80%D0%B0_%D1%81%D0%B5%D0%BA%D1%82%D0%BE%D1%80%D0%B0_%D1%83%D1%81%D1%82%D1%80%D0%BE%D0%B9%D1%81%D1%82%D0%B2%D0%B0">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">2.2</span>Установка размера сектора устройства</div>
			</a>
			
			<ul id="toc-Установка_размера_сектора_устройства-sublist" class="sidebar-toc-list">
				<li id="toc-NVMe" class="sidebar-toc-list-item sidebar-toc-level-3">
			<a class="sidebar-toc-link" href="#NVMe">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">2.2.1</span>NVMe</div>
			</a>
			
			<ul id="toc-NVMe-sublist" class="sidebar-toc-list">
			</ul>
		</li>
		<li id="toc-SATA" class="sidebar-toc-list-item sidebar-toc-level-3">
			<a class="sidebar-toc-link" href="#SATA">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">2.2.2</span>SATA</div>
			</a>
			
			<ul id="toc-SATA-sublist" class="sidebar-toc-list">
				<li id="toc-Intel" class="sidebar-toc-list-item sidebar-toc-level-4">
			<a class="sidebar-toc-link" href="#Intel">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">2.2.2.1</span>Intel</div>
			</a>
			
			<ul id="toc-Intel-sublist" class="sidebar-toc-list">
			</ul>
		</li>
		<li id="toc-Seagate" class="sidebar-toc-list-item sidebar-toc-level-4">
			<a class="sidebar-toc-link" href="#Seagate">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">2.2.2.2</span>Seagate</div>
			</a>
			
			<ul id="toc-Seagate-sublist" class="sidebar-toc-list">
			</ul>
		</li>
	</ul>
		</li>
	</ul>
		</li>
	</ul>
		</li>
		<li id="toc-Выравнивание_разделов" class="sidebar-toc-list-item sidebar-toc-level-1 sidebar-toc-list-item-expanded">
			<a class="sidebar-toc-link" href="#%D0%92%D1%8B%D1%80%D0%B0%D0%B2%D0%BD%D0%B8%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5_%D1%80%D0%B0%D0%B7%D0%B4%D0%B5%D0%BB%D0%BE%D0%B2">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">3</span>Выравнивание разделов</div>
			</a>
			
			<ul id="toc-Выравнивание_разделов-sublist" class="sidebar-toc-list">
			</ul>
		</li>
		<li id="toc-dm-crypt" class="sidebar-toc-list-item sidebar-toc-level-1 sidebar-toc-list-item-expanded">
			<a class="sidebar-toc-link" href="#dm-crypt">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">4</span>dm-crypt</div>
			</a>
			
			<ul id="toc-dm-crypt-sublist" class="sidebar-toc-list">
			</ul>
		</li>
		<li id="toc-Файловые_системы" class="sidebar-toc-list-item sidebar-toc-level-1 sidebar-toc-list-item-expanded">
			<a class="sidebar-toc-link" href="#%D0%A4%D0%B0%D0%B9%D0%BB%D0%BE%D0%B2%D1%8B%D0%B5_%D1%81%D0%B8%D1%81%D1%82%D0%B5%D0%BC%D1%8B">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">5</span>Файловые системы</div>
			</a>
			
			<ul id="toc-Файловые_системы-sublist" class="sidebar-toc-list">
			</ul>
		</li>
		<li id="toc-Смотрите_также" class="sidebar-toc-list-item sidebar-toc-level-1 sidebar-toc-list-item-expanded">
			<a class="sidebar-toc-link" href="#%D0%A1%D0%BC%D0%BE%D1%82%D1%80%D0%B8%D1%82%D0%B5_%D1%82%D0%B0%D0%BA%D0%B6%D0%B5">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">6</span>Смотрите также</div>
			</a>
			
			<ul id="toc-Смотрите_также-sublist" class="sidebar-toc-list">
			</ul>
		</li>
	</ul>
</nav>

			</div>
		</div>
		<div class="mw-content-container">
			<main id="content" class="mw-body" role="main" style="margin: 0">
				<a id="top"></a>
				<nav class="vector-article-toolbar" aria-label="Tools" role="navigation">
					<div class="mw-article-toolbar-container">
						<div id="left-navigation">
							

<div id="p-associated-pages" class="vector-menu mw-portlet mw-portlet-associated-pages vector-menu-tabs">
	<div class="vector-menu-content">
		
		<ul class="vector-menu-content-list">
<li id="ca-nstab-main" class="selected mw-list-item"><a href="../ru/Advanced_Format.html" title="View the content page [c]" accesskey="c"><span>Page</span></a></li>
<li id="ca-talk" class="new mw-list-item"><a href="/index.php?title=Talk:Advanced_Format_(%D0%A0%D1%83%D1%81%D1%81%D0%BA%D0%B8%D0%B9)&amp;action=edit&amp;redlink=1" rel="discussion" title="Discussion about the content page (page does not exist) [t]" accesskey="t"><span>Discussion</span></a></li>
</ul>
		
	</div>
</div>

							

<div id="p-variants" class="vector-menu mw-portlet mw-portlet-variants emptyPortlet vector-menu-dropdown">
	<input type="checkbox" id="p-variants-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-p-variants" class="vector-menu-checkbox" aria-label="Change language variant">
	<label id="p-variants-label" for="p-variants-checkbox" class="vector-menu-heading ">
		<span class="vector-menu-heading-label">русский</span>
	</label>
	<div class="vector-menu-content">
		
		<ul class="vector-menu-content-list"></ul>
		
	</div>
</div>

						</div>
						<div id="right-navigation" class="vector-collapsible ">
							

<div id="p-views" class="vector-menu mw-portlet mw-portlet-views vector-menu-tabs">
	<div class="vector-menu-content">
		
		<ul class="vector-menu-content-list">
<li id="ca-view" class="selected mw-list-item"><a href="../ru/Advanced_Format.html"><span>Read</span></a></li>
<li id="ca-viewsource" class="mw-list-item"><a href="/index.php?title=Advanced_Format_(%D0%A0%D1%83%D1%81%D1%81%D0%BA%D0%B8%D0%B9)&amp;action=edit" title="This page is protected.
You can view its source [e]" accesskey="e"><span>View source</span></a></li>
<li id="ca-history" class="mw-list-item"><a href="/index.php?title=Advanced_Format_(%D0%A0%D1%83%D1%81%D1%81%D0%BA%D0%B8%D0%B9)&amp;action=history" title="Past revisions of this page [h]" accesskey="h"><span>View history</span></a></li>
</ul>
		
	</div>
</div>

							

<div id="p-cactions" class="vector-menu mw-portlet mw-portlet-cactions emptyPortlet vector-menu-dropdown vector-has-collapsible-items" title="More options">
	<input type="checkbox" id="p-cactions-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-p-cactions" class="vector-menu-checkbox">
	<label id="p-cactions-label" for="p-cactions-checkbox" class="vector-menu-heading ">
		<span class="vector-menu-heading-label">More</span>
	</label>
	<div class="vector-menu-content">
		
		<ul class="vector-menu-content-list">
<li id="ca-more-view" class="selected vector-more-collapsible-item mw-list-item"><a href="../ru/Advanced_Format.html"><span>Read</span></a></li>
<li id="ca-more-viewsource" class="vector-more-collapsible-item mw-list-item"><a href="/index.php?title=Advanced_Format_(%D0%A0%D1%83%D1%81%D1%81%D0%BA%D0%B8%D0%B9)&amp;action=edit"><span>View source</span></a></li>
<li id="ca-more-history" class="vector-more-collapsible-item mw-list-item"><a href="/index.php?title=Advanced_Format_(%D0%A0%D1%83%D1%81%D1%81%D0%BA%D0%B8%D0%B9)&amp;action=history"><span>View history</span></a></li>
</ul>
		
	</div>
</div>

						</div>
					</div>
				</nav>
				<div id="bodyContent" class="vector-body" data-mw-ve-target-container>
					<div class="mw-body-subheader">
					        <div class="mw-indicators">
        </div>

					    <div id="siteSub" class="noprint">From ArchWiki</div>
					</div>
					
					
					
					<div id="mw-content-text" class="mw-body-content mw-content-ltr" lang="ru" dir="ltr">
<div class="mw-parser-output">
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Состояние перевода:</strong> На этой странице представлен перевод статьи <a href="../en/Advanced_Format.html" title="Advanced Format">Advanced Format</a>. Дата последней синхронизации: 28 мая 2023. Вы можете <a href="../ru/ArchWiki:Translation_Team.html" title="ArchWiki:Translation Team (Русский)">помочь</a> синхронизировать перевод, если в английской версии произошли <a rel="nofollow" class="external text" href="https://wiki.archlinux.org/index.php?title=Advanced_Format&amp;diff=0&amp;oldid=777432">изменения</a>.</div>
<p>Все устройства хранения данных имеют минимальную адресуемую единицу хранения информации, которую они могут использовать. Эта единица обычно называется <a href="https://en.wikipedia.org/wiki/ru:%D0%A1%D0%B5%D0%BA%D1%82%D0%BE%D1%80_%D0%B4%D0%B8%D1%81%D0%BA%D0%B0" class="extiw" title="wikipedia:ru:Сектор диска">сектором</a>, поскольку так называлась наименьшая единица на вращающихся жёстких дисках (в твердотельных накопителях используются ячейки памяти, и их наименьшая единица называется страницей). См. <a rel="nofollow" class="external autonumber" href="https://www.oo-software.com/en/docs/whitepaper/whitepaper_ssd.pdf">[1]</a>
</p>
<p>На разных накопителях используются разные размеры секторов. С 2011 года современные жёсткие диски обычно используют сектора размером 4 КиБ вместо обычных 512 байт. Твердотельные накопители иногда поддерживают несколько форматов.
</p>
<p>Разные «слои» (устройство / стековые блочные устройства / файловые системы) должны использовать один и тот же размер сектора для эффективной работы. Если размеры сектора не будут совпадать, будет выполняться преобразование из секторов файловой системы в физические сектора, что может снизить производительность.
</p>
<mw:tocplace></mw:tocplace>
<h2>
<span id=".D0.A0.D0.B0.D1.81.D1.88.D0.B8.D1.80.D0.B5.D0.BD.D0.BD.D1.8B.D0.B9_.D1.84.D0.BE.D1.80.D0.BC.D0.B0.D1.82_.D0.B6.D1.91.D1.81.D1.82.D0.BA.D0.B8.D1.85_.D0.B4.D0.B8.D1.81.D0.BA.D0.BE.D0.B2"></span><span class="mw-headline" id="Расширенный_формат_жёстких_дисков">Расширенный формат жёстких дисков</span>
</h2>
<p><a href="https://en.wikipedia.org/wiki/ru:Advanced_Format" class="extiw" title="w:ru:Advanced Format">Расширенный формат</a> - это общий термин, относящийся к любому формату сектора диска, используемому для хранения данных на магнитных дисках на <a href="https://en.wikipedia.org/wiki/ru:%D0%96%D1%91%D1%81%D1%82%D0%BA%D0%B8%D0%B9_%D0%B4%D0%B8%D1%81%D0%BA" class="extiw" title="w:ru:Жёсткий диск">жестких дисках</a>, которые используют 4 килобайтные сектора вместо традиционных 512-байтовых секторов. Основная идея использования 4096-байтовых секторов заключается в увеличении плотности битов на каждой дорожке за счет уменьшения количества пробелов, которые содержат информацию о синхронизации / DAM и ECC (Error Correction Code) между секторами данных. Старый формат дал формат эффективности 88,7%, в то время как расширенный формат приводит к эффективности формата 97,3%.
</p>
<p>Есть два типа дисков с расширенным форматом:
</p>
<ul>
<li>Диски Advanced Format, отмеченные оранжевым логотипом «AF»: внутри они используют сектора 4 КиБ, но предоставляют слой эмуляции для совместимости с операционными системами, не поддерживающими их.</li>
<li>Диски Advanced Format 4k native, отмеченные синим логотипом «4Kn»: для них требуется поддержка со стороны операционной системы (Windows 8+ или Linux 2.6.31+). Поскольку в них нет слоя трансляции, они дешевле, однако они могут быть несовместимы со старыми инструментами.</li>
</ul>
<h3>
<span id=".D0.9F.D1.80.D0.BE.D0.B2.D0.B5.D1.80.D0.BA.D0.B0_.D0.BF.D0.BE.D0.B4.D0.B4.D0.B5.D1.80.D0.B6.D0.B8.D0.B2.D0.B0.D0.B5.D0.BC.D1.8B.D1.85_.D1.80.D0.B0.D0.B7.D0.BC.D0.B5.D1.80.D0.BE.D0.B2_.D1.81.D0.B5.D0.BA.D1.82.D0.BE.D1.80.D0.B0"></span><span class="mw-headline" id="Проверка_поддерживаемых_размеров_сектора">Проверка поддерживаемых размеров сектора</span>
</h3>
<p>Размер физического и логического сектора жесткого диска <code>/dev/sd<i>X</i></code>  можно определить, прочитав следующие записи sysfs:
</p>
<pre>$ cat /sys/class/block/sd<i>X</i>/queue/physical_block_size
$ cat /sys/class/block/sd<i>X</i>/queue/logical_block_size
</pre>
<p>Диски, использующие слой трансляции (см. выше), обычно сообщают логический размер блока 512 (для обратной совместимости) и физический размер блока 4096 (что указывает на то, что это диски Advanced Format).
</p>
<p>Инструменты, которые будут сообщать о физическом секторе диска (при условии, что диск сообщит об этом правильно):
</p>
<ul>
<li>
<a href="../ru/Fdisk.html" title="Fdisk (Русский)">fdisk</a>: <pre># LC_ALL=C fdisk -l /dev/sd<i>X</i> | grep 'Sector size'</pre>
</li>
<li>
<a href="../ru/S.M.A.R.T..html#Smartmontools" title="S.M.A.R.T. (Русский)">smartmontools</a>: <pre># smartctl -a /dev/sd<i>X</i> | grep 'Sector Size'</pre>
</li>
<li>
<a href="../ru/Hdparm.html" title="Hdparm (Русский)">hdparm</a>: <pre># hdparm -I /dev/sd<i>X</i> | grep 'Sector size:'</pre>
</li>
</ul>
<p>Обратите внимание, что оба они работают даже для USB-подключенных дисков (если USB-мост поддерживает SAT aka SCSI/ATA Translation, ANSI INCITS 431-2007).
</p>
<h2>
<span id=".D0.A2.D0.B2.D0.B5.D1.80.D0.B4.D0.BE.D1.82.D0.B5.D0.BB.D1.8C.D0.BD.D1.8B.D0.B5_.D0.BD.D0.B0.D0.BA.D0.BE.D0.BF.D0.B8.D1.82.D0.B5.D0.BB.D0.B8"></span><span class="mw-headline" id="Твердотельные_накопители">Твердотельные накопители</span>
</h2>
<p>Большинство <a href="../ru/Solid_state_drive.html" title="Solid state drive (Русский)">твердотельных накопителей</a> (SSD) сообщают системе размер сектора 512 байт, хотя в них используются сектора большего размера — обычно 4 или 8 КиБ, а иногда даже больше. Из-за этого файловые системы не могут автоматически оптимизироваться под родной для накопителя размер сектора. Чтобы избежать потерь производительности, можно:
</p>
<ul>
<li>
<a href="#%D0%A4%D0%B0%D0%B9%D0%BB%D0%BE%D0%B2%D1%8B%D0%B5_%D1%81%D0%B8%D1%81%D1%82%D0%B5%D0%BC%D1%8B">вручную указать</a> размер сектора при создании файловой системы;</li>
<li>или <a href="#%D0%A3%D1%81%D1%82%D0%B0%D0%BD%D0%BE%D0%B2%D0%BA%D0%B0_%D1%80%D0%B0%D0%B7%D0%BC%D0%B5%D1%80%D0%B0_%D1%81%D0%B5%D0%BA%D1%82%D0%BE%D1%80%D0%B0_%D1%83%D1%81%D1%82%D1%80%D0%BE%D0%B9%D1%81%D1%82%D0%B2%D0%B0">изменить</a> размер сектора, сообщаемый накопителем.</li>
</ul>
<h3>
<span id=".D0.9F.D1.80.D0.BE.D1.81.D0.BC.D0.BE.D1.82.D1.80_.D1.80.D0.B0.D0.B7.D0.BC.D0.B5.D1.80.D0.BE.D0.B2_.D1.81.D0.B5.D0.BA.D1.82.D0.BE.D1.80.D0.B0.2C_.D0.BF.D0.BE.D0.B4.D0.B4.D0.B5.D1.80.D0.B6.D0.B8.D0.B2.D0.B0.D0.B5.D0.BC.D1.8B.D1.85_NVMe-.D0.BD.D0.B0.D0.BA.D0.BE.D0.BF.D0.B8.D1.82.D0.B5.D0.BB.D0.B5.D0.BC"></span><span class="mw-headline" id="Просмотр_размеров_сектора,_поддерживаемых_NVMe-накопителем">Просмотр размеров сектора, поддерживаемых NVMe-накопителем</span>
</h3>
<p>Используйте <a href="../ru/S.M.A.R.T..html#Smartmontools" title="S.M.A.R.T. (Русский)">smartmontools</a>:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;"># smartctl -a <i>устройство</i></pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">...
Supported LBA Sizes (NSID 0x1)
Id Fmt  Data  Metadt  Rel_Perf
 0 +     512       0         2
 1 -    4096       0         1
...
</pre>
<h3>
<span id=".D0.A3.D1.81.D1.82.D0.B0.D0.BD.D0.BE.D0.B2.D0.BA.D0.B0_.D1.80.D0.B0.D0.B7.D0.BC.D0.B5.D1.80.D0.B0_.D1.81.D0.B5.D0.BA.D1.82.D0.BE.D1.80.D0.B0_.D1.83.D1.81.D1.82.D1.80.D0.BE.D0.B9.D1.81.D1.82.D0.B2.D0.B0"></span><span class="mw-headline" id="Установка_размера_сектора_устройства">Установка размера сектора устройства</span>
</h3>
<p>Некоторые SSD позволяют изменить размер сектора во время форматирования, что позволит использовать значение, более близкое к реальному размеру сектора.
</p>
<h4><span class="mw-headline" id="NVMe">NVMe</span></h4>
<p>Чтобы проверить, поддерживает ли устройство <a href="../en/Solid_state_drive/NVMe.html" class="mw-redirect" title="NVMe">NVMe</a> эту функцию, используйте команду <i>Identify Namespace</i>.
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;"># nvme id-ns -H /dev/nvme0n1 | grep "Relative Performance"</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">LBA Format  0 : Metadata Size: 0   bytes - Data Size: 512 bytes - Relative Performance: 0x2 Good (in use)
LBA Format  1 : Metadata Size: 0   bytes - Data Size: 4096 bytes - Relative Performance: 0x1 Better
</pre>
<ul>
<li>
<code>Metadata Size</code> — это (вероятно) количество дополнительных байт метаданных на сектор, и это не очень хорошо поддерживается в Linux, поэтому лучше выбрать формат со значением 0.</li>
<li>
<code>Relative Performance</code> — указывает, какой формат обеспечит хорошую (<i>good</i>), получше (<i>better</i>) или наилучшую (<i>best</i>) производительность.</li>
</ul>
<p>Для изменения размера сектора выполните <code>nvme format</code> с указанием предпочтительного значения в параметре <code>--lbaf</code>:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;"># nvme format --lbaf=1 /dev/nvme0n1</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">You are about to format nvme0n1, namespace 0x1.
WARNING: Format may irrevocably delete this device's data.
You have 10 seconds to press Ctrl-C to cancel this operation.

Use the force [--force] option to suppress this warning.
Sending format operation ...
Success formatting namespace:1</pre>
<p>Это должно занять всего несколько секунд.
</p>
<p>Если <code>nvme format</code> не работает, попробуйте перевести машину в ждущий режим (например, с помощью <code>systemctl suspend</code>), а после пробуждения выполнить <code>nvme format</code> ещё раз. Если <code>nvme format</code> по-прежнему не работает, возможно, поможет изменение настроек BIOS.
</p>
<h4><span class="mw-headline" id="SATA">SATA</span></h4>
<p>Для устройств SATA нужно использовать программы, предоставляемые производителем. Не все устройства SATA поддерживают изменение размера сектора.
</p>
<h5><span class="mw-headline" id="Intel">Intel</span></h5>
<p>Для Intel используйте <a rel="nofollow" class="external text" href="https://downloadcenter.intel.com/download/29337/Intel-Memory-and-Storage-Tool-CLI-Command-Line-Interface-?product=83425">Intel Memory and Storage (MAS) Tool</a> (<span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/intel-mas-cli-tool/">intel-mas-cli-tool</a></span><sup><small>AUR</small></sup>) с опцией <code>-set PhysicalSectorSize=4096</code>.
</p>
<h5><span class="mw-headline" id="Seagate">Seagate</span></h5>
<p>Для Seagate используйте <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/seagate-seachest/">seagate-seachest</a></span><sup><small>AUR</small></sup>.
</p>
<p>Просканируйте все диски, чтобы найти нужный, и выведите информацию о нём:
</p>
<pre># SeaChest_Basics --scan
# SeaChest_Basics -d /dev/sg<i>X</i> -i
</pre>
<p>Проверьте серийный номер.
</p>
<p>Проверьте размеры логических блоков, поддерживаемые диском:
</p>
<pre># SeaChest_Format -d /dev/sg<i>X</i> --showSupportedFormats
</pre>
<p>Если в списке есть 4096, вы можете изменить размер логического сектора на него следующим образом:
</p>
<pre># SeaChest_Format -d /dev/sg<i>X</i> --setSectorSize=4096 --confirm this-will-erase-data
</pre>
<p>Это займёт несколько минут, после чего ваш диск будет использовать размер сектора 4K.
</p>
<h2>
<span id=".D0.92.D1.8B.D1.80.D0.B0.D0.B2.D0.BD.D0.B8.D0.B2.D0.B0.D0.BD.D0.B8.D0.B5_.D1.80.D0.B0.D0.B7.D0.B4.D0.B5.D0.BB.D0.BE.D0.B2"></span><span class="mw-headline" id="Выравнивание_разделов">Выравнивание разделов</span>
</h2>
<p>Правильное выравнивание разделов позволяет избежать лишних циклов read-modify-write. Типичной практикой для персональных компьютеров является выравнивание начала и размера каждого раздела по числам, кратным 1 МиБ (1 048 576 байт). Это значение очень удобно, так как делится на все часто используемые размеры страницы и блока — 1 МиБ, 512 КиБ, 128 КиБ, 4 КиБ и 512 байт.
</p>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Важно:</strong> Невыровненные разделы помешают использовать размер сектора 4096 байт с dm-crypt/LUKS. <a rel="nofollow" class="external autonumber" href="https://lore.kernel.org/dm-crypt/fe8cd3b4-6d50-66d3-375c-254e278a6443@gmail.com/">[2]</a>
</div>
<ul>
<li>
<a href="../ru/Fdisk.html" title="Fdisk (Русский)">fdisk, cfdisk и sfdisk</a> выполняют выравнивание автоматически.</li>
<li>
<a href="../ru/GPT_fdisk.html" title="GPT fdisk (Русский)">gdisk и cgdisk</a> выполняют выравнивание автоматически.
<ul><li>
<i>sgdisk</i> по умолчанию выравнивает только начала разделов. Используйте опцию <code>-I</code>/<code>--align-end</code> для выравнивания размеров разделов.</li></ul>
</li>
<li>
<a href="../ru/Parted.html#%D0%92%D1%8B%D1%80%D0%B0%D0%B2%D0%BD%D0%B8%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5" title="Parted (Русский)">Parted</a> выравнивает только начало раздела, но не размер. При создании разделов обязательно указывайте конец раздела в мебибайтах или более крупной двоичной единице МЭК.</li>
</ul>
<h2><span class="mw-headline" id="dm-crypt">dm-crypt</span></h2>
<p>В <a href="../en/Dm-crypt/Device_encryption.html#Cryptsetup_usage" class="mw-redirect" title="Cryptsetup">Cryptsetup</a> 2.4.0 <code>luksFormat</code> автоматически определяет оптимальный размер сектора шифрования для формата LUKS2 <a rel="nofollow" class="external autonumber" href="https://mirrors.edge.kernel.org/pub/linux/utils/cryptsetup/v2.4/v2.4.0-ReleaseNotes">[3]</a>.
</p>
<p>Однако, чтобы это работало, устройство должно сообщать правильный размер сектора по умолчанию; смотрите раздел <a href="#%D0%A3%D1%81%D1%82%D0%B0%D0%BD%D0%BE%D0%B2%D0%BA%D0%B0_%D1%80%D0%B0%D0%B7%D0%BC%D0%B5%D1%80%D0%B0_%D1%81%D0%B5%D0%BA%D1%82%D0%BE%D1%80%D0%B0_%D1%83%D1%81%D1%82%D1%80%D0%BE%D0%B9%D1%81%D1%82%D0%B2%D0%B0">#Установка размера сектора устройства</a>.
</p>
<p>После использования <code>cryptsetup luksFormat</code> вы можете проверить размер сектора, используемого томом LUKS2, с помощью команды
</p>
<pre># cryptsetup luksDump <i>устройство</i> | grep sector
</pre>
<p>Если размер сектора оказался неверный, вы можете принудительно создать контейнер LUKS2, указав размер сектора 4K и оставив другие параметры со значениями по умолчанию:
</p>
<pre># cryptsetup luksFormat --sector-size=4096 <i>устройство</i>
</pre>
<p>Команда выдаст ошибку, если запрашиваемый размер не соответствует вашему устройству:
</p>
<pre># cryptsetup luksFormat --sector-size 4096 <i>устройство</i>
(...)
Verify passphrase:
Device size is not aligned to requested sector size.
</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Примечание:</strong> Смотрите <a rel="nofollow" class="external text" href="https://gitlab.com/cryptsetup/cryptsetup/-/issues/585">cryptsetup issue 585</a> о том, почему команда может не сработать, если накопитель использует физические сектора 4K.</div>
<p>Если вы уже зашифровали устройство с неправильным размером сектора, устройство можно перешифровать командой:
</p>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Важно:</strong> Находящаяся на нём файловая система должна использовать размер блока 4096 байт или кратный ему, иначе всё сломается.</div>
<pre># cryptsetup reencrypt --sector-size=4096 <i>устройство</i>
</pre>
<h2>
<span id=".D0.A4.D0.B0.D0.B9.D0.BB.D0.BE.D0.B2.D1.8B.D0.B5_.D1.81.D0.B8.D1.81.D1.82.D0.B5.D0.BC.D1.8B"></span><span class="mw-headline" id="Файловые_системы">Файловые системы</span>
</h2>
<p><span class="plainlinks archwiki-template-man" title="$ man 8 mkfs.btrfs"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/mkfs.btrfs.8">mkfs.btrfs(8)</a></span>, <span class="plainlinks archwiki-template-man" title="$ man 8 mkfs.jfs"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/mkfs.jfs.8">mkfs.jfs(8)</a></span>, <span class="plainlinks archwiki-template-man" title="$ man 8 mkfs.nilfs2"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/mkfs.nilfs2.8">mkfs.nilfs2(8)</a></span>, <span class="plainlinks archwiki-template-man" title="$ man 8 mkfs.reiserfs"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/mkfs.reiserfs.8">mkfs.reiserfs(8)</a></span> и <span class="plainlinks archwiki-template-man" title="$ man 8 mkswap"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/mkswap.8">mkswap(8)</a></span> по умолчанию используют размер сектора 4096 байт.
</p>
<p><span class="plainlinks archwiki-template-man" title="$ man 8 mkfs.ext4"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/mkfs.ext4.8">mkfs.ext4(8)</a></span> по умолчанию использует размер сектора 1024 байт для файловых систем меньше чем 512 МиБ и 4096 байт для 512 МиБ и больше.
</p>
<p><span class="plainlinks archwiki-template-man" title="$ man 8 mkfs.xfs"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/mkfs.xfs.8">mkfs.xfs(8)</a></span> по умолчанию использует размер сектора 512 байт, но будет использовать 4096 для 512e и 4Kn дисков.
</p>
<p><span class="plainlinks archwiki-template-man" title="$ man 8 mkfs.f2fs"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/mkfs.f2fs.8">mkfs.f2fs(8)</a></span>, <span class="plainlinks archwiki-template-man" title="$ man 8 mkfs.fat"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/mkfs.fat.8">mkfs.fat(8)</a></span>, <span class="plainlinks archwiki-template-man" title="$ man 8 mkfs.ntfs"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/mkfs.ntfs.8">mkfs.ntfs(8)</a></span> и <span class="plainlinks archwiki-template-man" title="$ man 8 mkfs.udf"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/mkfs.udf.8">mkfs.udf(8)</a></span> используют логический размер сектора, сообщаемый устройством — то есть 512 байт для 512e и 4096 байт для 4Kn дисков.
</p>
<p><span class="plainlinks archwiki-template-man" title="$ man 8 zpool-create">zpool-create(8)</span> (из <a href="../en/ZFS.html#Advanced_Format_disks" title="ZFS">ZFS</a>) по умолчанию использует размер сектора 512 (2⁹) байт, для использования другого размера его нужно явно указать во время создания пула с помощью параметра <code>-o ashift=12</code> (2¹², 4096 байт).
</p>
<p>Если накопитель не сообщает правильный размер сектора, можно явно указать нужный размер сектора при форматировании.
</p>
<p>В частности, для дисков с <i>черепичной магнитной записью</i> (Shingled Magnetic Recording, SMR), управляемых прошивкой, использование логического размера сектора 512 байт, если их физический размер сектора составляет 4096 байт, приводит к серьёзным негативным последствиям. Эти диски имеют зоны записи с разной производительностью, и перераспределение выполняется во время простоя, но во время активной записи (например, при ресинхронизации RAID, резервном копировании, записи множества небольших файлов, rsync и т. д.) другой размер сектора файловой системы может снизить скорость записи до единиц МиБ/с, так как более производительные зоны записи заканчиваются, а слой трансляции секторов перегружается.
</p>
<p>Примеры явной установки размера сектора 4096 байт:
</p>
<ul>
<li>
<a href="../en/Ext4.html" class="mw-redirect" title="Ext4 (Русский)">ext4</a>: <pre># mkfs.ext4 -b 4096 /dev/<i>устройство</i></pre>
</li>
<li>
<a href="../ru/XFS.html" title="XFS (Русский)">XFS</a>: <pre># mkfs.xfs -s size=4096 /dev/<i>устройство</i></pre>
</li>
<li>
<a href="../ru/FAT.html" title="FAT (Русский)">FAT</a>: <pre># mkfs.fat -S 4096 /dev/<i>устройство</i></pre>
</li>
<li>
<a href="../ru/NTFS-3G.html" title="NTFS-3G (Русский)">NTFS-3G</a>: <pre># mkfs.ntfs -Q -s 4096 /dev/<i>устройство</i></pre>
</li>
<li>UDF: <pre># mkfs.udf -b 4096 /dev/<i>устройство</i></pre>
</li>
<li>
<a href="../en/ZFS.html#Advanced_Format_disks" title="ZFS">ZFS</a>: <pre># zpool create -o ashift=12 <i>имя-пула</i> raidz <i>устройство0</i> … <i>устройствоN</i></pre>
</li>
</ul>
<h2>
<span id=".D0.A1.D0.BC.D0.BE.D1.82.D1.80.D0.B8.D1.82.D0.B5_.D1.82.D0.B0.D0.BA.D0.B6.D0.B5"></span><span class="mw-headline" id="Смотрите_также">Смотрите также</span>
</h2>
<ul>
<li><a rel="nofollow" class="external text" href="https://www.anandtech.com/Show/Index/2888">Расширенный формат Western Digital: начинается переход на сектора 4K</a></li>
<li><a rel="nofollow" class="external text" href="https://www.wdc.com/wdproducts/library/WhitePapers/ENG/2579-771430.pdf">Белая книга под названием "Advanced Format Technology."</a></li>
<li>Несоблюдение правил обращения с жестким диском приводит к ухудшению производительности чтения/записи. Смотрите <a rel="nofollow" class="external text" href="https://www.linuxconfig.org/linux-wd-ears-advanced-format">эту статью</a> для конкретных примеров.</li>
</ul>
</div>
</div>
					<div id="catlinks" class="catlinks" data-mw="interface"><div id="mw-normal-catlinks" class="mw-normal-catlinks">
<a href="../Special:Categories.html" title="Special:Categories">Category</a>: <ul><li><a href="../ru/Category:Storage.html" title="Category:Storage (Русский)">Storage (Русский)</a></li></ul>
</div></div>
				</div>
			</main>
			
		</div>
		<div class="mw-footer-container">
			
<footer id="footer" class="mw-footer" role="contentinfo" style="margin: 0">
	<ul id="footer-info">
	<li data-nosnippet="">Retrieved from "<a dir="ltr" href="https://wiki.archlinux.org/index.php?title=Advanced_Format_(%D0%A0%D1%83%D1%81%D1%81%D0%BA%D0%B8%D0%B9)&amp;oldid=779795">https://wiki.archlinux.org/index.php?title=Advanced_Format_(Русский)&amp;oldid=779795</a>"</li>
<li id="footer-info-lastmod"> This page was last edited on 28 May 2023, at 20:55.</li>
	<li id="footer-info-copyright">Content is available under <a class="external" rel="nofollow" href="https://www.gnu.org/copyleft/fdl.html">GNU Free Documentation License 1.3 or later</a> unless otherwise noted.</li>
<br>
</ul>

	<ul id="footer-places">
	<li id="footer-places-privacy"><a href="https://terms.archlinux.org/docs/privacy-policy/">Privacy policy</a></li>
	<li id="footer-places-about"><a href="../en/ArchWiki:About.html">About ArchWiki</a></li>
	<li id="footer-places-disclaimer"><a href="../en/ArchWiki:General_disclaimer.html">Disclaimers</a></li>
</ul>

	
</footer>

		</div>
	</div> 
</div> 

</body>
</html>
