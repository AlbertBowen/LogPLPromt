<!DOCTYPE html>
<html class="client-nojs" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<title>OpenLDAP - ArchWiki</title>
<link rel="stylesheet" href="../ArchWikiOffline.css">
<meta name="ResourceLoaderDynamicStyles" content="">
<meta name="generator" content="MediaWiki 1.39.4">
<meta name="referrer" content="no-referrer-when-downgrade">
<meta name="format-detection" content="telephone=no">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes, minimum-scale=0.25, maximum-scale=5.0">
<link rel="icon" href="/favicon.ico">
<link rel="search" type="application/opensearchdescription+xml" href="/opensearch_desc.php" title="ArchWiki (en)">
<link rel="EditURI" type="application/rsd+xml" href="https://wiki.archlinux.org/api.php?action=rsd">
<link rel="license" href="https://www.gnu.org/copyleft/fdl.html">
<link rel="alternate" type="application/atom+xml" title="ArchWiki Atom feed" href="/index.php?title=Special:RecentChanges&amp;feed=atom">
</head>
<body class="skin-vector skin-vector-search-vue mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-OpenLDAP rootpage-OpenLDAP skin-vector-2022 action-view skin--responsive vector-feature-language-in-header-enabled vector-feature-language-in-main-page-header-disabled vector-feature-language-alert-in-sidebar-disabled vector-feature-sticky-header-disabled vector-feature-sticky-header-edit-disabled vector-feature-table-of-contents-disabled vector-feature-visual-enhancement-next-disabled">
<div class="mw-page-container">
	<span id="top-page"></span>
	<a class="mw-jump-link" href="#content">Jump to content</a>
	<div class="mw-page-container-inner">
		<input type="checkbox" id="mw-sidebar-checkbox" class="mw-checkbox-hack-checkbox">
		<div class="vector-sidebar-container ">
			</div>
		<div class="vector-sitenotice-container">
			<div id="siteNotice"></div>
		</div>
		<input type="checkbox" id="vector-toc-collapsed-checkbox" class="mw-checkbox-hack-checkbox">
		<div class="mw-table-of-contents-container">
			<div class="vector-sticky-toc-container mw-sticky-header-element">
				<nav id="mw-panel-toc" class="sidebar-toc" role="navigation" aria-labelledby="sidebar-toc-label" data-event-name="ui.sidebar-toc">
	<div id="sidebar-toc-label" class="sidebar-toc-header">
		<p class="sidebar-toc-title">
		Contents
		<button class="vector-toc-uncollapse-button">move to sidebar</button>
		<button class="vector-toc-collapse-button">hide</button>
		</p>
	</div>
	<ul class="sidebar-toc-contents" id="mw-panel-toc-list">
		<li id="toc-mw-content-text" class="sidebar-toc-list-item sidebar-toc-level-1">
			<a href="#top-page" class="sidebar-toc-link">
				<div class="sidebar-toc-text">Beginning</div>
			</a>
		</li>
		<li id="toc-Installation" class="sidebar-toc-list-item sidebar-toc-level-1">
			<a class="sidebar-toc-link" href="#Installation">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">1</span>Installation</div>
			</a>
			
			<ul id="toc-Installation-sublist" class="sidebar-toc-list">
			</ul>
		</li>
		<li id="toc-Configuration" class="sidebar-toc-list-item sidebar-toc-level-1">
			<a class="sidebar-toc-link" href="#Configuration">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">2</span>Configuration</div>
			</a>
			
				<button aria-controls="toc-Configuration-sublist" class="mw-ui-icon mw-ui-icon-wikimedia-expand mw-ui-icon-small sidebar-toc-toggle">
					Toggle Configuration subsection
				</button>
			
			<ul id="toc-Configuration-sublist" class="sidebar-toc-list">
				<li id="toc-The_server" class="sidebar-toc-list-item sidebar-toc-level-2">
			<a class="sidebar-toc-link" href="#The_server">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">2.1</span>The server</div>
			</a>
			
			<ul id="toc-The_server-sublist" class="sidebar-toc-list">
			</ul>
		</li>
		<li id="toc-The_client" class="sidebar-toc-list-item sidebar-toc-level-2">
			<a class="sidebar-toc-link" href="#The_client">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">2.2</span>The client</div>
			</a>
			
			<ul id="toc-The_client-sublist" class="sidebar-toc-list">
			</ul>
		</li>
		<li id="toc-Create_initial_entry" class="sidebar-toc-list-item sidebar-toc-level-2">
			<a class="sidebar-toc-link" href="#Create_initial_entry">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">2.3</span>Create initial entry</div>
			</a>
			
			<ul id="toc-Create_initial_entry-sublist" class="sidebar-toc-list">
			</ul>
		</li>
		<li id="toc-Test_your_new_OpenLDAP_installation" class="sidebar-toc-list-item sidebar-toc-level-2">
			<a class="sidebar-toc-link" href="#Test_your_new_OpenLDAP_installation">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">2.4</span>Test your new OpenLDAP installation</div>
			</a>
			
			<ul id="toc-Test_your_new_OpenLDAP_installation-sublist" class="sidebar-toc-list">
			</ul>
		</li>
		<li id="toc-OpenLDAP_over_TLS" class="sidebar-toc-list-item sidebar-toc-level-2">
			<a class="sidebar-toc-link" href="#OpenLDAP_over_TLS">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">2.5</span>OpenLDAP over TLS</div>
			</a>
			
			<ul id="toc-OpenLDAP_over_TLS-sublist" class="sidebar-toc-list">
				<li id="toc-Create_a_self-signed_certificate" class="sidebar-toc-list-item sidebar-toc-level-3">
			<a class="sidebar-toc-link" href="#Create_a_self-signed_certificate">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">2.5.1</span>Create a self-signed certificate</div>
			</a>
			
			<ul id="toc-Create_a_self-signed_certificate-sublist" class="sidebar-toc-list">
			</ul>
		</li>
		<li id="toc-Configure_slapd_for_SSL" class="sidebar-toc-list-item sidebar-toc-level-3">
			<a class="sidebar-toc-link" href="#Configure_slapd_for_SSL">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">2.5.2</span>Configure slapd for SSL</div>
			</a>
			
			<ul id="toc-Configure_slapd_for_SSL-sublist" class="sidebar-toc-list">
			</ul>
		</li>
		<li id="toc-Start_slapd_with_SSL" class="sidebar-toc-list-item sidebar-toc-level-3">
			<a class="sidebar-toc-link" href="#Start_slapd_with_SSL">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">2.5.3</span>Start slapd with SSL</div>
			</a>
			
			<ul id="toc-Start_slapd_with_SSL-sublist" class="sidebar-toc-list">
			</ul>
		</li>
	</ul>
		</li>
	</ul>
		</li>
		<li id="toc-Next_steps" class="sidebar-toc-list-item sidebar-toc-level-1">
			<a class="sidebar-toc-link" href="#Next_steps">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">3</span>Next steps</div>
			</a>
			
				<button aria-controls="toc-Next_steps-sublist" class="mw-ui-icon mw-ui-icon-wikimedia-expand mw-ui-icon-small sidebar-toc-toggle">
					Toggle Next steps subsection
				</button>
			
			<ul id="toc-Next_steps-sublist" class="sidebar-toc-list">
				<li id="toc-Backup_LDAP" class="sidebar-toc-list-item sidebar-toc-level-2">
			<a class="sidebar-toc-link" href="#Backup_LDAP">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">3.1</span>Backup LDAP</div>
			</a>
			
			<ul id="toc-Backup_LDAP-sublist" class="sidebar-toc-list">
				<li id="toc-Export_configuration" class="sidebar-toc-list-item sidebar-toc-level-3">
			<a class="sidebar-toc-link" href="#Export_configuration">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">3.1.1</span>Export configuration</div>
			</a>
			
			<ul id="toc-Export_configuration-sublist" class="sidebar-toc-list">
			</ul>
		</li>
		<li id="toc-Export_database" class="sidebar-toc-list-item sidebar-toc-level-3">
			<a class="sidebar-toc-link" href="#Export_database">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">3.1.2</span>Export database</div>
			</a>
			
			<ul id="toc-Export_database-sublist" class="sidebar-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id="toc-Restore_LDAP" class="sidebar-toc-list-item sidebar-toc-level-2">
			<a class="sidebar-toc-link" href="#Restore_LDAP">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">3.2</span>Restore LDAP</div>
			</a>
			
			<ul id="toc-Restore_LDAP-sublist" class="sidebar-toc-list">
				<li id="toc-Import_configuration" class="sidebar-toc-list-item sidebar-toc-level-3">
			<a class="sidebar-toc-link" href="#Import_configuration">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">3.2.1</span>Import configuration</div>
			</a>
			
			<ul id="toc-Import_configuration-sublist" class="sidebar-toc-list">
			</ul>
		</li>
		<li id="toc-Import_database" class="sidebar-toc-list-item sidebar-toc-level-3">
			<a class="sidebar-toc-link" href="#Import_database">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">3.2.2</span>Import database</div>
			</a>
			
			<ul id="toc-Import_database-sublist" class="sidebar-toc-list">
			</ul>
		</li>
	</ul>
		</li>
	</ul>
		</li>
		<li id="toc-Troubleshooting" class="sidebar-toc-list-item sidebar-toc-level-1">
			<a class="sidebar-toc-link" href="#Troubleshooting">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">4</span>Troubleshooting</div>
			</a>
			
				<button aria-controls="toc-Troubleshooting-sublist" class="mw-ui-icon mw-ui-icon-wikimedia-expand mw-ui-icon-small sidebar-toc-toggle">
					Toggle Troubleshooting subsection
				</button>
			
			<ul id="toc-Troubleshooting-sublist" class="sidebar-toc-list">
				<li id="toc-slapd_configuration_checking" class="sidebar-toc-list-item sidebar-toc-level-2">
			<a class="sidebar-toc-link" href="#slapd_configuration_checking">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">4.1</span>slapd configuration checking</div>
			</a>
			
			<ul id="toc-slapd_configuration_checking-sublist" class="sidebar-toc-list">
			</ul>
		</li>
		<li id="toc-Client_authentication_checking" class="sidebar-toc-list-item sidebar-toc-level-2">
			<a class="sidebar-toc-link" href="#Client_authentication_checking">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">4.2</span>Client authentication checking</div>
			</a>
			
			<ul id="toc-Client_authentication_checking-sublist" class="sidebar-toc-list">
			</ul>
		</li>
		<li id="toc-LDAP_server_stops_suddenly" class="sidebar-toc-list-item sidebar-toc-level-2">
			<a class="sidebar-toc-link" href="#LDAP_server_stops_suddenly">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">4.3</span>LDAP server stops suddenly</div>
			</a>
			
			<ul id="toc-LDAP_server_stops_suddenly-sublist" class="sidebar-toc-list">
			</ul>
		</li>
		<li id="toc-LDAP_server_does_not_start" class="sidebar-toc-list-item sidebar-toc-level-2">
			<a class="sidebar-toc-link" href="#LDAP_server_does_not_start">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">4.4</span>LDAP server does not start</div>
			</a>
			
			<ul id="toc-LDAP_server_does_not_start-sublist" class="sidebar-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id="toc-See_also" class="sidebar-toc-list-item sidebar-toc-level-1">
			<a class="sidebar-toc-link" href="#See_also">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">5</span>See also</div>
			</a>
			
			<ul id="toc-See_also-sublist" class="sidebar-toc-list">
			</ul>
		</li>
	</ul>
</nav>

			</div>
		</div>
		<div class="mw-content-container">
			<main id="content" class="mw-body" role="main" style="margin: 0">
				<a id="top"></a>
				<nav class="vector-article-toolbar" aria-label="Tools" role="navigation">
					<div class="mw-article-toolbar-container">
						<div id="left-navigation">
							

<div id="p-associated-pages" class="vector-menu mw-portlet mw-portlet-associated-pages vector-menu-tabs">
	<div class="vector-menu-content">
		
		<ul class="vector-menu-content-list">
<li id="ca-nstab-main" class="selected mw-list-item"><a href="../en/OpenLDAP.html" title="View the content page [c]" accesskey="c"><span>Page</span></a></li>
<li id="ca-talk" class="mw-list-item"><a href="../en/Talk:OpenLDAP.html" rel="discussion" title="Discussion about the content page [t]" accesskey="t"><span>Discussion</span></a></li>
</ul>
		
	</div>
</div>

							

<div id="p-variants" class="vector-menu mw-portlet mw-portlet-variants emptyPortlet vector-menu-dropdown">
	<input type="checkbox" id="p-variants-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-p-variants" class="vector-menu-checkbox" aria-label="Change language variant">
	<label id="p-variants-label" for="p-variants-checkbox" class="vector-menu-heading ">
		<span class="vector-menu-heading-label">English</span>
	</label>
	<div class="vector-menu-content">
		
		<ul class="vector-menu-content-list"></ul>
		
	</div>
</div>

						</div>
						<div id="right-navigation" class="vector-collapsible ">
							

<div id="p-views" class="vector-menu mw-portlet mw-portlet-views vector-menu-tabs">
	<div class="vector-menu-content">
		
		<ul class="vector-menu-content-list">
<li id="ca-view" class="selected mw-list-item"><a href="../en/OpenLDAP.html"><span>Read</span></a></li>
<li id="ca-viewsource" class="mw-list-item"><a href="/index.php?title=OpenLDAP&amp;action=edit" title="This page is protected.
You can view its source [e]" accesskey="e"><span>View source</span></a></li>
<li id="ca-history" class="mw-list-item"><a href="/index.php?title=OpenLDAP&amp;action=history" title="Past revisions of this page [h]" accesskey="h"><span>View history</span></a></li>
</ul>
		
	</div>
</div>

							

<div id="p-cactions" class="vector-menu mw-portlet mw-portlet-cactions emptyPortlet vector-menu-dropdown vector-has-collapsible-items" title="More options">
	<input type="checkbox" id="p-cactions-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-p-cactions" class="vector-menu-checkbox">
	<label id="p-cactions-label" for="p-cactions-checkbox" class="vector-menu-heading ">
		<span class="vector-menu-heading-label">More</span>
	</label>
	<div class="vector-menu-content">
		
		<ul class="vector-menu-content-list">
<li id="ca-more-view" class="selected vector-more-collapsible-item mw-list-item"><a href="../en/OpenLDAP.html"><span>Read</span></a></li>
<li id="ca-more-viewsource" class="vector-more-collapsible-item mw-list-item"><a href="/index.php?title=OpenLDAP&amp;action=edit"><span>View source</span></a></li>
<li id="ca-more-history" class="vector-more-collapsible-item mw-list-item"><a href="/index.php?title=OpenLDAP&amp;action=history"><span>View history</span></a></li>
</ul>
		
	</div>
</div>

						</div>
					</div>
				</nav>
				<div id="bodyContent" class="vector-body" data-mw-ve-target-container>
					<div class="mw-body-subheader">
					        <div class="mw-indicators">
        </div>

					    <div id="siteSub" class="noprint">From ArchWiki</div>
					</div>
					
					
					
					<div id="mw-content-text" class="mw-body-content mw-content-ltr" lang="en" dir="ltr">
<div class="mw-parser-output">
<div class="archwiki-template-meta-related-articles-start">
<p class="mw-no-invert">Related articles</p>
<ul>
<li><a href="../en/LDAP_authentication.html" title="LDAP authentication">LDAP authentication</a></li>
<li><a href="../en/LDAP_Hosts.html" title="LDAP Hosts">LDAP Hosts</a></li>
</ul>
</div>
<p><a rel="nofollow" class="external text" href="https://www.openldap.org/">OpenLDAP</a> is an open-source implementation of the LDAP protocol. An LDAP server basically is a non-relational database which is optimised for accessing, but not writing, data. It is mainly used as an address book (for e.g. email clients) or authentication backend to various services (such as Samba, where it is used to emulate a domain controller, or <a href="../en/LDAP_authentication.html" title="LDAP authentication">Linux system authentication</a>, where it replaces <code>/etc/passwd</code>) and basically holds the user data.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> Commands related to OpenLDAP that begin with <code>ldap</code> (like <code>ldapsearch</code>) are client-side utilities, while commands that begin with <code>slap</code> (like <code>slapcat</code>) are server-side.</div>
<p>This page is a starting point for a basic OpenLDAP installation and a sanity check.
</p>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip:</strong> Directory services are an enormous topic. Configuration can therefore be complex. If you are totally new to those concepts, <a rel="nofollow" class="external text" href="https://www.brennan.id.au/20-Shared_Address_Book_LDAP.html">this</a> is a good introduction that is easy to understand and that will get you started, even if you are new to LDAP.</div>
<mw:tocplace></mw:tocplace>
<h2><span class="mw-headline" id="Installation">Installation</span></h2>
<p>OpenLDAP contains both a LDAP server and client. <a href="../en/Help:Reading.html#Installation_of_packages" class="mw-redirect" title="Install">Install</a> it with the package <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=openldap">openldap</a></span>.
</p>
<h2><span class="mw-headline" id="Configuration">Configuration</span></h2>
<h3><span class="mw-headline" id="The_server">The server</span></h3>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> 
<ul><li>If you have an obsolete <code>slapd.conf</code> configuration, you can simply convert it into the new <code>cn=config</code> database using</li></ul>
<pre>$ slaptest -f /etc/openldap/slapd.conf -F /etc/openldap/slapd.d/
</pre>
<ul><li>If you already have an OpenLDAP database on your machine and would like to remove it, then it can be removed by deleting everything inside of <code>/var/lib/openldap/openldap-data/</code>. So, backup your <code>DB_CONFIG</code>.</li></ul>
</div>
<p>Slapd, the server, stores its configuration directly inside its database. Thus, we need to write our configuration as an LDIF file and import it.
</p>
<p>First, create the directory <code>/var/lib/openldap/openldap-data/</code>, where your database will be stored:
</p>
<pre># install -m 0700 -o ldap -g ldap -d /var/lib/openldap/openldap-data/
</pre>
<p>Then, create a file <code>/etc/openldap/config.ldif</code> containing the following minimal sane configuration:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/openldap/config.ldif</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;"># The root config entry
dn: cn=config
objectClass: olcGlobal
cn: config
olcArgsFile: /run/openldap/slapd.args
olcPidFile: /run/openldap/slapd.pid

# Schemas
dn: cn=schema,cn=config
objectClass: olcSchemaConfig
cn: schema

# TODO: Include further schemas as necessary
include: file:///etc/openldap/schema/core.ldif

# The config database
dn: olcDatabase=config,cn=config
objectClass: olcDatabaseConfig
olcDatabase: config
olcRootDN: cn=Manager,<b>$BASEDN</b>

# The database for our entries
dn: olcDatabase=mdb,cn=config
objectClass: olcDatabaseConfig
objectClass: olcMdbConfig
olcDatabase: mdb
olcSuffix: <b>$BASEDN</b>
olcRootDN: cn=Manager,<b>$BASEDN</b>
olcRootPW: <b>$PASSWD</b>
olcDbDirectory: /var/lib/openldap/openldap-data
# TODO: Create further indexes
olcDbIndex: objectClass eq</pre>
<p>There are a few options you will need to change:
</p>
<ul>
<li>Every occurence of <code>$BASEDN</code> must be replaced with a valid DN. If you own a domain <code>example.com</code> you will most likely want to choose <code>dc=example,dc=com</code>.</li>
<li>
<code>$PASSWD</code> must be replaced by a salted and hashed password, which you may generate by running <code>slappasswd</code>.</li>
</ul>
<p>Additionally, you might consider to add further <a rel="nofollow" class="external text" href="https://www.openldap.org/doc/admin24/schema.html">schemas</a> and create additional <a rel="nofollow" class="external text" href="https://www.openldap.org/doc/admin24/tuning.html#Indexes">indexes</a> to tune the performance of your database. The specifics will depend on your use case, but here are a few recommendations. For <a href="../en/LDAP_authentication.html" title="LDAP authentication">LDAP authentication</a>, you should include the three schemas below to be able to use the <code>posixAccount</code> object class used for storing users.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> Additional indexes must be part of the preceeding block. Newlines will result in a corrupted configuration file</div>
<pre># TODO: Create further indexes
olcDbIndex: objectClass eq
olcDbIndex: uid pres,eq
olcDbIndex: mail pres,sub,eq
olcDbIndex: cn,sn pres,sub,eq
olcDbIndex: dc eq

# Additional schemas
# RFC1274: Cosine and Internet X.500 schema
include: file:///etc/openldap/schema/cosine.ldif
# RFC2307: An Approach for Using LDAP as a Network Information Service
# Check RFC2307bis for nested groups and an auxiliary posixGroup objectClass (way easier)
include: file:///etc/openldap/schema/nis.ldif
# RFC2798: Internet Organizational Person
include: file:///etc/openldap/schema/inetorgperson.ldif</pre>
<p>To import these settings as the <code>ldap</code> user using <a href="../en/Sudo.html" title="Sudo">sudo</a>:
</p>
<pre># sudo -u ldap slapadd -n 0 -F /etc/openldap/slapd.d/ -l /etc/openldap/config.ldif
</pre>
<p>Alternatively, you may also run this directly as <code>root</code>. However, if you do, make sure <code>/etc/openldap/slapd.d/</code> is accessible by <code>ldap</code>:
</p>
<pre># slapadd -n 0 -F /etc/openldap/slapd.d/ -l /etc/openldap/config.ldif
# chown -R ldap:ldap /etc/openldap/*
</pre>
<p>By default, OpenLDAP will listen unencrypted on all interfaces. To make it only listen on local IP interfaces, you may edit the environment file read by <code>slapd.service</code>:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/conf.d/slapd</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">SLAPD_URLS="ldap://127.0.0.1/ ldap://[::1]"
SLAPD_OPTIONS=</pre>
<p>Finally, start the <i>slapd</i> daemon by <a href="../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Start">starting</a> <code>slapd.service</code>.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> 
<ul>
<li>If you want to have your directory accept requests from the network, you should consider using TLS. See <a href="#OpenLDAP_over_TLS">#OpenLDAP over TLS</a> for details.</li>
<li>If you plan to use your LDAP server for authentication, you might want to check access control configuration in <a href="../en/LDAP_authentication.html#LDAP_server_setup" title="LDAP authentication">LDAP authentication#LDAP server setup</a>.</li>
<li>Berkeley DB (BDB) should no longer be used. The mdb backend to <span class="plainlinks archwiki-template-man" title="$ man 8 slapd"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/slapd.8">slapd(8)</a></span> is the recommended primary backend for a normal <i>slapd</i> database. It uses OpenLDAP's own Lightning Memory-Mapped Database (LMDB) library to store data and is intended to replace the Berkeley DB backend. The OpenLDAP package in the <a href="../en/Official_repositories.html" title="Official repositories">official repositories</a> defaults to mdb.</li>
</ul>
</div>
<h3><span class="mw-headline" id="The_client">The client</span></h3>
<p>The client configuration file is located at <code>/etc/openldap/ldap.conf</code>.
</p>
<p>It is quite simple: you will only have to alter <code>BASE</code> to reflect the suffix of the server, and <code>URI</code> to reflect the address of the server, like:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/openldap/ldap.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">BASE            dc=example,dc=com
URI             ldap://localhost</pre>
<p>If you decide to use SSL:
</p>
<ul>
<li>The protocol (ldap or ldaps) in the <code>URI</code> entry has to conform with the slapd configuration</li>
<li>If you decide to use TLS, add a <code>TLS_REQCERT allow</code> line to <code>ldap.conf</code>
</li>
<li>If you use a signed certificate from a CA, add the line <code>TLS_CACERTDIR   /usr/share/ca-certificates/trust-source</code> in <code>ldap.conf</code>.</li>
</ul>
<h3><span class="mw-headline" id="Create_initial_entry">Create initial entry</span></h3>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> If you plan to use your LDAP server for authentication, you should import the <code>base.ldif</code> in the <a href="../en/LDAP_authentication.html#Populate_LDAP_tree_with_base_data" title="LDAP authentication">LDAP authentication</a> article instead of following the instructions here.</div>
<p>Once your client is configured, you probably want to create the root entry, and an entry for the Manager role:
</p>
<pre>$ ldapadd -x -D 'cn=Manager,dc=example,dc=com' -W
dn: dc=example,dc=com
objectClass: dcObject
objectClass: organization
dc: example
o: Example
description: Example directory

dn: cn=Manager,dc=example,dc=com
objectClass: organizationalRole
cn: Manager
description: Directory Manager
^D</pre>
<p>The text after the first line is entered on stdin, or could be read from a file either with the <code>-f</code> option or a file redirect.
</p>
<h3><span class="mw-headline" id="Test_your_new_OpenLDAP_installation">Test your new OpenLDAP installation</span></h3>
<p>This is easy, just run the command below:
</p>
<pre>$ ldapsearch -x '(objectclass=*)' -b 'dc=example,dc=com'
</pre>
<p>Or authenticating as the rootdn (replacing <code>-x</code> by <code>-D <i>user</i> -W</code>), using the example configuration we had above:
</p>
<pre>$ ldapsearch -D "cn=Manager,dc=example,dc=com" -W '(objectclass=*)' -b 'dc=example,dc=com'
</pre>
<p>Now you should see some information about your database.
</p>
<h3><span class="mw-headline" id="OpenLDAP_over_TLS">OpenLDAP over TLS</span></h3>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> <a rel="nofollow" class="external text" href="https://www.openldap.org/doc/">upstream documentation</a> is much more useful/complete than this section</div>
<p>If you access the OpenLDAP server over the network and especially if you have sensitive data stored on the server you run the risk of someone sniffing your data which is sent clear-text. The next part will guide you on how to setup an SSL connection between the LDAP server and the client so the data will be sent encrypted.
</p>
<p>In order to use TLS, you must have a certificate. For testing purposes, a <i>self-signed</i> certificate will suffice. To learn more about certificates, see <a href="../en/OpenSSL.html" title="OpenSSL">OpenSSL</a>.
</p>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Warning:</strong> OpenLDAP cannot use a certificate that has a password associated to it.</div>
<h4><span class="mw-headline" id="Create_a_self-signed_certificate">Create a self-signed certificate</span></h4>
<p>To create a <i>self-signed</i> certificate, type the following:
</p>
<pre>$ openssl req -new -x509 -nodes -out slapdcert.pem -keyout slapdkey.pem -days 365
</pre>
<p>You will be prompted for information about your LDAP server. Much of the information can be left blank. The most important information is the common name. This must be set to the DNS name of your LDAP server. If your LDAP server's IP address resolves to example.org but its server certificate shows a CN of bad.example.org, LDAP clients will reject the certificate and will be unable to negotiate TLS connections (apparently the results are wholly unpredictable).
</p>
<p>Now that the certificate files have been created copy them to <code>/etc/openldap/ssl/</code> (create this directory if it does not exist) and secure them. <code>slapdcert.pem</code> must be world readable because it contains the public key. <code>slapdkey.pem</code> on the other hand should only be readable for the ldap user for security reasons:
</p>
<pre># mv slapdcert.pem slapdkey.pem /etc/openldap/ssl/
# chmod -R 755 /etc/openldap/ssl/
# chmod 400 /etc/openldap/ssl/slapdkey.pem
# chmod 444 /etc/openldap/ssl/slapdcert.pem
# chown ldap /etc/openldap/ssl/slapdkey.pem
</pre>
<h4><span class="mw-headline" id="Configure_slapd_for_SSL">Configure slapd for SSL</span></h4>
<p>Edit the configuration to tell LDAP where the certificate files reside by executing the following command:
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> The latest version of OpenLDAP (2.4.45) uses OpenSSL and <u>not</u> GnuTLS. This means that current versions of OpenLDAP <b>do</b> in fact know how to handle the <a rel="nofollow" class="external text" href="https://www.openssl.org/docs/man1.1.1/man1/ciphers.html#CIPHER-STRINGS">DEFAULT TLSCipherSuite</a>. To prove this one could run <code>ldd /usr/bin/slapd</code>.</div>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">ldapmodify -D 'cn=Manager,dc=example,dc=com' -W</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">dn: cn=config
add: olcTLSCertificateFile
olcTLSCertificateFile: /etc/openldap/ssl/slapdcert.pem
-
add: olcTLSCertificateKeyFile
olcTLSCertificateKeyFile: /etc/openldap/ssl/slapdkey.pem</pre>
<p>If you are using a signed SSL Certificate from a certification authority such as <a href="../en/Certbot.html" class="mw-redirect" title="Let’s Encrypt">Let’s Encrypt</a>, you will also need to specify the path to the root certificates database and your intermediary certificate. You will also need to change ownership of the <i>.pem</i> files and intermediary directories to make them readable to the user <code>ldap</code>:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">ldapmodify -D 'cn=Manager,dc=example,dc=com' -W</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">dn: cn=config
add: olcTLSCACertificateFile
olcTLSCACertificateFile: /etc/letsencrypt/live/ldap.my-domain.com/chain.pem
-
add: olcTLSCertificateFile
olcTLSCertificateFile: /etc/letsencrypt/live/ldap.my-domain.com/cert.pem
-
add: olcTLSCertificateKeyFile
olcTLSCertificateKeyFile: /etc/letsencrypt/live/ldap.my-domain.com/privkey.pem
-
add: olcTLSCACertificatePath
olcTLSCACertificatePath: /usr/share/ca-certificates/trust-source</pre>
<p><b>SSLv2/v3</b>
</p>
<p>Disable SSLv2/v3 and use strong ciphers.
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">ldapmodify -D 'cn=Manager,dc=example,dc=com' -W</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">dn: cn=config
add: olcTLSProtocolMin
olcTLSProtocolMin: 3.3
-
add: olcTLSCipherSuite
olcTLSCipherSuite: DEFAULT:!kRSA:!kDHE
-</pre>
<p>TLSProtocolMin specifies the minimum version in wire format, so "3.3" actually means TLSv1.2.
</p>
<p>The TLSCipherSuite specifies a list of OpenSSL ciphers from which slapd will choose when negotiating TLS connections, in decreasing order of preference. In addition to those specific ciphers, you can use any of the wildcards supported by OpenSSL. <b>Note:</b> DEFAULT is a wildcard. See <span class="plainlinks archwiki-template-man" title="$ man 1ssl ciphers"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/ciphers.1ssl">ciphers(1ssl)</a></span> for description of ciphers, wildcards and options supported.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> To see which ciphers are supported by your local OpenSSL installation, type the following: <code>openssl ciphers -v ALL:COMPLEMENTOFALL</code>. Always test which ciphers will actually be enabled by TLSCipherSuite by providing it to OpenSSL command, like this: <code>openssl ciphers -v 'DEFAULT'</code>.</div>
<h4><span class="mw-headline" id="Start_slapd_with_SSL">Start slapd with SSL</span></h4>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> This is not needed for StartTLS which listens on the same port as unencrypted LDAP.</div>
<p>You will have to edit the environment file read by <code>slapd.service</code> to change the protocol <i>slapd</i> listens on:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/conf.d/slapd</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">SLAPD_URLS="ldaps:///"
SLAPD_OPTIONS=</pre>
<p>Localhost connections do not need to use SSL. So, if you want to access the server locally you should change the <code>SLAPD_URLS</code> line to:
</p>
<pre>SLAPD_URLS="ldap://127.0.0.1 ldaps:///"
</pre>
<p>Then <a href="../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Restart">restart</a> <code>slapd.service</code>. If it was enabled before, reenable it now.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> If you created a self-signed certificate above, be sure to add <code>TLS_REQCERT allow</code> to <code>/etc/openldap/ldap.conf</code> on the client, or it will not be able connect to the server.</div>
<h2><span class="mw-headline" id="Next_steps">Next steps</span></h2>
<p>You now have a basic LDAP installation. The next step is to design your directory. The design is heavily dependent on what you are using it for. If you are new to LDAP, consider starting with a directory design recommended by the specific client services that will use the directory (<a href="../en/PAM.html" title="PAM">PAM</a>, <a href="../en/Postfix.html" title="Postfix">Postfix</a>, etc).
</p>
<p>A directory for system authentication is the <a href="../en/LDAP_authentication.html" title="LDAP authentication">LDAP authentication</a> article.
</p>
<p>A nice web frontend is <a href="../en/PhpLDAPadmin.html" title="PhpLDAPadmin">phpLDAPadmin</a>.
</p>
<h3><span class="mw-headline" id="Backup_LDAP">Backup LDAP</span></h3>
<p>It is imperative that we have a backup of our LDAP database and configuration in case we ever need to restore for any number of reasons.
</p>
<h4><span class="mw-headline" id="Export_configuration">Export configuration</span></h4>
<pre>$ sudo -u ldap slapcat -vF /etc/openldap/slapd.d -n 0 -l "$(hostname)-ldap-mdb-config-$(date '+%F').ldif"
</pre>
<h4><span class="mw-headline" id="Export_database">Export database</span></h4>
<pre>$ sudo -u ldap slapcat -v -n 1 -l "$(hostname)-ldap-database-$(date '+%F').ldif"
</pre>
<h3><span class="mw-headline" id="Restore_LDAP">Restore LDAP</span></h3>
<h4><span class="mw-headline" id="Import_configuration">Import configuration</span></h4>
<pre>$ sudo -u ldap slapadd -v -n 0 -F /etc/openldap/slapd.d -l <i>&lt;filename from config export&gt;</i>
</pre>
<h4><span class="mw-headline" id="Import_database">Import database</span></h4>
<pre>$ sudo -u ldap slapadd -v -n 1 -F /etc/openldap/slapd.d -l <i>&lt;filename from database export&gt;</i>
</pre>
<h2><span class="mw-headline" id="Troubleshooting">Troubleshooting</span></h2>
<h3><span class="mw-headline" id="slapd_configuration_checking">slapd configuration checking</span></h3>
<p>You can check configuration settings with
</p>
<pre>$ slaptest -F /etc/openldap/slapd.d/ -v
</pre>
<h3><span class="mw-headline" id="Client_authentication_checking">Client authentication checking</span></h3>
<p>If you cannot connect to your server for non-secure authentication:
</p>
<pre>$ ldapsearch -x -H ldap://ldaservername:389 -D cn=Manager,dc=example,dc=exampledomain
</pre>
<p>and for TLS secured authentication with:
</p>
<pre>$ ldapsearch -x -H ldaps://ldaservername:636 -D cn=Manager,dc=example,dc=exampledomain
</pre>
<h3><span class="mw-headline" id="LDAP_server_stops_suddenly">LDAP server stops suddenly</span></h3>
<p>If you notice that <i>slapd</i> seems to start but then stops, try running:
</p>
<pre># chown -R ldap:ldap /var/lib/openldap
</pre>
<p>to allow <i>slapd</i> write access to its data directory as the user "ldap".
</p>
<h3><span class="mw-headline" id="LDAP_server_does_not_start">LDAP server does not start</span></h3>
<p>Try starting the server from the command line with debugging output enabled:
</p>
<pre># slapd -u ldap -g ldap -h ldaps://ldaservername:636 -d Config,Stats
</pre>
<h2><span class="mw-headline" id="See_also">See also</span></h2>
<ul>
<li><a rel="nofollow" class="external text" href="https://www.openldap.org/doc/">Official OpenLDAP Software Administrator's Guide</a></li>
<li>
<a href="../en/PhpLDAPadmin.html" title="PhpLDAPadmin">phpLDAPadmin</a> is a web interface tool in the style of phpMyAdmin.</li>
<li><a href="../en/LDAP_authentication.html" title="LDAP authentication">LDAP authentication</a></li>
<li>
<span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/apachedirectorystudio/">apachedirectorystudio</a></span><sup><small>AUR</small></sup> from the <a href="../en/Arch_User_Repository.html" title="Arch User Repository">Arch User Repository</a> is an Eclipse-based LDAP viewer. Works perfect with OpenLDAP installations.</li>
</ul>
</div>
</div>
					<div id="catlinks" class="catlinks" data-mw="interface"><div id="mw-normal-catlinks" class="mw-normal-catlinks">
<a href="../Special:Categories.html" title="Special:Categories">Category</a>: <ul><li><a href="../en/Category:Directory_services.html" title="Category:Directory services">Directory services</a></li></ul>
</div></div>
				</div>
			</main>
			
		</div>
		<div class="mw-footer-container">
			
<footer id="footer" class="mw-footer" role="contentinfo" style="margin: 0">
	<ul id="footer-info">
	<li data-nosnippet="">Retrieved from "<a dir="ltr" href="https://wiki.archlinux.org/index.php?title=OpenLDAP&amp;oldid=785069">https://wiki.archlinux.org/index.php?title=OpenLDAP&amp;oldid=785069</a>"</li>
<li id="footer-info-lastmod"> This page was last edited on 11 August 2023, at 06:07.</li>
	<li id="footer-info-copyright">Content is available under <a class="external" rel="nofollow" href="https://www.gnu.org/copyleft/fdl.html">GNU Free Documentation License 1.3 or later</a> unless otherwise noted.</li>
<br>
</ul>

	<ul id="footer-places">
	<li id="footer-places-privacy"><a href="https://terms.archlinux.org/docs/privacy-policy/">Privacy policy</a></li>
	<li id="footer-places-about"><a href="../en/ArchWiki:About.html">About ArchWiki</a></li>
	<li id="footer-places-disclaimer"><a href="../en/ArchWiki:General_disclaimer.html">Disclaimers</a></li>
</ul>

	
</footer>

		</div>
	</div> 
</div> 

</body>
</html>
