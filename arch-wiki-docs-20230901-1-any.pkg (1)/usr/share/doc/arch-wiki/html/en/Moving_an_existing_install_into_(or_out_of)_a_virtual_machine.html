<!DOCTYPE html>
<html class="client-nojs" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<title>Moving an existing install into (or out of) a virtual machine - ArchWiki</title>
<link rel="stylesheet" href="../ArchWikiOffline.css">
<meta name="ResourceLoaderDynamicStyles" content="">
<meta name="generator" content="MediaWiki 1.39.4">
<meta name="referrer" content="no-referrer-when-downgrade">
<meta name="format-detection" content="telephone=no">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes, minimum-scale=0.25, maximum-scale=5.0">
<link rel="icon" href="/favicon.ico">
<link rel="search" type="application/opensearchdescription+xml" href="/opensearch_desc.php" title="ArchWiki (en)">
<link rel="EditURI" type="application/rsd+xml" href="https://wiki.archlinux.org/api.php?action=rsd">
<link rel="license" href="https://www.gnu.org/copyleft/fdl.html">
<link rel="alternate" type="application/atom+xml" title="ArchWiki Atom feed" href="/index.php?title=Special:RecentChanges&amp;feed=atom">
</head>
<body class="skin-vector skin-vector-search-vue mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-Moving_an_existing_install_into_or_out_of_a_virtual_machine rootpage-Moving_an_existing_install_into_or_out_of_a_virtual_machine skin-vector-2022 action-view skin--responsive vector-feature-language-in-header-enabled vector-feature-language-in-main-page-header-disabled vector-feature-language-alert-in-sidebar-disabled vector-feature-sticky-header-disabled vector-feature-sticky-header-edit-disabled vector-feature-table-of-contents-disabled vector-feature-visual-enhancement-next-disabled">
<div class="mw-page-container">
	<span id="top-page"></span>
	<a class="mw-jump-link" href="#content">Jump to content</a>
	<div class="mw-page-container-inner">
		<input type="checkbox" id="mw-sidebar-checkbox" class="mw-checkbox-hack-checkbox">
		<div class="vector-sidebar-container ">
			</div>
		<div class="vector-sitenotice-container">
			<div id="siteNotice"></div>
		</div>
		<input type="checkbox" id="vector-toc-collapsed-checkbox" class="mw-checkbox-hack-checkbox">
		<div class="mw-table-of-contents-container">
			<div class="vector-sticky-toc-container mw-sticky-header-element">
				<nav id="mw-panel-toc" class="sidebar-toc" role="navigation" aria-labelledby="sidebar-toc-label" data-event-name="ui.sidebar-toc">
	<div id="sidebar-toc-label" class="sidebar-toc-header">
		<p class="sidebar-toc-title">
		Contents
		<button class="vector-toc-uncollapse-button">move to sidebar</button>
		<button class="vector-toc-collapse-button">hide</button>
		</p>
	</div>
	<ul class="sidebar-toc-contents" id="mw-panel-toc-list">
		<li id="toc-mw-content-text" class="sidebar-toc-list-item sidebar-toc-level-1">
			<a href="#top-page" class="sidebar-toc-link">
				<div class="sidebar-toc-text">Beginning</div>
			</a>
		</li>
		<li id="toc-Moving_out_of_a_virtual_machine" class="sidebar-toc-list-item sidebar-toc-level-1 sidebar-toc-list-item-expanded">
			<a class="sidebar-toc-link" href="#Moving_out_of_a_virtual_machine">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">1</span>Moving out of a virtual machine</div>
			</a>
			
				<button aria-controls="toc-Moving_out_of_a_virtual_machine-sublist" class="mw-ui-icon mw-ui-icon-wikimedia-expand mw-ui-icon-small sidebar-toc-toggle">
					Toggle Moving out of a virtual machine subsection
				</button>
			
			<ul id="toc-Moving_out_of_a_virtual_machine-sublist" class="sidebar-toc-list">
				<li id="toc-Set_up_a_shared_folder" class="sidebar-toc-list-item sidebar-toc-level-2">
			<a class="sidebar-toc-link" href="#Set_up_a_shared_folder">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">1.1</span>Set up a shared folder</div>
			</a>
			
			<ul id="toc-Set_up_a_shared_folder-sublist" class="sidebar-toc-list">
			</ul>
		</li>
		<li id="toc-Transfer_the_system" class="sidebar-toc-list-item sidebar-toc-level-2">
			<a class="sidebar-toc-link" href="#Transfer_the_system">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">1.2</span>Transfer the system</div>
			</a>
			
			<ul id="toc-Transfer_the_system-sublist" class="sidebar-toc-list">
			</ul>
		</li>
		<li id="toc-Chroot_and_reinstall_the_boot_loader" class="sidebar-toc-list-item sidebar-toc-level-2">
			<a class="sidebar-toc-link" href="#Chroot_and_reinstall_the_boot_loader">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">1.3</span>Chroot and reinstall the boot loader</div>
			</a>
			
			<ul id="toc-Chroot_and_reinstall_the_boot_loader-sublist" class="sidebar-toc-list">
			</ul>
		</li>
		<li id="toc-Adjust_the_fstab" class="sidebar-toc-list-item sidebar-toc-level-2">
			<a class="sidebar-toc-link" href="#Adjust_the_fstab">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">1.4</span>Adjust the fstab</div>
			</a>
			
			<ul id="toc-Adjust_the_fstab-sublist" class="sidebar-toc-list">
			</ul>
		</li>
		<li id="toc-Re-generate_the_initramfs_image" class="sidebar-toc-list-item sidebar-toc-level-2">
			<a class="sidebar-toc-link" href="#Re-generate_the_initramfs_image">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">1.5</span>Re-generate the initramfs image</div>
			</a>
			
			<ul id="toc-Re-generate_the_initramfs_image-sublist" class="sidebar-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id="toc-Moving_into_a_virtual_machine" class="sidebar-toc-list-item sidebar-toc-level-1 sidebar-toc-list-item-expanded">
			<a class="sidebar-toc-link" href="#Moving_into_a_virtual_machine">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">2</span>Moving into a virtual machine</div>
			</a>
			
				<button aria-controls="toc-Moving_into_a_virtual_machine-sublist" class="mw-ui-icon mw-ui-icon-wikimedia-expand mw-ui-icon-small sidebar-toc-toggle">
					Toggle Moving into a virtual machine subsection
				</button>
			
			<ul id="toc-Moving_into_a_virtual_machine-sublist" class="sidebar-toc-list">
				<li id="toc-Create_the_container" class="sidebar-toc-list-item sidebar-toc-level-2">
			<a class="sidebar-toc-link" href="#Create_the_container">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">2.1</span>Create the container</div>
			</a>
			
			<ul id="toc-Create_the_container-sublist" class="sidebar-toc-list">
			</ul>
		</li>
		<li id="toc-Transfer_the_system_2" class="sidebar-toc-list-item sidebar-toc-level-2">
			<a class="sidebar-toc-link" href="#Transfer_the_system_2">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">2.2</span>Transfer the system</div>
			</a>
			
			<ul id="toc-Transfer_the_system_2-sublist" class="sidebar-toc-list">
			</ul>
		</li>
		<li id="toc-Convert_the_container_to_a_compatible_format" class="sidebar-toc-list-item sidebar-toc-level-2">
			<a class="sidebar-toc-link" href="#Convert_the_container_to_a_compatible_format">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">2.3</span>Convert the container to a compatible format</div>
			</a>
			
			<ul id="toc-Convert_the_container_to_a_compatible_format-sublist" class="sidebar-toc-list">
			</ul>
		</li>
		<li id="toc-Chroot_and_reinstall_the_boot_loader_2" class="sidebar-toc-list-item sidebar-toc-level-2">
			<a class="sidebar-toc-link" href="#Chroot_and_reinstall_the_boot_loader_2">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">2.4</span>Chroot and reinstall the boot loader</div>
			</a>
			
			<ul id="toc-Chroot_and_reinstall_the_boot_loader_2-sublist" class="sidebar-toc-list">
			</ul>
		</li>
		<li id="toc-Adjust_the_fstab_2" class="sidebar-toc-list-item sidebar-toc-level-2">
			<a class="sidebar-toc-link" href="#Adjust_the_fstab_2">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">2.5</span>Adjust the fstab</div>
			</a>
			
			<ul id="toc-Adjust_the_fstab_2-sublist" class="sidebar-toc-list">
			</ul>
		</li>
		<li id="toc-Disable_any_Xorg-related_files" class="sidebar-toc-list-item sidebar-toc-level-2">
			<a class="sidebar-toc-link" href="#Disable_any_Xorg-related_files">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">2.6</span>Disable any Xorg-related files</div>
			</a>
			
			<ul id="toc-Disable_any_Xorg-related_files-sublist" class="sidebar-toc-list">
			</ul>
		</li>
		<li id="toc-Re-generate_the_initramfs_image_2" class="sidebar-toc-list-item sidebar-toc-level-2">
			<a class="sidebar-toc-link" href="#Re-generate_the_initramfs_image_2">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">2.7</span>Re-generate the initramfs image</div>
			</a>
			
			<ul id="toc-Re-generate_the_initramfs_image_2-sublist" class="sidebar-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id="toc-Troubleshooting" class="sidebar-toc-list-item sidebar-toc-level-1 sidebar-toc-list-item-expanded">
			<a class="sidebar-toc-link" href="#Troubleshooting">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">3</span>Troubleshooting</div>
			</a>
			
				<button aria-controls="toc-Troubleshooting-sublist" class="mw-ui-icon mw-ui-icon-wikimedia-expand mw-ui-icon-small sidebar-toc-toggle">
					Toggle Troubleshooting subsection
				</button>
			
			<ul id="toc-Troubleshooting-sublist" class="sidebar-toc-list">
				<li id='toc-"mount:_special_device_/dev/loop5p1_does_not_exist"' class="sidebar-toc-list-item sidebar-toc-level-2">
			<a class="sidebar-toc-link" href='#"mount:_special_device_/dev/loop5p1_does_not_exist"'>
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">3.1</span>"mount: special device /dev/loop5p1 does not exist"</div>
			</a>
			
			<ul id='toc-"mount:_special_device_/dev/loop5p1_does_not_exist"-sublist' class="sidebar-toc-list">
			</ul>
		</li>
		<li id="toc-&quot;Waiting_10_seconds_for_device_/dev/sda1;_ERROR:_Unable_to_find_root_device_'/dev/sda1'&quot;" class="sidebar-toc-list-item sidebar-toc-level-2">
			<a class="sidebar-toc-link" href="#&quot;Waiting_10_seconds_for_device_/dev/sda1;_ERROR:_Unable_to_find_root_device_'/dev/sda1'&quot;">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">3.2</span>"Waiting 10 seconds for device /dev/sda1; ERROR: Unable to find root device '/dev/sda1'"</div>
			</a>
			
			<ul id="toc-&quot;Waiting_10_seconds_for_device_/dev/sda1;_ERROR:_Unable_to_find_root_device_'/dev/sda1'&quot;-sublist" class="sidebar-toc-list">
			</ul>
		</li>
		<li id='toc-"Missing_operating_system._FATAL:_INT18:_BOOT_FAILURE"' class="sidebar-toc-list-item sidebar-toc-level-2">
			<a class="sidebar-toc-link" href='#"Missing_operating_system._FATAL:_INT18:_BOOT_FAILURE"'>
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">3.3</span>"Missing operating system. FATAL: INT18: BOOT FAILURE"</div>
			</a>
			
			<ul id='toc-"Missing_operating_system._FATAL:_INT18:_BOOT_FAILURE"-sublist' class="sidebar-toc-list">
			</ul>
		</li>
		<li id="toc-I_am_asked_for_the_root_password,_for_maintenance" class="sidebar-toc-list-item sidebar-toc-level-2">
			<a class="sidebar-toc-link" href="#I_am_asked_for_the_root_password,_for_maintenance">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">3.4</span>I am asked for the root password, for maintenance</div>
			</a>
			
			<ul id="toc-I_am_asked_for_the_root_password,_for_maintenance-sublist" class="sidebar-toc-list">
			</ul>
		</li>
	</ul>
		</li>
	</ul>
</nav>

			</div>
		</div>
		<div class="mw-content-container">
			<main id="content" class="mw-body" role="main" style="margin: 0">
				<a id="top"></a>
				<nav class="vector-article-toolbar" aria-label="Tools" role="navigation">
					<div class="mw-article-toolbar-container">
						<div id="left-navigation">
							

<div id="p-associated-pages" class="vector-menu mw-portlet mw-portlet-associated-pages vector-menu-tabs">
	<div class="vector-menu-content">
		
		<ul class="vector-menu-content-list">
<li id="ca-nstab-main" class="selected mw-list-item"><a href="../en/Moving_an_existing_install_into_(or_out_of)_a_virtual_machine.html" title="View the content page [c]" accesskey="c"><span>Page</span></a></li>
<li id="ca-talk" class="mw-list-item"><a href="../en/Talk:Moving_an_existing_install_into_(or_out_of)_a_virtual_machine.html" rel="discussion" title="Discussion about the content page [t]" accesskey="t"><span>Discussion</span></a></li>
</ul>
		
	</div>
</div>

							

<div id="p-variants" class="vector-menu mw-portlet mw-portlet-variants emptyPortlet vector-menu-dropdown">
	<input type="checkbox" id="p-variants-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-p-variants" class="vector-menu-checkbox" aria-label="Change language variant">
	<label id="p-variants-label" for="p-variants-checkbox" class="vector-menu-heading ">
		<span class="vector-menu-heading-label">English</span>
	</label>
	<div class="vector-menu-content">
		
		<ul class="vector-menu-content-list"></ul>
		
	</div>
</div>

						</div>
						<div id="right-navigation" class="vector-collapsible ">
							

<div id="p-views" class="vector-menu mw-portlet mw-portlet-views vector-menu-tabs">
	<div class="vector-menu-content">
		
		<ul class="vector-menu-content-list">
<li id="ca-view" class="selected mw-list-item"><a href="../en/Moving_an_existing_install_into_(or_out_of)_a_virtual_machine.html"><span>Read</span></a></li>
<li id="ca-viewsource" class="mw-list-item"><a href="/index.php?title=Moving_an_existing_install_into_(or_out_of)_a_virtual_machine&amp;action=edit" title="This page is protected.
You can view its source [e]" accesskey="e"><span>View source</span></a></li>
<li id="ca-history" class="mw-list-item"><a href="/index.php?title=Moving_an_existing_install_into_(or_out_of)_a_virtual_machine&amp;action=history" title="Past revisions of this page [h]" accesskey="h"><span>View history</span></a></li>
</ul>
		
	</div>
</div>

							

<div id="p-cactions" class="vector-menu mw-portlet mw-portlet-cactions emptyPortlet vector-menu-dropdown vector-has-collapsible-items" title="More options">
	<input type="checkbox" id="p-cactions-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-p-cactions" class="vector-menu-checkbox">
	<label id="p-cactions-label" for="p-cactions-checkbox" class="vector-menu-heading ">
		<span class="vector-menu-heading-label">More</span>
	</label>
	<div class="vector-menu-content">
		
		<ul class="vector-menu-content-list">
<li id="ca-more-view" class="selected vector-more-collapsible-item mw-list-item"><a href="../en/Moving_an_existing_install_into_(or_out_of)_a_virtual_machine.html"><span>Read</span></a></li>
<li id="ca-more-viewsource" class="vector-more-collapsible-item mw-list-item"><a href="/index.php?title=Moving_an_existing_install_into_(or_out_of)_a_virtual_machine&amp;action=edit"><span>View source</span></a></li>
<li id="ca-more-history" class="vector-more-collapsible-item mw-list-item"><a href="/index.php?title=Moving_an_existing_install_into_(or_out_of)_a_virtual_machine&amp;action=history"><span>View history</span></a></li>
</ul>
		
	</div>
</div>

						</div>
					</div>
				</nav>
				<div id="bodyContent" class="vector-body" data-mw-ve-target-container>
					<div class="mw-body-subheader">
					        <div class="mw-indicators">
        </div>

					    <div id="siteSub" class="noprint">From ArchWiki</div>
					</div>
					
					
					
					<div id="mw-content-text" class="mw-body-content mw-content-ltr" lang="en" dir="ltr">
<div class="mw-parser-output">
<div class="archwiki-template-meta-related-articles-start">
<p class="mw-no-invert">Related articles</p>
<ul>
<li><a href="../en/VirtualBox.html" title="VirtualBox">VirtualBox</a></li>
<li><a href="../en/VMware.html" title="VMware">VMware</a></li>
<li><a href="../en/QEMU.html" title="QEMU">QEMU</a></li>
<li><a href="../en/Migrate_installation_to_new_hardware.html" title="Migrate installation to new hardware">Migrate installation to new hardware</a></li>
</ul>
</div>
<p>This article describes how to transfer your current Arch Linux installation in or out of a virtual environment (i.e. QEMU, VirtualBox, VMware). A virtual machine uses different hardware, which needs to be addressed by re-generating the initramfs image and possibly adjusting the fstab â€“ especially if it is an <a href="../en/Solid_state_drive.html" class="mw-redirect" title="SSD">SSD</a>.
</p>
<mw:tocplace></mw:tocplace>
<h2><span class="mw-headline" id="Moving_out_of_a_virtual_machine">Moving out of a virtual machine</span></h2>
<p>Moving out of a virtual environment is relatively easy.
</p>
<h3><span class="mw-headline" id="Set_up_a_shared_folder">Set up a shared folder</span></h3>
<p>Setting up a shared folder between the guest virtual machine and the host depends on the hypervisor you use. Please thus refer to their specific wiki page or manual.
</p>
<p>If you do not already have an ext4 partition, see <a href="../en/File_systems.html" title="File systems">File systems</a>.
</p>
<div class="noprint archwiki-template-message">
<p><a href="../File:Tango-inaccurate.png" class="image"><img alt="Tango-inaccurate.png" src="../File:Tango-inaccurate.png" decoding="async" width="48" height="48"></a><b>The factual accuracy of this article or section is disputed.</b><a href="../File:Tango-inaccurate.png" class="image"><img alt="Tango-inaccurate.png" src="../File:Tango-inaccurate.png" decoding="async" width="48" height="48"></a></p>
<div>
<b>Reason:</b> Ext2Fsd 0.66 does not support extended attributes and ACL. (Discuss in <a rel="nofollow" class="external text" href="https://wiki.archlinux.org/title/Talk:Moving_an_existing_install_into_(or_out_of)_a_virtual_machine">Talk:Moving an existing install into (or out of) a virtual machine</a>)</div>
</div>
<p>If you are on Windows, install <a rel="nofollow" class="external text" href="https://www.ext2fsd.com/">Ext2Fsd</a> to be able to mount ext volumes.
</p>
<h3><span class="mw-headline" id="Transfer_the_system">Transfer the system</span></h3>
<p>From the virtual machine, open a terminal and <a href="../en/Rsync.html" title="Rsync">transfer</a> the system:
</p>
<pre># rsync -aAXHSv /* /path/to/shared/folder --exclude={/dev/*,/proc/*,/sys/*,/tmp/*,/run/*,/mnt/*,/media/*,/lost+found,/home/*/.gvfs}
</pre>
<p>This can also be done with <a rel="nofollow" class="external text" href="https://clonezilla.org/">clonezilla boot disk</a> or <a href="../en/Dd.html#Disk_cloning_and_restore" title="Dd">dd</a> from a random Linux live-cd. If you are using Virtualbox you need to connect the target drive through USB (or SATA to USB cable) otherwise use an external USB drive to save the disk image (with dd or clonezilla).
</p>
<h3><span class="mw-headline" id="Chroot_and_reinstall_the_boot_loader">Chroot and reinstall the boot loader</span></h3>
<p>Boot a "live" GNU/Linux distribution, mount the root partition and <a href="../en/Chroot.html" title="Chroot">chroot</a> into it.
</p>
<p>Reinstall your boot loader or boot manager: either <a href="../en/Syslinux.html" title="Syslinux">Syslinux</a>, <a href="../en/GRUB.html" title="GRUB">GRUB</a> or <a href="../en/Systemd-boot.html" title="Systemd-boot">systemd-boot</a>. Do not forget to update the configuration file: <code>syslinux.cfg</code> for Syslinux, <code>grub.cfg</code> for Grub, or the systemd-boot boot entries located in <code>/boot/loader/entries/</code>.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong>  You might be able to boot directly without reinstalling the boot loader. Try that before using a chroot. That way you could (possibly) reinstall the boot loader and regenerate ramfs from a graphical environment.</div>
<h3><span class="mw-headline" id="Adjust_the_fstab">Adjust the fstab</span></h3>
<p>Since your entire root tree has been transferred to a single partition, edit the <a href="../en/Fstab.html" title="Fstab">fstab</a> file to reflect the right partition(s).
</p>
<p>Check with the <code>blkid</code> command, since <code>lsblk</code> is not very useful inside a chroot.
</p>
<h3><span class="mw-headline" id="Re-generate_the_initramfs_image">Re-generate the initramfs image</span></h3>
<p>Because the hardware has changed, while you are still in the chroot, <a href="../en/Mkinitcpio.html#Image_creation_and_activation" class="mw-redirect" title="Regenerate the initramfs">regenerate the initramfs</a>.
</p>
<p>And that is about it.
</p>
<p>You will most likely need to set up the network, since the virtual machine was probably piggybacking on the host OS's network settings. See <a href="../en/Network_configuration.html" title="Network configuration">Network configuration</a>.
</p>
<h2><span class="mw-headline" id="Moving_into_a_virtual_machine">Moving into a virtual machine</span></h2>
<p>Moving <i>into</i> a virtual environment takes a little more effort.
</p>
<h3><span class="mw-headline" id="Create_the_container">Create the container</span></h3>
<p>This will create a 10 GB raw image:
</p>
<pre># dd if=/dev/zero of=/media/Backup/backup.img bs=1024 count=10482381
</pre>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip:</strong>  Using <code>fallocate</code> is much faster:
<pre># fallocate -l 10GiB -o 1024 /media/Backup/backup.img
</pre>
</div>
<div class="noprint archwiki-template-message">
<p><a href="../File:Tango-inaccurate.png" class="image"><img alt="Tango-inaccurate.png" src="../File:Tango-inaccurate.png" decoding="async" width="48" height="48"></a><b>The factual accuracy of this article or section is disputed.</b><a href="../File:Tango-inaccurate.png" class="image"><img alt="Tango-inaccurate.png" src="../File:Tango-inaccurate.png" decoding="async" width="48" height="48"></a></p>
<div>
<b>Reason:</b> <code>fdisk -l</code> now shows a <code>Sectors</code> column instead <code>Blocks</code>. Does the same affirmation apply? (Discuss in <a rel="nofollow" class="external text" href="https://wiki.archlinux.org/title/Talk:Moving_an_existing_install_into_(or_out_of)_a_virtual_machine">Talk:Moving an existing install into (or out of) a virtual machine</a>)</div>
</div>
<p>If you want to create one the exact size of your root partition, run <code>fdisk -l</code> and use the value from the <code>Blocks</code> column for the <code>count=</code> parameter. Note that you will transfer your entire root tree, so that includes the <code>/boot</code> and <code>/home</code> folders. If you have any separate partitions for those, you need to take them into account when creating the container.
</p>
<p>Partition the <code>/media/Backup/backup.img</code> file by running your favourite <a href="../en/Partitioning.html#Partitioning_tools" title="Partitioning">partitioning tool</a>. Create a partition table on it (e.g. <code>msdos</code>), choose the <a href="../en/Partitioning.html#Partition_scheme" class="mw-redirect" title="Partition scheme">partition scheme</a> and create the partitions. 
</p>
<p>Now load the necessary module and mount it as a loopback device, on <code>/dev/loop5</code> (for example):
</p>
<pre># modprobe loop
# losetup --partscan /dev/loop5 /media/Backup/backup.img
</pre>
<p>Then create a <a href="../en/File_systems.html" class="mw-redirect" title="File system">file system</a> on the partitions, which will appear as <code>/dev/loop5p1</code>, <code>/dev/loop5p2</code>, etc.
</p>
<h3><span class="mw-headline" id="Transfer_the_system_2">Transfer the system</span></h3>
<p>Mount the loopback device and <a href="../en/Rsync.html" title="Rsync">transfer</a> the system:
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> If the container was saved somewhere other than <code>/mnt</code> or <code>/media</code>, do not forget to add it to the exclude list.</div>
<pre># mount --mkdir /dev/loop5p1 /mnt/Virtual
# rsync -aAXv /* /mnt/Virtual --exclude={/dev/*,/proc/*,/sys/*,/tmp/*,/run/*,/mnt/*,/media/*,/lost+found,/home/*/.gvfs}
</pre>
<h3><span class="mw-headline" id="Convert_the_container_to_a_compatible_format">Convert the container to a compatible format</span></h3>
<p>Choose the appropriate command depending on the desired virtual machine.
</p>
<p>To convert into a <b>KVM</b> container, use <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=qemu-desktop">qemu-desktop</a></span> with the following command line:
</p>
<pre>$ qemu-img convert -c -f raw -O qcow /media/backup.img /media/backup.qcow2
</pre>
<p>To convert into a <b>VirtualBox</b> container, use <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=virtualbox">virtualbox</a></span> with the following command line: 
</p>
<pre>$ VBoxManage convertfromraw --format VDI /media/backup.img /media/backup.vdi
</pre>
<p>To convert into a <b>VMware</b> container, use <i>virtualbox</i> with the following command line: 
</p>
<pre>$ VBoxManage convertfromraw --format VMDK /media/backup.img /media/backup.vmdk
</pre>
<h3><span class="mw-headline" id="Chroot_and_reinstall_the_boot_loader_2">Chroot and reinstall the boot loader</span></h3>
<p>Connect the container to the virtual machine, along with a Linux LiveCD (e.g. the latest Arch Linux ISO) in the virtual machine's virtual CD-ROM, then start the virtual machine and <a href="../en/Chroot.html" title="Chroot">chroot</a> into it:
</p>
<pre># mount /dev/sda1 /mnt
# arch-chroot /mnt /bin/bash
</pre>
<p>Reinstall either <a href="../en/Syslinux.html" title="Syslinux">Syslinux</a> or <a href="../en/GRUB.html" title="GRUB">GRUB</a>. Do not forget to update its configuration file:
</p>
<ul>
<li>For Syslinux, it should be <code>APPEND root=/dev/sda1 ro</code> in <code>syslinux.cfg</code>.</li>
<li>For GRUB, it is recommended that you automatically re-generate a <code>grub.cfg</code>.</li>
</ul>
<h3><span class="mw-headline" id="Adjust_the_fstab_2">Adjust the fstab</span></h3>
<p>Since your entire root tree has been transferred to a single partition, edit the <a href="../en/Fstab.html" title="Fstab">fstab</a> file. You may use the UUID or label if you want, but those are more useful in multi-drive, multi-partition configurations (to avoid confusions). For now, <code>/dev/sda1</code> for your entire system is just fine.
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/fstab</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">tmpfs                    /tmp      tmpfs     nodev,nosuid          0   0
/dev/sda1                /         ext4      defaults,noatime      0   1</pre>
<h3><span class="mw-headline" id="Disable_any_Xorg-related_files">Disable any Xorg-related files</span></h3>
<p>Having an <code>nvidia</code>, <code>nouveau</code>, <code>radeon</code>, <code>intel</code>, etc., entry in the <code>Device</code> section from one of the Xorg configuration files will prevent it from starting, since you will be using <i>emulated</i> hardware (including the video card). So it is recommended that you move/rename or delete the following:
</p>
<pre># mv /etc/X11/xorg.conf /etc/X11/xorg.conf.bak
# mv /etc/X11/xorg.conf.d/10-monitor /etc/X11/xorg.conf.d/10-monitor.bak
</pre>
<h3><span class="mw-headline" id="Re-generate_the_initramfs_image_2">Re-generate the initramfs image</span></h3>
<p>Because the hardware has changed, while you are still in the chroot, re-generate the initramfs image and do a proper shutdown:
</p>
<pre># mkinitcpio -p linux
# exit
# umount -R /mnt
# poweroff
</pre>
<p>Finally, pull out the LiveCD (the ISO file), so that you do not boot back into it, and start the virtual machine.
</p>
<p>Enjoy your new virtual environment.
</p>
<h2><span class="mw-headline" id="Troubleshooting">Troubleshooting</span></h2>
<h3>
<span id=".22mount:_special_device_.2Fdev.2Floop5p1_does_not_exist.22"></span><span class="mw-headline" id='"mount:_special_device_/dev/loop5p1_does_not_exist"'>"mount: special device /dev/loop5p1 does not exist"</span>
</h3>
<p>Use <code>losetup --partscan</code>, for example:
</p>
<pre># losetup --partscan /dev/loop5 /media/Backup/backup.img
</pre>
<p>This should create device nodes for each partition you have created inside the loop device.
</p>
<h3>
<span id=".22Waiting_10_seconds_for_device_.2Fdev.2Fsda1.3B_ERROR:_Unable_to_find_root_device_.27.2Fdev.2Fsda1.27.22"></span><span class="mw-headline" id="&quot;Waiting_10_seconds_for_device_/dev/sda1;_ERROR:_Unable_to_find_root_device_'/dev/sda1'&quot;">"Waiting 10 seconds for device /dev/sda1; ERROR: Unable to find root device '/dev/sda1'"</span>
</h3>
<pre>Waiting 10 seconds for device /dev/sda1 ...
ERROR: Unable to find root device '/dev/sda1'.
You are being dropped to a recovery shell
    Type 'exit' to try and continue booting
sh: cannot access tty; job control turned off
[rootfs /]# _
</pre>
<p>It most likely means that you did not run <code>poweroff</code> like <i>you were instructed to</i>, and closed the virtual machine with the "close" button, which is the equivalent of a power outage. Now you need to regenerate your initramfs image. To do that, you can start the virtual machine using the Fallback entry. If you do not have a Fallback entry, press <code>Tab</code> (for Syslinux) or <code>e</code> (for GRUB) and rename it <code>initramfs-linux-fallback.img</code>. After it boots, open up a terminal and run:
</p>
<pre># mkinitcpio -p linux
# poweroff
</pre>
<h3>
<span id=".22Missing_operating_system._FATAL:_INT18:_BOOT_FAILURE.22"></span><span class="mw-headline" id='"Missing_operating_system._FATAL:_INT18:_BOOT_FAILURE"'>"Missing operating system. FATAL: INT18: BOOT FAILURE"</span>
</h3>
<ul>
<li>You either need to install or reinstall a boot loader. See <a href="../en/Arch_boot_process.html#Boot_loader" title="Arch boot process">Arch boot process#Boot loader</a>.</li>
<li>You are using a <a href="../en/Btrfs.html" title="Btrfs">Btrfs</a> filesystem with compression for <code>/boot</code>, for which <a href="../en/Syslinux.html" title="Syslinux">Syslinux</a> currently cannot boot from.</li>
<li>The boot order from the BIOS or from the virtual machine's settings is not properly set up. Make sure that the drive containing the boot loader is the first one to boot.</li>
</ul>
<h3>
<span id="I_am_asked_for_the_root_password.2C_for_maintenance"></span><span class="mw-headline" id="I_am_asked_for_the_root_password,_for_maintenance">I am asked for the root password, for maintenance</span>
</h3>
<pre>:: Checking Filesystems                        [BUSY]
fsck.ext4: Unable to resolve '...'
</pre>
<p>This means that you forgot to add the drive's UUID, label or device name in <code>/etc/fstab</code>. The UUID is different every time you format it (or in this case, create one from scratch), and they likely do not match. Check with <code>blkid</code>.
</p>
</div>
</div>
					<div id="catlinks" class="catlinks" data-mw="interface">
<div id="mw-normal-catlinks" class="mw-normal-catlinks">
<a href="../Special:Categories.html" title="Special:Categories">Categories</a>: <ul>
<li><a href="../en/Category:Installation_process.html" title="Category:Installation process">Installation process</a></li>
<li><a href="../en/Category:Virtualization.html" title="Category:Virtualization">Virtualization</a></li>
</ul>
</div>
<div id="mw-hidden-catlinks" class="mw-hidden-catlinks mw-hidden-cats-hidden">Hidden category: <ul><li><a href="../en/Category:Pages_or_sections_flagged_with_Template:Accuracy.html" title="Category:Pages or sections flagged with Template:Accuracy">Pages or sections flagged with Template:Accuracy</a></li></ul>
</div>
</div>
				</div>
			</main>
			
		</div>
		<div class="mw-footer-container">
			
<footer id="footer" class="mw-footer" role="contentinfo" style="margin: 0">
	<ul id="footer-info">
	<li data-nosnippet="">Retrieved from "<a dir="ltr" href="https://wiki.archlinux.org/index.php?title=Moving_an_existing_install_into_(or_out_of)_a_virtual_machine&amp;oldid=779351">https://wiki.archlinux.org/index.php?title=Moving_an_existing_install_into_(or_out_of)_a_virtual_machine&amp;oldid=779351</a>"</li>
<li id="footer-info-lastmod"> This page was last edited on 22 May 2023, at 06:44.</li>
	<li id="footer-info-copyright">Content is available under <a class="external" rel="nofollow" href="https://www.gnu.org/copyleft/fdl.html">GNU Free Documentation License 1.3 or later</a> unless otherwise noted.</li>
<br>
</ul>

	<ul id="footer-places">
	<li id="footer-places-privacy"><a href="https://terms.archlinux.org/docs/privacy-policy/">Privacy policy</a></li>
	<li id="footer-places-about"><a href="../en/ArchWiki:About.html">About ArchWiki</a></li>
	<li id="footer-places-disclaimer"><a href="../en/ArchWiki:General_disclaimer.html">Disclaimers</a></li>
</ul>

	
</footer>

		</div>
	</div> 
</div> 

</body>
</html>
