<!DOCTYPE html>
<html class="client-nojs" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<title>Python package guidelines - ArchWiki</title>
<link rel="stylesheet" href="../ArchWikiOffline.css">
<meta name="ResourceLoaderDynamicStyles" content="">
<meta name="generator" content="MediaWiki 1.39.4">
<meta name="referrer" content="no-referrer-when-downgrade">
<meta name="format-detection" content="telephone=no">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes, minimum-scale=0.25, maximum-scale=5.0">
<link rel="icon" href="/favicon.ico">
<link rel="search" type="application/opensearchdescription+xml" href="/opensearch_desc.php" title="ArchWiki (en)">
<link rel="EditURI" type="application/rsd+xml" href="https://wiki.archlinux.org/api.php?action=rsd">
<link rel="license" href="https://www.gnu.org/copyleft/fdl.html">
<link rel="alternate" type="application/atom+xml" title="ArchWiki Atom feed" href="/index.php?title=Special:RecentChanges&amp;feed=atom">
</head>
<body class="skin-vector skin-vector-search-vue mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-Python_package_guidelines rootpage-Python_package_guidelines skin-vector-2022 action-view skin--responsive vector-feature-language-in-header-enabled vector-feature-language-in-main-page-header-disabled vector-feature-language-alert-in-sidebar-disabled vector-feature-sticky-header-disabled vector-feature-sticky-header-edit-disabled vector-feature-table-of-contents-disabled vector-feature-visual-enhancement-next-disabled">
<div class="mw-page-container">
	<span id="top-page"></span>
	<a class="mw-jump-link" href="#content">Jump to content</a>
	<div class="mw-page-container-inner">
		<input type="checkbox" id="mw-sidebar-checkbox" class="mw-checkbox-hack-checkbox">
		<div class="vector-sidebar-container ">
			</div>
		<div class="vector-sitenotice-container">
			<div id="siteNotice"></div>
		</div>
		<input type="checkbox" id="vector-toc-collapsed-checkbox" class="mw-checkbox-hack-checkbox">
		<div class="mw-table-of-contents-container">
			<div class="vector-sticky-toc-container mw-sticky-header-element">
				<nav id="mw-panel-toc" class="sidebar-toc" role="navigation" aria-labelledby="sidebar-toc-label" data-event-name="ui.sidebar-toc">
	<div id="sidebar-toc-label" class="sidebar-toc-header">
		<p class="sidebar-toc-title">
		Contents
		<button class="vector-toc-uncollapse-button">move to sidebar</button>
		<button class="vector-toc-collapse-button">hide</button>
		</p>
	</div>
	<ul class="sidebar-toc-contents" id="mw-panel-toc-list">
		<li id="toc-mw-content-text" class="sidebar-toc-list-item sidebar-toc-level-1">
			<a href="#top-page" class="sidebar-toc-link">
				<div class="sidebar-toc-text">Beginning</div>
			</a>
		</li>
		<li id="toc-Package_naming" class="sidebar-toc-list-item sidebar-toc-level-1 sidebar-toc-list-item-expanded">
			<a class="sidebar-toc-link" href="#Package_naming">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">1</span>Package naming</div>
			</a>
			
			<ul id="toc-Package_naming-sublist" class="sidebar-toc-list">
			</ul>
		</li>
		<li id="toc-Architecture" class="sidebar-toc-list-item sidebar-toc-level-1 sidebar-toc-list-item-expanded">
			<a class="sidebar-toc-link" href="#Architecture">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">2</span>Architecture</div>
			</a>
			
			<ul id="toc-Architecture-sublist" class="sidebar-toc-list">
			</ul>
		</li>
		<li id="toc-Source" class="sidebar-toc-list-item sidebar-toc-level-1 sidebar-toc-list-item-expanded">
			<a class="sidebar-toc-link" href="#Source">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">3</span>Source</div>
			</a>
			
			<ul id="toc-Source-sublist" class="sidebar-toc-list">
			</ul>
		</li>
		<li id="toc-Installation_methods" class="sidebar-toc-list-item sidebar-toc-level-1 sidebar-toc-list-item-expanded">
			<a class="sidebar-toc-link" href="#Installation_methods">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">4</span>Installation methods</div>
			</a>
			
				<button aria-controls="toc-Installation_methods-sublist" class="mw-ui-icon mw-ui-icon-wikimedia-expand mw-ui-icon-small sidebar-toc-toggle">
					Toggle Installation methods subsection
				</button>
			
			<ul id="toc-Installation_methods-sublist" class="sidebar-toc-list">
				<li id="toc-Standards_based_(PEP_517)" class="sidebar-toc-list-item sidebar-toc-level-2">
			<a class="sidebar-toc-link" href="#Standards_based_(PEP_517)">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">4.1</span>Standards based (PEP 517)</div>
			</a>
			
			<ul id="toc-Standards_based_(PEP_517)-sublist" class="sidebar-toc-list">
			</ul>
		</li>
		<li id="toc-setuptools_or_distutils" class="sidebar-toc-list-item sidebar-toc-level-2">
			<a class="sidebar-toc-link" href="#setuptools_or_distutils">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">4.2</span>setuptools or distutils</div>
			</a>
			
			<ul id="toc-setuptools_or_distutils-sublist" class="sidebar-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id="toc-Check" class="sidebar-toc-list-item sidebar-toc-level-1 sidebar-toc-list-item-expanded">
			<a class="sidebar-toc-link" href="#Check">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">5</span>Check</div>
			</a>
			
			<ul id="toc-Check-sublist" class="sidebar-toc-list">
			</ul>
		</li>
		<li id="toc-Tips_and_tricks" class="sidebar-toc-list-item sidebar-toc-level-1 sidebar-toc-list-item-expanded">
			<a class="sidebar-toc-link" href="#Tips_and_tricks">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">6</span>Tips and tricks</div>
			</a>
			
				<button aria-controls="toc-Tips_and_tricks-sublist" class="mw-ui-icon mw-ui-icon-wikimedia-expand mw-ui-icon-small sidebar-toc-toggle">
					Toggle Tips and tricks subsection
				</button>
			
			<ul id="toc-Tips_and_tricks-sublist" class="sidebar-toc-list">
				<li id="toc-Discovering_detached_PGP_signatures_on_PyPI" class="sidebar-toc-list-item sidebar-toc-level-2">
			<a class="sidebar-toc-link" href="#Discovering_detached_PGP_signatures_on_PyPI">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">6.1</span>Discovering detached PGP signatures on PyPI</div>
			</a>
			
			<ul id="toc-Discovering_detached_PGP_signatures_on_PyPI-sublist" class="sidebar-toc-list">
			</ul>
		</li>
		<li id="toc-Using_python_version" class="sidebar-toc-list-item sidebar-toc-level-2">
			<a class="sidebar-toc-link" href="#Using_python_version">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">6.2</span>Using python version</div>
			</a>
			
			<ul id="toc-Using_python_version-sublist" class="sidebar-toc-list">
			</ul>
		</li>
		<li id="toc-Using_site-packages" class="sidebar-toc-list-item sidebar-toc-level-2">
			<a class="sidebar-toc-link" href="#Using_site-packages">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">6.3</span>Using site-packages</div>
			</a>
			
			<ul id="toc-Using_site-packages-sublist" class="sidebar-toc-list">
			</ul>
		</li>
		<li id="toc-Test_directory_in_site-package" class="sidebar-toc-list-item sidebar-toc-level-2">
			<a class="sidebar-toc-link" href="#Test_directory_in_site-package">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">6.4</span>Test directory in site-package</div>
			</a>
			
			<ul id="toc-Test_directory_in_site-package-sublist" class="sidebar-toc-list">
			</ul>
		</li>
	</ul>
		</li>
	</ul>
</nav>

			</div>
		</div>
		<div class="mw-content-container">
			<main id="content" class="mw-body" role="main" style="margin: 0">
				<a id="top"></a>
				<nav class="vector-article-toolbar" aria-label="Tools" role="navigation">
					<div class="mw-article-toolbar-container">
						<div id="left-navigation">
							

<div id="p-associated-pages" class="vector-menu mw-portlet mw-portlet-associated-pages vector-menu-tabs">
	<div class="vector-menu-content">
		
		<ul class="vector-menu-content-list">
<li id="ca-nstab-main" class="selected mw-list-item"><a href="../en/Python_package_guidelines.html" title="View the content page [c]" accesskey="c"><span>Page</span></a></li>
<li id="ca-talk" class="mw-list-item"><a href="../en/Talk:Python_package_guidelines.html" rel="discussion" title="Discussion about the content page [t]" accesskey="t"><span>Discussion</span></a></li>
</ul>
		
	</div>
</div>

							

<div id="p-variants" class="vector-menu mw-portlet mw-portlet-variants emptyPortlet vector-menu-dropdown">
	<input type="checkbox" id="p-variants-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-p-variants" class="vector-menu-checkbox" aria-label="Change language variant">
	<label id="p-variants-label" for="p-variants-checkbox" class="vector-menu-heading ">
		<span class="vector-menu-heading-label">English</span>
	</label>
	<div class="vector-menu-content">
		
		<ul class="vector-menu-content-list"></ul>
		
	</div>
</div>

						</div>
						<div id="right-navigation" class="vector-collapsible ">
							

<div id="p-views" class="vector-menu mw-portlet mw-portlet-views vector-menu-tabs">
	<div class="vector-menu-content">
		
		<ul class="vector-menu-content-list">
<li id="ca-view" class="selected mw-list-item"><a href="../en/Python_package_guidelines.html"><span>Read</span></a></li>
<li id="ca-viewsource" class="mw-list-item"><a href="/index.php?title=Python_package_guidelines&amp;action=edit" title="This page is protected.
You can view its source [e]" accesskey="e"><span>View source</span></a></li>
<li id="ca-history" class="mw-list-item"><a href="/index.php?title=Python_package_guidelines&amp;action=history" title="Past revisions of this page [h]" accesskey="h"><span>View history</span></a></li>
</ul>
		
	</div>
</div>

							

<div id="p-cactions" class="vector-menu mw-portlet mw-portlet-cactions emptyPortlet vector-menu-dropdown vector-has-collapsible-items" title="More options">
	<input type="checkbox" id="p-cactions-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-p-cactions" class="vector-menu-checkbox">
	<label id="p-cactions-label" for="p-cactions-checkbox" class="vector-menu-heading ">
		<span class="vector-menu-heading-label">More</span>
	</label>
	<div class="vector-menu-content">
		
		<ul class="vector-menu-content-list">
<li id="ca-more-view" class="selected vector-more-collapsible-item mw-list-item"><a href="../en/Python_package_guidelines.html"><span>Read</span></a></li>
<li id="ca-more-viewsource" class="vector-more-collapsible-item mw-list-item"><a href="/index.php?title=Python_package_guidelines&amp;action=edit"><span>View source</span></a></li>
<li id="ca-more-history" class="vector-more-collapsible-item mw-list-item"><a href="/index.php?title=Python_package_guidelines&amp;action=history"><span>View history</span></a></li>
</ul>
		
	</div>
</div>

						</div>
					</div>
				</nav>
				<div id="bodyContent" class="vector-body" data-mw-ve-target-container>
					<div class="mw-body-subheader">
					        <div class="mw-indicators">
        </div>

					    <div id="siteSub" class="noprint">From ArchWiki</div>
					</div>
					
					
					
					<div id="mw-content-text" class="mw-body-content mw-content-ltr" lang="en" dir="ltr">
<div class="mw-parser-output">
<div class="toc" style="display:block; text-align: center; margin-bottom: 1em;">
<b><a href="../en/Arch_package_guidelines.html" title="Arch package guidelines">Arch package guidelines</a></b>
<hr>
<p><a href="../en/32-bit_package_guidelines.html" title="32-bit package guidelines">32-bit</a> – <a href="../en/CLR_package_guidelines.html" title="CLR package guidelines">CLR</a> – <a href="../en/CMake_package_guidelines.html" title="CMake package guidelines">CMake</a> – <a href="../en/Cross-compiling_tools_package_guidelines.html" title="Cross-compiling tools package guidelines">Cross</a> – <a href="../en/DKMS_package_guidelines.html" title="DKMS package guidelines">DKMS</a> – <a href="../en/Eclipse_plugin_package_guidelines.html" title="Eclipse plugin package guidelines">Eclipse</a> – <a href="../en/Electron_package_guidelines.html" title="Electron package guidelines">Electron</a> – <a href="../en/Font_package_guidelines.html" title="Font package guidelines">Font</a> – <a href="../en/Free_Pascal_package_guidelines.html" title="Free Pascal package guidelines">Free Pascal</a> – <a href="../en/GNOME_package_guidelines.html" title="GNOME package guidelines">GNOME</a> – <a href="../en/Go_package_guidelines.html" title="Go package guidelines">Go</a> – <a href="../en/Haskell_package_guidelines.html" title="Haskell package guidelines">Haskell</a> – <a href="../en/Java_package_guidelines.html" title="Java package guidelines">Java</a> – <a href="../en/KDE_package_guidelines.html" title="KDE package guidelines">KDE</a> – <a href="../en/Kernel_module_package_guidelines.html" title="Kernel module package guidelines">Kernel</a> – <a href="../en/Lisp_package_guidelines.html" title="Lisp package guidelines">Lisp</a> – <a href="../en/Meson_package_guidelines.html" title="Meson package guidelines">Meson</a> – <a href="../en/MinGW_package_guidelines.html" title="MinGW package guidelines">MinGW</a> – <a href="../en/Node.js_package_guidelines.html" title="Node.js package guidelines">Node.js</a> – <a href="../en/Nonfree_applications_package_guidelines.html" title="Nonfree applications package guidelines">Nonfree</a> – <a href="../en/OCaml_package_guidelines.html" title="OCaml package guidelines">OCaml</a> – <a href="../en/Perl_package_guidelines.html" title="Perl package guidelines">Perl</a> – <a href="../en/PHP_package_guidelines.html" title="PHP package guidelines">PHP</a> – <a class="mw-selflink selflink">Python</a> – <a href="../en/R_package_guidelines.html" title="R package guidelines">R</a> – <a href="../en/Ruby_package_guidelines.html" title="Ruby package guidelines">Ruby</a> – <a href="../en/Rust_package_guidelines.html" title="Rust package guidelines">Rust</a> – <a href="../en/Shell_package_guidelines.html" title="Shell package guidelines">Shell</a> – <a href="../en/VCS_package_guidelines.html" title="VCS package guidelines">VCS</a> – <a href="../en/Web_application_package_guidelines.html" title="Web application package guidelines">Web</a> – <a href="../en/Wine_package_guidelines.html" title="Wine package guidelines">Wine</a>
</p>
</div>
<p>This document covers standards and guidelines on writing <a href="../en/PKGBUILD.html" title="PKGBUILD">PKGBUILDs</a> for <a href="../en/Python.html" title="Python">Python</a> software.
</p>
<mw:tocplace></mw:tocplace>
<h2><span class="mw-headline" id="Package_naming">Package naming</span></h2>
<p>For <a href="../en/Python.html#Installation" title="Python">Python 3</a> library modules, use <code>python-<i>modulename</i></code>. Also use the prefix if the package provides a program that is strongly coupled to the Python ecosystem (e.g. <i>pip</i> or <i>tox</i>). For other applications, use only the program name.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> The package name should be entirely lowercase.</div>
<h2><span class="mw-headline" id="Architecture">Architecture</span></h2>
<p>See <a href="../en/PKGBUILD.html#arch" title="PKGBUILD">PKGBUILD#arch</a>.
</p>
<p>A Python package that contains C extensions is architecture-dependent. Otherwise it is most likely architecture-independent.
</p>
<p>Packages built using <a rel="nofollow" class="external text" href="https://setuptools.pypa.io/">setuptools</a> define their C extensions using the <code>ext_modules</code> keyword in <code>setup.py</code>.
</p>
<h2><span class="mw-headline" id="Source">Source</span></h2>
<p>Download URLs linked from the PyPI website include an unpredictable hash that needs to be fetched from the PyPI website each time a package must be updated. This makes them unsuitable for use in a PKGBUILD. PyPI <a rel="nofollow" class="external text" href="https://github.com/pypa/pypi-legacy/issues/438#issuecomment-226940730">provides</a> an alternative stable scheme: <a href="../en/PKGBUILD.html#source" title="PKGBUILD">PKGBUILD#source</a> <code>source=()</code> array should use the following URL templates:
</p>
<dl>
<dt>Source package</dt>
<dd></dd>
<dd><code>https://files.pythonhosted.org/packages/source/${_name::1}/$_name/$_name-$pkgver.tar.gz</code></dd>
<dt>Pure Python wheel package</dt>
<dd>
<code>https://files.pythonhosted.org/packages/py2.py3/${_name::1}/$_name/${_name//-/_}-$pkgver-py2.py3-none-any.whl</code> (Bilingual – Python 2 and Python 3 compatible)</dd>
<dd>
<code>https://files.pythonhosted.org/packages/py3/${_name::1}/$_name/${_name//-/_}-$pkgver-py3-none-any.whl</code> (Python 3 only)</dd>
<dd>Note that the distribution name can contain dashes, while its representation in a wheel filename cannot (they are converted to underscores).</dd>
<dt>Architecture specific wheel package</dt>
<dd>Additional architecture-specific arrays can be added by appending an underscore and the architecture name, e.g.  <code>source_x86_64=('...')</code>. Also <code>_py=cp310</code> can be used to not repeat the Python version:</dd>
<dd><code>https://files.pythonhosted.org/packages/$_py/${_name::1}/$_name/${_name//-/_}-$pkgver-$_py-${_py}m-manylinux1_x86_64.whl</code></dd>
</dl>
<p>Note that a custom <code><b>_name</b></code> variable is used instead of <code>pkgname</code> since Python packages are generally prefixed with <code>python-</code>. This variable can generically be defined as follows:
</p>
<pre>_name=${pkgname#python-}
</pre>
<h2><span class="mw-headline" id="Installation_methods">Installation methods</span></h2>
<p>Python packages are generally installed using language-specific package manager such as <a rel="nofollow" class="external text" href="https://pip.pypa.io/">pip</a>, which fetches packages from an online repository (usually <a rel="nofollow" class="external text" href="https://pypi.org/">PyPI</a>, the Python Package Index) and tracks the relevant files.
</p>
<p>However, for managing Python packages from within <code>PKGBUILD</code>s, one needs to "install" the Python package to the temporary location <code><i>$pkgdir</i>/usr/lib/python<i>&lt;Python version&gt;</i>/site-packages/<i>$pkgname</i></code>.
</p>
<p>For Python packages using <a rel="nofollow" class="external text" href="https://www.python.org/dev/peps/pep-0517/">standard metadata</a> to specify their build backend in <code>pyproject.toml</code>, this can most easily achieved using <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=python-build">python-build</a></span> and <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=python-installer">python-installer</a></span>.
Old packages might fail to specify that they use setuptools, and only offer a <code>setup.py</code> that has to be invoked manually.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> Dependencies from the package's metadata must be defined in the <code>depends</code> array otherwise they will not be installed.</div>
<h3>
<span id="Standards_based_.28PEP_517.29"></span><span class="mw-headline" id="Standards_based_(PEP_517)">Standards based (PEP 517)</span>
</h3>
<p>A standards based workflow is straightforward: Build a wheel using <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=python-build">python-build</a></span> and install it to <code>$pkgdir</code> using <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=python-installer">python-installer</a></span>:
</p>
<pre>makedepends=(python-build python-installer python-wheel)

build() {
    cd "$_name-$pkgver"
    python -m build --wheel --no-isolation
}

package() {
    cd "$_name-$pkgver"
    python -m installer --destdir="$pkgdir" dist/*.whl
}</pre>
<p>where
</p>
<ul>
<li>
<code>--wheel</code> results in only a wheel file to be built, no source distribution.</li>
<li>
<code>--no-isolation</code> means that the package is built using what is installed on your system (which includes packages you specified in <code>depends</code>), by default the tool creates an isolated virtual environment and performs the build there.</li>
<li>
<code>--destdir="$pkgdir"</code> prevents trying to directly install in the host system instead of inside the package file, which would result in a permission error</li>
<li>
<code>--compile-bytecode=...</code> or <code>--no-compile-bytecode</code> can be passed to <code>installer</code>, but the default is sensibly picked, so this should not be necessary.</li>
</ul>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Warning:</strong> Skipping <code>build</code> and putting the <code>.whl</code> file in your <code>source</code> array is discouraged in favor of building from source, and should only be used when the latter is not a viable option (for example, packages which <b>only</b> come with wheel sources, and therefore cannot be built from source).</div>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Warning:</strong> If your package is a <a href="../en/VCS_package_guidelines.html" title="VCS package guidelines">VCS package</a> (<code>python-…-git</code>), include the command <code>git -C "${srcdir}/${pkgname}" clean -dfx</code> in your <code>prepare</code> function. This removes stale wheels along with other build artifacts, and helps prevent issues further down the road. See also upstream issues for <a rel="nofollow" class="external text" href="https://github.com/pypa/setuptools/issues/1347">setuptools</a> and <a rel="nofollow" class="external text" href="https://github.com/python-poetry/poetry/issues/1329">Poetry</a>.</div>
<h3><span class="mw-headline" id="setuptools_or_distutils">setuptools or distutils</span></h3>
<p>If no <code>pyproject.toml</code> can be found or it fails to contain a <code>[build-system]</code> table, it means the project is using the old legacy format, which uses a <i>setup.py</i> file which invokes <i>setuptools</i> or <i>distutils</i>. Note that while <i>distutils</i> is included in Python's standardlib, having <i>setuptools</i> installed means that you use a patched version of <i>distutils</i>.
</p>
<pre>makedepends=('python-setuptools')  # unless it only requires distutils

build() {
    cd "$_name-$pkgver"
    python setup.py build
}

package() {
    cd "$_name-$pkgver"
    python setup.py install --root="$pkgdir" --optimize=1
}</pre>
<p>where:
</p>
<ul>
<li>
<code>--root="$pkgdir"</code> works like <code>--destdir</code> above</li>
<li>
<code>--optimize=1</code> compiles optimized bytecode files (<i>.opt-1.pyc</i>) so they can be tracked by <a href="../en/Pacman.html" title="Pacman">pacman</a> instead of being created on the host system on demand.</li>
<li>Adding <code>--skip-build</code> optimizes away the unnecessary attempt to re-run the build steps already run in the <code>build()</code> function, if that is the case.</li>
</ul>
<p>If the resulting package includes executables which <a rel="nofollow" class="external text" href="https://setuptools.readthedocs.io/en/latest/setuptools.html#automatic-script-creation">import the deprecated pkg_resources module</a>, then <i>setuptools</i> must be additionally specified as a <code>depends</code> in the split <code>package_*()</code> functions; alternatively, if the PKGBUILD only installs the Python package for a single version of Python, <i>setuptools</i> should be moved from <code>makedepends</code> to <code>depends</code>.
</p>
<p>Some packages try to use <i>setuptools</i> and fall back to <i>distutils</i> if <i>setuptools</i> could not be imported. In this case, setuptools should be added as a <code>makedepends</code>, so that the resulting Python metadata is better.
</p>
<p>If a package needs <i>setuptools</i> to be built due to including executables (which is not supported by <i>distutils</i>), but only imports <i>distutils</i>, then building will raise a warning, and the resulting package will be broken (it will not contain the executables):
</p>
<pre>/usr/lib/python3.8/distutils/dist.py:274: UserWarning: Unknown distribution option: 'entry_points'
  warnings.warn(msg)</pre>
<p>An upstream bug should be reported. To work around the problem, an undocumented setuptools feature can be used:
</p>
<pre># fails because of distutils
python setup.py build

# works by using a setuptools shim
python -m setuptools.launch setup.py build</pre>
<p>If a package uses <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=python-setuptools-scm">python-setuptools-scm</a></span>, the package most likely will not build with an error such as:
</p>
<pre>LookupError: setuptools-scm was unable to detect version for /build/python-jsonschema/src/jsonschema-3.2.0.

Make sure you're either building from a fully intact git repository or PyPI tarballs. Most other sources (such as GitHub's tarballs, a git checkout without the .git folder) don't contain the necessary metadata and will not work.</pre>
<p>To get it building <code>SETUPTOOLS_SCM_PRETEND_VERSION</code> has to be exported as an environment variable with <code>$pkgver</code> as the value:
</p>
<pre>export SETUPTOOLS_SCM_PRETEND_VERSION=$pkgver
</pre>
<h2><span class="mw-headline" id="Check">Check</span></h2>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Warning:</strong> Avoid using <code>tox</code> to run testsuites as it is explicitly designed to test repeatable configurations downloaded from PyPI while <code>tox</code> is running, and does <b>not</b> test the version that will be installed by the package. This defeats the purpose of having a <i>check</i> function at all.</div>
<p>Most Python projects providing a testsuite use nosetests or pytest to run tests with <code>test</code> in the name of the file or directory containing the testsuite. In general, simply running <code>nosetests</code> or <code>pytest</code> is enough to run the testsuite.
</p>
<pre>check(){
    cd "$srcdir/foo-$pkgver"

    # For nosetests
    nosetests

    # For pytest
    pytest
}
</pre>
<p>If there is a compiled C extension, the tests need to be run using a <code>$PYTHONPATH</code>, that reflects the current major and minor version of Python in order to find and load it.
</p>
<pre>check(){
  cd "$pkgname-$pkgver"
  local python_version=$(python -c 'import sys; print("".join(map(str, sys.version_info[:2])))')
  # For nosetests
  PYTHONPATH="$PWD/build/lib.linux-$CARCH-cpython-${python_version}" nosetests

  # For pytest
  PYTHONPATH="$PWD/build/lib.linux-$CARCH-cpython-${python_version}" pytest
}</pre>
<p>Some projects provide <code>setup.py</code> entry points for running the test. This works for both <code>pytest</code> and <code>nosetests</code>.
</p>
<pre>check(){
    cd "$srcdir/foo-$pkgver"

    # For nosetests
    python setup.py nosetests

    # For pytest - needs python-pytest-runner
    python setup.py pytest
}
</pre>
<h2><span class="mw-headline" id="Tips_and_tricks">Tips and tricks</span></h2>
<h3><span class="mw-headline" id="Discovering_detached_PGP_signatures_on_PyPI">Discovering detached PGP signatures on PyPI</span></h3>
<p>If detached PGP signatures for a given Python sdist tarball exist, they should be used to verify the tarball. However, the signature files do not show up directly in the files download section of any given project on pypi.org. To discover the sdist tarballs and their potential signature files, it is possible to use this service to get an overview per project: <a rel="nofollow" class="external free" href="https://pypi.debian.net/">https://pypi.debian.net/</a>
</p>
<p>For <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=python-requests">python-requests</a></span>, this would be <a rel="nofollow" class="external free" href="https://pypi.debian.net/requests">https://pypi.debian.net/requests</a>.
</p>
<h3><span class="mw-headline" id="Using_python_version">Using python version</span></h3>
<p>Sometimes during preparing, building, testing or installation it is required to refer to the system's major and minor Python version. Do not hardcode this (e.g. <code>3.9</code> or <code>3.10</code>) and instead use a call to the Python interpreter to retrieve the information and store it in a local variable:
</p>
<pre>check(){
  local python_version=$(python -c 'import sys; print(".".join(map(str, sys.version_info[:2])))')
  ...
}</pre>
<h3><span class="mw-headline" id="Using_site-packages">Using site-packages</span></h3>
<p>Sometimes during building, testing or installation it is required to refer to the system's <code>site-packages</code> directory. Do not hardcode this directory and use a call to the Python interpreter instead to retrieve the path and store it in a local variable:
</p>
<pre>check(){
  local site_packages=$(python -c "import site; print(site.getsitepackages()[0])")
  ...
}</pre>
<h3><span class="mw-headline" id="Test_directory_in_site-package">Test directory in site-package</span></h3>
<p>Make sure to not install a directory named just <code>tests</code> into <code>site-packages</code> (i.e. <code>/usr/lib/pythonX.Y/site-packages/tests/</code>). Python package projects using setuptools are sometimes misconfigured to include the directory containing its tests as a top level Python package. If you encounter this, you can help by filing an issue with the package project and ask them to fix this, e.g. <a rel="nofollow" class="external text" href="https://github.com/Lightning-AI/lightning/issues/10335">like this</a>.
</p>
</div>
</div>
					<div id="catlinks" class="catlinks" data-mw="interface"><div id="mw-normal-catlinks" class="mw-normal-catlinks">
<a href="../Special:Categories.html" title="Special:Categories">Category</a>: <ul><li><a href="../en/Category:Arch_package_guidelines.html" title="Category:Arch package guidelines">Arch package guidelines</a></li></ul>
</div></div>
				</div>
			</main>
			
		</div>
		<div class="mw-footer-container">
			
<footer id="footer" class="mw-footer" role="contentinfo" style="margin: 0">
	<ul id="footer-info">
	<li data-nosnippet="">Retrieved from "<a dir="ltr" href="https://wiki.archlinux.org/index.php?title=Python_package_guidelines&amp;oldid=781620">https://wiki.archlinux.org/index.php?title=Python_package_guidelines&amp;oldid=781620</a>"</li>
<li id="footer-info-lastmod"> This page was last edited on 21 June 2023, at 09:51.</li>
	<li id="footer-info-copyright">Content is available under <a class="external" rel="nofollow" href="https://www.gnu.org/copyleft/fdl.html">GNU Free Documentation License 1.3 or later</a> unless otherwise noted.</li>
<br>
</ul>

	<ul id="footer-places">
	<li id="footer-places-privacy"><a href="https://terms.archlinux.org/docs/privacy-policy/">Privacy policy</a></li>
	<li id="footer-places-about"><a href="../en/ArchWiki:About.html">About ArchWiki</a></li>
	<li id="footer-places-disclaimer"><a href="../en/ArchWiki:General_disclaimer.html">Disclaimers</a></li>
</ul>

	
</footer>

		</div>
	</div> 
</div> 

</body>
</html>
