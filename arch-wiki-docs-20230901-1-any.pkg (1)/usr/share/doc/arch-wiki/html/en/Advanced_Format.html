<!DOCTYPE html>
<html class="client-nojs" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<title>Advanced Format - ArchWiki</title>
<link rel="stylesheet" href="../ArchWikiOffline.css">
<meta name="ResourceLoaderDynamicStyles" content="">
<meta name="generator" content="MediaWiki 1.39.4">
<meta name="referrer" content="no-referrer-when-downgrade">
<meta name="format-detection" content="telephone=no">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes, minimum-scale=0.25, maximum-scale=5.0">
<link rel="icon" href="/favicon.ico">
<link rel="search" type="application/opensearchdescription+xml" href="/opensearch_desc.php" title="ArchWiki (en)">
<link rel="EditURI" type="application/rsd+xml" href="https://wiki.archlinux.org/api.php?action=rsd">
<link rel="license" href="https://www.gnu.org/copyleft/fdl.html">
<link rel="alternate" type="application/atom+xml" title="ArchWiki Atom feed" href="/index.php?title=Special:RecentChanges&amp;feed=atom">
</head>
<body class="skin-vector skin-vector-search-vue mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-Advanced_Format rootpage-Advanced_Format skin-vector-2022 action-view skin--responsive vector-feature-language-in-header-enabled vector-feature-language-in-main-page-header-disabled vector-feature-language-alert-in-sidebar-disabled vector-feature-sticky-header-disabled vector-feature-sticky-header-edit-disabled vector-feature-table-of-contents-disabled vector-feature-visual-enhancement-next-disabled">
<div class="mw-page-container">
	<span id="top-page"></span>
	<a class="mw-jump-link" href="#content">Jump to content</a>
	<div class="mw-page-container-inner">
		<input type="checkbox" id="mw-sidebar-checkbox" class="mw-checkbox-hack-checkbox">
		<div class="vector-sidebar-container ">
			</div>
		<div class="vector-sitenotice-container">
			<div id="siteNotice"></div>
		</div>
		<input type="checkbox" id="vector-toc-collapsed-checkbox" class="mw-checkbox-hack-checkbox">
		<div class="mw-table-of-contents-container">
			<div class="vector-sticky-toc-container mw-sticky-header-element">
				<nav id="mw-panel-toc" class="sidebar-toc" role="navigation" aria-labelledby="sidebar-toc-label" data-event-name="ui.sidebar-toc">
	<div id="sidebar-toc-label" class="sidebar-toc-header">
		<p class="sidebar-toc-title">
		Contents
		<button class="vector-toc-uncollapse-button">move to sidebar</button>
		<button class="vector-toc-collapse-button">hide</button>
		</p>
	</div>
	<ul class="sidebar-toc-contents" id="mw-panel-toc-list">
		<li id="toc-mw-content-text" class="sidebar-toc-list-item sidebar-toc-level-1">
			<a href="#top-page" class="sidebar-toc-link">
				<div class="sidebar-toc-text">Beginning</div>
			</a>
		</li>
		<li id="toc-Changing_sector_size" class="sidebar-toc-list-item sidebar-toc-level-1 sidebar-toc-list-item-expanded">
			<a class="sidebar-toc-link" href="#Changing_sector_size">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">1</span>Changing sector size</div>
			</a>
			
				<button aria-controls="toc-Changing_sector_size-sublist" class="mw-ui-icon mw-ui-icon-wikimedia-expand mw-ui-icon-small sidebar-toc-toggle">
					Toggle Changing sector size subsection
				</button>
			
			<ul id="toc-Changing_sector_size-sublist" class="sidebar-toc-list">
				<li id="toc-Advanced_Format_hard_disk_drives" class="sidebar-toc-list-item sidebar-toc-level-2">
			<a class="sidebar-toc-link" href="#Advanced_Format_hard_disk_drives">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">1.1</span>Advanced Format hard disk drives</div>
			</a>
			
			<ul id="toc-Advanced_Format_hard_disk_drives-sublist" class="sidebar-toc-list">
			</ul>
		</li>
		<li id="toc-NVMe_solid_state_drives" class="sidebar-toc-list-item sidebar-toc-level-2">
			<a class="sidebar-toc-link" href="#NVMe_solid_state_drives">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">1.2</span>NVMe solid state drives</div>
			</a>
			
			<ul id="toc-NVMe_solid_state_drives-sublist" class="sidebar-toc-list">
			</ul>
		</li>
		<li id="toc-Using_manufacturer_specific_programs" class="sidebar-toc-list-item sidebar-toc-level-2">
			<a class="sidebar-toc-link" href="#Using_manufacturer_specific_programs">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">1.3</span>Using manufacturer specific programs</div>
			</a>
			
			<ul id="toc-Using_manufacturer_specific_programs-sublist" class="sidebar-toc-list">
				<li id="toc-Intel" class="sidebar-toc-list-item sidebar-toc-level-3">
			<a class="sidebar-toc-link" href="#Intel">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">1.3.1</span>Intel</div>
			</a>
			
			<ul id="toc-Intel-sublist" class="sidebar-toc-list">
			</ul>
		</li>
		<li id="toc-Seagate" class="sidebar-toc-list-item sidebar-toc-level-3">
			<a class="sidebar-toc-link" href="#Seagate">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">1.3.2</span>Seagate</div>
			</a>
			
			<ul id="toc-Seagate-sublist" class="sidebar-toc-list">
			</ul>
		</li>
	</ul>
		</li>
	</ul>
		</li>
		<li id="toc-Partition_alignment" class="sidebar-toc-list-item sidebar-toc-level-1 sidebar-toc-list-item-expanded">
			<a class="sidebar-toc-link" href="#Partition_alignment">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">2</span>Partition alignment</div>
			</a>
			
			<ul id="toc-Partition_alignment-sublist" class="sidebar-toc-list">
			</ul>
		</li>
		<li id="toc-dm-crypt" class="sidebar-toc-list-item sidebar-toc-level-1 sidebar-toc-list-item-expanded">
			<a class="sidebar-toc-link" href="#dm-crypt">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">3</span>dm-crypt</div>
			</a>
			
			<ul id="toc-dm-crypt-sublist" class="sidebar-toc-list">
			</ul>
		</li>
		<li id="toc-File_systems" class="sidebar-toc-list-item sidebar-toc-level-1 sidebar-toc-list-item-expanded">
			<a class="sidebar-toc-link" href="#File_systems">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">4</span>File systems</div>
			</a>
			
			<ul id="toc-File_systems-sublist" class="sidebar-toc-list">
			</ul>
		</li>
		<li id="toc-See_also" class="sidebar-toc-list-item sidebar-toc-level-1 sidebar-toc-list-item-expanded">
			<a class="sidebar-toc-link" href="#See_also">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">5</span>See also</div>
			</a>
			
			<ul id="toc-See_also-sublist" class="sidebar-toc-list">
			</ul>
		</li>
	</ul>
</nav>

			</div>
		</div>
		<div class="mw-content-container">
			<main id="content" class="mw-body" role="main" style="margin: 0">
				<a id="top"></a>
				<nav class="vector-article-toolbar" aria-label="Tools" role="navigation">
					<div class="mw-article-toolbar-container">
						<div id="left-navigation">
							

<div id="p-associated-pages" class="vector-menu mw-portlet mw-portlet-associated-pages vector-menu-tabs">
	<div class="vector-menu-content">
		
		<ul class="vector-menu-content-list">
<li id="ca-nstab-main" class="selected mw-list-item"><a href="../en/Advanced_Format.html" title="View the content page [c]" accesskey="c"><span>Page</span></a></li>
<li id="ca-talk" class="mw-list-item"><a href="../en/Talk:Advanced_Format.html" rel="discussion" title="Discussion about the content page [t]" accesskey="t"><span>Discussion</span></a></li>
</ul>
		
	</div>
</div>

							

<div id="p-variants" class="vector-menu mw-portlet mw-portlet-variants emptyPortlet vector-menu-dropdown">
	<input type="checkbox" id="p-variants-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-p-variants" class="vector-menu-checkbox" aria-label="Change language variant">
	<label id="p-variants-label" for="p-variants-checkbox" class="vector-menu-heading ">
		<span class="vector-menu-heading-label">English</span>
	</label>
	<div class="vector-menu-content">
		
		<ul class="vector-menu-content-list"></ul>
		
	</div>
</div>

						</div>
						<div id="right-navigation" class="vector-collapsible ">
							

<div id="p-views" class="vector-menu mw-portlet mw-portlet-views vector-menu-tabs">
	<div class="vector-menu-content">
		
		<ul class="vector-menu-content-list">
<li id="ca-view" class="selected mw-list-item"><a href="../en/Advanced_Format.html"><span>Read</span></a></li>
<li id="ca-viewsource" class="mw-list-item"><a href="/index.php?title=Advanced_Format&amp;action=edit" title="This page is protected.
You can view its source [e]" accesskey="e"><span>View source</span></a></li>
<li id="ca-history" class="mw-list-item"><a href="/index.php?title=Advanced_Format&amp;action=history" title="Past revisions of this page [h]" accesskey="h"><span>View history</span></a></li>
</ul>
		
	</div>
</div>

							

<div id="p-cactions" class="vector-menu mw-portlet mw-portlet-cactions emptyPortlet vector-menu-dropdown vector-has-collapsible-items" title="More options">
	<input type="checkbox" id="p-cactions-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-p-cactions" class="vector-menu-checkbox">
	<label id="p-cactions-label" for="p-cactions-checkbox" class="vector-menu-heading ">
		<span class="vector-menu-heading-label">More</span>
	</label>
	<div class="vector-menu-content">
		
		<ul class="vector-menu-content-list">
<li id="ca-more-view" class="selected vector-more-collapsible-item mw-list-item"><a href="../en/Advanced_Format.html"><span>Read</span></a></li>
<li id="ca-more-viewsource" class="vector-more-collapsible-item mw-list-item"><a href="/index.php?title=Advanced_Format&amp;action=edit"><span>View source</span></a></li>
<li id="ca-more-history" class="vector-more-collapsible-item mw-list-item"><a href="/index.php?title=Advanced_Format&amp;action=history"><span>View history</span></a></li>
</ul>
		
	</div>
</div>

						</div>
					</div>
				</nav>
				<div id="bodyContent" class="vector-body" data-mw-ve-target-container>
					<div class="mw-body-subheader">
					        <div class="mw-indicators">
        </div>

					    <div id="siteSub" class="noprint">From ArchWiki</div>
					</div>
					
					
					
					<div id="mw-content-text" class="mw-body-content mw-content-ltr" lang="en" dir="ltr">
<div class="mw-parser-output">
<div class="noprint archwiki-template-message">
<p><a href="../File:Tango-go-next.png" class="image"><img alt="Tango-go-next.png" src="../File:Tango-go-next.png" decoding="async" width="48" height="48"></a><b>This article or section is a candidate for moving to <a href="/index.php?title=Storage_layout_and_alignment&amp;action=edit&amp;redlink=1" class="new" title="Storage layout and alignment (page does not exist)">Storage layout and alignment</a>.</b><a href="../File:Tango-go-next.png" class="image"><img alt="Tango-go-next.png" src="../File:Tango-go-next.png" decoding="async" width="48" height="48"></a></p>
<div>
<b>Notes:</b> "Advanced Format" is HDD-specific. (Discuss in <a href="../en/Talk:Advanced_Format.html#Rewrite_Advanced_Format_to_a_new_Sector_Sizes_page" title="Talk:Advanced Format">Talk:Advanced Format#Rewrite Advanced Format to a new Sector Sizes page</a>)</div>
</div>
<p>The minimum physical storage unit of a hard disk drive (HDD) is a <a href="https://en.wikipedia.org/wiki/Disk_sector" class="extiw" title="wikipedia:Disk sector">sector</a>. The solid state drive (SSD) equivalent is a page.<a rel="nofollow" class="external autonumber" href="https://www.oo-software.com/en/docs/whitepaper/whitepaper_ssd.pdf">[1]</a> Storage device firmware abstract away their physical sectors into logical sectors that software can operate on. The size of this sector refers to the size of the smallest addressable unit on the disk.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> Software and documentation may sometimes refer to "sectors" and "blocks" interchangeably, regardless of the storage type.</div>
<dl>
<dt>Physical sector size</dt>
<dd>This is the smallest unit a physical storage device claims it can write atomically. For HDDs, it is the actual size of sectors in a platter. Traditionally, the physical sector size for HDDs was 512 bytes, meaning that each sector could hold 512 bytes of data. However, with the introduction of <a href="https://en.wikipedia.org/wiki/Advanced_Format#History" class="extiw" title="wikipedia:Advanced Format">Advanced Format</a> HDDs, the physical sector size was increased to 4096 bytes (4 KiB) for increased storage density and improved error correction capabilities. SSDs do not expose their actual NAND flash memory page size, which typically ranges from 4 KiB to 16 KiB, instead their reported physical sector size is the same as their logical sector size. For NVMe SSDs, if it is available, the Atomic Write Unit Power Fail (AWUPF) parameter value is used.</dd>
<dt>Logical sector size</dt>
<dd>The logical sector size, also known as the operating system sector size, represents the size of the sectors exposed to the operating system and applications. It is the sector size used for reading from and writing to the storage device at the software level. The logical sector size can differ from the physical sector size. For example, an Advanced Format HDD with a physical sector size of 4096 bytes may still present a logical sector size of 512 bytes for compatibility with older systems and applications.</dd>
</dl>
<p>The different "layers", namely the device, stacked block devices, and file systems, should utilize the same sector sizes. If they do not, the mapping process from the firmware's translation layer, although usually transparent, will result in overhead that can be avoided.
</p>
<p>The current physical and logical sector sizes values can be listed with <a href="../en/Device_file.html#lsblk" class="mw-redirect" title="Lsblk">lsblk</a>:
</p>
<div class="noprint archwiki-template-message">
<p><a href="../File:Tango-inaccurate.png" class="image"><img alt="Tango-inaccurate.png" src="../File:Tango-inaccurate.png" decoding="async" width="48" height="48"></a><b>The factual accuracy of this article or section is disputed.</b><a href="../File:Tango-inaccurate.png" class="image"><img alt="Tango-inaccurate.png" src="../File:Tango-inaccurate.png" decoding="async" width="48" height="48"></a></p>
<div>
<b>Reason:</b> Neither of the commands below (<code>lsblk</code> or <code>cat /sys/class...</code>) will accurately provide the physical sector size on NVMe drives (probably all SSDs), and will report the logical sector size instead. (Discuss in <a rel="nofollow" class="external text" href="https://wiki.archlinux.org/title/Talk:Advanced_Format">Talk:Advanced Format</a>)</div>
</div>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">$ lsblk -td</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">NAME    ALIGNMENT MIN-IO OPT-IO PHY-SEC LOG-SEC ROTA SCHED       RQ-SIZE  RA WSAME
sda             0   4096      0    4096    4096    1 mq-deadline      64 128    0B
nvme1n1         0   4096      0    4096    4096    0 none           1023 128    0B
nvme0n1         0   4096      0    4096    4096    0 none           1023 128    0B
</pre>
<p>The <code>PHY-SEC</code> shows the physical sector size and <code>LOG-SEC</code>—the logical sector size.
</p>
<p>Alternatively, the values for a specific drive can read from the following sysfs entries: 
</p>
<pre>$ cat /sys/class/block/<i>drive</i>/queue/physical_block_size
$ cat /sys/class/block/<i>drive</i>/queue/logical_block_size
</pre>
<p>Sector sizes can also be seen in <a href="../en/Fdisk.html" title="Fdisk">fdisk</a>, <a href="../en/S.M.A.R.T..html#smartctl" class="mw-redirect" title="Smartctl">smartctl</a> and <a href="../en/Hdparm.html" title="Hdparm">hdparm</a> output.
</p>
<mw:tocplace></mw:tocplace>
<h2><span class="mw-headline" id="Changing_sector_size">Changing sector size</span></h2>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Warning:</strong> Changing a drive's sector size will irrevocably erase all the data on the drive.</div>
<p>Some NVMe drives and "enterprise" SATA hard disk drives support changing their reported sector size using standard NVMe (<code>Format NVM</code> from NVM Command Set Specification 1.0 or later) or ATA (<code>SET SECTOR CONFIGURATION EXT</code> from ATA Command Set - 4 or later) commands, respectively. For hard disk drives this changes the logical sector size in order to match the physical sector size for optimal performance. While for NVMe solid state drives, both the logical and physical sector size values get changed.
</p>
<p>SATA solid state drives typically do not support changing their sector size. Exception are certain Intel SATA SSDs that can change the reported physical sector size, but not the logical sector size.<a rel="nofollow" class="external autonumber" href="https://superuser.com/q/982680">[2]</a> Follow <a href="#Intel">#Intel</a> to change their reported physical sector size.
</p>
<p>Changing the sector size of a drive is a complex process that requires low-level formatting. As an alternative, you can manually specify the desired sector size when creating file systems on the drive to get optimal performance. See <a href="#dm-crypt">#dm-crypt</a> and <a href="#File_systems">#File systems</a>.
</p>
<h3><span class="mw-headline" id="Advanced_Format_hard_disk_drives">Advanced Format hard disk drives</span></h3>
<p>To determine if the sector size of an Advanced Format hard disk drive can be changed, use the <a href="../en/Hdparm.html" title="Hdparm">hdparm</a> utility:
</p>
<pre># hdparm -I /dev/sd<i>X</i> | grep 'Sector size:'
</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> For USB-attached drives, the USB bridge needs to support <a href="https://en.wikipedia.org/wiki/SCSI_/_ATA_Translation" class="extiw" title="wikipedia:SCSI / ATA Translation">SAT aka SCSI/ATA Translation</a> (ANSI INCITS 431-2007).</div>
<p>Advanced Format drives whose Sector Configuration Log lists multiple logical sector sizes will show a list of them:
</p>
<pre>        Logical  Sector size:                   512 bytes [ Supported: 512 4096 ]
        Physical Sector size:                  4096 bytes
</pre>
<p>Hard disk drives which do not support multiple changeable logical sector sizes will simply report the current sector sizes. E.g., an Advanced Format 512e drive:
</p>
<pre>        Logical  Sector size:                   512 bytes
        Physical Sector size:                  4096 bytes
</pre>
<p>For optimal performance on these types of drives, ensure the <a href="#dm-crypt">#dm-crypt</a> sector size or <a href="#File_systems">#File systems</a> block size is at least 4096 bytes and aligns to it.
</p>
<p>An Advanced Format 4Kn drive:
</p>
<pre>        Logical  Sector size:                  4096 bytes
        Physical Sector size:                  4096 bytes
</pre>
<p>4Kn drives already have the optimal configuration out of the box and do not need special considerations when partitioning/formatting. They can be simply used as is.
</p>
<p>If your SATA HDD supports multiple logical sector sizes and the optional ATA command <code>SET SECTOR CONFIGURATION EXT</code> (e.g. Seagate drives advertising FastFormat support), you can use <i>hdparm</i> to change between the supported logical sector sizes. To set it to 4096 bytes, i.e. 4Kn, run:
</p>
<pre># hdparm --set-sector-size 4096 --please-destroy-my-drive /dev/sd<i>X</i>
</pre>
<p>Afterwards, <i>hdparm</i> should report the logical sector size as 4096 bytes:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;"># hdparm -I /dev/sd<i>X</i> | grep 'Sector size:'</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">        Logical  Sector size:                  4096 bytes [ Supported: 512 4096 ]
        Physical Sector size:                  4096 bytes
</pre>
<h3><span class="mw-headline" id="NVMe_solid_state_drives">NVMe solid state drives</span></h3>
<p>Most <a href="../en/Solid_state_drive.html" title="Solid state drive">solid state drives</a> (SSDs) report their logical block address size as 512 bytes, even though they use larger blocks physically - typically 4 KiB, 8 KiB, or sometimes larger.
</p>
<p>To check the formatted logical block address size (FLBAS) of an <a href="../en/Solid_state_drive/NVMe.html" class="mw-redirect" title="NVMe">NVMe</a> drive, use the <i>Identify Namespace</i> command:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;"># nvme id-ns -H /dev/nvme0n1 | grep "Relative Performance"</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">LBA Format  0 : Metadata Size: 0   bytes - Data Size: 512 bytes - Relative Performance: 0x2 Good (in use)
LBA Format  1 : Metadata Size: 0   bytes - Data Size: 4096 bytes - Relative Performance: 0x1 Better
</pre>
<ul>
<li>
<code>Metadata Size</code> is (probably) the number of extra metadata bytes per sector, and this is not well supported under Linux so best to select a format with a value of 0 here.</li>
<li>
<code>Relative Performance</code> indicates which format will provide <i>good</i>, <i>better</i> or the <i>best</i> performance.</li>
</ul>
<p><a href="../en/S.M.A.R.T..html#smartctl" class="mw-redirect" title="Smartctl">smartctl</a> can also display the supported logical block address sizes, but it does not provide user friendly descriptions. E.g.:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;"># smartctl -c /dev/nvme0n1</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">...
Supported LBA Sizes (NSID 0x1)
Id Fmt  Data  Metadt  Rel_Perf
 0 +     512       0         2
 1 -    4096       0         1
</pre>
<p>To change the logical block address size, use <code>nvme format</code> and specify the preferred value with the <code>--lbaf</code> parameter:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;"># nvme format --lbaf=1 /dev/nvme0n1</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">You are about to format nvme0n1, namespace 0x1.
WARNING: Format may irrevocably delete this device's data.
You have 10 seconds to press Ctrl-C to cancel this operation.

Use the force [--force] option to suppress this warning.
Sending format operation ... 
Success formatting namespace:1</pre>
<p>This should take just a few seconds to proceed.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> Make sure to follow <a href="#Partition_alignment">#Partition alignment</a> when partitioning, otherwise any performance benefit will be void.</div>
<div class="noprint archwiki-template-message">
<p><a href="../File:Tango-inaccurate.png" class="image"><img alt="Tango-inaccurate.png" src="../File:Tango-inaccurate.png" decoding="async" width="48" height="48"></a><b>The factual accuracy of this article or section is disputed.</b><a href="../File:Tango-inaccurate.png" class="image"><img alt="Tango-inaccurate.png" src="../File:Tango-inaccurate.png" decoding="async" width="48" height="48"></a></p>
<div>
<b>Reason:</b> Before fiddling with power state or UEFI settings, users are encouraged to use native <code>nvme</code> commands to check operation logs, or soft reset the controller with <i>e.g.</i> <code>nvme reset</code>. (Discuss in <a rel="nofollow" class="external text" href="https://wiki.archlinux.org/title/Talk:Advanced_Format">Talk:Advanced Format</a>)</div>
</div>
<p>Drives older than 2020 can block the <code>Format NVM</code> command when used on systems that issue a non-standard "security freeze" at the end of POST.<a rel="nofollow" class="external autonumber" href="https://github.com/linux-nvme/nvme-cli/issues/816">[3]</a><a rel="nofollow" class="external autonumber" href="https://forums.lenovo.com/topic/findpost/1300/5043069/5167342">[4]</a> If <code>nvme format</code> fails, try to <a href="../en/Systemd.html#Power_management" title="Systemd">suspend the system</a> (make sure to <a href="../en/Power_management/Suspend_and_hibernate.html#Changing_suspend_method" title="Power management/Suspend and hibernate">use S3 sleep not S0ix</a>) and then try running <code>nvme format</code> again after waking it.<a rel="nofollow" class="external autonumber" href="https://github.com/linux-nvme/nvme-cli/issues/84">[5]</a><a rel="nofollow" class="external autonumber" href="https://community.wd.com/t/sn750-cannot-format-using-the-nvme-command/254374">[6]</a>
</p>
<h3><span class="mw-headline" id="Using_manufacturer_specific_programs">Using manufacturer specific programs</span></h3>
<p>If the above generic utilities do not allow changing the sector size, it may still be possible to change it using an utility from the drive's manufacturer.
</p>
<h4><span class="mw-headline" id="Intel">Intel</span></h4>
<div class="noprint archwiki-template-message">
<p><a href="../File:Tango-view-refresh-red.png" class="image"><img alt="Tango-view-refresh-red.png" src="../File:Tango-view-refresh-red.png" decoding="async" width="48" height="48"></a><b>This article or section is out of date.</b><a href="../File:Tango-view-refresh-red.png" class="image"><img alt="Tango-view-refresh-red.png" src="../File:Tango-view-refresh-red.png" decoding="async" width="48" height="48"></a></p>
<div>
<b>Reason:</b> Ever since Intel's SSD business was bought by SK Hynix under the Solidigm brand, Intel MAS cannot be used to manage SSDs, only Optane products. Solidigm provides <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/solidigm-sst-storage-tool-cli/">solidigm-sst-storage-tool-cli</a></span><sup><small>AUR</small></sup> to perform the same functions Intel MAS used to offer: see <a href="../en/Solid_state_drive/NVMe.html#Intel/Solidigm" title="Solid state drive/NVMe">Solid_state_drive/NVMe#Intel/Solidigm</a>. (Discuss in <a rel="nofollow" class="external text" href="https://wiki.archlinux.org/title/Talk:Advanced_Format">Talk:Advanced Format</a>)</div>
</div>
<div class="noprint archwiki-template-message">
<p><a href="../File:Tango-view-fullscreen.png" class="image"><img alt="Tango-view-fullscreen.png" src="../File:Tango-view-fullscreen.png" decoding="async" width="48" height="48"></a><b>This article or section needs expansion.</b><a href="../File:Tango-view-fullscreen.png" class="image"><img alt="Tango-view-fullscreen.png" src="../File:Tango-view-fullscreen.png" decoding="async" width="48" height="48"></a></p>
<div>
<b>Reason:</b> Intel's tool only changes the reported physical sector size, the logical sector size still remains 512 bytes.<a rel="nofollow" class="external autonumber" href="https://superuser.com/q/982680">[7]</a> (Discuss in <a rel="nofollow" class="external text" href="https://wiki.archlinux.org/title/Talk:Advanced_Format">Talk:Advanced Format</a>)</div>
</div>
<p>For Intel use the <a rel="nofollow" class="external text" href="https://downloadcenter.intel.com/download/29337/Intel-Memory-and-Storage-Tool-CLI-Command-Line-Interface-?product=83425">Intel Memory and Storage (MAS) Tool</a> (<span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/intel-mas-cli-tool/">intel-mas-cli-tool</a></span><sup><small>AUR</small></sup>) with the <code>-set PhysicalSectorSize=4096</code> option.
</p>
<h4><span class="mw-headline" id="Seagate">Seagate</span></h4>
<p>For Seagate use <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/openseachest/">openseachest</a></span><sup><small>AUR</small></sup>.
</p>
<p>Scan all drives to find the correct one, and print info from the one you found:
</p>
<pre># openSeaChest_Basics --scan
# openSeaChest_Basics -d /dev/sd<i>X</i> -i
</pre>
<p>Should print out information about the drive. Make sure to check the serial number.
</p>
<p>Check the logical block sizes supported by the drive:
</p>
<pre># openSeaChest_Format -d /dev/sd<i>X</i> --showSupportedFormats
</pre>
<p>If 4096 is listed, you can change the logical sector size to it as follows:
</p>
<pre># openSeaChest_Format -d /dev/sd<i>X</i> --setSectorSize=4096 --confirm this-will-erase-data
</pre>
<p>This will take a couple of minutes, after which your drive now uses a 4K native sector size.
</p>
<h2><span class="mw-headline" id="Partition_alignment">Partition alignment</span></h2>
<p>Aligning partitions correctly avoids excessive read-modify-write cycles. A typical practice for personal computers is to have each partition's start and size aligned to 1 MiB (1 048 576 bytes) marks. This covers all common page and block size scenarios, as it is divisible by all commonly used sizes—1 MiB, 512 KiB, 128 KiB, 4 KiB, and 512 B.
</p>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Warning:</strong> Misaligned partitions will prevent being able to use 4096 byte sectors with dm-crypt/LUKS. See <a rel="nofollow" class="external autonumber" href="https://lore.kernel.org/dm-crypt/fe8cd3b4-6d50-66d3-375c-254e278a6443@gmail.com/">[8]</a>.</div>
<ul>
<li>
<a href="../en/Fdisk.html" title="Fdisk">fdisk, cfdisk and sfdisk</a> handle alignment automatically.</li>
<li>
<a href="../en/GPT_fdisk.html" title="GPT fdisk">gdisk and cgdisk</a> handle alignment automatically.
<ul><li>
<i>sgdisk</i> by default only aligns the start of partitions. Use the <code>-I</code>/<code>--align-end</code> option to additionally enable partition size/end alignment.</li></ul>
</li>
<li>
<a href="../en/Parted.html#Alignment" title="Parted">Parted</a> only aligns the start of the partition, but not the size/end. When creating partitions, make sure to specify the partition end in mebibytes or a larger IEC binary unit.</li>
</ul>
<h2><span class="mw-headline" id="dm-crypt">dm-crypt</span></h2>
<div class="noprint archwiki-template-message">
<p><a href="../File:Tango-view-fullscreen.png" class="image"><img alt="Tango-view-fullscreen.png" src="../File:Tango-view-fullscreen.png" decoding="async" width="48" height="48"></a><b>This article or section needs expansion.</b><a href="../File:Tango-view-fullscreen.png" class="image"><img alt="Tango-view-fullscreen.png" src="../File:Tango-view-fullscreen.png" decoding="async" width="48" height="48"></a></p>
<div>
<b>Reason:</b> Add example for plain dm-crypt. (Discuss in <a rel="nofollow" class="external text" href="https://wiki.archlinux.org/title/Talk:Advanced_Format">Talk:Advanced Format</a>)</div>
</div>
<p>As of <a href="../en/Dm-crypt/Device_encryption.html#Cryptsetup_usage" class="mw-redirect" title="Cryptsetup">Cryptsetup</a> 2.4.0, <code>luksFormat</code> automatically detects the optimal encryption sector size for LUKS2 format <a rel="nofollow" class="external autonumber" href="https://mirrors.edge.kernel.org/pub/linux/utils/cryptsetup/v2.4/v2.4.0-ReleaseNotes">[9]</a>. 
</p>
<p>However, for this to work, the device needs to report the correct default sector size, see <a href="#Changing_sector_size">#Changing sector size</a>.
</p>
<p>After using <code>cryptsetup luksFormat</code>, you can check the sector size used by the LUKS2 volume with
</p>
<pre># cryptsetup luksDump <i>device</i> | grep sector
</pre>
<p>If the default sector size is incorrect, you can force create a LUKS2 container with a 4K sector size and otherwise default options with: 
</p>
<pre># cryptsetup luksFormat --sector-size=4096 <i>device</i>
</pre>
<p>The command will abort on an error if the requested size does not match your device:
</p>
<pre># cryptsetup luksFormat --sector-size 4096 <i>device</i>
(...)
Verify passphrase: 
Device size is not aligned to requested sector size.
</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> See <a rel="nofollow" class="external text" href="https://gitlab.com/cryptsetup/cryptsetup/-/issues/585">cryptsetup issue 585</a> for why the command may fail while the underlying drive does use 4K physical sectors.</div>
<p>If you encrypted your device with the wrong sector size, the device can be re-encrypted by running:
</p>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Warning:</strong> The contained file system must have a block size of 4096 bytes or a multiple of it, otherwise it will break.</div>
<pre># cryptsetup reencrypt --sector-size=4096 <i>device</i>
</pre>
<h2><span class="mw-headline" id="File_systems">File systems</span></h2>
<div class="noprint archwiki-template-message">
<p><a href="../File:Tango-view-fullscreen.png" class="image"><img alt="Tango-view-fullscreen.png" src="../File:Tango-view-fullscreen.png" decoding="async" width="48" height="48"></a><b>This article or section needs expansion.</b><a href="../File:Tango-view-fullscreen.png" class="image"><img alt="Tango-view-fullscreen.png" src="../File:Tango-view-fullscreen.png" decoding="async" width="48" height="48"></a></p>
<div>
<b>Reason:</b> Differentiate which <i>mkfs</i> utilities use 4096 explicitly and which use the page size (<code>getconf PAGESIZE</code>). (Discuss in <a rel="nofollow" class="external text" href="https://wiki.archlinux.org/title/Talk:Advanced_Format">Talk:Advanced Format</a>)</div>
</div>
<p><span class="plainlinks archwiki-template-man" title="$ man 8 mkfs.btrfs"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/mkfs.btrfs.8">mkfs.btrfs(8)</a></span>, <span class="plainlinks archwiki-template-man" title="$ man 8 mkfs.jfs"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/mkfs.jfs.8">mkfs.jfs(8)</a></span>, <span class="plainlinks archwiki-template-man" title="$ man 8 mkfs.nilfs2"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/mkfs.nilfs2.8">mkfs.nilfs2(8)</a></span>, <span class="plainlinks archwiki-template-man" title="$ man 8 mkfs.reiserfs"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/mkfs.reiserfs.8">mkfs.reiserfs(8)</a></span> and <span class="plainlinks archwiki-template-man" title="$ man 8 mkswap"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/mkswap.8">mkswap(8)</a></span> default to a 4096 byte sector size.
</p>
<p><span class="plainlinks archwiki-template-man" title="$ man 8 mkfs.ext4"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/mkfs.ext4.8">mkfs.ext4(8)</a></span> defaults to 1024 byte sectors for file systems smaller than 512 MiB and 4096 byte sectors for 512 MiB and larger.
</p>
<p><span class="plainlinks archwiki-template-man" title="$ man 8 mkfs.xfs"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/mkfs.xfs.8">mkfs.xfs(8)</a></span> defaults to 512 byte sectors, but will use 4096 for 512e and 4Kn disks.
</p>
<p><span class="plainlinks archwiki-template-man" title="$ man 8 mkfs.f2fs"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/mkfs.f2fs.8">mkfs.f2fs(8)</a></span>, <span class="plainlinks archwiki-template-man" title="$ man 8 mkfs.fat"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/mkfs.fat.8">mkfs.fat(8)</a></span>, <span class="plainlinks archwiki-template-man" title="$ man 8 mkfs.ntfs"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/mkfs.ntfs.8">mkfs.ntfs(8)</a></span> and <span class="plainlinks archwiki-template-man" title="$ man 8 mkfs.udf"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/mkfs.udf.8">mkfs.udf(8)</a></span> use the backing device's logical sector size. I.e. they will use 512 byte sectors for 512e disks and 4096 byte sectors for 4Kn disks.
</p>
<p><span class="plainlinks archwiki-template-man" title="$ man 8 zpool-create">zpool-create(8)</span> (from <a href="../en/ZFS.html#Advanced_Format_disks" title="ZFS">ZFS</a>) defaults to 512 (2⁹) byte sectors, the sector size should be set explicitly at pool creation if using advanced format disks with the parameter <code>-o ashift=12</code> (2¹², 4096 bytes).
</p>
<p>If the storage device does not report the correct sector size, you can explicitly format the partitions according to the physical sector size.
</p>
<p>In particular <i>shingled magnetic recording</i> (SMR) drives that are firmware-managed are severely and negatively impacted if using a logical sector size of 512 bytes if their physical sector size is of 4096 bytes. Those drives have different performance writing zones and remapping reallocation occurs while being idle, but during heavy active writes (e.g., RAID resilvering, backups, writing many small files, rsync, etc.), a different file system sector size could drop write speed to single digit megabytes/second, as the higher performance write areas get depleted, and the sector translation layer gets overworked on the shingled areas. 
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> On x86_64 systems Linux cannot mount file systems with a block size larger than 4 KiB. See <a rel="nofollow" class="external text" href="https://kernelnewbies.org/KernelProjects/large-block-size">Large block sizes (LBS)</a> for details and current progress.</div>
<p>Here are some examples to set the 4096-byte sector size explicitly:
</p>
<ul>
<li>
<a href="../en/Ext4.html" title="Ext4">ext4</a>: <pre># mkfs.ext4 -b 4096 /dev/<i>device</i></pre>
</li>
<li>
<a href="../en/XFS.html" title="XFS">XFS</a>: <pre># mkfs.xfs -s size=4096 /dev/<i>device</i></pre>
</li>
<li>
<a href="../en/FAT.html" title="FAT">FAT</a>: <pre># mkfs.fat -S 4096 /dev/<i>device</i></pre>
</li>
<li>
<a href="../en/NTFS-3G.html" title="NTFS-3G">NTFS-3G</a>: <pre># mkfs.ntfs -Q -s 4096 /dev/<i>device</i></pre>
</li>
<li>UDF: <pre># mkfs.udf -b 4096 /dev/<i>device</i></pre>
</li>
<li>
<a href="../en/ZFS.html#Advanced_Format_disks" title="ZFS">ZFS</a>: <pre># zpool create -o ashift=12 <i>poolname</i> raidz <i>device0</i> … <i>deviceN</i></pre>
</li>
</ul>
<h2><span class="mw-headline" id="See_also">See also</span></h2>
<ul>
<li><a rel="nofollow" class="external text" href="https://www.anandtech.com/Show/Index/2888">Western Digital’s Advanced Format: The 4K Sector Transition Begins</a></li>
<li><a rel="nofollow" class="external text" href="https://www.wdc.com/wdproducts/library/WhitePapers/ENG/2579-771430.pdf">White paper entitled "Advanced Format Technology."</a></li>
<li>Failure to align one's HDD results in poor read/write performance.  See <a rel="nofollow" class="external autonumber" href="https://linuxconfig.org/linux-wd-ears-advanced-format">[10]</a> for specific examples.</li>
</ul>
</div>
</div>
					<div id="catlinks" class="catlinks" data-mw="interface">
<div id="mw-normal-catlinks" class="mw-normal-catlinks">
<a href="../Special:Categories.html" title="Special:Categories">Category</a>: <ul><li><a href="../en/Category:Storage.html" title="Category:Storage">Storage</a></li></ul>
</div>
<div id="mw-hidden-catlinks" class="mw-hidden-catlinks mw-hidden-cats-hidden">Hidden categories: <ul>
<li><a href="../en/Category:Pages_or_sections_flagged_with_Template:Move.html" title="Category:Pages or sections flagged with Template:Move">Pages or sections flagged with Template:Move</a></li>
<li><a href="../en/Category:Pages_or_sections_flagged_with_Template:Accuracy.html" title="Category:Pages or sections flagged with Template:Accuracy">Pages or sections flagged with Template:Accuracy</a></li>
<li><a href="../en/Category:Pages_or_sections_flagged_with_Template:Out_of_date.html" title="Category:Pages or sections flagged with Template:Out of date">Pages or sections flagged with Template:Out of date</a></li>
<li><a href="../en/Category:Pages_or_sections_flagged_with_Template:Expansion.html" title="Category:Pages or sections flagged with Template:Expansion">Pages or sections flagged with Template:Expansion</a></li>
</ul>
</div>
</div>
				</div>
			</main>
			
		</div>
		<div class="mw-footer-container">
			
<footer id="footer" class="mw-footer" role="contentinfo" style="margin: 0">
	<ul id="footer-info">
	<li data-nosnippet="">Retrieved from "<a dir="ltr" href="https://wiki.archlinux.org/index.php?title=Advanced_Format&amp;oldid=786295">https://wiki.archlinux.org/index.php?title=Advanced_Format&amp;oldid=786295</a>"</li>
<li id="footer-info-lastmod"> This page was last edited on 27 August 2023, at 08:24.</li>
	<li id="footer-info-copyright">Content is available under <a class="external" rel="nofollow" href="https://www.gnu.org/copyleft/fdl.html">GNU Free Documentation License 1.3 or later</a> unless otherwise noted.</li>
<br>
</ul>

	<ul id="footer-places">
	<li id="footer-places-privacy"><a href="https://terms.archlinux.org/docs/privacy-policy/">Privacy policy</a></li>
	<li id="footer-places-about"><a href="../en/ArchWiki:About.html">About ArchWiki</a></li>
	<li id="footer-places-disclaimer"><a href="../en/ArchWiki:General_disclaimer.html">Disclaimers</a></li>
</ul>

	
</footer>

		</div>
	</div> 
</div> 

</body>
</html>
