<!DOCTYPE html>
<html class="client-nojs" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<title>Smokeping - ArchWiki</title>
<link rel="stylesheet" href="../ArchWikiOffline.css">
<meta name="ResourceLoaderDynamicStyles" content="">
<meta name="generator" content="MediaWiki 1.39.4">
<meta name="referrer" content="no-referrer-when-downgrade">
<meta name="format-detection" content="telephone=no">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes, minimum-scale=0.25, maximum-scale=5.0">
<link rel="icon" href="/favicon.ico">
<link rel="search" type="application/opensearchdescription+xml" href="/opensearch_desc.php" title="ArchWiki (en)">
<link rel="EditURI" type="application/rsd+xml" href="https://wiki.archlinux.org/api.php?action=rsd">
<link rel="license" href="https://www.gnu.org/copyleft/fdl.html">
<link rel="alternate" type="application/atom+xml" title="ArchWiki Atom feed" href="/index.php?title=Special:RecentChanges&amp;feed=atom">
</head>
<body class="skin-vector skin-vector-search-vue mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-Smokeping rootpage-Smokeping skin-vector-2022 action-view skin--responsive vector-feature-language-in-header-enabled vector-feature-language-in-main-page-header-disabled vector-feature-language-alert-in-sidebar-disabled vector-feature-sticky-header-disabled vector-feature-sticky-header-edit-disabled vector-feature-table-of-contents-disabled vector-feature-visual-enhancement-next-disabled">
<div class="mw-page-container">
	<span id="top-page"></span>
	<a class="mw-jump-link" href="#content">Jump to content</a>
	<div class="mw-page-container-inner">
		<input type="checkbox" id="mw-sidebar-checkbox" class="mw-checkbox-hack-checkbox">
		<div class="vector-sidebar-container ">
			</div>
		<div class="vector-sitenotice-container">
			<div id="siteNotice"></div>
		</div>
		<input type="checkbox" id="vector-toc-collapsed-checkbox" class="mw-checkbox-hack-checkbox">
		<div class="mw-table-of-contents-container">
			<div class="vector-sticky-toc-container mw-sticky-header-element">
				<nav id="mw-panel-toc" class="sidebar-toc" role="navigation" aria-labelledby="sidebar-toc-label" data-event-name="ui.sidebar-toc">
	<div id="sidebar-toc-label" class="sidebar-toc-header">
		<p class="sidebar-toc-title">
		Contents
		<button class="vector-toc-uncollapse-button">move to sidebar</button>
		<button class="vector-toc-collapse-button">hide</button>
		</p>
	</div>
	<ul class="sidebar-toc-contents" id="mw-panel-toc-list">
		<li id="toc-mw-content-text" class="sidebar-toc-list-item sidebar-toc-level-1">
			<a href="#top-page" class="sidebar-toc-link">
				<div class="sidebar-toc-text">Beginning</div>
			</a>
		</li>
		<li id="toc-Installation" class="sidebar-toc-list-item sidebar-toc-level-1 sidebar-toc-list-item-expanded">
			<a class="sidebar-toc-link" href="#Installation">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">1</span>Installation</div>
			</a>
			
				<button aria-controls="toc-Installation-sublist" class="mw-ui-icon mw-ui-icon-wikimedia-expand mw-ui-icon-small sidebar-toc-toggle">
					Toggle Installation subsection
				</button>
			
			<ul id="toc-Installation-sublist" class="sidebar-toc-list">
				<li id="toc-Optional_Prerequisites" class="sidebar-toc-list-item sidebar-toc-level-2">
			<a class="sidebar-toc-link" href="#Optional_Prerequisites">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">1.1</span>Optional Prerequisites</div>
			</a>
			
			<ul id="toc-Optional_Prerequisites-sublist" class="sidebar-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id="toc-Configuration" class="sidebar-toc-list-item sidebar-toc-level-1 sidebar-toc-list-item-expanded">
			<a class="sidebar-toc-link" href="#Configuration">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">2</span>Configuration</div>
			</a>
			
				<button aria-controls="toc-Configuration-sublist" class="mw-ui-icon mw-ui-icon-wikimedia-expand mw-ui-icon-small sidebar-toc-toggle">
					Toggle Configuration subsection
				</button>
			
			<ul id="toc-Configuration-sublist" class="sidebar-toc-list">
				<li id="toc-Editing_the_configuration_file" class="sidebar-toc-list-item sidebar-toc-level-2">
			<a class="sidebar-toc-link" href="#Editing_the_configuration_file">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">2.1</span>Editing the configuration file</div>
			</a>
			
			<ul id="toc-Editing_the_configuration_file-sublist" class="sidebar-toc-list">
				<li id="toc-Notes_on_the_smokeping_configuration_file_syntax" class="sidebar-toc-list-item sidebar-toc-level-3">
			<a class="sidebar-toc-link" href="#Notes_on_the_smokeping_configuration_file_syntax">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">2.1.1</span>Notes on the smokeping configuration file syntax</div>
			</a>
			
			<ul id="toc-Notes_on_the_smokeping_configuration_file_syntax-sublist" class="sidebar-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id="toc-Setup_the_rest_of_the_system" class="sidebar-toc-list-item sidebar-toc-level-2">
			<a class="sidebar-toc-link" href="#Setup_the_rest_of_the_system">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">2.2</span>Setup the rest of the system</div>
			</a>
			
			<ul id="toc-Setup_the_rest_of_the_system-sublist" class="sidebar-toc-list">
			</ul>
		</li>
		<li id="toc-Start_and_enable_daemon" class="sidebar-toc-list-item sidebar-toc-level-2">
			<a class="sidebar-toc-link" href="#Start_and_enable_daemon">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">2.3</span>Start and enable daemon</div>
			</a>
			
			<ul id="toc-Start_and_enable_daemon-sublist" class="sidebar-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id="toc-Setup_web_frontend" class="sidebar-toc-list-item sidebar-toc-level-1 sidebar-toc-list-item-expanded">
			<a class="sidebar-toc-link" href="#Setup_web_frontend">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">3</span>Setup web frontend</div>
			</a>
			
				<button aria-controls="toc-Setup_web_frontend-sublist" class="mw-ui-icon mw-ui-icon-wikimedia-expand mw-ui-icon-small sidebar-toc-toggle">
					Toggle Setup web frontend subsection
				</button>
			
			<ul id="toc-Setup_web_frontend-sublist" class="sidebar-toc-list">
				<li id="toc-Apache" class="sidebar-toc-list-item sidebar-toc-level-2">
			<a class="sidebar-toc-link" href="#Apache">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">3.1</span>Apache</div>
			</a>
			
			<ul id="toc-Apache-sublist" class="sidebar-toc-list">
			</ul>
		</li>
		<li id="toc-Caddy" class="sidebar-toc-list-item sidebar-toc-level-2">
			<a class="sidebar-toc-link" href="#Caddy">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">3.2</span>Caddy</div>
			</a>
			
			<ul id="toc-Caddy-sublist" class="sidebar-toc-list">
			</ul>
		</li>
		<li id="toc-Caddy_2" class="sidebar-toc-list-item sidebar-toc-level-2">
			<a class="sidebar-toc-link" href="#Caddy_2">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">3.3</span>Caddy 2</div>
			</a>
			
			<ul id="toc-Caddy_2-sublist" class="sidebar-toc-list">
			</ul>
		</li>
		<li id="toc-Lighttpd" class="sidebar-toc-list-item sidebar-toc-level-2">
			<a class="sidebar-toc-link" href="#Lighttpd">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">3.4</span>Lighttpd</div>
			</a>
			
			<ul id="toc-Lighttpd-sublist" class="sidebar-toc-list">
			</ul>
		</li>
		<li id="toc-Nginx" class="sidebar-toc-list-item sidebar-toc-level-2">
			<a class="sidebar-toc-link" href="#Nginx">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">3.5</span>Nginx</div>
			</a>
			
			<ul id="toc-Nginx-sublist" class="sidebar-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id="toc-Advanced_Configuration" class="sidebar-toc-list-item sidebar-toc-level-1 sidebar-toc-list-item-expanded">
			<a class="sidebar-toc-link" href="#Advanced_Configuration">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">4</span>Advanced Configuration</div>
			</a>
			
			<ul id="toc-Advanced_Configuration-sublist" class="sidebar-toc-list">
			</ul>
		</li>
		<li id="toc-Notes" class="sidebar-toc-list-item sidebar-toc-level-1 sidebar-toc-list-item-expanded">
			<a class="sidebar-toc-link" href="#Notes">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">5</span>Notes</div>
			</a>
			
				<button aria-controls="toc-Notes-sublist" class="mw-ui-icon mw-ui-icon-wikimedia-expand mw-ui-icon-small sidebar-toc-toggle">
					Toggle Notes subsection
				</button>
			
			<ul id="toc-Notes-sublist" class="sidebar-toc-list">
				<li id="toc-Smoketrace_(Tr.cgi)" class="sidebar-toc-list-item sidebar-toc-level-2">
			<a class="sidebar-toc-link" href="#Smoketrace_(Tr.cgi)">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">5.1</span>Smoketrace (Tr.cgi)</div>
			</a>
			
			<ul id="toc-Smoketrace_(Tr.cgi)-sublist" class="sidebar-toc-list">
			</ul>
		</li>
	</ul>
		</li>
	</ul>
</nav>

			</div>
		</div>
		<div class="mw-content-container">
			<main id="content" class="mw-body" role="main" style="margin: 0">
				<a id="top"></a>
				<nav class="vector-article-toolbar" aria-label="Tools" role="navigation">
					<div class="mw-article-toolbar-container">
						<div id="left-navigation">
							

<div id="p-associated-pages" class="vector-menu mw-portlet mw-portlet-associated-pages vector-menu-tabs">
	<div class="vector-menu-content">
		
		<ul class="vector-menu-content-list">
<li id="ca-nstab-main" class="selected mw-list-item"><a href="../en/Smokeping.html" title="View the content page [c]" accesskey="c"><span>Page</span></a></li>
<li id="ca-talk" class="mw-list-item"><a href="../en/Talk:Smokeping.html" rel="discussion" title="Discussion about the content page [t]" accesskey="t"><span>Discussion</span></a></li>
</ul>
		
	</div>
</div>

							

<div id="p-variants" class="vector-menu mw-portlet mw-portlet-variants emptyPortlet vector-menu-dropdown">
	<input type="checkbox" id="p-variants-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-p-variants" class="vector-menu-checkbox" aria-label="Change language variant">
	<label id="p-variants-label" for="p-variants-checkbox" class="vector-menu-heading ">
		<span class="vector-menu-heading-label">English</span>
	</label>
	<div class="vector-menu-content">
		
		<ul class="vector-menu-content-list"></ul>
		
	</div>
</div>

						</div>
						<div id="right-navigation" class="vector-collapsible ">
							

<div id="p-views" class="vector-menu mw-portlet mw-portlet-views vector-menu-tabs">
	<div class="vector-menu-content">
		
		<ul class="vector-menu-content-list">
<li id="ca-view" class="selected mw-list-item"><a href="../en/Smokeping.html"><span>Read</span></a></li>
<li id="ca-viewsource" class="mw-list-item"><a href="/index.php?title=Smokeping&amp;action=edit" title="This page is protected.
You can view its source [e]" accesskey="e"><span>View source</span></a></li>
<li id="ca-history" class="mw-list-item"><a href="/index.php?title=Smokeping&amp;action=history" title="Past revisions of this page [h]" accesskey="h"><span>View history</span></a></li>
</ul>
		
	</div>
</div>

							

<div id="p-cactions" class="vector-menu mw-portlet mw-portlet-cactions emptyPortlet vector-menu-dropdown vector-has-collapsible-items" title="More options">
	<input type="checkbox" id="p-cactions-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-p-cactions" class="vector-menu-checkbox">
	<label id="p-cactions-label" for="p-cactions-checkbox" class="vector-menu-heading ">
		<span class="vector-menu-heading-label">More</span>
	</label>
	<div class="vector-menu-content">
		
		<ul class="vector-menu-content-list">
<li id="ca-more-view" class="selected vector-more-collapsible-item mw-list-item"><a href="../en/Smokeping.html"><span>Read</span></a></li>
<li id="ca-more-viewsource" class="vector-more-collapsible-item mw-list-item"><a href="/index.php?title=Smokeping&amp;action=edit"><span>View source</span></a></li>
<li id="ca-more-history" class="vector-more-collapsible-item mw-list-item"><a href="/index.php?title=Smokeping&amp;action=history"><span>View history</span></a></li>
</ul>
		
	</div>
</div>

						</div>
					</div>
				</nav>
				<div id="bodyContent" class="vector-body" data-mw-ve-target-container>
					<div class="mw-body-subheader">
					        <div class="mw-indicators">
        </div>

					    <div id="siteSub" class="noprint">From ArchWiki</div>
					</div>
					
					
					
					<div id="mw-content-text" class="mw-body-content mw-content-ltr" lang="en" dir="ltr">
<div class="mw-parser-output">
<p><a rel="nofollow" class="external text" href="https://oss.oetiker.ch/smokeping/index.en.html">Smokeping</a>
allows you to probe a list of servers, store that data using
RRDtool, and generate statistical charts based on RRDtool's
output. Smokeping consists of two parts. A daemon runs in the
background pinging and collecting data at set intervals. A web
interface displays that data in the form of graphs.
</p>
<p>This wiki page covers a basic setup of the smokeping daemon and the CGI webinterface.
</p>
<mw:tocplace></mw:tocplace>
<h2><span class="mw-headline" id="Installation">Installation</span></h2>
<p>This section covers the installation of <a rel="nofollow" class="external text" href="https://oss.oetiker.ch/smokeping/index.en.html">Smokeping</a> using the <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=smokeping">smokeping</a></span> package. FastCGI on Apache will be setup as described in <a href="../en/Apache_HTTP_Server/mod_fcgid.html" class="mw-redirect" title="Apache and FastCGI">Apache and FastCGI</a>.
</p>
<p>The smokeping package consists of two parts:
</p>
<ul>
<li>The smokeping daemon and configs in <code>/etc/smokeping/</code>. This daemon performs the monitoring.</li>
<li>The smokeping "htdocs" in <code>/srv/http/smokeping</code>. These will be used by the web interface.</li>
</ul>
<p>In addition to the <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=smokeping">smokeping</a></span> package, you will need:
</p>
<ul>
<li>A tool that smokeping can use for monitoring. <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=fping">fping</a></span> is the simplest and default method for simple ping probes.</li>
<li>
<span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=apache">apache</a></span> and <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/mod_fcgid/">mod_fcgid</a></span><sup><small>AUR</small></sup> for the web interface if you are using Apache.</li>
<li>
<span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=fcgiwrap">fcgiwrap</a></span> and start and enable fcgiwrap.socket if you are using Nginx</li>
<li>An image cache directory that the FastCGI script can write to, e.g. <code>/srv/smokeping/imgcache</code>
</li>
<li>A data directory that the smokeping daemon can write to, and the FastCGI script can read, e.g. <code>/srv/smokeping/data</code>
</li>
<li>To ensure that the main configuration file is readable by the smokeping daemon.</li>
</ul>
<h3><span class="mw-headline" id="Optional_Prerequisites">Optional Prerequisites</span></h3>
<p>If you want to use other probes such as the DNS or http probe you will
need other packages as shown below. The configuration of these will is not covered by this wiki page.
</p>
<table class="wikitable">
<tbody>
<tr>
<th>Probe</th>
<th>Package Needed
</th>
</tr>
<tr>
<td>Curl</td>
<td>
<span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=curl">curl</a></span>
</td>
</tr>
<tr>
<td>DNS</td>
<td>
<span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=bind">bind</a></span> (for the dig utility)
</td>
</tr>
<tr>
<td>EchoPing</td>
<td>
<span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=echoping">echoping</a></span>
</td>
</tr>
<tr>
<td>SSH</td>
<td>
<span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=openssh">openssh</a></span>
</td>
</tr>
<tr>
<td>TelnetIOSPing</td>
<td>
<span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=perl-net-telnet">perl-net-telnet</a></span>
</td>
</tr>
<tr>
<td>AnotherDNS</td>
<td>
<span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=perl-net-dns">perl-net-dns</a></span>
</td>
</tr>
<tr>
<td>LDAP</td>
<td>
<span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=perl-ldap">perl-ldap</a></span>
</td>
</tr>
<tr>
<td>LDAP (tls)</td>
<td>
<span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=perl-io-socket-ssl">perl-io-socket-ssl</a></span>
</td>
</tr>
<tr>
<td>Authen</td>
<td>
<span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=perl-authen-radius">perl-authen-radius</a></span>
</td>
</tr>
</tbody>
</table>
<h2><span class="mw-headline" id="Configuration">Configuration</span></h2>
<p>Smokeping requires you to edit a few files. The unedited files end
with the <code>.dist</code> extension. Rename the <code>.dist</code>
files in <code>/etc/smokeping</code> to remove the suffix. The <i>find</i> command does this and
prints out each file that is being renamed and needs editing:
</p>
<pre># cd /etc/smokeping
# find . -name '*.dist' -print -execdir sh -c 'mv {} $(basename {} .dist)' \;
# mv /srv/http/smokeping/smokeping.fcgi.dist /srv/http/smokeping/smokeping.fcgi
</pre>
<h3><span class="mw-headline" id="Editing_the_configuration_file">Editing the configuration file</span></h3>
<p>Next, edit the <code>/etc/smokeping/config</code> file; this is smokeping's main configuration file. A brief description of the sections is followed by a complete example.
</p>
<p>The <i>General</i> section of the <code>/etc/smokeping/config</code> file is the easiest to edit. Personalize the
top of the configuration file to match your information. The comments describe each field. Note that if you do not have the <code>sendmail</code> program installed (ie from postfix or sendmail) then use something else instead like <code>/bin/false</code>. The file you specify must exist or smokeping will error out.
</p>
<p>The <i>Alerts</i> section is not needed in this minimal example, so it can be either commented out or removed.
</p>
<p>The <i>Database</i> section does not require any changes.
</p>
<p>In the <i>Presentation</i> section the path to the template filename needs to be updated.
</p>
<p>The <i>Probes</i> section specifies which probes are active. By default only the <i>FPing</i> probe is enabled. This section does not require any changes.
</p>
<p>The <i>Slaves</i> section is not needed in this minimal example, so it can be either commented out or removed. Note that if you use the <code>smokeping_secrets</code> setting in the <i>Slaves</i> section, you will have to make that file unreadable to the rest of the world, or else smokeping will error: <code>chmod 600 /etc/smokeping/smokeping_secrets</code>.
</p>
<p>The <i>Targets</i> section specifies which hosts will be probed (pinged in our example). Customize it so that it probes the host(s) you would like to collect statistics on, as shown in the example below.
</p>
<p>You can learn more about the Smokeping configuration file with the examples at
<a rel="nofollow" class="external free" href="https://oss.oetiker.ch/smokeping/doc/smokeping_examples.en.html">https://oss.oetiker.ch/smokeping/doc/smokeping_examples.en.html</a>
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/smokeping/config</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">*** General ***

owner     = Your Name Here                            # your name
contact   = your.email@host.bla                       # your email
mailhost  = your.smtp.server.bla                      # your mail server
sendmail  = /bin/false                                # where the sendmail program is
imgcache  = /srv/smokeping/imgcache                   # filesystem directory where we store files
imgurl    = imgcache                                  # URL directory to find them
datadir   = /srv/smokeping/data                       # where we share data between the daemon and webapp
piddir    = /var/run                                  # filesystem directory to store PID file
cgiurl    = http://localhost/smokeping/smokeping.fcgi  # exterior URL
smokemail = /etc/smokeping/smokemail   
tmail     = /etc/smokeping/tmail
syslogfacility = local0
# each probe is now run in its own process
# disable this to revert to the old behaviour
# concurrentprobes = no

*** Database ***

step     = 300
pings    = 20

# consfn mrhb steps total

AVERAGE  0.5   1  1008
AVERAGE  0.5  12  4320
    MIN  0.5  12  4320
    MAX  0.5  12  4320
AVERAGE  0.5 144   720
    MAX  0.5 144   720
    MIN  0.5 144   720

*** Presentation ***

template = /etc/smokeping/basepage.html

+ charts

menu = Charts
title = The most interesting destinations
++ stddev
sorter = StdDev(entries=&gt;4)
title = Top Standard Deviation
menu = Std Deviation
format = Standard Deviation %f

++ max
sorter = Max(entries=&gt;5)
title = Top Max Roundtrip Time
menu = by Max
format = Max Roundtrip Time %f seconds

++ loss
sorter = Loss(entries=&gt;5)
title = Top Packet Loss
menu = Loss
format = Packets Lost %f

++ median
sorter = Median(entries=&gt;5)
title = Top Median Roundtrip Time
menu = by Median
format = Median RTT %f seconds

+ overview 

width = 600
height = 50
range = 10h

+ detail

width = 600
height = 200
unison_tolerance = 2

"Last 3 Hours"    3h
"Last 30 Hours"   30h
"Last 10 Days"    10d
"Last 400 Days"   400d

*** Probes ***

+ FPing

binary = /usr/bin/fping

*** Targets ***

probe = FPing

menu = Top
title = Network Latency Grapher
remark = Welcome to the SmokePing website of Arch User. \
         Here you will learn all about the latency of our network.

+ targets
menu = Targets
title = Targets

++ CloudflareDNS
 
menu = Cloudflare DNS
title = Cloudflare DNS server
host = 1.1.1.1

++ GoogleDNS

menu = Google DNS
title = Google DNS server
host = 8.8.8.8

++ MultiHost

menu = Multihost example
title = CloudflareDNS and Google DNS
host = /targets/CloudflareDNS /targets/GoogleDNS
</pre>
<h4><span class="mw-headline" id="Notes_on_the_smokeping_configuration_file_syntax">Notes on the smokeping configuration file syntax</span></h4>
<p>Each <b>+</b> character defines a section in the hierarchy. Spaces are not allowed in the section names. Period and forward slashes should probably also be avoided in section names. This is probably because the RRD files are stored under the data directory with the same exact names as the sections.
</p>
<p>In the <i>Targets</i> section, you can define <code>host</code> as either a real host name or the path to another section to generate a multiple host chart, as shown in the <code>MultiHost</code> example above.
</p>
<h3><span class="mw-headline" id="Setup_the_rest_of_the_system">Setup the rest of the system</span></h3>
<p>Setup the extra directories referenced by the configuration file:
</p>
<pre># mkdir -p /srv/smokeping/data
# mkdir -p /srv/smokeping/imgcache
# chown -R smokeping:smokeping /srv/smokeping
# chown -R http:http /srv/smokeping/imgcache
# chmod a+rx /srv/smokeping
# chmod -R a+rx /srv/smokeping/data
</pre>
<p>Since the smokeping configuration is read by both the smokeping daemon and the FastCGI scripts, so it needs to be readable:
</p>
<pre># chmod a+rx /etc/smokeping
# chmod a+r /etc/smokeping/config
</pre>
<h3><span class="mw-headline" id="Start_and_enable_daemon">Start and enable daemon</span></h3>
<p><a href="../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Start">Start</a> and enable <code>smokeping.service</code>. Then check that it is running.
</p>
<h2><span class="mw-headline" id="Setup_web_frontend">Setup web frontend</span></h2>
<h3><span class="mw-headline" id="Apache">Apache</span></h3>
<p>Edit <code>/etc/httpd/conf/httpd.conf</code> so that it includes:
</p>
<pre>LoadModule fcgid_module modules/mod_fcgid.so
&lt;IfModule fcgid_module&gt;
  AddHandler fcgid-script .fcgi
&lt;/IfModule&gt;

Alias /smokeping/imgcache /srv/smokeping/imgcache
Alias /smokeping /srv/http/smokeping

&lt;Directory "/srv/smokeping/imgcache"&gt;
  AllowOverride all
  Require all granted
&lt;/Directory&gt;

&lt;Directory "/srv/http/smokeping"&gt;
 Options FollowSymLinks ExecCGI
 AllowOverride all
 Require all granted
&lt;/Directory&gt;
</pre>
<p><a href="../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Start">Start</a> Apache via the <code>httpd.service</code>.
</p>
<p>Check that <a rel="nofollow" class="external free" href="http://localhost/smokeping/smokeping.fcgi">http://localhost/smokeping/smokeping.fcgi</a> loads. The first data should appear after a couple of minutes.
</p>
<p>If the fonts in the graphs are unreadable, you may need to install the <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=ttf-dejavu">ttf-dejavu</a></span> package.
</p>
<h3><span class="mw-headline" id="Caddy">Caddy</span></h3>
<p>Thanks to the <a rel="nofollow" class="external text" href="https://caddy.community/t/smokeping-caddyfile/3560/8">Caddy community</a> and with this configuration file <a rel="nofollow" class="external text" href="https://s.natalian.org/2018-03-27/config">/etc/smokeping/config</a> and with <a href="../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Enable">enable</a> <code>fcgiwrap.socket</code>
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/caddy/caddy.conf.d/smokeping.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">smokeping.example.com {

        log stdout
        errors

        tls john@example.com
        root /srv/http/smokeping

        fastcgi / unix:/var/run/fcgiwrap.sock {
                env SCRIPT_FILENAME /srv/http/smokeping/smokeping.fcgi.dist
        }
}

smokeping.example.com/js {
        root /srv/http/smokeping/js
}

smokeping.example.com/css {
        root /srv/http/smokeping/css
}

smokeping.example.com/cache {
        root /var/cache/smokeping
}
</pre>
<p>An updated version of this Caddy configuration for smokeping - <a rel="nofollow" class="external free" href="https://gist.github.com/Strykar/4df1eb8aebc4d5f7039f6045301352c7">https://gist.github.com/Strykar/4df1eb8aebc4d5f7039f6045301352c7</a>
</p>
<h3><span class="mw-headline" id="Caddy_2">Caddy 2</span></h3>
<p>Thanks to the <a rel="nofollow" class="external text" href="https://caddy.community/t/having-trouble-migrating-smokeping-caddyfile-to-caddy-2/8640/3">francislavoie and Caddy community</a> and to the <a rel="nofollow" class="external text" href="https://caddyserver.com/docs/caddyfile">Caddy docs</a>.
Start and enable fcgiwrap.socket!
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/caddy/caddy.conf.d/smokeping.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">smokeping.example.com {

    handle /js/* {
        root * /srv/http/smokeping/
        file_server
    }
    handle /css/* {
        root * /srv/http/smokeping/
        file_server
    }
    handle /imgcache/* {
        root * /srv/http/smokeping/
        file_server
    }
    handle /images/* {
        root * /srv/http/smokeping/
        file_server
    }
    
    handle {
        root * /srv/http/smokeping/
        reverse_proxy unix//var/run/fcgiwrap.sock {
            transport fastcgi {
                env SCRIPT_FILENAME /srv/http/smokeping/smokeping.fcgi
                split ""
            }
        }
    }
}
</pre>
<h3><span class="mw-headline" id="Lighttpd">Lighttpd</span></h3>
<p>First install <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=lighttpd">lighttpd</a></span> and <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=fcgi">fcgi</a></span>.
</p>
<p>Edit the <a href="../en/Lighttpd.html" title="Lighttpd">Lighttpd</a> configuration file and ensure you have at least all of the following configuration directives:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/lighttpd/lighttpd.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">server.document-root    = "/srv/http"
server.follow-symlink   = "enable"

server.modules += ("mod_fastcgi")
fastcgi.server = (
        ".fcgi" =&gt;
        ((
                "bin-path" =&gt; "/srv/http/smokeping/smokeping.fcgi",
                "host" =&gt; "localhost",
                "port" =&gt; 8001,
        )),
)</pre>
<p><a href="../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Start/enable">Start/enable</a> the <code>lighttpd.service</code>
</p>
<p><a href="../en/Systemd.html" title="Systemd">Systemd</a> should show <code>smokeping_cgi</code> being managed by <code>lighttpd.service</code>.
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">$ systemctl status lighttpd</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">● lighttpd.service - Lighttpd Web Server
   Loaded: loaded (/usr/lib/systemd/system/lighttpd.service; enabled; vendor preset: disabled)
   Active: active (running) since Wed 2018-12-26 14:34:42 PST; 1 day 7h ago
  Process: 17117 ExecReload=/bin/kill -HUP $MAINPID (code=exited, status=0/SUCCESS)
 Main PID: 28321 (lighttpd-angel)
    Tasks: 6 (limit: 4915)
   Memory: 128.9M
   CGroup: /system.slice/lighttpd.service
           ├─17119 /usr/bin/lighttpd -D -f /etc/lighttpd/lighttpd.conf
           ├─17126 /usr/bin/perl /usr/bin/smokeping_cgi /etc/smokeping/config
           ├─17127 /usr/bin/perl /usr/bin/smokeping_cgi /etc/smokeping/config
           ├─17128 /usr/bin/perl /usr/bin/smokeping_cgi /etc/smokeping/config
           ├─17129 /usr/bin/perl /usr/bin/smokeping_cgi /etc/smokeping/config
           └─28321 /usr/bin/lighttpd-angel -D -f /etc/lighttpd/lighttpd.conf</pre>
<p>Finally, add a symbolic link to allow images to load:
</p>
<pre># ln -s -t /srv/http/smokeping /srv/smokeping/imgcache
</pre>
<h3><span class="mw-headline" id="Nginx">Nginx</span></h3>
<p>Ensure that <code>fcgiwrap.socket</code> and <code>nginx.service</code> are both running via systemctl.
</p>
<p>Add a server block for smokeping to <code>/etc/nginx/nginx.conf</code>, following is an example for a TLS enabled block.
</p>
<pre>   server {
       server_name smokeping.example.com;
       listen 443 ssl http2;
       listen [::]:443 ssl http2;
       root /srv/http/smokeping/;
       index smokeping.fcgi;
       gzip off;
       location ~ \.fcgi$ {
           fastcgi_intercept_errors on;
           include /etc/nginx/fastcgi_params;
           fastcgi_param SCRIPT_FILENAME /srv/http/smokeping/smokeping.fcgi;
           fastcgi_pass unix:/var/run/fcgiwrap.sock;
       }
       location /imgcache {
           alias /srv/smokeping/imgcache;
           gzip off;
       }
   }
</pre>
<p>Verify that your configuration is fine via <code>nginx -t</code> as the root user and reload the configuration via <code>nginx -s reload</code> as the root user.
</p>
<h2><span class="mw-headline" id="Advanced_Configuration">Advanced Configuration</span></h2>
<p>Smokeping is a powerful tool that can be configured in many ways. You can setup many different types of probes. You can setup slave smokeping servers that can send their statistics and show you probes from other servers. You can also create your custom probes in perl. These options are currently not covered by this guide, please consult the documentation on the <a rel="nofollow" class="external text" href="https://oss.oetiker.ch/smokeping/index.en.html">Smokeping website</a> instead. Also see - <a rel="nofollow" class="external free" href="https://github.com/oetiker/SmokePing/wiki/FAQ">https://github.com/oetiker/SmokePing/wiki/FAQ</a>
</p>
<h2><span class="mw-headline" id="Notes">Notes</span></h2>
<h3>
<span id="Smoketrace_.28Tr.cgi.29"></span><span class="mw-headline" id="Smoketrace_(Tr.cgi)">Smoketrace (Tr.cgi)</span>
</h3>
<p>The <a rel="nofollow" class="external text" href="https://oss.oetiker.ch/smokeping/doc/smoketrace.en.html">SmokeTraceroute</a> utility is gone since v2.5.0 according to the <a rel="nofollow" class="external text" href="https://oss.oetiker.ch/smokeping/pub/CHANGES">release notes</a>.
</p>
</div>
</div>
					<div id="catlinks" class="catlinks" data-mw="interface"><div id="mw-normal-catlinks" class="mw-normal-catlinks">
<a href="../Special:Categories.html" title="Special:Categories">Category</a>: <ul><li><a href="../en/Category:Network_monitoring.html" title="Category:Network monitoring">Network monitoring</a></li></ul>
</div></div>
				</div>
			</main>
			
		</div>
		<div class="mw-footer-container">
			
<footer id="footer" class="mw-footer" role="contentinfo" style="margin: 0">
	<ul id="footer-info">
	<li data-nosnippet="">Retrieved from "<a dir="ltr" href="https://wiki.archlinux.org/index.php?title=Smokeping&amp;oldid=765371">https://wiki.archlinux.org/index.php?title=Smokeping&amp;oldid=765371</a>"</li>
<li id="footer-info-lastmod"> This page was last edited on 27 January 2023, at 21:05.</li>
	<li id="footer-info-copyright">Content is available under <a class="external" rel="nofollow" href="https://www.gnu.org/copyleft/fdl.html">GNU Free Documentation License 1.3 or later</a> unless otherwise noted.</li>
<br>
</ul>

	<ul id="footer-places">
	<li id="footer-places-privacy"><a href="https://terms.archlinux.org/docs/privacy-policy/">Privacy policy</a></li>
	<li id="footer-places-about"><a href="../en/ArchWiki:About.html">About ArchWiki</a></li>
	<li id="footer-places-disclaimer"><a href="../en/ArchWiki:General_disclaimer.html">Disclaimers</a></li>
</ul>

	
</footer>

		</div>
	</div> 
</div> 

</body>
</html>
