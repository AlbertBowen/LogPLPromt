<!DOCTYPE html>
<html class="client-nojs" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<title>AppArmor - ArchWiki</title>
<link rel="stylesheet" href="../ArchWikiOffline.css">
<meta name="ResourceLoaderDynamicStyles" content="">
<meta name="generator" content="MediaWiki 1.39.4">
<meta name="referrer" content="no-referrer-when-downgrade">
<meta name="format-detection" content="telephone=no">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes, minimum-scale=0.25, maximum-scale=5.0">
<link rel="icon" href="/favicon.ico">
<link rel="search" type="application/opensearchdescription+xml" href="/opensearch_desc.php" title="ArchWiki (en)">
<link rel="EditURI" type="application/rsd+xml" href="https://wiki.archlinux.org/api.php?action=rsd">
<link rel="license" href="https://www.gnu.org/copyleft/fdl.html">
<link rel="alternate" type="application/atom+xml" title="ArchWiki Atom feed" href="/index.php?title=Special:RecentChanges&amp;feed=atom">
</head>
<body class="skin-vector skin-vector-search-vue mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-AppArmor rootpage-AppArmor skin-vector-2022 action-view skin--responsive vector-feature-language-in-header-enabled vector-feature-language-in-main-page-header-disabled vector-feature-language-alert-in-sidebar-disabled vector-feature-sticky-header-disabled vector-feature-sticky-header-edit-disabled vector-feature-table-of-contents-disabled vector-feature-visual-enhancement-next-disabled">
<div class="mw-page-container">
	<span id="top-page"></span>
	<a class="mw-jump-link" href="#content">Jump to content</a>
	<div class="mw-page-container-inner">
		<input type="checkbox" id="mw-sidebar-checkbox" class="mw-checkbox-hack-checkbox">
		<div class="vector-sidebar-container ">
			</div>
		<div class="vector-sitenotice-container">
			<div id="siteNotice"></div>
		</div>
		<input type="checkbox" id="vector-toc-collapsed-checkbox" class="mw-checkbox-hack-checkbox">
		<div class="mw-table-of-contents-container">
			<div class="vector-sticky-toc-container mw-sticky-header-element">
				<nav id="mw-panel-toc" class="sidebar-toc" role="navigation" aria-labelledby="sidebar-toc-label" data-event-name="ui.sidebar-toc">
	<div id="sidebar-toc-label" class="sidebar-toc-header">
		<p class="sidebar-toc-title">
		Contents
		<button class="vector-toc-uncollapse-button">move to sidebar</button>
		<button class="vector-toc-collapse-button">hide</button>
		</p>
	</div>
	<ul class="sidebar-toc-contents" id="mw-panel-toc-list">
		<li id="toc-mw-content-text" class="sidebar-toc-list-item sidebar-toc-level-1">
			<a href="#top-page" class="sidebar-toc-link">
				<div class="sidebar-toc-text">Beginning</div>
			</a>
		</li>
		<li id="toc-Installation" class="sidebar-toc-list-item sidebar-toc-level-1 sidebar-toc-list-item-expanded">
			<a class="sidebar-toc-link" href="#Installation">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">1</span>Installation</div>
			</a>
			
				<button aria-controls="toc-Installation-sublist" class="mw-ui-icon mw-ui-icon-wikimedia-expand mw-ui-icon-small sidebar-toc-toggle">
					Toggle Installation subsection
				</button>
			
			<ul id="toc-Installation-sublist" class="sidebar-toc-list">
				<li id="toc-Custom_kernel" class="sidebar-toc-list-item sidebar-toc-level-2">
			<a class="sidebar-toc-link" href="#Custom_kernel">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">1.1</span>Custom kernel</div>
			</a>
			
			<ul id="toc-Custom_kernel-sublist" class="sidebar-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id="toc-Usage" class="sidebar-toc-list-item sidebar-toc-level-1 sidebar-toc-list-item-expanded">
			<a class="sidebar-toc-link" href="#Usage">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">2</span>Usage</div>
			</a>
			
				<button aria-controls="toc-Usage-sublist" class="mw-ui-icon mw-ui-icon-wikimedia-expand mw-ui-icon-small sidebar-toc-toggle">
					Toggle Usage subsection
				</button>
			
			<ul id="toc-Usage-sublist" class="sidebar-toc-list">
				<li id="toc-Display_current_status" class="sidebar-toc-list-item sidebar-toc-level-2">
			<a class="sidebar-toc-link" href="#Display_current_status">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">2.1</span>Display current status</div>
			</a>
			
			<ul id="toc-Display_current_status-sublist" class="sidebar-toc-list">
			</ul>
		</li>
		<li id="toc-Parsing_profiles" class="sidebar-toc-list-item sidebar-toc-level-2">
			<a class="sidebar-toc-link" href="#Parsing_profiles">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">2.2</span>Parsing profiles</div>
			</a>
			
			<ul id="toc-Parsing_profiles-sublist" class="sidebar-toc-list">
			</ul>
		</li>
		<li id="toc-Disabling_loading" class="sidebar-toc-list-item sidebar-toc-level-2">
			<a class="sidebar-toc-link" href="#Disabling_loading">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">2.3</span>Disabling loading</div>
			</a>
			
			<ul id="toc-Disabling_loading-sublist" class="sidebar-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id="toc-Configuration" class="sidebar-toc-list-item sidebar-toc-level-1 sidebar-toc-list-item-expanded">
			<a class="sidebar-toc-link" href="#Configuration">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">3</span>Configuration</div>
			</a>
			
				<button aria-controls="toc-Configuration-sublist" class="mw-ui-icon mw-ui-icon-wikimedia-expand mw-ui-icon-small sidebar-toc-toggle">
					Toggle Configuration subsection
				</button>
			
			<ul id="toc-Configuration-sublist" class="sidebar-toc-list">
				<li id="toc-Auditing_and_generating_profiles" class="sidebar-toc-list-item sidebar-toc-level-2">
			<a class="sidebar-toc-link" href="#Auditing_and_generating_profiles">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">3.1</span>Auditing and generating profiles</div>
			</a>
			
			<ul id="toc-Auditing_and_generating_profiles-sublist" class="sidebar-toc-list">
			</ul>
		</li>
		<li id="toc-Understanding_profiles" class="sidebar-toc-list-item sidebar-toc-level-2">
			<a class="sidebar-toc-link" href="#Understanding_profiles">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">3.2</span>Understanding profiles</div>
			</a>
			
			<ul id="toc-Understanding_profiles-sublist" class="sidebar-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id="toc-Tips_and_tricks" class="sidebar-toc-list-item sidebar-toc-level-1 sidebar-toc-list-item-expanded">
			<a class="sidebar-toc-link" href="#Tips_and_tricks">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">4</span>Tips and tricks</div>
			</a>
			
				<button aria-controls="toc-Tips_and_tricks-sublist" class="mw-ui-icon mw-ui-icon-wikimedia-expand mw-ui-icon-small sidebar-toc-toggle">
					Toggle Tips and tricks subsection
				</button>
			
			<ul id="toc-Tips_and_tricks-sublist" class="sidebar-toc-list">
				<li id="toc-Get_desktop_notification_on_DENIED_actions" class="sidebar-toc-list-item sidebar-toc-level-2">
			<a class="sidebar-toc-link" href="#Get_desktop_notification_on_DENIED_actions">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">4.1</span>Get desktop notification on DENIED actions</div>
			</a>
			
			<ul id="toc-Get_desktop_notification_on_DENIED_actions-sublist" class="sidebar-toc-list">
			</ul>
		</li>
		<li id="toc-Speed-up_AppArmor_start_by_caching_profiles" class="sidebar-toc-list-item sidebar-toc-level-2">
			<a class="sidebar-toc-link" href="#Speed-up_AppArmor_start_by_caching_profiles">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">4.2</span>Speed-up AppArmor start by caching profiles</div>
			</a>
			
			<ul id="toc-Speed-up_AppArmor_start_by_caching_profiles-sublist" class="sidebar-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id="toc-Troubleshooting" class="sidebar-toc-list-item sidebar-toc-level-1 sidebar-toc-list-item-expanded">
			<a class="sidebar-toc-link" href="#Troubleshooting">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">5</span>Troubleshooting</div>
			</a>
			
				<button aria-controls="toc-Troubleshooting-sublist" class="mw-ui-icon mw-ui-icon-wikimedia-expand mw-ui-icon-small sidebar-toc-toggle">
					Toggle Troubleshooting subsection
				</button>
			
			<ul id="toc-Troubleshooting-sublist" class="sidebar-toc-list">
				<li id="toc-Failing_to_start_Samba_SMB/CIFS_server" class="sidebar-toc-list-item sidebar-toc-level-2">
			<a class="sidebar-toc-link" href="#Failing_to_start_Samba_SMB/CIFS_server">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">5.1</span>Failing to start Samba SMB/CIFS server</div>
			</a>
			
			<ul id="toc-Failing_to_start_Samba_SMB/CIFS_server-sublist" class="sidebar-toc-list">
			</ul>
		</li>
		<li id="toc-No_events_caught_by_aa-logprof" class="sidebar-toc-list-item sidebar-toc-level-2">
			<a class="sidebar-toc-link" href="#No_events_caught_by_aa-logprof">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">5.2</span>No events caught by aa-logprof</div>
			</a>
			
			<ul id="toc-No_events_caught_by_aa-logprof-sublist" class="sidebar-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id="toc-See_also" class="sidebar-toc-list-item sidebar-toc-level-1 sidebar-toc-list-item-expanded">
			<a class="sidebar-toc-link" href="#See_also">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">6</span>See also</div>
			</a>
			
			<ul id="toc-See_also-sublist" class="sidebar-toc-list">
			</ul>
		</li>
	</ul>
</nav>

			</div>
		</div>
		<div class="mw-content-container">
			<main id="content" class="mw-body" role="main" style="margin: 0">
				<a id="top"></a>
				<nav class="vector-article-toolbar" aria-label="Tools" role="navigation">
					<div class="mw-article-toolbar-container">
						<div id="left-navigation">
							

<div id="p-associated-pages" class="vector-menu mw-portlet mw-portlet-associated-pages vector-menu-tabs">
	<div class="vector-menu-content">
		
		<ul class="vector-menu-content-list">
<li id="ca-nstab-main" class="selected mw-list-item"><a href="../en/AppArmor.html" title="View the content page [c]" accesskey="c"><span>Page</span></a></li>
<li id="ca-talk" class="mw-list-item"><a href="../en/Talk:AppArmor.html" rel="discussion" title="Discussion about the content page [t]" accesskey="t"><span>Discussion</span></a></li>
</ul>
		
	</div>
</div>

							

<div id="p-variants" class="vector-menu mw-portlet mw-portlet-variants emptyPortlet vector-menu-dropdown">
	<input type="checkbox" id="p-variants-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-p-variants" class="vector-menu-checkbox" aria-label="Change language variant">
	<label id="p-variants-label" for="p-variants-checkbox" class="vector-menu-heading ">
		<span class="vector-menu-heading-label">English</span>
	</label>
	<div class="vector-menu-content">
		
		<ul class="vector-menu-content-list"></ul>
		
	</div>
</div>

						</div>
						<div id="right-navigation" class="vector-collapsible ">
							

<div id="p-views" class="vector-menu mw-portlet mw-portlet-views vector-menu-tabs">
	<div class="vector-menu-content">
		
		<ul class="vector-menu-content-list">
<li id="ca-view" class="selected mw-list-item"><a href="../en/AppArmor.html"><span>Read</span></a></li>
<li id="ca-viewsource" class="mw-list-item"><a href="/index.php?title=AppArmor&amp;action=edit" title="This page is protected.
You can view its source [e]" accesskey="e"><span>View source</span></a></li>
<li id="ca-history" class="mw-list-item"><a href="/index.php?title=AppArmor&amp;action=history" title="Past revisions of this page [h]" accesskey="h"><span>View history</span></a></li>
</ul>
		
	</div>
</div>

							

<div id="p-cactions" class="vector-menu mw-portlet mw-portlet-cactions emptyPortlet vector-menu-dropdown vector-has-collapsible-items" title="More options">
	<input type="checkbox" id="p-cactions-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-p-cactions" class="vector-menu-checkbox">
	<label id="p-cactions-label" for="p-cactions-checkbox" class="vector-menu-heading ">
		<span class="vector-menu-heading-label">More</span>
	</label>
	<div class="vector-menu-content">
		
		<ul class="vector-menu-content-list">
<li id="ca-more-view" class="selected vector-more-collapsible-item mw-list-item"><a href="../en/AppArmor.html"><span>Read</span></a></li>
<li id="ca-more-viewsource" class="vector-more-collapsible-item mw-list-item"><a href="/index.php?title=AppArmor&amp;action=edit"><span>View source</span></a></li>
<li id="ca-more-history" class="vector-more-collapsible-item mw-list-item"><a href="/index.php?title=AppArmor&amp;action=history"><span>View history</span></a></li>
</ul>
		
	</div>
</div>

						</div>
					</div>
				</nav>
				<div id="bodyContent" class="vector-body" data-mw-ve-target-container>
					<div class="mw-body-subheader">
					        <div class="mw-indicators">
        </div>

					    <div id="siteSub" class="noprint">From ArchWiki</div>
					</div>
					
					
					
					<div id="mw-content-text" class="mw-body-content mw-content-ltr" lang="en" dir="ltr">
<div class="mw-parser-output">
<div class="archwiki-template-meta-related-articles-start">
<p class="mw-no-invert">Related articles</p>
<ul>
<li><a href="../en/Security.html" title="Security">Security</a></li>
<li><a href="../en/SELinux.html" title="SELinux">SELinux</a></li>
<li><a href="../en/TOMOYO_Linux.html" title="TOMOYO Linux">TOMOYO Linux</a></li>
</ul>
</div>
<p><a rel="nofollow" class="external text" href="https://apparmor.net/">AppArmor</a> is a <a href="../en/Security.html#Mandatory_access_control" class="mw-redirect" title="Mandatory Access Control">Mandatory Access Control</a> (MAC) system, implemented upon the <a href="https://en.wikipedia.org/wiki/Linux_Security_Modules" class="extiw" title="wikipedia:Linux Security Modules">Linux Security Modules</a> (LSM).
</p>
<p>AppArmor, like most other LSMs, supplements rather than replaces the default Discretionary Access Control (DAC). As such it is impossible to grant a process more privileges than it had in the first place. 
</p>
<p>Ubuntu, SUSE and a number of other distributions use it by default. RHEL (and its variants) use SELinux which requires good userspace integration to work properly. SELinux attaches labels to all files, processes and objects and is therefore very flexible. However configuring SELinux is considered to be very complicated and requires a supported filesystem. AppArmor on the other hand works using file paths and its configuration can be easily adapted.
</p>
<p>AppArmor proactively protects the operating system and applications from external or internal threats and even zero-day attacks by enforcing a specific rule set on a per application basis. Security policies completely define what system resources individual applications can access, and with what privileges. Access is denied by default if no profile says otherwise. A few default policies are included with AppArmor and using a combination of advanced static analysis and learning-based tools, AppArmor policies for even very complex applications can be deployed successfully in a matter of hours.
</p>
<p>Every breach of policy triggers a message in the system log, and AppArmor can be configured to notify users with real-time violation warnings popping up on the desktop.
</p>
<mw:tocplace></mw:tocplace>
<h2><span class="mw-headline" id="Installation">Installation</span></h2>
<p>AppArmor is available in all <a href="../en/Kernel.html#Officially_supported_kernels" title="Kernel">officially supported kernels</a>.
</p>
<p><a href="../en/Help:Reading.html#Installation_of_packages" class="mw-redirect" title="Install">Install</a> <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=apparmor">apparmor</a></span> for userspace tools and libraries to control AppArmor. To load all AppArmor profiles on startup, <a href="../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Enable">enable</a> <code>apparmor.service</code>.
</p>
<p>To enable AppArmor as default security model on every boot, set the following <a href="../en/Kernel_parameters.html" class="mw-redirect" title="Kernel parameter">kernel parameter</a>:
</p>
<pre>lsm=landlock,lockdown,yama,integrity,apparmor,bpf
</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> The <code>lsm=</code> kernel parameter sets the initialization order of Linux security modules. The kernel's configured <code>lsm=</code> value can be found with <code>zgrep CONFIG_LSM= /proc/config.gz</code> and the current value with <code>cat /sys/kernel/security/lsm</code>.
<ul>
<li>Make sure that <code>apparmor</code> is the first "major" module in the list.<a rel="nofollow" class="external autonumber" href="https://docs.kernel.org/admin-guide/LSM/index.html">[1]</a> Examples of valid values and their order can be found in <a rel="nofollow" class="external text" href="https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/tree/security/Kconfig">security/Kconfig</a>.</li>
<li>
<code>capability</code> should be omitted from <code>lsm=</code> as it will always get included automatically.</li>
</ul>
</div>
<h3><span class="mw-headline" id="Custom_kernel">Custom kernel</span></h3>
<p>When <a href="../en/Kernel.html#Compilation" class="mw-redirect" title="Kernels">compiling the kernel</a>, it is required to set at least the following options:
</p>
<pre>CONFIG_SECURITY_APPARMOR=y
CONFIG_AUDIT=y
</pre>
<p>To enable the AppArmor Linux security model by default and omit the need to set kernel parameters, additionally set the <code>CONFIG_LSM</code> option and specify <code>apparmor</code> as the first "major" module in the list:
</p>
<pre>CONFIG_LSM="landlock,lockdown,yama,integrity,apparmor,bpf"
</pre>
<h2><span class="mw-headline" id="Usage">Usage</span></h2>
<h3><span class="mw-headline" id="Display_current_status">Display current status</span></h3>
<p>To test if AppArmor has been correctly enabled:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">$ aa-enabled</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">Yes
</pre>
<p>To display the current loaded status use <span class="plainlinks archwiki-template-man" title="$ man 8 aa-status"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/aa-status.8">aa-status(8)</a></span>:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;"># aa-status</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">apparmor module is loaded.
44 profiles are loaded.
44 profiles are in enforce mode.
 ...
0 profiles are in complain mode.
0 processes have profiles defined.
0 processes are in enforce mode.
0 processes are in complain mode.
0 processes are unconfined but have a profile defined.
</pre>
<h3><span class="mw-headline" id="Parsing_profiles">Parsing profiles</span></h3>
<p>To load (enforce or complain), unload, reload, cache and stat profiles use <code>apparmor_parser</code>. The default action (<code>-a</code>) is to load a new profile in enforce mode, loading it in complain mode is possible using the <code>-C</code> switch, in order to overwrite an existing profile use the <code>-r</code> option and to remove a profile use <code>-R</code>. Each action may also apply to multiple profiles. Refer to <span class="plainlinks archwiki-template-man" title="$ man 8 apparmor_parser"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/apparmor_parser.8">apparmor_parser(8)</a></span> man page for more information.
</p>
<h3><span class="mw-headline" id="Disabling_loading">Disabling loading</span></h3>
<p>Disable AppArmor by unloading all profiles for the current session:
</p>
<pre># aa-teardown 
</pre>
<p>To prevent AppArmor profiles from loading at the next boot <a href="../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Disable">disable</a> <code>apparmor.service</code>. To prevent the kernel from loading AppArmor, remove the <code>lsm=</code> <a href="../en/Kernel_parameters.html" class="mw-redirect" title="Kernel parameter">kernel parameter</a> that was added when <a href="#Installation">setting up AppArmor</a>.
</p>
<h2><span class="mw-headline" id="Configuration">Configuration</span></h2>
<h3><span class="mw-headline" id="Auditing_and_generating_profiles">Auditing and generating profiles</span></h3>
<p>To create new profiles the <a href="../en/Audit_framework.html" title="Audit framework">Audit framework</a> should be running. This is because Arch Linux adopted <a href="../en/Systemd.html" title="Systemd">systemd</a> and does not do kernel logging to file by default. AppArmor can grab kernel audit logs from the userspace auditd daemon, allowing you to build a profile.
</p>
<p>New AppArmor profiles can be created by utilizing <span class="plainlinks archwiki-template-man" title="$ man 8 aa-genprof"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/aa-genprof.8">aa-genprof(8)</a></span> or <span class="plainlinks archwiki-template-man" title="$ man 8 aa-autodep"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/aa-autodep.8">aa-autodep(8)</a></span>. The profile is first created in <i>complain mode</i>: in this mode policy violations are only reported but not enforced. The rules are interactively created by the <span class="plainlinks archwiki-template-man" title="$ man 8 aa-logprof"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/aa-logprof.8">aa-logprof(8)</a></span> tool available in <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=apparmor">apparmor</a></span> package. Finally the profile should be set into <i>enforce mode</i> with <span class="plainlinks archwiki-template-man" title="$ man 8 aa-enforce"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/aa-enforce.8">aa-enforce(8)</a></span>. In this mode the policy defined by the rules in the respecting profile are enforced. If necessary, additional rules can be added by repeatedly executing <span class="plainlinks archwiki-template-man" title="$ man 8 aa-logprof"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/aa-logprof.8">aa-logprof(8)</a></span>, or the profile can be set back to complain mode with <span class="plainlinks archwiki-template-man" title="$ man 8 aa-complain"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/aa-complain.8">aa-complain(8)</a></span>. Detailed guide about using those tools is available at <a rel="nofollow" class="external text" href="https://gitlab.com/apparmor/apparmor/wikis/Profiling_with_tools">AppArmor wiki - Profiling with tools</a>.
</p>
<p>Note that <span class="plainlinks archwiki-template-man" title="$ man 8 aa-logprof"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/aa-logprof.8">aa-logprof(8)</a></span> also offers <i>deny</i> rules which are actually not strictly necessary as according to the basic AppArmor logic everything is forbidden which is not explicitly allowed by a rule. However, <i>deny</i> rules serve two purposes:
</p>
<ol>
<li>
<i>deny</i> rules take precedence over <i>allow</i> rules. They are often used in many <a rel="nofollow" class="external text" href="https://man.archlinux.org/man/extra/apparmor/apparmor.d.5.en##include_mechanism">abstractions</a> located in <code>/etc/apparmor.d/abstractions</code> in order to block any access to important folders/files. This makes sure that inadvertently created allow rules do not make a profile too permissive.</li>
<li>
<i>deny</i> rules silence logging and make subsequent runs of <i>aa-logprof</i> less noisy. It is important to keep in mind that <i>deny</i> rules are enforced also in <i>complain mode</i> - hence, if an application does not work properly even in complain mode it should be checked if a deny rule in the profile or in one of the included abstractions is the culprit.</li>
</ol>
<p>Alternatively profiles may be also created manually, see guide available at <a rel="nofollow" class="external text" href="https://gitlab.com/apparmor/apparmor/wikis/Profiling_by_hand">AppArmor wiki - Profiling by hand</a>.
</p>
<p>In addition to the default profiles in <code>/etc/apparmor.d/</code>, there are more predefined profiles in <code>/usr/share/apparmor/extra-profiles/</code>. Note that those are not necessarily deemed production-ready, so manual intervention or usage of <span class="plainlinks archwiki-template-man" title="$ man 8 aa-logprof"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/aa-logprof.8">aa-logprof(8)</a></span> may be required.
</p>
<h3><span class="mw-headline" id="Understanding_profiles">Understanding profiles</span></h3>
<p>Profiles are human readable text files residing under <code>/etc/apparmor.d/</code> describing how binaries should be treated when executed. A basic profile looks similar to this:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/apparmor.d/usr.bin.test</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">#include &lt;tunables/global&gt;

profile test /usr/lib/test/test_binary {
    #include &lt;abstractions/base&gt;

    # Main libraries and plugins
    /usr/share/TEST/** r,
    /usr/lib/TEST/** rm,

    # Configuration files and logs
    @{HOME}/.config/ r,
    @{HOME}/.config/TEST/** rw,
}
</pre>
<p>Strings preceded by a <code>@</code> symbol are variables defined by abstractions (<code>/etc/apparmor.d/abstractions/</code>), tunables (<code>/etc/apparmor.d/tunables/</code>) or by the profile itself. <code>#include</code> includes other profile-files directly. Paths followed by a set of characters are <a rel="nofollow" class="external text" href="https://man.archlinux.org/man/extra/apparmor/apparmor.d.5.en#Access_Modes">access permissions</a>. Pattern matching is done using <a rel="nofollow" class="external text" href="https://man.archlinux.org/man/extra/apparmor/apparmor.d.5.en#Globbing">AppArmor's globbing syntax</a>.
</p>
<p>Most common use cases are covered by the following statements:
</p>
<ul>
<li>
<code>r</code> — read: read data</li>
<li>
<code>w</code> — write: create, delete, write to a file and extend it</li>
<li>
<code>m</code> — memory map executable: memory map a file executable</li>
<li>
<code>x</code> — execute: execute file; needs to be preceded by a <a rel="nofollow" class="external text" href="https://gitlab.com/apparmor/apparmor/wikis/AppArmor_Core_Policy_Reference#execute-rules">qualifier</a>
</li>
</ul>
<p>Remember that those permission do not allow binaries to exceed the permission dictated by the Discretionary Access Control (DAC).
</p>
<p>This is merely a short overview, for a more detailed guide be sure to have a look at the <span class="plainlinks archwiki-template-man" title="$ man 5 apparmor.d"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/apparmor.d.5">apparmor.d(5)</a></span> man page and <a rel="nofollow" class="external text" href="https://gitlab.com/apparmor/apparmor/wikis/AppArmor_Core_Policy_Reference">documentation</a>.
</p>
<h2><span class="mw-headline" id="Tips_and_tricks">Tips and tricks</span></h2>
<h3><span class="mw-headline" id="Get_desktop_notification_on_DENIED_actions">Get desktop notification on DENIED actions</span></h3>
<p>The notification daemon displays desktop notifications whenever AppArmor denies a program access. To automatically start <i>aa-notify</i> daemon on login follow below steps:
</p>
<p>Install the <a href="../en/Audit_framework.html" title="Audit framework">Audit framework</a> and enable and start the userspace Linux Audit daemon. Allow your desktop user to read audit logs in <code>/var/log/audit</code> by adding it to <code>audit</code> <a href="../en/Users_and_groups.html#Group_management" class="mw-redirect" title="User group">user group</a>:
</p>
<pre># groupadd -r audit
# gpasswd -a <i>user</i> audit
</pre>
<p>Add <code>audit</code> group to <code>auditd.conf</code>:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/audit/auditd.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">log_group = audit</pre>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip:</strong> You may use other already existing system groups like <code>wheel</code> or <code>adm</code>.</div>
<p><a href="../en/Help:Reading.html#Installation_of_packages" class="mw-redirect" title="Install">Install</a> <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=python-notify2">python-notify2</a></span> and <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=python-psutil">python-psutil</a></span>.
</p>
<p>Create a <a href="../en/Desktop_entries.html" class="mw-redirect" title="Desktop launcher">desktop launcher</a> with the below content:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">~/.config/autostart/apparmor-notify.desktop</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[Desktop Entry]
Type=Application
Name=AppArmor Notify
Comment=Receive on screen notifications of AppArmor denials
TryExec=aa-notify
Exec=aa-notify -p -s 1 -w 60 -f /var/log/audit/audit.log
StartupNotify=false
NoDisplay=true</pre>
<p>Reboot and check if the <code>aa-notify</code> process is running:
</p>
<pre>$ pgrep -ax aa-notify
</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> Depending on your specific system configuration there could be A LOT of notifications displayed.</div>
<p>For more information, see <span class="plainlinks archwiki-template-man" title="$ man 8 aa-notify"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/aa-notify.8">aa-notify(8)</a></span>.
</p>
<h3><span class="mw-headline" id="Speed-up_AppArmor_start_by_caching_profiles">Speed-up AppArmor start by caching profiles</span></h3>
<p>Since AppArmor has to translate the configured profiles into a binary format it may significantly increase the boot time. You can check current AppArmor startup time with:
</p>
<pre>$ systemd-analyze blame | grep apparmor
</pre>
<p>To enable caching AppArmor profiles, uncomment:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/apparmor/parser.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">## Turn creating/updating of the cache on by default
write-cache</pre>
<p>To change default cache location add:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/apparmor/parser.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">cache-loc=/path/to/location</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> Since 2.13.1 default cache location is <code>/var/cache/apparmor/</code>, previously it was <code>/etc/apparmor.d/cache.d/</code>.</div>
<p>Reboot and check AppArmor startup time again to see improvement:
</p>
<pre>$ systemd-analyze blame | grep apparmor
</pre>
<h2><span class="mw-headline" id="Troubleshooting">Troubleshooting</span></h2>
<h3>
<span id="Failing_to_start_Samba_SMB.2FCIFS_server"></span><span class="mw-headline" id="Failing_to_start_Samba_SMB/CIFS_server">Failing to start Samba SMB/CIFS server</span>
</h3>
<p>See <a href="../en/Samba.html#Permission_issues_on_AppArmor" title="Samba">Samba#Permission issues on AppArmor</a>.
</p>
<h3><span class="mw-headline" id="No_events_caught_by_aa-logprof">No events caught by aa-logprof</span></h3>
<p><a href="../en/Audit_framework.html" title="Audit framework">Audit framework</a> logs may have the special character <code>0x1d</code><a rel="nofollow" class="external autonumber" href="https://github.com/linux-audit/audit-userspace/issues/3">[2]</a>. There is a <a rel="nofollow" class="external text" href="https://gitlab.com/apparmor/apparmor/-/issues/271">AppArmor bug report</a>, but a workaround is to run:
</p>
<pre># aa-logprof -f &lt;(sed 's/\x1d.*//' &lt; /var/log/audit/audit.log)
</pre>
<h2><span class="mw-headline" id="See_also">See also</span></h2>
<ul>
<li><a href="https://en.wikipedia.org/wiki/AppArmor" class="extiw" title="wikipedia:AppArmor">Wikipedia:AppArmor</a></li>
<li><a rel="nofollow" class="external text" href="https://gitlab.com/apparmor/apparmor/wikis/home">AppArmor wiki</a></li>
<li>
<a rel="nofollow" class="external text" href="https://gitlab.com/apparmor/apparmor/wikis/AppArmor_Core_Policy_Reference">AppArmor Core Policy Reference</a> — Detailed description of available options in a profile</li>
<li>
<a rel="nofollow" class="external text" href="https://ubuntuforums.org/showthread.php?t=1008906">Ubuntu Tutorial</a> — General overview of available utilities and profile creation</li>
<li>
<a rel="nofollow" class="external text" href="https://help.ubuntu.com/community/AppArmor">Ubuntu Wiki</a> — Basic command overview</li>
<li>
<a rel="nofollow" class="external text" href="https://gitlab.com/apparmor/apparmor/wikis/AppArmor_versions">AppArmor Versions</a> — Version overview and links to the respective release notes</li>
<li>
<a rel="nofollow" class="external text" href="https://gitlab.com/apparmor/apparmor/wikis/Kernel_interfaces">Kernel Interfaces</a> — Low level interfaces to the AppArmor kernel module</li>
<li>
<a href="https://en.wikipedia.org/wiki/Linux_Security_Modules" class="extiw" title="wikipedia:Linux Security Modules">wikipedia:Linux Security Modules</a> — Linux kernel module on which basis AppArmor is build upon</li>
<li><a rel="nofollow" class="external text" href="https://doc.opensuse.org/documentation/leap/security/single-html/book-security/index.html#part-apparmor">AppArmor in openSUSE Security Guide</a></li>
</ul>
</div>
</div>
					<div id="catlinks" class="catlinks" data-mw="interface"><div id="mw-normal-catlinks" class="mw-normal-catlinks">
<a href="../Special:Categories.html" title="Special:Categories">Categories</a>: <ul>
<li><a href="../en/Category:Access_control.html" title="Category:Access control">Access control</a></li>
<li><a href="../en/Category:Kernel.html" title="Category:Kernel">Kernel</a></li>
</ul>
</div></div>
				</div>
			</main>
			
		</div>
		<div class="mw-footer-container">
			
<footer id="footer" class="mw-footer" role="contentinfo" style="margin: 0">
	<ul id="footer-info">
	<li data-nosnippet="">Retrieved from "<a dir="ltr" href="https://wiki.archlinux.org/index.php?title=AppArmor&amp;oldid=780809">https://wiki.archlinux.org/index.php?title=AppArmor&amp;oldid=780809</a>"</li>
<li id="footer-info-lastmod"> This page was last edited on 10 June 2023, at 17:19.</li>
	<li id="footer-info-copyright">Content is available under <a class="external" rel="nofollow" href="https://www.gnu.org/copyleft/fdl.html">GNU Free Documentation License 1.3 or later</a> unless otherwise noted.</li>
<br>
</ul>

	<ul id="footer-places">
	<li id="footer-places-privacy"><a href="https://terms.archlinux.org/docs/privacy-policy/">Privacy policy</a></li>
	<li id="footer-places-about"><a href="../en/ArchWiki:About.html">About ArchWiki</a></li>
	<li id="footer-places-disclaimer"><a href="../en/ArchWiki:General_disclaimer.html">Disclaimers</a></li>
</ul>

	
</footer>

		</div>
	</div> 
</div> 

</body>
</html>
