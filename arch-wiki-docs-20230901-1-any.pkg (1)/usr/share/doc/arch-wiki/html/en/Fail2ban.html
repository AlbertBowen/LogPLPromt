<!DOCTYPE html>
<html class="client-nojs" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<title>Fail2ban - ArchWiki</title>
<link rel="stylesheet" href="../ArchWikiOffline.css">
<meta name="ResourceLoaderDynamicStyles" content="">
<meta name="generator" content="MediaWiki 1.39.4">
<meta name="referrer" content="no-referrer-when-downgrade">
<meta name="format-detection" content="telephone=no">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes, minimum-scale=0.25, maximum-scale=5.0">
<link rel="icon" href="/favicon.ico">
<link rel="search" type="application/opensearchdescription+xml" href="/opensearch_desc.php" title="ArchWiki (en)">
<link rel="EditURI" type="application/rsd+xml" href="https://wiki.archlinux.org/api.php?action=rsd">
<link rel="license" href="https://www.gnu.org/copyleft/fdl.html">
<link rel="alternate" type="application/atom+xml" title="ArchWiki Atom feed" href="/index.php?title=Special:RecentChanges&amp;feed=atom">
</head>
<body class="skin-vector skin-vector-search-vue mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-Fail2ban rootpage-Fail2ban skin-vector-2022 action-view skin--responsive vector-feature-language-in-header-enabled vector-feature-language-in-main-page-header-disabled vector-feature-language-alert-in-sidebar-disabled vector-feature-sticky-header-disabled vector-feature-sticky-header-edit-disabled vector-feature-table-of-contents-disabled vector-feature-visual-enhancement-next-disabled">
<div class="mw-page-container">
	<span id="top-page"></span>
	<a class="mw-jump-link" href="#content">Jump to content</a>
	<div class="mw-page-container-inner">
		<input type="checkbox" id="mw-sidebar-checkbox" class="mw-checkbox-hack-checkbox">
		<div class="vector-sidebar-container ">
			</div>
		<div class="vector-sitenotice-container">
			<div id="siteNotice"></div>
		</div>
		<input type="checkbox" id="vector-toc-collapsed-checkbox" class="mw-checkbox-hack-checkbox">
		<div class="mw-table-of-contents-container">
			<div class="vector-sticky-toc-container mw-sticky-header-element">
				<nav id="mw-panel-toc" class="sidebar-toc" role="navigation" aria-labelledby="sidebar-toc-label" data-event-name="ui.sidebar-toc">
	<div id="sidebar-toc-label" class="sidebar-toc-header">
		<p class="sidebar-toc-title">
		Contents
		<button class="vector-toc-uncollapse-button">move to sidebar</button>
		<button class="vector-toc-collapse-button">hide</button>
		</p>
	</div>
	<ul class="sidebar-toc-contents" id="mw-panel-toc-list">
		<li id="toc-mw-content-text" class="sidebar-toc-list-item sidebar-toc-level-1">
			<a href="#top-page" class="sidebar-toc-link">
				<div class="sidebar-toc-text">Beginning</div>
			</a>
		</li>
		<li id="toc-Installation" class="sidebar-toc-list-item sidebar-toc-level-1 sidebar-toc-list-item-expanded">
			<a class="sidebar-toc-link" href="#Installation">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">1</span>Installation</div>
			</a>
			
			<ul id="toc-Installation-sublist" class="sidebar-toc-list">
			</ul>
		</li>
		<li id="toc-Usage" class="sidebar-toc-list-item sidebar-toc-level-1 sidebar-toc-list-item-expanded">
			<a class="sidebar-toc-link" href="#Usage">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">2</span>Usage</div>
			</a>
			
				<button aria-controls="toc-Usage-sublist" class="mw-ui-icon mw-ui-icon-wikimedia-expand mw-ui-icon-small sidebar-toc-toggle">
					Toggle Usage subsection
				</button>
			
			<ul id="toc-Usage-sublist" class="sidebar-toc-list">
				<li id="toc-fail2ban-client" class="sidebar-toc-list-item sidebar-toc-level-2">
			<a class="sidebar-toc-link" href="#fail2ban-client">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">2.1</span>fail2ban-client</div>
			</a>
			
			<ul id="toc-fail2ban-client-sublist" class="sidebar-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id="toc-Configuration" class="sidebar-toc-list-item sidebar-toc-level-1 sidebar-toc-list-item-expanded">
			<a class="sidebar-toc-link" href="#Configuration">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">3</span>Configuration</div>
			</a>
			
				<button aria-controls="toc-Configuration-sublist" class="mw-ui-icon mw-ui-icon-wikimedia-expand mw-ui-icon-small sidebar-toc-toggle">
					Toggle Configuration subsection
				</button>
			
			<ul id="toc-Configuration-sublist" class="sidebar-toc-list">
				<li id="toc-Enabling_jails" class="sidebar-toc-list-item sidebar-toc-level-2">
			<a class="sidebar-toc-link" href="#Enabling_jails">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">3.1</span>Enabling jails</div>
			</a>
			
			<ul id="toc-Enabling_jails-sublist" class="sidebar-toc-list">
			</ul>
		</li>
		<li id="toc-Receive_an_alert_e-mail" class="sidebar-toc-list-item sidebar-toc-level-2">
			<a class="sidebar-toc-link" href="#Receive_an_alert_e-mail">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">3.2</span>Receive an alert e-mail</div>
			</a>
			
			<ul id="toc-Receive_an_alert_e-mail-sublist" class="sidebar-toc-list">
			</ul>
		</li>
		<li id="toc-Firewall_and_services" class="sidebar-toc-list-item sidebar-toc-level-2">
			<a class="sidebar-toc-link" href="#Firewall_and_services">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">3.3</span>Firewall and services</div>
			</a>
			
			<ul id="toc-Firewall_and_services-sublist" class="sidebar-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id="toc-Tips_and_tricks" class="sidebar-toc-list-item sidebar-toc-level-1 sidebar-toc-list-item-expanded">
			<a class="sidebar-toc-link" href="#Tips_and_tricks">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">4</span>Tips and tricks</div>
			</a>
			
				<button aria-controls="toc-Tips_and_tricks-sublist" class="mw-ui-icon mw-ui-icon-wikimedia-expand mw-ui-icon-small sidebar-toc-toggle">
					Toggle Tips and tricks subsection
				</button>
			
			<ul id="toc-Tips_and_tricks-sublist" class="sidebar-toc-list">
				<li id="toc-Custom_SSH_jail" class="sidebar-toc-list-item sidebar-toc-level-2">
			<a class="sidebar-toc-link" href="#Custom_SSH_jail">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">4.1</span>Custom SSH jail</div>
			</a>
			
			<ul id="toc-Custom_SSH_jail-sublist" class="sidebar-toc-list">
			</ul>
		</li>
		<li id="toc-Systemd_backend:_journald_filtering" class="sidebar-toc-list-item sidebar-toc-level-2">
			<a class="sidebar-toc-link" href="#Systemd_backend:_journald_filtering">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">4.2</span>Systemd backend: journald filtering</div>
			</a>
			
			<ul id="toc-Systemd_backend:_journald_filtering-sublist" class="sidebar-toc-list">
			</ul>
		</li>
		<li id="toc-Service_hardening" class="sidebar-toc-list-item sidebar-toc-level-2">
			<a class="sidebar-toc-link" href="#Service_hardening">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">4.3</span>Service hardening</div>
			</a>
			
			<ul id="toc-Service_hardening-sublist" class="sidebar-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id="toc-See_also" class="sidebar-toc-list-item sidebar-toc-level-1 sidebar-toc-list-item-expanded">
			<a class="sidebar-toc-link" href="#See_also">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">5</span>See also</div>
			</a>
			
			<ul id="toc-See_also-sublist" class="sidebar-toc-list">
			</ul>
		</li>
	</ul>
</nav>

			</div>
		</div>
		<div class="mw-content-container">
			<main id="content" class="mw-body" role="main" style="margin: 0">
				<a id="top"></a>
				<nav class="vector-article-toolbar" aria-label="Tools" role="navigation">
					<div class="mw-article-toolbar-container">
						<div id="left-navigation">
							

<div id="p-associated-pages" class="vector-menu mw-portlet mw-portlet-associated-pages vector-menu-tabs">
	<div class="vector-menu-content">
		
		<ul class="vector-menu-content-list">
<li id="ca-nstab-main" class="selected mw-list-item"><a href="../en/Fail2ban.html" title="View the content page [c]" accesskey="c"><span>Page</span></a></li>
<li id="ca-talk" class="mw-list-item"><a href="../en/Talk:Fail2ban.html" rel="discussion" title="Discussion about the content page [t]" accesskey="t"><span>Discussion</span></a></li>
</ul>
		
	</div>
</div>

							

<div id="p-variants" class="vector-menu mw-portlet mw-portlet-variants emptyPortlet vector-menu-dropdown">
	<input type="checkbox" id="p-variants-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-p-variants" class="vector-menu-checkbox" aria-label="Change language variant">
	<label id="p-variants-label" for="p-variants-checkbox" class="vector-menu-heading ">
		<span class="vector-menu-heading-label">English</span>
	</label>
	<div class="vector-menu-content">
		
		<ul class="vector-menu-content-list"></ul>
		
	</div>
</div>

						</div>
						<div id="right-navigation" class="vector-collapsible ">
							

<div id="p-views" class="vector-menu mw-portlet mw-portlet-views vector-menu-tabs">
	<div class="vector-menu-content">
		
		<ul class="vector-menu-content-list">
<li id="ca-view" class="selected mw-list-item"><a href="../en/Fail2ban.html"><span>Read</span></a></li>
<li id="ca-viewsource" class="mw-list-item"><a href="/index.php?title=Fail2ban&amp;action=edit" title="This page is protected.
You can view its source [e]" accesskey="e"><span>View source</span></a></li>
<li id="ca-history" class="mw-list-item"><a href="/index.php?title=Fail2ban&amp;action=history" title="Past revisions of this page [h]" accesskey="h"><span>View history</span></a></li>
</ul>
		
	</div>
</div>

							

<div id="p-cactions" class="vector-menu mw-portlet mw-portlet-cactions emptyPortlet vector-menu-dropdown vector-has-collapsible-items" title="More options">
	<input type="checkbox" id="p-cactions-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-p-cactions" class="vector-menu-checkbox">
	<label id="p-cactions-label" for="p-cactions-checkbox" class="vector-menu-heading ">
		<span class="vector-menu-heading-label">More</span>
	</label>
	<div class="vector-menu-content">
		
		<ul class="vector-menu-content-list">
<li id="ca-more-view" class="selected vector-more-collapsible-item mw-list-item"><a href="../en/Fail2ban.html"><span>Read</span></a></li>
<li id="ca-more-viewsource" class="vector-more-collapsible-item mw-list-item"><a href="/index.php?title=Fail2ban&amp;action=edit"><span>View source</span></a></li>
<li id="ca-more-history" class="vector-more-collapsible-item mw-list-item"><a href="/index.php?title=Fail2ban&amp;action=history"><span>View history</span></a></li>
</ul>
		
	</div>
</div>

						</div>
					</div>
				</nav>
				<div id="bodyContent" class="vector-body" data-mw-ve-target-container>
					<div class="mw-body-subheader">
					        <div class="mw-indicators">
        </div>

					    <div id="siteSub" class="noprint">From ArchWiki</div>
					</div>
					
					
					
					<div id="mw-content-text" class="mw-body-content mw-content-ltr" lang="en" dir="ltr">
<div class="mw-parser-output">
<div class="archwiki-template-meta-related-articles-start">
<p class="mw-no-invert">Related articles</p>
<ul>
<li><a href="../en/Sshguard.html" title="Sshguard">sshguard</a></li>
<li><a href="../en/Security.html" title="Security">Security</a></li>
</ul>
</div>
<p><a rel="nofollow" class="external text" href="https://www.fail2ban.org/wiki/index.php/Main_Page">Fail2ban</a> scans log files (e.g. <code>/var/log/httpd/error_log</code>) and bans IPs that show the malicious signs like too many password failures, seeking for exploits, etc. Generally Fail2ban is then used to update <a href="../en/Category:Firewalls.html" class="mw-redirect" title="Firewall">firewall</a> rules to reject the IP addresses for a specified amount of time, although any other arbitrary action (e.g. sending an email) could also be configured. 
</p>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Warning:</strong> Using an IP banning software will stop trivial attacks but it relies on an additional daemon and successful logging. Additionally, if the attacker knows your IP address, they can send packets with a spoofed source header and get your IP address banned. Make sure to specify your IP in <code>ignoreip</code>.</div>
<mw:tocplace></mw:tocplace>
<h2><span class="mw-headline" id="Installation">Installation</span></h2>
<p><a href="../en/Help:Reading.html#Installation_of_packages" class="mw-redirect" title="Install">Install</a> one of the following packages:
</p>
<ul>
<li>
<span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=fail2ban">fail2ban</a></span> - Latest stable version.</li>
<li>
<span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/fail2ban-git/">fail2ban-git</a></span><sup><small>AUR</small></sup> - Latest commit to master.</li>
</ul>
<h2><span class="mw-headline" id="Usage">Usage</span></h2>
<p><a href="#Configuration">Configure</a> Fail2ban and <a href="../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Enable/start">enable/start</a> <code>fail2ban.service</code>.
</p>
<h3><span class="mw-headline" id="fail2ban-client">fail2ban-client</span></h3>
<p>The fail2ban-client allows monitoring jails (reload, restart, status, etc.), to view all available commands:
</p>
<pre>$ fail2ban-client
</pre>
<p>To view all enabled jails:
</p>
<pre># fail2ban-client status
</pre>
<p>To check the status of a jail, e.g. for <i>sshd</i>:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;"># fail2ban-client status sshd</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">Status for the jail: sshd
|- Filter
|  |- Currently failed: 1
|  |- Total failed:     9
|  `- Journal matches:  _SYSTEMD_UNIT=sshd.service + _COMM=sshd
`- Actions
   |- Currently banned: 1
   |- Total banned:     1
   `- Banned IP list:   0.0.0.0
</pre>
<p>For a compact version for all jails, including banned IPs:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;"># fail2ban-client banned</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[{'sshd': ['192.168.100.50']}, {'apache-auth': []}]
</pre>
<h2><span class="mw-headline" id="Configuration">Configuration</span></h2>
<div class="noprint archwiki-template-message">
<p><a href="../File:Tango-view-fullscreen.png" class="image"><img alt="Tango-view-fullscreen.png" src="../File:Tango-view-fullscreen.png" decoding="async" width="48" height="48"></a><b>This article or section needs expansion.</b><a href="../File:Tango-view-fullscreen.png" class="image"><img alt="Tango-view-fullscreen.png" src="../File:Tango-view-fullscreen.png" decoding="async" width="48" height="48"></a></p>
<div>
<b>Reason:</b> Add a note about <code>dbpurgeage</code>, see <a rel="nofollow" class="external autonumber" href="https://wiki.meurisse.org/wiki/Fail2Ban#Recidive">[1]</a>. (Discuss in <a rel="nofollow" class="external text" href="https://wiki.archlinux.org/title/Talk:Fail2ban">Talk:Fail2ban</a>)</div>
</div>
<p>Due to the possibility of <a href="../en/Pacman/Pacnew_and_Pacsave.html" class="mw-redirect" title="Pacnew and Pacsave files">Pacnew and Pacsave files</a> being created for <code>/etc/fail2ban/jail.conf</code> during an <a href="../en/System_maintenance.html#Upgrading_the_system" class="mw-redirect" title="Upgrade">upgrade</a>, <span class="plainlinks archwiki-template-man" title="$ man 5 jail.conf"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/jail.conf.5#CONFIGURATION_FILES_FORMAT">jail.conf(5) § CONFIGURATION FILES FORMAT</a></span> recommends that users <a href="../en/Help:Reading.html#Append,_add,_create,_edit" class="mw-redirect" title="Create">create</a> a <code>/etc/fail2ban/jail.local</code> file to "ease upgrades".
</p>
<p>For example, to change the default ban time to 1 day:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/fail2ban/jail.local</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[DEFAULT]
bantime = 1d</pre>
<p>Or create separate <code><i>name</i>.local</code> files under the <code>/etc/fail2ban/jail.d</code> directory, e.g. <code>/etc/fail2ban/jail.d/sshd.local</code>.
</p>
<p><a href="../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Reload">Reload</a> <code>fail2ban.service</code> to apply the configuration changes.
</p>
<h3><span class="mw-headline" id="Enabling_jails">Enabling jails</span></h3>
<p>By default all jails are disabled. <a href="../en/Help:Reading.html#Append,_add,_create,_edit" class="mw-redirect" title="Append">Append</a> <code>enabled = true</code> to the jail you want to use, e.g. to enable the <a href="../en/OpenSSH.html" title="OpenSSH">OpenSSH</a> jail:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/fail2ban/jail.local</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[sshd]
enabled = true</pre>
<p>See <a href="#Custom_SSH_jail">#Custom SSH jail</a>.
</p>
<h3><span class="mw-headline" id="Receive_an_alert_e-mail">Receive an alert e-mail</span></h3>
<p>If you want to receive an e-mail when someone has been banned, you have to configure an SMTP client (e.g. <a href="../en/Msmtp.html" title="Msmtp">msmtp</a>) and change default action, as given below.
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/fail2ban/jail.local</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[DEFAULT]
destemail = yourname@example.com
sender = yourname@example.com

# to ban &amp; send an e-mail with whois report to the destemail.
action = %(action_mw)s

# same as action_mw but also send relevant log lines
#action = %(action_mwl)s</pre>
<h3><span class="mw-headline" id="Firewall_and_services">Firewall and services</span></h3>
<p>By default, Fail2ban uses <a href="../en/Iptables.html" title="Iptables">iptables</a>. However, configuration of most <a href="../en/Category:Firewalls.html" class="mw-redirect" title="Firewalls">firewalls</a> and services is straightforward. For example, to use <a href="../en/Nftables.html" title="Nftables">nftables</a>:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/fail2ban/jail.local</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[DEFAULT]
banaction = nftables
banaction_allports = nftables[type=allports]</pre>
<p>See <code>/etc/fail2ban/action.d/</code> for other examples, e.g. <a rel="nofollow" class="external text" href="https://github.com/fail2ban/fail2ban/blob/master/config/action.d/ufw.conf">ufw.conf</a>.
</p>
<h2><span class="mw-headline" id="Tips_and_tricks">Tips and tricks</span></h2>
<h3><span class="mw-headline" id="Custom_SSH_jail">Custom SSH jail</span></h3>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Warning:</strong> If the attacker knows your IP address, they can send packets with a spoofed source header and get your IP address locked out of the server. <a href="../en/SSH_keys.html" title="SSH keys">SSH keys</a> provide an elegant solution to the problem of brute forcing without these problems.</div>
<p>Edit <code>/etc/fail2ban/jail.d/sshd.local</code>, add this section and update the list of trusted IP addresses in <code>ignoreip</code>:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/fail2ban/jail.d/sshd.local</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[sshd]
enabled   = true
filter    = sshd
banaction = iptables
backend   = systemd
maxretry  = 5
findtime  = 1d
bantime   = 2w
ignoreip  = 127.0.0.1/8</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> 
<ul>
<li>It may be necessary to set <code>LogLevel VERBOSE</code> in <code>/etc/ssh/sshd_config</code> to allow full fail2ban monitoring as otherwise password failures may not be logged correctly.</li>
<li>Fail2ban has IPv6 support since version 0.10. Adapt your <a href="../en/Category:Firewalls.html" class="mw-redirect" title="Firewall">firewall</a> accordingly, e.g. <a href="../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Start">start</a>/<a href="../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Enable">enable</a> <code>ip6tables.service</code>.</li>
<li>When using journal namespaces (by adding <code>LogNamespace=<i>something</i></code> to a unit file), you can make fail2ban read those logs by setting <code>backend</code> like this: <code>backend = systemd[journalfiles="/var/log/journal/*.<i>something</i>/system.journal"]</code>.</li>
</ul>
</div>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip:</strong> 
<ul>
<li>If using <a href="../en/Iptables.html" title="Iptables">iptables</a> front-ends like <a href="../en/Uncomplicated_Firewall.html" class="mw-redirect" title="Ufw">ufw</a>, one can use <code>banaction = ufw</code> instead of using iptables.</li>
<li>When using <a href="../en/Shorewall.html" title="Shorewall">Shorewall</a>, one can use <code>banaction = shorewall</code> and also set <code>BLACKLIST</code> to <code>ALL</code> in <code>/etc/shorewall/shorewall.conf</code>, otherwise the rule added to ban an IP address will affect only new connections.</li>
</ul>
</div>
<h3><span class="mw-headline" id="Systemd_backend:_journald_filtering">Systemd backend: journald filtering</span></h3>
<p>When using the <i>systemd</i> backend to improve performance, configure a filter with <code>journalmatch</code>. For example, to parse only kernel-level log messages:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/fail2ban/filter.d/fwdrop.local</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[Definition]
failregex = ^.*DROP_.*SRC=&lt;ADDR&gt; DST=.*$
journalmatch = _TRANSPORT=kernel</pre>
<p>See also <span class="plainlinks archwiki-template-man" title="$ man 7 systemd.journal-fields"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/systemd.journal-fields.7">systemd.journal-fields(7)</a></span>.
</p>
<h3><span class="mw-headline" id="Service_hardening">Service hardening</span></h3>
<p>Currently, Fail2ban must be run as <i>root</i>. Therefore, you may wish to consider hardening the process with <a href="../en/Systemd.html" title="Systemd">systemd</a>.
</p>
<p><a href="../en/Help:Reading.html#Append,_add,_create,_edit" class="mw-redirect" title="Create">Create</a> a <a href="../en/Systemd.html#Drop-in_files" title="Systemd">drop-in</a> configuration file for <code>fail2ban.service</code>:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/systemd/system/fail2ban.service.d/override.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[Service]
PrivateDevices=yes
PrivateTmp=yes
ProtectHome=read-only
ProtectSystem=strict
ReadWritePaths=-/var/run/fail2ban
ReadWritePaths=-/var/lib/fail2ban
ReadWritePaths=-/var/log/fail2ban
ReadWritePaths=-/var/spool/postfix/maildrop
ReadWritePaths=/run/xtables.lock
CapabilityBoundingSet=CAP_AUDIT_READ CAP_DAC_READ_SEARCH CAP_NET_ADMIN CAP_NET_RAW</pre>
<p>The <code>CapabilityBoundingSet</code> parameters <code>CAP_DAC_READ_SEARCH</code> will allow Fail2ban full read access to every directory and file. <code>CAP_NET_ADMIN</code> and <code>CAP_NET_RAW</code> allow Fail2ban to operate on any firewall that has <a href="../en/Command-line_shell.html" title="Command-line shell">command-line shell</a> interface. See <span class="plainlinks archwiki-template-man" title="$ man 7 capabilities"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/capabilities.7">capabilities(7)</a></span> for more info.
</p>
<p>By using <code>ProtectSystem=strict</code> the <a href="../en/File_systems.html" class="mw-redirect" title="Filesystem">filesystem</a> hierarchy will only be read-only, <code>ReadWritePaths</code> allows Fail2ban to have write access on required paths.
</p>
<p>Create <code>/etc/fail2ban/fail2ban.local</code> with the correct <code>logtarget</code> path:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/fail2ban/fail2ban.local</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[Definition]
logtarget = /var/log/fail2ban/fail2ban.log
</pre>
<p>Create the <code>/var/log/fail2ban/</code> directory as root.
</p>
<p>Finally, <a href="../en/Systemd.html#Using_units" title="Systemd">reload systemd daemon</a> to apply the changes of the unit and <a href="../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Restart">restart</a> <code>fail2ban.service</code>.
</p>
<h2><span class="mw-headline" id="See_also">See also</span></h2>
<ul>
<li><a rel="nofollow" class="external text" href="https://www.the-art-of-web.com/system/fail2ban-action-whitelist/">Using a Fail2Ban Jail to Whitelist a User</a></li>
<li><a rel="nofollow" class="external text" href="https://www.the-art-of-web.com/system/fail2ban-filters/">Optimising your Fail2Ban filters</a></li>
<li><a rel="nofollow" class="external text" href="https://www.the-art-of-web.com/system/fail2ban-sendmail/">Fail2Ban and sendmail</a></li>
<li><a rel="nofollow" class="external text" href="https://www.the-art-of-web.com/system/fail2ban/">Fail2Ban and iptables</a></li>
<li><a rel="nofollow" class="external text" href="https://www.the-art-of-web.com/system/fail2ban-howto/">Fail2Ban 0.8.3 Howto</a></li>
<li><a rel="nofollow" class="external text" href="https://www.the-art-of-web.com/system/fail2ban-log/">Monitoring the fail2ban log</a></li>
</ul>
</div>
</div>
					<div id="catlinks" class="catlinks" data-mw="interface">
<div id="mw-normal-catlinks" class="mw-normal-catlinks">
<a href="../Special:Categories.html" title="Special:Categories">Categories</a>: <ul>
<li><a href="../en/Category:Firewalls.html" title="Category:Firewalls">Firewalls</a></li>
<li><a href="../en/Category:Secure_Shell.html" title="Category:Secure Shell">Secure Shell</a></li>
</ul>
</div>
<div id="mw-hidden-catlinks" class="mw-hidden-catlinks mw-hidden-cats-hidden">Hidden category: <ul><li><a href="../en/Category:Pages_or_sections_flagged_with_Template:Expansion.html" title="Category:Pages or sections flagged with Template:Expansion">Pages or sections flagged with Template:Expansion</a></li></ul>
</div>
</div>
				</div>
			</main>
			
		</div>
		<div class="mw-footer-container">
			
<footer id="footer" class="mw-footer" role="contentinfo" style="margin: 0">
	<ul id="footer-info">
	<li data-nosnippet="">Retrieved from "<a dir="ltr" href="https://wiki.archlinux.org/index.php?title=Fail2ban&amp;oldid=783405">https://wiki.archlinux.org/index.php?title=Fail2ban&amp;oldid=783405</a>"</li>
<li id="footer-info-lastmod"> This page was last edited on 18 July 2023, at 02:20.</li>
	<li id="footer-info-copyright">Content is available under <a class="external" rel="nofollow" href="https://www.gnu.org/copyleft/fdl.html">GNU Free Documentation License 1.3 or later</a> unless otherwise noted.</li>
<br>
</ul>

	<ul id="footer-places">
	<li id="footer-places-privacy"><a href="https://terms.archlinux.org/docs/privacy-policy/">Privacy policy</a></li>
	<li id="footer-places-about"><a href="../en/ArchWiki:About.html">About ArchWiki</a></li>
	<li id="footer-places-disclaimer"><a href="../en/ArchWiki:General_disclaimer.html">Disclaimers</a></li>
</ul>

	
</footer>

		</div>
	</div> 
</div> 

</body>
</html>
