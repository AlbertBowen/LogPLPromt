<!DOCTYPE html>
<html class="client-nojs" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<title>dracut - ArchWiki</title>
<link rel="stylesheet" href="../ArchWikiOffline.css">
<meta name="ResourceLoaderDynamicStyles" content="">
<meta name="generator" content="MediaWiki 1.39.4">
<meta name="referrer" content="no-referrer-when-downgrade">
<meta name="format-detection" content="telephone=no">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes, minimum-scale=0.25, maximum-scale=5.0">
<link rel="icon" href="/favicon.ico">
<link rel="search" type="application/opensearchdescription+xml" href="/opensearch_desc.php" title="ArchWiki (en)">
<link rel="EditURI" type="application/rsd+xml" href="https://wiki.archlinux.org/api.php?action=rsd">
<link rel="license" href="https://www.gnu.org/copyleft/fdl.html">
<link rel="alternate" type="application/atom+xml" title="ArchWiki Atom feed" href="/index.php?title=Special:RecentChanges&amp;feed=atom">
</head>
<body class="skin-vector skin-vector-search-vue mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-Dracut rootpage-Dracut skin-vector-2022 action-view skin--responsive vector-feature-language-in-header-enabled vector-feature-language-in-main-page-header-disabled vector-feature-language-alert-in-sidebar-disabled vector-feature-sticky-header-disabled vector-feature-sticky-header-edit-disabled vector-feature-table-of-contents-disabled vector-feature-visual-enhancement-next-disabled">
<div class="mw-page-container">
	<span id="top-page"></span>
	<a class="mw-jump-link" href="#content">Jump to content</a>
	<div class="mw-page-container-inner">
		<input type="checkbox" id="mw-sidebar-checkbox" class="mw-checkbox-hack-checkbox">
		<div class="vector-sidebar-container ">
			</div>
		<div class="vector-sitenotice-container">
			<div id="siteNotice"></div>
		</div>
		<input type="checkbox" id="vector-toc-collapsed-checkbox" class="mw-checkbox-hack-checkbox">
		<div class="mw-table-of-contents-container">
			<div class="vector-sticky-toc-container mw-sticky-header-element">
				<nav id="mw-panel-toc" class="sidebar-toc" role="navigation" aria-labelledby="sidebar-toc-label" data-event-name="ui.sidebar-toc">
	<div id="sidebar-toc-label" class="sidebar-toc-header">
		<p class="sidebar-toc-title">
		Contents
		<button class="vector-toc-uncollapse-button">move to sidebar</button>
		<button class="vector-toc-collapse-button">hide</button>
		</p>
	</div>
	<ul class="sidebar-toc-contents" id="mw-panel-toc-list">
		<li id="toc-mw-content-text" class="sidebar-toc-list-item sidebar-toc-level-1">
			<a href="#top-page" class="sidebar-toc-link">
				<div class="sidebar-toc-text">Beginning</div>
			</a>
		</li>
		<li id="toc-Installation" class="sidebar-toc-list-item sidebar-toc-level-1">
			<a class="sidebar-toc-link" href="#Installation">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">1</span>Installation</div>
			</a>
			
			<ul id="toc-Installation-sublist" class="sidebar-toc-list">
			</ul>
		</li>
		<li id="toc-Usage" class="sidebar-toc-list-item sidebar-toc-level-1">
			<a class="sidebar-toc-link" href="#Usage">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">2</span>Usage</div>
			</a>
			
				<button aria-controls="toc-Usage-sublist" class="mw-ui-icon mw-ui-icon-wikimedia-expand mw-ui-icon-small sidebar-toc-toggle">
					Toggle Usage subsection
				</button>
			
			<ul id="toc-Usage-sublist" class="sidebar-toc-list">
				<li id="toc-Additional_options" class="sidebar-toc-list-item sidebar-toc-level-2">
			<a class="sidebar-toc-link" href="#Additional_options">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">2.1</span>Additional options</div>
			</a>
			
			<ul id="toc-Additional_options-sublist" class="sidebar-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id="toc-Advanced_configuration" class="sidebar-toc-list-item sidebar-toc-level-1">
			<a class="sidebar-toc-link" href="#Advanced_configuration">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">3</span>Advanced configuration</div>
			</a>
			
				<button aria-controls="toc-Advanced_configuration-sublist" class="mw-ui-icon mw-ui-icon-wikimedia-expand mw-ui-icon-small sidebar-toc-toggle">
					Toggle Advanced configuration subsection
				</button>
			
			<ul id="toc-Advanced_configuration-sublist" class="sidebar-toc-list">
				<li id="toc-Dracut_modules" class="sidebar-toc-list-item sidebar-toc-level-2">
			<a class="sidebar-toc-link" href="#Dracut_modules">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">3.1</span>Dracut modules</div>
			</a>
			
			<ul id="toc-Dracut_modules-sublist" class="sidebar-toc-list">
				<li id="toc-TPM2" class="sidebar-toc-list-item sidebar-toc-level-3">
			<a class="sidebar-toc-link" href="#TPM2">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">3.1.1</span>TPM2</div>
			</a>
			
			<ul id="toc-TPM2-sublist" class="sidebar-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id="toc-Early_kernel_module_loading" class="sidebar-toc-list-item sidebar-toc-level-2">
			<a class="sidebar-toc-link" href="#Early_kernel_module_loading">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">3.2</span>Early kernel module loading</div>
			</a>
			
			<ul id="toc-Early_kernel_module_loading-sublist" class="sidebar-toc-list">
			</ul>
		</li>
		<li id="toc-Kernel_command_line_options" class="sidebar-toc-list-item sidebar-toc-level-2">
			<a class="sidebar-toc-link" href="#Kernel_command_line_options">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">3.3</span>Kernel command line options</div>
			</a>
			
			<ul id="toc-Kernel_command_line_options-sublist" class="sidebar-toc-list">
				<li id="toc-Miscellaneous_notes" class="sidebar-toc-list-item sidebar-toc-level-3">
			<a class="sidebar-toc-link" href="#Miscellaneous_notes">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">3.3.1</span>Miscellaneous notes</div>
			</a>
			
			<ul id="toc-Miscellaneous_notes-sublist" class="sidebar-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id="toc-Unified_kernel_image" class="sidebar-toc-list-item sidebar-toc-level-2">
			<a class="sidebar-toc-link" href="#Unified_kernel_image">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">3.4</span>Unified kernel image</div>
			</a>
			
			<ul id="toc-Unified_kernel_image-sublist" class="sidebar-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id="toc-Tips_and_tricks" class="sidebar-toc-list-item sidebar-toc-level-1">
			<a class="sidebar-toc-link" href="#Tips_and_tricks">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">4</span>Tips and tricks</div>
			</a>
			
				<button aria-controls="toc-Tips_and_tricks-sublist" class="mw-ui-icon mw-ui-icon-wikimedia-expand mw-ui-icon-small sidebar-toc-toggle">
					Toggle Tips and tricks subsection
				</button>
			
			<ul id="toc-Tips_and_tricks-sublist" class="sidebar-toc-list">
				<li id="toc-View_information_about_generated_image" class="sidebar-toc-list-item sidebar-toc-level-2">
			<a class="sidebar-toc-link" href="#View_information_about_generated_image">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">4.1</span>View information about generated image</div>
			</a>
			
			<ul id="toc-View_information_about_generated_image-sublist" class="sidebar-toc-list">
			</ul>
		</li>
		<li id="toc-Change_compression_program" class="sidebar-toc-list-item sidebar-toc-level-2">
			<a class="sidebar-toc-link" href="#Change_compression_program">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">4.2</span>Change compression program</div>
			</a>
			
			<ul id="toc-Change_compression_program-sublist" class="sidebar-toc-list">
			</ul>
		</li>
		<li id="toc-Generate_a_new_initramfs_on_kernel_upgrade" class="sidebar-toc-list-item sidebar-toc-level-2">
			<a class="sidebar-toc-link" href="#Generate_a_new_initramfs_on_kernel_upgrade">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">4.3</span>Generate a new initramfs on kernel upgrade</div>
			</a>
			
			<ul id="toc-Generate_a_new_initramfs_on_kernel_upgrade-sublist" class="sidebar-toc-list">
			</ul>
		</li>
		<li id="toc-Bluetooth_keyboard_support" class="sidebar-toc-list-item sidebar-toc-level-2">
			<a class="sidebar-toc-link" href="#Bluetooth_keyboard_support">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">4.4</span>Bluetooth keyboard support</div>
			</a>
			
			<ul id="toc-Bluetooth_keyboard_support-sublist" class="sidebar-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id="toc-Troubleshooting" class="sidebar-toc-list-item sidebar-toc-level-1">
			<a class="sidebar-toc-link" href="#Troubleshooting">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">5</span>Troubleshooting</div>
			</a>
			
				<button aria-controls="toc-Troubleshooting-sublist" class="mw-ui-icon mw-ui-icon-wikimedia-expand mw-ui-icon-small sidebar-toc-toggle">
					Toggle Troubleshooting subsection
				</button>
			
			<ul id="toc-Troubleshooting-sublist" class="sidebar-toc-list">
				<li id="toc-Hibernation" class="sidebar-toc-list-item sidebar-toc-level-2">
			<a class="sidebar-toc-link" href="#Hibernation">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">5.1</span>Hibernation</div>
			</a>
			
			<ul id="toc-Hibernation-sublist" class="sidebar-toc-list">
			</ul>
		</li>
		<li id="toc-LVM_/_software_RAID_/_LUKS" class="sidebar-toc-list-item sidebar-toc-level-2">
			<a class="sidebar-toc-link" href="#LVM_/_software_RAID_/_LUKS">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">5.2</span>LVM / software RAID / LUKS</div>
			</a>
			
			<ul id="toc-LVM_/_software_RAID_/_LUKS-sublist" class="sidebar-toc-list">
			</ul>
		</li>
		<li id='toc-A_stop_job_is_running_for_"brltty"' class="sidebar-toc-list-item sidebar-toc-level-2">
			<a class="sidebar-toc-link" href='#A_stop_job_is_running_for_"brltty"'>
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">5.3</span>A stop job is running for "brltty"</div>
			</a>
			
			<ul id='toc-A_stop_job_is_running_for_"brltty"-sublist' class="sidebar-toc-list">
			</ul>
		</li>
		<li id="toc-No_usable_keyslot_is_available" class="sidebar-toc-list-item sidebar-toc-level-2">
			<a class="sidebar-toc-link" href="#No_usable_keyslot_is_available">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">5.4</span>No usable keyslot is available</div>
			</a>
			
			<ul id="toc-No_usable_keyslot_is_available-sublist" class="sidebar-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id="toc-See_also" class="sidebar-toc-list-item sidebar-toc-level-1">
			<a class="sidebar-toc-link" href="#See_also">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">6</span>See also</div>
			</a>
			
			<ul id="toc-See_also-sublist" class="sidebar-toc-list">
			</ul>
		</li>
	</ul>
</nav>

			</div>
		</div>
		<div class="mw-content-container">
			<main id="content" class="mw-body" role="main" style="margin: 0">
				<a id="top"></a>
				<nav class="vector-article-toolbar" aria-label="Tools" role="navigation">
					<div class="mw-article-toolbar-container">
						<div id="left-navigation">
							

<div id="p-associated-pages" class="vector-menu mw-portlet mw-portlet-associated-pages vector-menu-tabs">
	<div class="vector-menu-content">
		
		<ul class="vector-menu-content-list">
<li id="ca-nstab-main" class="selected mw-list-item"><a href="../en/Dracut.html" title="View the content page [c]" accesskey="c"><span>Page</span></a></li>
<li id="ca-talk" class="mw-list-item"><a href="../en/Talk:Dracut.html" rel="discussion" title="Discussion about the content page [t]" accesskey="t"><span>Discussion</span></a></li>
</ul>
		
	</div>
</div>

							

<div id="p-variants" class="vector-menu mw-portlet mw-portlet-variants emptyPortlet vector-menu-dropdown">
	<input type="checkbox" id="p-variants-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-p-variants" class="vector-menu-checkbox" aria-label="Change language variant">
	<label id="p-variants-label" for="p-variants-checkbox" class="vector-menu-heading ">
		<span class="vector-menu-heading-label">English</span>
	</label>
	<div class="vector-menu-content">
		
		<ul class="vector-menu-content-list"></ul>
		
	</div>
</div>

						</div>
						<div id="right-navigation" class="vector-collapsible ">
							

<div id="p-views" class="vector-menu mw-portlet mw-portlet-views vector-menu-tabs">
	<div class="vector-menu-content">
		
		<ul class="vector-menu-content-list">
<li id="ca-view" class="selected mw-list-item"><a href="../en/Dracut.html"><span>Read</span></a></li>
<li id="ca-viewsource" class="mw-list-item"><a href="/index.php?title=Dracut&amp;action=edit" title="This page is protected.
You can view its source [e]" accesskey="e"><span>View source</span></a></li>
<li id="ca-history" class="mw-list-item"><a href="/index.php?title=Dracut&amp;action=history" title="Past revisions of this page [h]" accesskey="h"><span>View history</span></a></li>
</ul>
		
	</div>
</div>

							

<div id="p-cactions" class="vector-menu mw-portlet mw-portlet-cactions emptyPortlet vector-menu-dropdown vector-has-collapsible-items" title="More options">
	<input type="checkbox" id="p-cactions-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-p-cactions" class="vector-menu-checkbox">
	<label id="p-cactions-label" for="p-cactions-checkbox" class="vector-menu-heading ">
		<span class="vector-menu-heading-label">More</span>
	</label>
	<div class="vector-menu-content">
		
		<ul class="vector-menu-content-list">
<li id="ca-more-view" class="selected vector-more-collapsible-item mw-list-item"><a href="../en/Dracut.html"><span>Read</span></a></li>
<li id="ca-more-viewsource" class="vector-more-collapsible-item mw-list-item"><a href="/index.php?title=Dracut&amp;action=edit"><span>View source</span></a></li>
<li id="ca-more-history" class="vector-more-collapsible-item mw-list-item"><a href="/index.php?title=Dracut&amp;action=history"><span>View history</span></a></li>
</ul>
		
	</div>
</div>

						</div>
					</div>
				</nav>
				<div id="bodyContent" class="vector-body" data-mw-ve-target-container>
					<div class="mw-body-subheader">
					        <div class="mw-indicators">
        </div>

					    <div id="siteSub" class="noprint">From ArchWiki</div>
					</div>
					
					
					
					<div id="mw-content-text" class="mw-body-content mw-content-ltr" lang="en" dir="ltr">
<div class="mw-parser-output">
<p><span>
</span>
</p>
<div class="archwiki-template-meta-related-articles-start">
<p class="mw-no-invert">Related articles</p>
<ul>
<li><a href="../en/Booster.html" title="Booster">booster</a></li>
<li><a href="../en/Mkinitcpio.html" title="Mkinitcpio">mkinitcpio</a></li>
<li><a href="../en/Unified_kernel_image.html" title="Unified kernel image">Unified kernel image</a></li>
</ul>
</div>
<p><a rel="nofollow" class="external text" href="https://github.com/dracutdevs/dracut/wiki">dracut</a> creates an initial image used by the kernel for preloading the block device modules (such as IDE, SCSI or RAID) which are needed to access the root filesystem. Upon installing <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=linux">linux</a></span>, you can choose between <a href="../en/Mkinitcpio.html" title="Mkinitcpio">mkinitcpio</a> and <i>dracut</i>. <i>dracut</i> is used by Fedora, RHEL, Gentoo, and Debian, among others. Arch uses <a href="../en/Mkinitcpio.html" title="Mkinitcpio">mkinitcpio</a> by default.
</p>
<p>You can read the full project documentation for <i>dracut</i> <a rel="nofollow" class="external text" href="https://github.com/dracutdevs/dracut/wiki">in the documentation</a>.
</p>
<mw:tocplace></mw:tocplace>
<h2><span class="mw-headline" id="Installation">Installation</span></h2>
<p><a href="../en/Help:Reading.html#Installation_of_packages" class="mw-redirect" title="Install">Install</a> the <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=dracut">dracut</a></span> package, or <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/dracut-git/">dracut-git</a></span><sup><small>AUR</small></sup> for the latest development version.
</p>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip:</strong> If <i>dracut</i> works on your machine <b>after you test it</b>, you can <a href="../en/Pacman.html#Removing_packages" class="mw-redirect" title="Uninstall">uninstall</a> <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=mkinitcpio">mkinitcpio</a></span>.</div>
<h2><span class="mw-headline" id="Usage">Usage</span></h2>
<p><code>dracut</code> is easy to use and typically does not require user configuration, even when using non-standard setups, like <a href="../en/Dm-crypt/Encrypting_an_entire_system.html#LVM_on_LUKS" title="Dm-crypt/Encrypting an entire system">LVM on LUKS</a>.
</p>
<p>To generate an initramfs for the running kernel:
</p>
<pre># dracut --hostonly --no-hostonly-cmdline /boot/initramfs-linux.img
</pre>
<p>To generate a fallback initramfs run:
</p>
<pre># dracut /boot/initramfs-linux-fallback.img
</pre>
<p><code>/boot/initramfs-linux.img</code> refers to the output image file. If you are using the non-regular kernel, consider changing the file name. For example, for the <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=linux-lts">linux-lts</a></span> kernel, the output file should be named <code>/boot/initramfs-linux-lts.img</code>. However, you can name these files whatever you wish as long as your <a href="../en/Arch_boot_process.html#Boot_loader" class="mw-redirect" title="Boot loader">boot loader</a> configuration uses the same file names.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> 
<ul>
<li>The files created through these commands embed any installed <a href="../en/Microcode.html" title="Microcode">Microcode</a> images.</li>
<li>Due to <a rel="nofollow" class="external text" href="https://bugs.archlinux.org/task/59841">FS#59841</a>, the hostonly mode includes all Intel microcode in the initramfs, not just that which is needed by the system.<a rel="nofollow" class="external autonumber" href="https://github.com/dracutdevs/dracut/commit/d613d88dd272cde8b69445bd69d64f99aac5b94b">[1]</a>
</li>
</ul>
</div>
<h3><span class="mw-headline" id="Additional_options">Additional options</span></h3>
<p>The <code>--force</code> flag overwrites the image file if it is already present.
</p>
<p>The <code>--kver</code> option specifies which kernel to use. The argument to this option must match the name of a directory present in <code>/usr/lib/modules</code>.
</p>
<p>More flags can be found with <span class="plainlinks archwiki-template-man" title="$ man 8 dracut"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/dracut.8">dracut(8)</a></span>.
</p>
<h2><span class="mw-headline" id="Advanced_configuration">Advanced configuration</span></h2>
<p><code>dracut</code> can be configured by directly passing arguments on the command line (see <span class="plainlinks archwiki-template-man" title="$ man 8 dracut"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/dracut.8#OPTIONS">dracut(8) § OPTIONS</a></span>). If you wish to always execute <code>dracut</code> with a certain set of flags, you can save a specified configuration in a <code>.conf</code> file in <code>/etc/dracut.conf.d/</code>. For example:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/dracut.conf.d/myflags.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">hostonly="yes"
compress="lz4"
add_drivers+=" i915 "
omit_dracutmodules+=" network iscsi "</pre>
<p>You can see more configuration options with <span class="plainlinks archwiki-template-man" title="$ man 5 dracut.conf"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/dracut.conf.5">dracut.conf(5)</a></span>. Fuller descriptions of each option can be found with <span class="plainlinks archwiki-template-man" title="$ man 8 dracut"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/dracut.8">dracut(8)</a></span>. We will describe a few common options in what follows.
</p>
<h3><span class="mw-headline" id="Dracut_modules">Dracut modules</span></h3>
<p><i>dracut</i> uses a modular approach to build the initramfs (see <span class="plainlinks archwiki-template-man" title="$ man 7 dracut.modules"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/dracut.modules.7">dracut.modules(7)</a></span>). All of <i>dracut</i> 's builtin modules are located in <code>/lib/dracut/modules.d</code> and can be listed with <code>dracut --list-modules</code>. Extra modules can be provided by external packages e.g. <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/dracut-sshd-git/">dracut-sshd-git</a></span><sup><small>AUR</small></sup>. <i>dracut</i> 's built-in modules unfortunately lack documentation, although their names can be self-explanatory.
</p>
<p>Some of the modules are active/inactive by default, and can be activated/deactivated with <code>--add</code>/<code>--omit</code> command line argument or with the <code>add_dracutmodules+=""</code>/<code>omit_dracutmodules+=""</code> persistent config entry lines.
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/dracut.conf.d/myflags.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;"># ...
add_dracutmodules+=" &lt;dracut modules to activate&gt; "
omit_dracutmodules+=" &lt;dracut modules to deactivate&gt; "
# ...</pre>
<h4><span class="mw-headline" id="TPM2">TPM2</span></h4>
<p>To make use of <i>systemd</i> 's unlocking of <i>luks2</i> encrypted volumes using TPM2 through <a href="../en/Trusted_Platform_Module.html#systemd-cryptenroll" title="Trusted Platform Module">systemd-cryptenroll</a>, install <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=tpm2-tools">tpm2-tools</a></span> package and enable the <code>tpm2-tss</code> <i>dracut</i> module.
</p>
<h3><span class="mw-headline" id="Early_kernel_module_loading">Early kernel module loading</span></h3>
<p>Dracut enables early loading (at the initramfs stage, via <code>modprobe</code>) through it's <code>--force_drivers</code> command or <code>force_drivers+=""</code> config entry line. For example:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/dracut.conf.d/myflags.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;"># ...
force_drivers+=" nvidia nvidia_modeset nvidia_uvm nvidia_drm "
# ...</pre>
<h3><span class="mw-headline" id="Kernel_command_line_options">Kernel command line options</span></h3>
<p>Kernel command line options can be placed in a <i>.conf</i> file in <code>/etc/dracut.conf.d/</code>, and set via the <code>kernel_cmdline=</code> flag. Dracut will automatically source this file and create a <code>01-default.conf</code> file and place it inside the initramfs directory <code>/etc/cmdline.d/</code>. For example, your kernel command line options file could look like:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/dracut.conf.d/cmdline.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">kernel_cmdline="rd.luks.uuid=luks-f6c738f3-ee64-4633-b6b0-eceddb1bb010 rd.lvm.lv=arch/root  rd.lvm.lv=arch/swap  root=/dev/arch/root rootfstype=ext4 rootflags=rw,relatime"</pre>
<h4><span class="mw-headline" id="Miscellaneous_notes">Miscellaneous notes</span></h4>
<p>It is not necessary to specify the root block device for <code>dracut</code>. From <span class="plainlinks archwiki-template-man" title="$ man 7 dracut.cmdline"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/dracut.cmdline.7">dracut.cmdline(7)</a></span>:
</p>
<dl><dd>The root device used by the kernel is specified in the boot configuration file on the kernel command line, as always.</dd></dl>
<p>However, it may be useful to set some parameters early, and you can enable additional features like prompting for additional command line parameters. See <span class="plainlinks archwiki-template-man" title="$ man 7 dracut.cmdline"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/dracut.cmdline.7">dracut.cmdline(7)</a></span> for all options. Here are some example configuration options:
</p>
<ul>
<li>Resume from a swap partition: <code>resume=UUID=80895b78-7312-45bc-afe5-58eb4b579422</code>
</li>
<li>Prompt for additional kernel command line parameters: <code>rd.cmdline=ask</code> <div class="archwiki-template-box archwiki-template-box-warning">
<strong>Warning:</strong> <code>rd.cmdline=ask</code> may cause an issue where the keyboard is not yet initialized prior to its prompt forcing a hard reset. See <a rel="nofollow" class="external text" href="https://github.com/dracutdevs/dracut/issues/728">dracut issue 728</a>.</div>
</li>
<li>Print informational output even if <code>quiet</code> is set: <code>rd.info</code>
</li>
</ul>
<h3><span class="mw-headline" id="Unified_kernel_image">Unified kernel image</span></h3>
<p><i>dracut</i> can produce <a href="../en/Unified_kernel_image.html" title="Unified kernel image">unified kernel images</a> with the <code>--uefi</code> command line option or with the <code>uefi="yes"</code> configuration option.
</p>
<h2><span class="mw-headline" id="Tips_and_tricks">Tips and tricks</span></h2>
<h3><span class="mw-headline" id="View_information_about_generated_image">View information about generated image</span></h3>
<p>You can view information about a generated initramfs image, which you may wish to view in a pager: 
</p>
<pre># lsinitrd <i>/path/to/initramfs_or_uefi_image</i> | less
</pre>
<p>This command will list the arguments passed to <code>dracut</code> when the image was created, the list of included <code>dracut</code> modules, and the list of all included files.
</p>
<h3><span class="mw-headline" id="Change_compression_program">Change compression program</span></h3>
<p>To reduce the amount of time spent compressing the final image, you may change the compression program used.
</p>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Warning:</strong> 
<ul>
<li>Make sure your kernel has your chosen decompression support compiled in, otherwise you will not be able to boot. You must also have the chosen compression program package installed.</li>
<li>The upstream Linux kernel does not support zstd compressed initramfs before version 5.9. <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=linux-zen">linux-zen</a></span> supports it since version 5.8</li>
</ul>
</div>
<p>Simply add any one of the following lines (not multiple) <a href="#Advanced_configuration">to your dracut configuration</a>:
</p>
<pre>compress="cat"
compress="gzip"
compress="bzip2"
compress="lzma"
compress="xz"
compress="lzo"
compress="lz4"
compress="zstd"
</pre>
<p><span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=gzip">gzip</a></span> is the default compression program used. <code>compress="cat"</code> will make the initramfs with no compression.
</p>
<p>You can also use a non-officially-supported compression program:
</p>
<pre>compress="<i>program</i>"
</pre>
<h3><span class="mw-headline" id="Generate_a_new_initramfs_on_kernel_upgrade">Generate a new initramfs on kernel upgrade</span></h3>
<p>It is possible to automatically generate new initramfs images upon each kernel upgrade. The instructions here are for the default <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=linux">linux</a></span> kernel, but it should be easy to add extra hooks for other kernels.
</p>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip:</strong> The <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/dracut-hook/">dracut-hook</a></span><sup><small>AUR</small></sup> package includes hooks and scripts similar to the below. Alternatively, you may want <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/dracut-uefi-hook/">dracut-uefi-hook</a></span><sup><small>AUR</small></sup> or <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/dracut-hook-uefi/">dracut-hook-uefi</a></span><sup><small>AUR</small></sup> instead, if you want an initramfs image that is an EFI executable (i.e. <code><i>esp</i>/EFI/Linux/linux-<i>kernel</i>-<i>machine_id</i>-<i>build_id</i>.efi</code>). EFI binaries in this directory are automatically detected by <a href="../en/Systemd-boot.html" title="Systemd-boot">systemd-boot</a> and therefore do not need an entry in <code>/boot/loader/loader.conf</code>.</div>
<p>As the command to figure out the kernel version is somewhat complex, it will not work by itself in a <a href="../en/Pacman.html#Hooks" class="mw-redirect" title="Pacman hook">pacman hook</a>. So create a script anywhere on your system. For this example it will be created in <code>/usr/local/bin/</code>.
</p>
<p>The script will also copy the new <code>vmlinuz</code> kernel file to <code>/boot/</code>, since the kernel packages do not place files in <code>/boot/</code> anymore.<a rel="nofollow" class="external autonumber" href="https://lists.archlinux.org/archives/list/arch-general@lists.archlinux.org/message/ZSO3ZLU2ATKBRLZBPOE3EHR6GS63RO3P/">[2]</a>
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/usr/local/bin/dracut-install.sh</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">#!/usr/bin/env bash

args=('--force' '--no-hostonly-cmdline')

while read -r line; do
	if [[ "$line" == 'usr/lib/modules/'+([^/])'/pkgbase' ]]; then
		read -r pkgbase &lt; "/${line}"
		kver="${line#'usr/lib/modules/'}"
		kver="${kver%'/pkgbase'}"

		install -Dm0644 "/${line%'/pkgbase'}/vmlinuz" "/boot/vmlinuz-${pkgbase}"
		dracut "${args[@]}" --hostonly "/boot/initramfs-${pkgbase}.img" --kver "$kver"
		dracut "${args[@]}" --no-hostonly "/boot/initramfs-${pkgbase}-fallback.img" --kver "$kver"
	fi
done
</pre>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/usr/local/bin/dracut-remove.sh</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">#!/usr/bin/env bash

while read -r line; do
	if [[ "$line" == 'usr/lib/modules/'+([^/])'/pkgbase' ]]; then
		read -r pkgbase &lt; "/${line}"
		rm -f "/boot/vmlinuz-${pkgbase}" "/boot/initramfs-${pkgbase}.img" "/boot/initramfs-${pkgbase}-fallback.img"
	fi
done
</pre>
<p>You need to make the scripts <a href="../en/Help:Reading.html#Make_executable" class="mw-redirect" title="Executable">executable</a>. If you wish to add or remove flags, you should <a href="#Advanced_configuration">add them to your dracut configuration</a>.
</p>
<p>The next step is creating <a href="../en/Pacman.html#Hooks" class="mw-redirect" title="Pacman hook">pacman hooks</a>:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/pacman.d/hooks/90-dracut-install.hook</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[Trigger]
Type = Path
Operation = Install
Operation = Upgrade
Target = usr/lib/modules/*/pkgbase

[Action]
Description = Updating linux initcpios (with dracut!)...
When = PostTransaction
Exec = /usr/local/bin/dracut-install.sh
Depends = dracut
NeedsTargets
</pre>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/pacman.d/hooks/60-dracut-remove.hook</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[Trigger]
Type = Path
Operation = Remove
Target = usr/lib/modules/*/pkgbase

[Action]
Description = Removing linux initcpios...
When = PreTransaction
Exec = /usr/local/bin/dracut-remove.sh
NeedsTargets
</pre>
<p>You should stop <a href="../en/Mkinitcpio.html" title="Mkinitcpio">mkinitcpio</a> from creating and removing initramfs images as well, either by removing <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=mkinitcpio">mkinitcpio</a></span> or with the following commands:
</p>
<pre># ln -sf /dev/null /etc/pacman.d/hooks/90-mkinitcpio-install.hook
# ln -sf /dev/null /etc/pacman.d/hooks/60-mkinitcpio-remove.hook
</pre>
<h3><span class="mw-headline" id="Bluetooth_keyboard_support">Bluetooth keyboard support</span></h3>
<p>Dracut will enable the bluetooth module automatically when a bluetooth keyboard is detected. However it is required that dracut is in hostonly mode for this. This seems to not be the default. To enable hostonly mode you can add the following to your dracut configuration:
</p>
<pre>hostonly=yes
</pre>
<h2><span class="mw-headline" id="Troubleshooting">Troubleshooting</span></h2>
<h3><span class="mw-headline" id="Hibernation">Hibernation</span></h3>
<p>If resuming from hibernation does not work, you may need to configure <code>dracut</code> to include the <code>resume</code> module. You will need to <a href="#Dracut_modules">add a configuration file</a>:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/dracut.conf.d/resume-from-hibernate.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">add_dracutmodules+=" resume "</pre>
<h3>
<span id="LVM_.2F_software_RAID_.2F_LUKS"></span><span class="mw-headline" id="LVM_/_software_RAID_/_LUKS">LVM / software RAID / LUKS</span>
</h3>
<p>If the kernel has issues auto discovering and mounting LVM / software RAID / LUKS blocks. You can retry generating an initramfs with the following kernel command line options:
</p>
<pre>rd.auto rd.lvm=1 rd.dm=1 rd.md=1 rd.luks=1
</pre>
<h3>
<span id="A_stop_job_is_running_for_.22brltty.22"></span><span class="mw-headline" id='A_stop_job_is_running_for_"brltty"'>A stop job is running for "brltty"</span>
</h3>
<p>If you have issues booting or very long shutdown processes while the system waits for <code>brllty</code>, add the following to the dracut configuration line:
</p>
<pre>omit_dracutmodules+=" brltty "
</pre>
<p>Alternatively, uninstall <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=brltty">brltty</a></span> if it is not needed.
</p>
<h3><span class="mw-headline" id="No_usable_keyslot_is_available">No usable keyslot is available</span></h3>
<pre>Cannot use whirlpool hash for keyslot encryption. 
Keyslot open failed. 
No usable keyslot is available.
</pre>
<p>A failure to boot with a message similar to the above typically will only require the user to include the <code>crypt</code> module via <code>add_dracutmodules</code>. However, if you continue to get the message after adding it, you may need to adjust your configuration with the following.
</p>
<pre>install_items+=" /usr/lib/ossl-modules/legacy.so "
</pre>
<p>This is because <a href="../en/OpenSSL.html" title="OpenSSL">OpenSSL</a> deprecated the whirlpool hash and moved it to that library. Dracut does not automatically gather it when using Arch.
</p>
<h2><span class="mw-headline" id="See_also">See also</span></h2>
<ul>
<li><a href="https://en.wikipedia.org/wiki/dracut_(software)" class="extiw" title="wikipedia:dracut (software)">Wikipedia:dracut (software)</a></li>
<li><a href="https://wiki.gentoo.org/wiki/Dracut" class="extiw" title="gentoo:Dracut">Gentoo:Dracut</a></li>
</ul>
</div>
</div>
					<div id="catlinks" class="catlinks" data-mw="interface"><div id="mw-normal-catlinks" class="mw-normal-catlinks">
<a href="../Special:Categories.html" title="Special:Categories">Category</a>: <ul><li><a href="../en/Category:Initramfs.html" title="Category:Initramfs">Initramfs</a></li></ul>
</div></div>
				</div>
			</main>
			
		</div>
		<div class="mw-footer-container">
			
<footer id="footer" class="mw-footer" role="contentinfo" style="margin: 0">
	<ul id="footer-info">
	<li data-nosnippet="">Retrieved from "<a dir="ltr" href="https://wiki.archlinux.org/index.php?title=Dracut&amp;oldid=783287">https://wiki.archlinux.org/index.php?title=Dracut&amp;oldid=783287</a>"</li>
<li id="footer-info-lastmod"> This page was last edited on 16 July 2023, at 18:05.</li>
	<li id="footer-info-copyright">Content is available under <a class="external" rel="nofollow" href="https://www.gnu.org/copyleft/fdl.html">GNU Free Documentation License 1.3 or later</a> unless otherwise noted.</li>
<br>
</ul>

	<ul id="footer-places">
	<li id="footer-places-privacy"><a href="https://terms.archlinux.org/docs/privacy-policy/">Privacy policy</a></li>
	<li id="footer-places-about"><a href="../en/ArchWiki:About.html">About ArchWiki</a></li>
	<li id="footer-places-disclaimer"><a href="../en/ArchWiki:General_disclaimer.html">Disclaimers</a></li>
</ul>

	
</footer>

		</div>
	</div> 
</div> 

</body>
</html>
