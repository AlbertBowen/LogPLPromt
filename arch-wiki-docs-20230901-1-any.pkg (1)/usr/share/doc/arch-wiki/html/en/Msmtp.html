<!DOCTYPE html>
<html class="client-nojs" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<title>msmtp - ArchWiki</title>
<link rel="stylesheet" href="../ArchWikiOffline.css">
<meta name="ResourceLoaderDynamicStyles" content="">
<meta name="generator" content="MediaWiki 1.39.4">
<meta name="referrer" content="no-referrer-when-downgrade">
<meta name="format-detection" content="telephone=no">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes, minimum-scale=0.25, maximum-scale=5.0">
<link rel="icon" href="/favicon.ico">
<link rel="search" type="application/opensearchdescription+xml" href="/opensearch_desc.php" title="ArchWiki (en)">
<link rel="EditURI" type="application/rsd+xml" href="https://wiki.archlinux.org/api.php?action=rsd">
<link rel="license" href="https://www.gnu.org/copyleft/fdl.html">
<link rel="alternate" type="application/atom+xml" title="ArchWiki Atom feed" href="/index.php?title=Special:RecentChanges&amp;feed=atom">
</head>
<body class="skin-vector skin-vector-search-vue mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-Msmtp rootpage-Msmtp skin-vector-2022 action-view skin--responsive vector-feature-language-in-header-enabled vector-feature-language-in-main-page-header-disabled vector-feature-language-alert-in-sidebar-disabled vector-feature-sticky-header-disabled vector-feature-sticky-header-edit-disabled vector-feature-table-of-contents-disabled vector-feature-visual-enhancement-next-disabled">
<div class="mw-page-container">
	<span id="top-page"></span>
	<a class="mw-jump-link" href="#content">Jump to content</a>
	<div class="mw-page-container-inner">
		<input type="checkbox" id="mw-sidebar-checkbox" class="mw-checkbox-hack-checkbox">
		<div class="vector-sidebar-container ">
			</div>
		<div class="vector-sitenotice-container">
			<div id="siteNotice"></div>
		</div>
		<input type="checkbox" id="vector-toc-collapsed-checkbox" class="mw-checkbox-hack-checkbox">
		<div class="mw-table-of-contents-container">
			<div class="vector-sticky-toc-container mw-sticky-header-element">
				<nav id="mw-panel-toc" class="sidebar-toc" role="navigation" aria-labelledby="sidebar-toc-label" data-event-name="ui.sidebar-toc">
	<div id="sidebar-toc-label" class="sidebar-toc-header">
		<p class="sidebar-toc-title">
		Contents
		<button class="vector-toc-uncollapse-button">move to sidebar</button>
		<button class="vector-toc-collapse-button">hide</button>
		</p>
	</div>
	<ul class="sidebar-toc-contents" id="mw-panel-toc-list">
		<li id="toc-mw-content-text" class="sidebar-toc-list-item sidebar-toc-level-1">
			<a href="#top-page" class="sidebar-toc-link">
				<div class="sidebar-toc-text">Beginning</div>
			</a>
		</li>
		<li id="toc-Installation" class="sidebar-toc-list-item sidebar-toc-level-1">
			<a class="sidebar-toc-link" href="#Installation">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">1</span>Installation</div>
			</a>
			
			<ul id="toc-Installation-sublist" class="sidebar-toc-list">
			</ul>
		</li>
		<li id="toc-Basic_setup" class="sidebar-toc-list-item sidebar-toc-level-1">
			<a class="sidebar-toc-link" href="#Basic_setup">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">2</span>Basic setup</div>
			</a>
			
				<button aria-controls="toc-Basic_setup-sublist" class="mw-ui-icon mw-ui-icon-wikimedia-expand mw-ui-icon-small sidebar-toc-toggle">
					Toggle Basic setup subsection
				</button>
			
			<ul id="toc-Basic_setup-sublist" class="sidebar-toc-list">
				<li id="toc-OAuth2_Setup" class="sidebar-toc-list-item sidebar-toc-level-2">
			<a class="sidebar-toc-link" href="#OAuth2_Setup">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">2.1</span>OAuth2 Setup</div>
			</a>
			
			<ul id="toc-OAuth2_Setup-sublist" class="sidebar-toc-list">
				<li id="toc-mailctl" class="sidebar-toc-list-item sidebar-toc-level-3">
			<a class="sidebar-toc-link" href="#mailctl">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">2.1.1</span>mailctl</div>
			</a>
			
			<ul id="toc-mailctl-sublist" class="sidebar-toc-list">
			</ul>
		</li>
		<li id="toc-oauth2token" class="sidebar-toc-list-item sidebar-toc-level-3">
			<a class="sidebar-toc-link" href="#oauth2token">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">2.1.2</span>oauth2token</div>
			</a>
			
			<ul id="toc-oauth2token-sublist" class="sidebar-toc-list">
			</ul>
		</li>
		<li id="toc-Wrapper_on_oauth2.py" class="sidebar-toc-list-item sidebar-toc-level-3">
			<a class="sidebar-toc-link" href="#Wrapper_on_oauth2.py">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">2.1.3</span>Wrapper on oauth2.py</div>
			</a>
			
			<ul id="toc-Wrapper_on_oauth2.py-sublist" class="sidebar-toc-list">
			</ul>
		</li>
		<li id="toc-OAuth2_hack" class="sidebar-toc-list-item sidebar-toc-level-3">
			<a class="sidebar-toc-link" href="#OAuth2_hack">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">2.1.4</span>OAuth2 hack</div>
			</a>
			
			<ul id="toc-OAuth2_hack-sublist" class="sidebar-toc-list">
			</ul>
		</li>
	</ul>
		</li>
	</ul>
		</li>
		<li id="toc-Using_the_mail_command" class="sidebar-toc-list-item sidebar-toc-level-1">
			<a class="sidebar-toc-link" href="#Using_the_mail_command">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">3</span>Using the mail command</div>
			</a>
			
			<ul id="toc-Using_the_mail_command-sublist" class="sidebar-toc-list">
			</ul>
		</li>
		<li id="toc-Test_functionality" class="sidebar-toc-list-item sidebar-toc-level-1">
			<a class="sidebar-toc-link" href="#Test_functionality">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">4</span>Test functionality</div>
			</a>
			
			<ul id="toc-Test_functionality-sublist" class="sidebar-toc-list">
			</ul>
		</li>
		<li id="toc-Cronie_default_email_client" class="sidebar-toc-list-item sidebar-toc-level-1">
			<a class="sidebar-toc-link" href="#Cronie_default_email_client">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">5</span>Cronie default email client</div>
			</a>
			
			<ul id="toc-Cronie_default_email_client-sublist" class="sidebar-toc-list">
			</ul>
		</li>
		<li id="toc-Password_management" class="sidebar-toc-list-item sidebar-toc-level-1">
			<a class="sidebar-toc-link" href="#Password_management">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">6</span>Password management</div>
			</a>
			
				<button aria-controls="toc-Password_management-sublist" class="mw-ui-icon mw-ui-icon-wikimedia-expand mw-ui-icon-small sidebar-toc-toggle">
					Toggle Password management subsection
				</button>
			
			<ul id="toc-Password_management-sublist" class="sidebar-toc-list">
				<li id="toc-GNOME_Keyring" class="sidebar-toc-list-item sidebar-toc-level-2">
			<a class="sidebar-toc-link" href="#GNOME_Keyring">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">6.1</span>GNOME Keyring</div>
			</a>
			
			<ul id="toc-GNOME_Keyring-sublist" class="sidebar-toc-list">
			</ul>
		</li>
		<li id="toc-GnuPG" class="sidebar-toc-list-item sidebar-toc-level-2">
			<a class="sidebar-toc-link" href="#GnuPG">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">6.2</span>GnuPG</div>
			</a>
			
			<ul id="toc-GnuPG-sublist" class="sidebar-toc-list">
			</ul>
		</li>
		<li id="toc-pass" class="sidebar-toc-list-item sidebar-toc-level-2">
			<a class="sidebar-toc-link" href="#pass">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">6.3</span>pass</div>
			</a>
			
			<ul id="toc-pass-sublist" class="sidebar-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id="toc-Miscellaneous" class="sidebar-toc-list-item sidebar-toc-level-1">
			<a class="sidebar-toc-link" href="#Miscellaneous">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">7</span>Miscellaneous</div>
			</a>
			
				<button aria-controls="toc-Miscellaneous-sublist" class="mw-ui-icon mw-ui-icon-wikimedia-expand mw-ui-icon-small sidebar-toc-toggle">
					Toggle Miscellaneous subsection
				</button>
			
			<ul id="toc-Miscellaneous-sublist" class="sidebar-toc-list">
				<li id="toc-Using_msmtp_offline" class="sidebar-toc-list-item sidebar-toc-level-2">
			<a class="sidebar-toc-link" href="#Using_msmtp_offline">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">7.1</span>Using msmtp offline</div>
			</a>
			
			<ul id="toc-Using_msmtp_offline-sublist" class="sidebar-toc-list">
			</ul>
		</li>
		<li id="toc-Vim_syntax_highlighting" class="sidebar-toc-list-item sidebar-toc-level-2">
			<a class="sidebar-toc-link" href="#Vim_syntax_highlighting">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">7.2</span>Vim syntax highlighting</div>
			</a>
			
			<ul id="toc-Vim_syntax_highlighting-sublist" class="sidebar-toc-list">
			</ul>
		</li>
		<li id="toc-Send_mail_with_PHP_using_msmtp" class="sidebar-toc-list-item sidebar-toc-level-2">
			<a class="sidebar-toc-link" href="#Send_mail_with_PHP_using_msmtp">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">7.3</span>Send mail with PHP using msmtp</div>
			</a>
			
			<ul id="toc-Send_mail_with_PHP_using_msmtp-sublist" class="sidebar-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id="toc-Troubleshooting" class="sidebar-toc-list-item sidebar-toc-level-1">
			<a class="sidebar-toc-link" href="#Troubleshooting">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">8</span>Troubleshooting</div>
			</a>
			
				<button aria-controls="toc-Troubleshooting-sublist" class="mw-ui-icon mw-ui-icon-wikimedia-expand mw-ui-icon-small sidebar-toc-toggle">
					Toggle Troubleshooting subsection
				</button>
			
			<ul id="toc-Troubleshooting-sublist" class="sidebar-toc-list">
				<li id="toc-Issues_with_TLS" class="sidebar-toc-list-item sidebar-toc-level-2">
			<a class="sidebar-toc-link" href="#Issues_with_TLS">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">8.1</span>Issues with TLS</div>
			</a>
			
			<ul id="toc-Issues_with_TLS-sublist" class="sidebar-toc-list">
			</ul>
		</li>
		<li id="toc-Server_sent_empty_reply" class="sidebar-toc-list-item sidebar-toc-level-2">
			<a class="sidebar-toc-link" href="#Server_sent_empty_reply">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">8.2</span>Server sent empty reply</div>
			</a>
			
			<ul id="toc-Server_sent_empty_reply-sublist" class="sidebar-toc-list">
				<li id="toc-Zoho_SMTP_server" class="sidebar-toc-list-item sidebar-toc-level-3">
			<a class="sidebar-toc-link" href="#Zoho_SMTP_server">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">8.2.1</span>Zoho SMTP server</div>
			</a>
			
			<ul id="toc-Zoho_SMTP_server-sublist" class="sidebar-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id="toc-Issues_with_GSSAPI" class="sidebar-toc-list-item sidebar-toc-level-2">
			<a class="sidebar-toc-link" href="#Issues_with_GSSAPI">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">8.3</span>Issues with GSSAPI</div>
			</a>
			
			<ul id="toc-Issues_with_GSSAPI-sublist" class="sidebar-toc-list">
			</ul>
		</li>
		<li id="toc-Envelope_not_accepted" class="sidebar-toc-list-item sidebar-toc-level-2">
			<a class="sidebar-toc-link" href="#Envelope_not_accepted">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">8.4</span>Envelope not accepted</div>
			</a>
			
			<ul id="toc-Envelope_not_accepted-sublist" class="sidebar-toc-list">
			</ul>
		</li>
	</ul>
		</li>
	</ul>
</nav>

			</div>
		</div>
		<div class="mw-content-container">
			<main id="content" class="mw-body" role="main" style="margin: 0">
				<a id="top"></a>
				<nav class="vector-article-toolbar" aria-label="Tools" role="navigation">
					<div class="mw-article-toolbar-container">
						<div id="left-navigation">
							

<div id="p-associated-pages" class="vector-menu mw-portlet mw-portlet-associated-pages vector-menu-tabs">
	<div class="vector-menu-content">
		
		<ul class="vector-menu-content-list">
<li id="ca-nstab-main" class="selected mw-list-item"><a href="../en/Msmtp.html" title="View the content page [c]" accesskey="c"><span>Page</span></a></li>
<li id="ca-talk" class="mw-list-item"><a href="../en/Talk:Msmtp.html" rel="discussion" title="Discussion about the content page [t]" accesskey="t"><span>Discussion</span></a></li>
</ul>
		
	</div>
</div>

							

<div id="p-variants" class="vector-menu mw-portlet mw-portlet-variants emptyPortlet vector-menu-dropdown">
	<input type="checkbox" id="p-variants-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-p-variants" class="vector-menu-checkbox" aria-label="Change language variant">
	<label id="p-variants-label" for="p-variants-checkbox" class="vector-menu-heading ">
		<span class="vector-menu-heading-label">English</span>
	</label>
	<div class="vector-menu-content">
		
		<ul class="vector-menu-content-list"></ul>
		
	</div>
</div>

						</div>
						<div id="right-navigation" class="vector-collapsible ">
							

<div id="p-views" class="vector-menu mw-portlet mw-portlet-views vector-menu-tabs">
	<div class="vector-menu-content">
		
		<ul class="vector-menu-content-list">
<li id="ca-view" class="selected mw-list-item"><a href="../en/Msmtp.html"><span>Read</span></a></li>
<li id="ca-viewsource" class="mw-list-item"><a href="/index.php?title=Msmtp&amp;action=edit" title="This page is protected.
You can view its source [e]" accesskey="e"><span>View source</span></a></li>
<li id="ca-history" class="mw-list-item"><a href="/index.php?title=Msmtp&amp;action=history" title="Past revisions of this page [h]" accesskey="h"><span>View history</span></a></li>
</ul>
		
	</div>
</div>

							

<div id="p-cactions" class="vector-menu mw-portlet mw-portlet-cactions emptyPortlet vector-menu-dropdown vector-has-collapsible-items" title="More options">
	<input type="checkbox" id="p-cactions-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-p-cactions" class="vector-menu-checkbox">
	<label id="p-cactions-label" for="p-cactions-checkbox" class="vector-menu-heading ">
		<span class="vector-menu-heading-label">More</span>
	</label>
	<div class="vector-menu-content">
		
		<ul class="vector-menu-content-list">
<li id="ca-more-view" class="selected vector-more-collapsible-item mw-list-item"><a href="../en/Msmtp.html"><span>Read</span></a></li>
<li id="ca-more-viewsource" class="vector-more-collapsible-item mw-list-item"><a href="/index.php?title=Msmtp&amp;action=edit"><span>View source</span></a></li>
<li id="ca-more-history" class="vector-more-collapsible-item mw-list-item"><a href="/index.php?title=Msmtp&amp;action=history"><span>View history</span></a></li>
</ul>
		
	</div>
</div>

						</div>
					</div>
				</nav>
				<div id="bodyContent" class="vector-body" data-mw-ve-target-container>
					<div class="mw-body-subheader">
					        <div class="mw-indicators">
        </div>

					    <div id="siteSub" class="noprint">From ArchWiki</div>
					</div>
					
					
					
					<div id="mw-content-text" class="mw-body-content mw-content-ltr" lang="en" dir="ltr">
<div class="mw-parser-output">
<p><span>
</span>
</p>
<div class="archwiki-template-meta-related-articles-start">
<p class="mw-no-invert">Related articles</p>
<ul>
<li><a href="../en/Mail_server.html" title="Mail server">Mail server</a></li>
</ul>
</div>
<p><a rel="nofollow" class="external text" href="https://marlam.de/msmtp/">msmtp</a> is a very simple and easy to use SMTP client with fairly complete <a href="../en/Sendmail.html" title="Sendmail">sendmail</a> compatibility.
</p>
<mw:tocplace></mw:tocplace>
<h2><span class="mw-headline" id="Installation">Installation</span></h2>
<p><a href="../en/Help:Reading.html#Installation_of_packages" class="mw-redirect" title="Install">Install</a> the <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=msmtp">msmtp</a></span> package. Additionally, <a href="../en/Help:Reading.html#Installation_of_packages" class="mw-redirect" title="Install">install</a> <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=msmtp-mta">msmtp-mta</a></span>, which creates a sendmail alias to msmtp.
</p>
<h2><span class="mw-headline" id="Basic_setup">Basic setup</span></h2>
<p>Since msmtp version 1.8.6 you can place your user configuration either at <code>~/.msmtprc</code> or <code>$XDG_CONFIG_HOME/msmtp/config</code>. The following is an example of a msmtp configuration (the file is based on the per-user example file located at <code>/usr/share/doc/msmtp/msmtprc-user.example</code>; the system configuration file belongs at <code>/etc/msmtprc</code> and its corresponding example file is located at <code>/usr/share/doc/msmtp/msmtprc-system.example</code>).
</p>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip:</strong> If using Gmail you will need to either:
<ul>
<li>Use OAuth, via <a href="#OAuth2_Setup">#OAuth2 Setup</a>.</li>
<li>If you use two factor authentication: <a rel="nofollow" class="external text" href="https://myaccount.google.com/apppasswords">create an app password</a>.</li>
</ul>
</div>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">~/.msmtprc</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;"># Set default values for all following accounts.
defaults
auth           on
tls            on
tls_trust_file /etc/ssl/certs/ca-certificates.crt
logfile        ~/.msmtp.log

# Gmail
account        gmail
host           smtp.gmail.com
port           465
tls_starttls   off
from           <i>username</i>@gmail.com
user           <i>username</i>
password       <i>plain-text-password</i>

# A freemail service
account        freemail
host           smtp.freemail.example
from           joe_smith@freemail.example
...

# Set a default account
account default: gmail
</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> If you are using SSL/TLS and receive a "Server sent empty reply" error message, see <a href="#Server_sent_empty_reply">#Server sent empty reply</a>.</div>
<p>The <i>user</i> configuration file must be explicitly readable/writeable by its owner or msmtp will fail:
</p>
<pre>$ chmod 600 ~/.msmtprc
</pre>
<p>To avoid saving the password in plain text in the configuration file, use <i>passwordeval</i> to launch an external program, or see the <a href="#Password_management">#Password management</a> section below.  This example using Gnu PG is commonly used to perform decryption of a password:
</p>
<pre>echo -e "password\n" | gpg --encrypt -o .msmtp-gmail.gpg # enter id (email...)
</pre>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Warning:</strong> Most shells save command history(e.g. .bash_history .zhistory). To avoid this, use gpg with shell stdin: <code>gpg --encrypt -o .msmtp-gmail.gpg -r &lt;email&gt; -</code>. The ending dash is not a typo, rather it causes gpg to use stdin. After running that snippet of code, type in your password, press enter, and press Control-d so gpg can encrypt your password.</div>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">~/.msmtprc</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">passwordeval    "gpg --quiet --for-your-eyes-only --no-tty --decrypt ~/.msmtp-gmail.gpg"
</pre>
<h3><span class="mw-headline" id="OAuth2_Setup">OAuth2 Setup</span></h3>
<p><a href="https://en.wikipedia.org/wiki/OAuth2" class="extiw" title="wikipedia:OAuth2">OAuth2</a> can be used to securely authenticate msmtp when basic username/password authentication is unsupported by the site configuration or otherwise undesirable.
</p>
<h4><span class="mw-headline" id="mailctl">mailctl</span></h4>
<p>msmtp alone lacks the ability to renew or authorize OAuth2 credentials. A comprehensive solution is using the <a rel="nofollow" class="external text" href="https://github.com/pdobsan/mailctl">mailctl</a> utility which provides IMAP/SMTP clients with renewal capabilities and authorization of OAuth2 credentials.
</p>
<p>To use mailctl, <a href="../en/Help:Reading.html#Installation_of_packages" class="mw-redirect" title="Install">install</a> <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/mailctl-bin/">mailctl-bin</a></span><sup><small>AUR</small></sup> and configure msmtp to use it:
</p>
<pre>   # account at Google with oauth2 access                                    
   account YOUR_EMAIL_NAME@gmail.com
   from YOUR_EMAIL_NAME@gmail.com
   user YOUR_EMAIL_NAME@gmail.com
   auth oauthbearer
   passwordeval mailctl access YOUR_EMAIL_NAME@gmail.com
   host smtp.gmail.com
   port 587
   tls on
   tls_trust_file /etc/ssl/certs/ca-certificates.crt
</pre>
<p>Access token renewal happens automatically in the background transparent to the user.
</p>
<h4><span class="mw-headline" id="oauth2token">oauth2token</span></h4>
<p>Install <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/oauth2token/">oauth2token</a></span><sup><small>AUR</small></sup> and follow its <a rel="nofollow" class="external text" href="https://pypi.org/project/oauth2token/">README</a> to configure the account. Run the <code>oauth2create</code> script to obtain and store credentials for each account. 
</p>
<p>Add <code>auth oauthbearer</code> and <code>passwordeval oauth2get <i>provider</i> <i>account</i></code>, substituting <code><i>provider</i></code> and <code><i>account</i></code> with the values you used for <code>oauth2create</code> in your config.  
</p>
<h4><span class="mw-headline" id="Wrapper_on_oauth2.py">Wrapper on oauth2.py</span></h4>
<p>This is a scripted method, using the <a rel="nofollow" class="external text" href="https://marlam.de/msmtp/msmtp.html#Authentication">msmtp setting oauthbearer</a> for authentication.
</p>
<p>Once you have your <a rel="nofollow" class="external text" href="https://developers.google.com/gmail/api">Gmail API</a> setup, you can implement the wrapper script <a rel="nofollow" class="external text" href="https://github.com/tenllado/dotfiles/tree/master/config/msmtp">oauth2token</a><sup title="Last check status: 404">[<a href="https://en.wikipedia.org/wiki/Wikipedia:Link_rot" class="extiw" title="wikipedia:Wikipedia:Link rot">dead link</a> 2023-05-06 ⓘ]</sup> (that employs <span class="plainlinks archwiki-template-man" title="$ man 1 secret-tool"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/secret-tool.1">secret-tool(1)</a></span>) or an <a rel="nofollow" class="external text" href="https://github.com/harriott/ArchBuilds/blob/master/jo/clm/msmtprc/oauth2tool.sh">adaptation of oauth2token</a> (that employs <a rel="nofollow" class="external text" href="https://www.passwordstore.org/">pass</a>).
</p>
<p>An <code>msmtp</code> configuration would be adapted thus:
</p>
<pre>auth oauthbearer
...
passwordeval &lt;call_to_wrapper_script&gt;
</pre>
<p>If you comment out the last line, <code>msmtp</code> will request you for the token that <code>oauth2.py</code> provides you, which is normally valid for one hour.
</p>
<h4><span class="mw-headline" id="OAuth2_hack">OAuth2 hack</span></h4>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> This method may work, but uses outdated tools.</div>
<p>To use XOAUTH2 authentication with Gmail (see <a rel="nofollow" class="external text" href="https://developers.google.com/gmail/imap/xoauth2-protocol">official information</a>), you can install the <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/msmtp-oauth2/">msmtp-oauth2</a></span><sup><small>AUR</small></sup> package. The package does a small hack so that the plain authentication method will send the <code>AUTH XOAUTH2 password</code> instead of the <code>AUTH PLAIN ...</code>, effectively disabling plain authentication and enabling XOAUTH2. Your <code>msmtp</code> would be adapted as follows:
</p>
<pre>from your@gmail_login_email
tls on
tls_starttls on
tls_certcheck off
auth plain
user any_thing_here
passwordeval "get-gmail-token"
</pre>
<p>The <code>get-gmail-token</code> script can be found from the source files of the <i>msmtp-oauth2</i> package. See more information on <a rel="nofollow" class="external text" href="https://www.bytereef.org/howto/oauth2/getmail.html">getmail link</a> about how this works. And see <a rel="nofollow" class="external text" href="https://developers.google.com/gmail/api/quickstart/python">Gmail API quickstart</a> for instruction on registering a Gmail APP and authorizing it to access emails.
</p>
<h2><span class="mw-headline" id="Using_the_mail_command">Using the mail command</span></h2>
<p>To send mails using the <code>mail</code> command you must install the package <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=s-nail">s-nail</a></span>, which also provides the <code>mailx</code> command. You will also need to provide a <code>sendmail</code>-compatible MTA, either by installing <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=msmtp-mta">msmtp-mta</a></span> (which symlinks <code>sendmail</code> to <code>msmtp</code>) or by editing <code>/etc/mail.rc</code> to set the sendmail path:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/mail.rc</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">set mta=/usr/bin/msmtp</pre>
<p>A <code>.msmtprc</code> file will need to be in the home of every user who wants to send mail or alternatively the system wide <code>/etc/msmtprc</code> can be used.
</p>
<p>msmtp also understands aliases. Add the following line to the defaults section of msmtprc or your local configuration file:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/msmtprc</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">aliases               /etc/aliases</pre>
<p>and create an aliases file in <code>/etc</code>
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/aliases</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;"># Example aliases file
     
# Send root to Joe and Jane
root: joe_smith@example.com, jane_chang@example.com
   
# Send everything else to admin
default: admin@domain.example</pre>
<h2><span class="mw-headline" id="Test_functionality">Test functionality</span></h2>
<p>The account option (<code>--account=,-a</code>) tells which account to use as sender:
</p>
<pre>$ echo "hello there username." | msmtp -a default <i>username</i>@domain.com
</pre>
<p>Or, send both a subject and a body:
</p>
<pre>$ printf "Subject: Test\n\nhello there username." | msmtp -a default <i>username</i>@domain.com
</pre>
<p>Or, with the addresses in a file:
</p>
<pre>To: <i>username</i>@domain.com
From: <i>username</i>@gmail.com
Subject: A test

Hello there.
</pre>
<pre>$ cat test.mail | msmtp -a default &lt;username&gt;@domain.com
</pre>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip:</strong> You can use <code>--read-envelope-from</code> instead of <code>-a default</code> to automatically choose account by the <i>From:</i> field in a message you are going to send. You can also use <code>--read-recipients,-t</code> to read recipient addresses from the To, Cc, and Bcc headers of the mail in addition to the recipients given on the command line.</div>
<h2><span class="mw-headline" id="Cronie_default_email_client">Cronie default email client</span></h2>
<div class="noprint archwiki-template-message">
<p><a href="../File:Tango-view-refresh-red.png" class="image"><img alt="Tango-view-refresh-red.png" src="../File:Tango-view-refresh-red.png" decoding="async" width="48" height="48"></a><b>This article or section is out of date.</b><a href="../File:Tango-view-refresh-red.png" class="image"><img alt="Tango-view-refresh-red.png" src="../File:Tango-view-refresh-red.png" decoding="async" width="48" height="48"></a></p>
<div>
<b>Reason:</b> Arch uses <a href="../en/Systemd/Timers.html" title="Systemd/Timers">systemd/Timers</a> instead of cronie (Discuss in <a rel="nofollow" class="external text" href="https://wiki.archlinux.org/title/Talk:Msmtp">Talk:Msmtp</a>)</div>
</div>
<p>To make <a href="../en/Cron.html#Cronie" title="Cron">Cronie</a> use msmtp rather than sendmail, make sure <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=msmtp-mta">msmtp-mta</a></span> is installed, or edit the <code>cronie.service</code> systemd unit:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/systemd/system/cronie.service.d/msmtp.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[Service]
ExecStart=
ExecStart=/usr/bin/crond -n -m '/usr/bin/msmtp -t'</pre>
<p>Then you must tell cronie or msmtp what your email address is. One way to accomplish this is by adding it to the msmtp configuration:
</p>
<ol>
<li>Add to <code>/etc/msmtprc</code>:<pre>aliases /etc/aliases</pre>
</li>
<li>Create <code>/etc/aliases</code>:<pre>your_username: email@address.com</pre>
</li>
</ol>
<p>Alternatively, you can add it directly to the crontab:
</p>
<ul>
<li>Add a <code>MAILTO</code> line to the crontab:<pre>MAILTO=email@address.com</pre>
</li>
<li>Add a <code>MAILFROM</code> line to the crontab:<pre>MAILFROM=email@address-from-msmtp.com</pre>
</li>
</ul>
<dl><dd>The last part is necessary to prevent this error:<pre>sendmail: server message: 550 5.7.1 Rejected due to unmatching envelope and header sender.</pre>
</dd></dl>
<h2><span class="mw-headline" id="Password_management">Password management</span></h2>
<p>Passwords for msmtp <a rel="nofollow" class="external text" href="https://marlam.de/msmtp/msmtp.html#Authentication">can be stored</a> in plaintext, encrypted files, or a keyring.
</p>
<h3><span class="mw-headline" id="GNOME_Keyring">GNOME Keyring</span></h3>
<p>Storing passwords in <a href="../en/GNOME/Keyring.html" class="mw-redirect" title="GNOME Keyring">GNOME Keyring</a> is supported natively in msmtp. Setup the keyring as described on the linked wiki page and install <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=libsecret">libsecret</a></span>. Then, store a password by running:
</p>
<pre>secret-tool store --label=msmtp host <i>smtp.your.domain</i> service smtp user <i>yourusername</i>
</pre>
<p><i>msmtp</i> should now find the password automatically.
</p>
<h3><span class="mw-headline" id="GnuPG">GnuPG</span></h3>
<p>The <code>password</code> directive may be omitted. In that case, if the account in question has <code>auth</code> set to a legitimate value other than <code>off</code>, invoking msmtp from an interactive shell will ask for the password before sending mail. msmtp will not prompt if it has been called by another type of application, such as <a href="../en/Mutt.html" title="Mutt">Mutt</a>. For such cases, the <code>--passwordeval</code> parameter
can be used to call an external keyring tool like <a href="../en/GnuPG.html" title="GnuPG">GnuPG</a>.
</p>
<p>To do this, set up <a href="../en/GnuPG.html" title="GnuPG">GnuPG</a>, including <a href="../en/GnuPG.html#gpg-agent" class="mw-redirect" title="Gpg-agent">gpg-agent</a> to avoid having to enter the password every time. Then, create an encrypted password file for msmtp, as follows. Create a secure directory with <code>700</code> permissions located on a <a href="../en/Tmpfs.html" title="Tmpfs">tmpfs</a> to avoid writing the unencrypted password to the disk. In that directory create a plain text file with the mail account password. Then, encrypt the file with your private key:
</p>
<pre>$ gpg --default-recipient-self -e <i>/path/to/plain/password</i>
</pre>
<p>Remove the plain text file and move the encrypted file to the final location, e.g. <code>~/.mail/.msmtp-credentials.gpg</code>. In <code>~/.msmtprc</code> add:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">~/.msmtprc</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">passwordeval  "gpg --quiet --for-your-eyes-only --no-tty --decrypt ~/.mail/.msmtp-credentials.gpg"
</pre>
<p>Normally this is sufficient for a GUI password prompt to appear when, for example, sending a message from <a href="../en/Mutt.html" title="Mutt">Mutt</a>. If gpg prompt for the passphrase cannot be issued, then start the <a href="../en/GnuPG.html#gpg-agent" class="mw-redirect" title="GPG">gpg-agent</a> before. A simple hack to start the agent is to execute a external command in your muttrc using the backtick <code>`<i>command</i>`</code> syntax. For example, you can put something like the following in your muttrc:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">muttrc</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">set my_msmtp_pass=`gpg -d mypwfile.gpg`</pre>
<p>Mutt will execute this when it starts, gpg-agent will cache your password, msmtp will be happy and you can send mail. 
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong>  If you do this, you will have to restart mutt after gpg-agent clears the password to start sending emails again.</div>
<p>An alternative is to place passwords in <code>~/.netrc</code>, a file that can act as a common pool for msmtp, <a href="../en/OfflineIMAP.html" title="OfflineIMAP">OfflineIMAP</a>, and associated tools.
</p>
<h3><span class="mw-headline" id="pass">pass</span></h3>
<p>You may store your credentials inside of the <a href="../en/Pass.html" title="Pass">pass</a> password manager.
</p>
<p>If you are using your main password (which is customarily stored in the first line of your pass file) to login into your SMTP server, you can add the following to your <code>.msmptrc</code>:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">~/.msmtprc</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">passwordeval   "pass your_email_password_entry | head -n1"
</pre>
<p>If you are using <a rel="nofollow" class="external text" href="https://www.google.com/gmail/">Gmail</a>, and have set up an <a rel="nofollow" class="external text" href="https://myaccount.google.com/apppasswords">app password</a>, the following configuration will suit you better.
Save your app password inside your <code>pass</code> password file, but with a <code>msmtp:</code> prefix:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">your_email_password_entry</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">your_main_password

login: your_username
url: the_url_of_your_email
<b>msmtp: your_msmtp_app_password</b></pre>
<p>Then add the following to your <code>.msmptrc</code>:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">~/.msmtprc</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">passwordeval   "pass your_email_password_entry | awk '/^msmtp:/ { print $2; }'"
</pre>
<p>In either case, trying to send an email with msmtp will trigger <code>pass</code>, which may ask you for your <code>pass</code> master password if you have not entered it recently.
</p>
<h2><span class="mw-headline" id="Miscellaneous">Miscellaneous</span></h2>
<h3><span class="mw-headline" id="Using_msmtp_offline">Using msmtp offline</span></h3>
<p>Although msmtp is great, it requires that you be online to use it. This is not ideal for people on laptops with intermittent connections to the Internet or dialup users. Several scripts have been written to remedy this fact, collectively called msmtpqueue.
</p>
<p>The scripts are installed under <code>/usr/share/doc/msmtp/msmtpqueue</code>. You might want to copy the scripts to a convenient location on your computer, (<code>/usr/local/bin</code> is a good choice).
</p>
<p>Finally, change your MUA to use msmtp-enqueue.sh instead of msmtp when sending e-mail. By default, queued messages will be stored in <code>~/.msmtpqueue</code>. To change this location, change the <code>QUEUEDIR=$HOME/.msmtpqueue</code> line in the scripts (or delete the line, and export the QUEUEDIR variable in <code>.bash_profile</code> like so: <code>export QUEUEDIR="$XDG_DATA_HOME/msmtpqueue"</code>). 
</p>
<p>When you want to send any mail that you have created and queued up run:
</p>
<pre>$ /usr/local/bin/msmtp-runqueue.sh
</pre>
<p>Adding <code>/usr/local/bin</code> to your PATH can save you some keystrokes if you are doing it manually. The README file that comes with the scripts has some handy information, reading it is recommended.
</p>
<h3><span class="mw-headline" id="Vim_syntax_highlighting">Vim syntax highlighting</span></h3>
<p>The msmtp source distribution includes an <code>msmtprc</code> syntax-highlighting script for <a href="../en/Vim.html" title="Vim">Vim</a>, which is available at <code>/usr/share/vim/vimfiles/syntax/msmtp.vim</code>. The filetype is not detected automatically. The easiest way to enable it is by adding a <a rel="nofollow" class="external text" href="https://vimdoc.sourceforge.net/htmldoc/options.html#modeline">modeline</a> at the top or bottom of the file(s), i.e.:
</p>
<pre># vim:filetype=msmtp
</pre>
<h3><span class="mw-headline" id="Send_mail_with_PHP_using_msmtp">Send mail with PHP using msmtp</span></h3>
<p>Look for <code>sendmail_path</code> option in your <code>php.ini</code> and edit like this:
</p>
<pre>sendmail_path = "/usr/bin/msmtp -C /path/to/your/config -t"
</pre>
<p>Note that you <b>can not</b> use a user configuration file (ie: one under ~/) if you plan on using msmtp as a sendmail replacement with php or something similar.
In that case just create /etc/msmtprc, and remove your user configuration (or not if you plan on using it for something else). Also make sure it is readable by whatever you are using it with (php, django, etc...).
</p>
<p>From the msmtp manual: <i>Accounts defined in the user configuration file override accounts from the system configuration file. The user configuration file must have no more permissions than user read/write</i>
</p>
<p>So it is impossible to have a conf file under ~/ and have it still be readable by the php user.
</p>
<p>To test it place this file in your php enabled server or using php-cli.
</p>
<pre>&lt;?php
mail("your@email.com", "Test email from PHP", "msmtp as sendmail for PHP");
?&gt;
</pre>
<p><code>php-fpm</code> will fail to send mails and logs the warning: <code>PHP Warning:  mail(mail.log): failed to open stream</code> unless you set the permissions of your /etc/msmtprc to user read/write (600).
</p>
<h2><span class="mw-headline" id="Troubleshooting">Troubleshooting</span></h2>
<h3><span class="mw-headline" id="Issues_with_TLS">Issues with TLS</span></h3>
<p>If you see the following message:
</p>
<pre>msmtp: TLS certificate verification failed: the certificate hasn't got a known issuer
</pre>
<p>It probably means your tls_trust_file is not right.
</p>
<p>Just follow the <a rel="nofollow" class="external text" href="https://marlam.de/msmtp/msmtp.html#Transport-Layer-Security">fine manual</a>. It explains you how to find out the server certificate issuer of a given smtp server. Then you can explore the <code>/usr/share/ca-certificates/</code> directory to find out if by any chance, the certificate you need is there. If not, you will have to get the certificate on your own. If you are using your own certificate, you can make msmtp trust it by adding the following to your <code>~/.msmtprc</code>:
</p>
<pre>tls_fingerprint &lt;SHA1 (recommended) or MD5 fingerprint of the certificate&gt;
</pre>
<p>If you are trying to send mail through Gmail and are receiving this error, have a look at <a rel="nofollow" class="external text" href="https://www.mail-archive.com/msmtp-users@lists.sourceforge.net/msg00141.html">this</a> thread or just use the second Gmail example above.
</p>
<p>If you are completely desperate, but are 100% sure you are communicating with the right server, you can always temporarily disable the cert check:
</p>
<pre>$ msmtp --tls-certcheck off
</pre>
<p>If you see the following message:
</p>
<pre>msmtp: TLS handshake failed: the operation timed out
</pre>
<p>You may be affected by this <a rel="nofollow" class="external text" href="https://bugs.archlinux.org/task/44994">bug</a>. Recompile with <code>--with-ssl=openssl</code> (msmtp is compiled with GnuTLS by default).
</p>
<h3><span class="mw-headline" id="Server_sent_empty_reply">Server sent empty reply</span></h3>
<p>If you get a "server sent empty reply" error, this probably means the mail server does not support STARTTLS over port 587, but requires TLS over port 465.
</p>
<p>To let msmtp use TLS over port 465, add the following line to <code>~/.msmtprc</code>:
</p>
<pre>tls_starttls off
</pre>
<h4><span class="mw-headline" id="Zoho_SMTP_server">Zoho SMTP server</span></h4>
<p>It can also happen on Zoho SMTP servers when the mail has no
blank line between mail headers and mail body (see Debian bug <a rel="nofollow" class="external text" href="https://www.mail-archive.com/debian-bugs-dist@lists.debian.org/msg1650762.html">#917260</a>). The solution to this is to add an extra space in between:
</p>
<pre>"test-header\n\ntest-body"
</pre>
<h3><span class="mw-headline" id="Issues_with_GSSAPI">Issues with GSSAPI</span></h3>
<p>If you get the following error
</p>
<pre>GNU SASL: GSSAPI error in client while negotiating security context in gss_init_sec_context() in SASL library.  This is most likely due insufficient credentials or malicious interactions.
</pre>
<p>Try changing your auth setting to plain, instead of gssapi in your .msmtprc file <a rel="nofollow" class="external autonumber" href="https://bbs.archlinux.org/viewtopic.php?id=138727">[1]</a>:
</p>
<pre>auth plain
</pre>
<h3><span class="mw-headline" id="Envelope_not_accepted">Envelope not accepted</span></h3>
<p>In the case of
</p>
<pre>msmtp: envelope from address mail@server not accepted by the server
msmtp: server message: 530 5.5.1 Authentication Required.
msmtp: could not send mail (account default from /etc/msmtprc)
</pre>
<p>Try enabling authentication with
</p>
<pre>auth on
</pre>
<p>or any other method.
</p>
</div>
</div>
					<div id="catlinks" class="catlinks" data-mw="interface">
<div id="mw-normal-catlinks" class="mw-normal-catlinks">
<a href="../Special:Categories.html" title="Special:Categories">Category</a>: <ul><li><a href="../en/Category:Email_clients.html" title="Category:Email clients">Email clients</a></li></ul>
</div>
<div id="mw-hidden-catlinks" class="mw-hidden-catlinks mw-hidden-cats-hidden">Hidden categories: <ul>
<li><a href="../en/Category:Pages_with_dead_links.html" title="Category:Pages with dead links">Pages with dead links</a></li>
<li><a href="../en/Category:Pages_or_sections_flagged_with_Template:Out_of_date.html" title="Category:Pages or sections flagged with Template:Out of date">Pages or sections flagged with Template:Out of date</a></li>
</ul>
</div>
</div>
				</div>
			</main>
			
		</div>
		<div class="mw-footer-container">
			
<footer id="footer" class="mw-footer" role="contentinfo" style="margin: 0">
	<ul id="footer-info">
	<li data-nosnippet="">Retrieved from "<a dir="ltr" href="https://wiki.archlinux.org/index.php?title=Msmtp&amp;oldid=783412">https://wiki.archlinux.org/index.php?title=Msmtp&amp;oldid=783412</a>"</li>
<li id="footer-info-lastmod"> This page was last edited on 18 July 2023, at 10:13.</li>
	<li id="footer-info-copyright">Content is available under <a class="external" rel="nofollow" href="https://www.gnu.org/copyleft/fdl.html">GNU Free Documentation License 1.3 or later</a> unless otherwise noted.</li>
<br>
</ul>

	<ul id="footer-places">
	<li id="footer-places-privacy"><a href="https://terms.archlinux.org/docs/privacy-policy/">Privacy policy</a></li>
	<li id="footer-places-about"><a href="../en/ArchWiki:About.html">About ArchWiki</a></li>
	<li id="footer-places-disclaimer"><a href="../en/ArchWiki:General_disclaimer.html">Disclaimers</a></li>
</ul>

	
</footer>

		</div>
	</div> 
</div> 

</body>
</html>
