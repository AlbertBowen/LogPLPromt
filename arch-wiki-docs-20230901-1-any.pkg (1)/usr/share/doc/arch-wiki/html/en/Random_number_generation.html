<!DOCTYPE html>
<html class="client-nojs" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<title>Random number generation - ArchWiki</title>
<link rel="stylesheet" href="../ArchWikiOffline.css">
<meta name="ResourceLoaderDynamicStyles" content="">
<meta name="generator" content="MediaWiki 1.39.4">
<meta name="referrer" content="no-referrer-when-downgrade">
<meta name="format-detection" content="telephone=no">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes, minimum-scale=0.25, maximum-scale=5.0">
<link rel="icon" href="/favicon.ico">
<link rel="search" type="application/opensearchdescription+xml" href="/opensearch_desc.php" title="ArchWiki (en)">
<link rel="EditURI" type="application/rsd+xml" href="https://wiki.archlinux.org/api.php?action=rsd">
<link rel="license" href="https://www.gnu.org/copyleft/fdl.html">
<link rel="alternate" type="application/atom+xml" title="ArchWiki Atom feed" href="/index.php?title=Special:RecentChanges&amp;feed=atom">
</head>
<body class="skin-vector skin-vector-search-vue mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-Random_number_generation rootpage-Random_number_generation skin-vector-2022 action-view skin--responsive vector-feature-language-in-header-enabled vector-feature-language-in-main-page-header-disabled vector-feature-language-alert-in-sidebar-disabled vector-feature-sticky-header-disabled vector-feature-sticky-header-edit-disabled vector-feature-table-of-contents-disabled vector-feature-visual-enhancement-next-disabled">
<div class="mw-page-container">
	<span id="top-page"></span>
	<a class="mw-jump-link" href="#content">Jump to content</a>
	<div class="mw-page-container-inner">
		<input type="checkbox" id="mw-sidebar-checkbox" class="mw-checkbox-hack-checkbox">
		<div class="vector-sidebar-container vector-sidebar-container-no-toc">
			</div>
		<div class="vector-sitenotice-container">
			<div id="siteNotice"></div>
		</div>
		<input type="checkbox" id="vector-toc-collapsed-checkbox" class="mw-checkbox-hack-checkbox">
		<div class="mw-table-of-contents-container">
			<div class="vector-sticky-toc-container mw-sticky-header-element">
				
			</div>
		</div>
		<div class="mw-content-container">
			<main id="content" class="mw-body" role="main" style="margin: 0">
				<a id="top"></a>
				<nav class="vector-article-toolbar" aria-label="Tools" role="navigation">
					<div class="mw-article-toolbar-container">
						<div id="left-navigation">
							

<div id="p-associated-pages" class="vector-menu mw-portlet mw-portlet-associated-pages vector-menu-tabs">
	<div class="vector-menu-content">
		
		<ul class="vector-menu-content-list">
<li id="ca-nstab-main" class="selected mw-list-item"><a href="../en/Random_number_generation.html" title="View the content page [c]" accesskey="c"><span>Page</span></a></li>
<li id="ca-talk" class="mw-list-item"><a href="../en/Talk:Random_number_generation.html" rel="discussion" title="Discussion about the content page [t]" accesskey="t"><span>Discussion</span></a></li>
</ul>
		
	</div>
</div>

							

<div id="p-variants" class="vector-menu mw-portlet mw-portlet-variants emptyPortlet vector-menu-dropdown">
	<input type="checkbox" id="p-variants-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-p-variants" class="vector-menu-checkbox" aria-label="Change language variant">
	<label id="p-variants-label" for="p-variants-checkbox" class="vector-menu-heading ">
		<span class="vector-menu-heading-label">English</span>
	</label>
	<div class="vector-menu-content">
		
		<ul class="vector-menu-content-list"></ul>
		
	</div>
</div>

						</div>
						<div id="right-navigation" class="vector-collapsible ">
							

<div id="p-views" class="vector-menu mw-portlet mw-portlet-views vector-menu-tabs">
	<div class="vector-menu-content">
		
		<ul class="vector-menu-content-list">
<li id="ca-view" class="selected mw-list-item"><a href="../en/Random_number_generation.html"><span>Read</span></a></li>
<li id="ca-viewsource" class="mw-list-item"><a href="/index.php?title=Random_number_generation&amp;action=edit" title="This page is protected.
You can view its source [e]" accesskey="e"><span>View source</span></a></li>
<li id="ca-history" class="mw-list-item"><a href="/index.php?title=Random_number_generation&amp;action=history" title="Past revisions of this page [h]" accesskey="h"><span>View history</span></a></li>
</ul>
		
	</div>
</div>

							

<div id="p-cactions" class="vector-menu mw-portlet mw-portlet-cactions emptyPortlet vector-menu-dropdown vector-has-collapsible-items" title="More options">
	<input type="checkbox" id="p-cactions-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-p-cactions" class="vector-menu-checkbox">
	<label id="p-cactions-label" for="p-cactions-checkbox" class="vector-menu-heading ">
		<span class="vector-menu-heading-label">More</span>
	</label>
	<div class="vector-menu-content">
		
		<ul class="vector-menu-content-list">
<li id="ca-more-view" class="selected vector-more-collapsible-item mw-list-item"><a href="../en/Random_number_generation.html"><span>Read</span></a></li>
<li id="ca-more-viewsource" class="vector-more-collapsible-item mw-list-item"><a href="/index.php?title=Random_number_generation&amp;action=edit"><span>View source</span></a></li>
<li id="ca-more-history" class="vector-more-collapsible-item mw-list-item"><a href="/index.php?title=Random_number_generation&amp;action=history"><span>View history</span></a></li>
</ul>
		
	</div>
</div>

						</div>
					</div>
				</nav>
				<div id="bodyContent" class="vector-body" data-mw-ve-target-container>
					<div class="mw-body-subheader">
					        <div class="mw-indicators">
        </div>

					    <div id="siteSub" class="noprint">From ArchWiki</div>
					</div>
					
					
					
					<div id="mw-content-text" class="mw-body-content mw-content-ltr" lang="en" dir="ltr">
<div class="mw-parser-output">
<p>From <a href="https://en.wikipedia.org/wiki/Random_number_generation" class="extiw" title="wikipedia:Random number generation">wikipedia:Random number generation</a>:
</p>
<dl><dd>A random number generator (RNG) is a computational or physical device designed to generate a sequence of numbers or symbols that lack any pattern, i.e. appear random.</dd></dl>
<p>Generation of random data is crucial for several applications like making cryptographic keys (e.g. for <a href="../en/Data-at-rest_encryption.html" title="Data-at-rest encryption">data-at-rest encryption</a>), <a href="../en/Securely_wipe_disk.html" title="Securely wipe disk">securely wiping disks</a>, running encrypted <a href="../en/Software_access_point.html" title="Software access point">Software access points</a>.
</p>
<h2><span class="mw-headline" id="Kernel_built-in_RNG">Kernel built-in RNG</span></h2>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> the Linux RNG has been improved significantly in recent years, with many changes occurring in the 4.x and 5.x kernel series.  As such, much information that exists about it is outdated.  This page describes the current implementation and behavior, applicable to modern kernels including Arch Linux's <a href="../en/Kernel.html#Officially_supported_kernels" title="Kernel">officially supported kernels</a>.</div>
<p><a rel="nofollow" class="external text" href="https://github.com/torvalds/linux/blob/master/drivers/char/random.c">The Linux kernel's built-in RNG</a> produces cryptographically secure pseudorandom data.  It works by collecting <a href="https://en.wikipedia.org/wiki/Entropy_(information_theory)" class="extiw" title="wikipedia:Entropy (information theory)">entropy</a> from various sources, such as hardware RNGs, interrupts, and CPU-based jitterentropy.  No single entropy source is relied on exclusively.  The entropy is extracted using the <a href="https://en.wikipedia.org/wiki/BLAKE_(hash_function)#BLAKE2" class="extiw" title="wikipedia:BLAKE (hash function)">BLAKE2s cryptographic hash function</a> and used to seed a set of <a href="https://en.wikipedia.org/wiki/Salsa20#ChaCha_variant" class="extiw" title="wikipedia:Salsa20">ChaCha20</a> CRNGs (Cryptographic Random Number Generators) that provide the actual random data.  Entropy continues to be collected, and the CRNGs are periodically reseeded, as long as the kernel is running.
</p>
<p>The Linux RNG provides three interfaces for userspace to get random data:
</p>
<ul>
<li>The <span class="plainlinks archwiki-template-man" title="$ man 2 getrandom"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/getrandom.2">getrandom(2)</a></span> system call</li>
<li><code>/dev/random</code></li>
<li><code>/dev/urandom</code></li>
</ul>
<p>Historically, <code>/dev/random</code> was considered to provide stronger random numbers than <code>/dev/urandom</code>.  However, the behavior of <code>/dev/random</code> and <code>/dev/urandom</code> has significantly converged over time, and on x86-64 systems they are now equivalent.  Since Arch Linux only supports x86-64, <code>/dev/random</code> and <code>/dev/urandom</code> are equivalent on Arch Linux.  (This is true because the presence of the <a href="https://en.wikipedia.org/wiki/Time_Stamp_Counter" class="extiw" title="wikipedia:Time Stamp Counter">RDTSC instruction</a> on all x86-64 CPUs means that the <a rel="nofollow" class="external text" href="https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/tree/drivers/char/random.c?h=v6.1#n1205">CPU-based jitterentropy algorithm</a> will always be able to generate entropy, not to mention that most x86-64 CPUs also support <a href="https://en.wikipedia.org/wiki/RDRAND" class="extiw" title="wikipedia:RDRAND">RDRAND</a>.)
</p>
<p>On other architectures (specifically, architectures that do not have a fast cycle counter), there is one remaining difference between the two: <code>/dev/random</code> blocks until the kernel has estimated that the CRNGs are properly initialized, whereas <code>/dev/urandom</code> does not.  Therefore, in the general case, users and applications should still follow the traditional guidance of using <code>/dev/random</code> when generating long-term cryptographic keys, or use <span class="plainlinks archwiki-template-man" title="$ man 2 getrandom"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/getrandom.2">getrandom(2)</a></span> which by default behaves similarly to <code>/dev/random</code>.
</p>
<p>Note that because <code>/dev/random</code> no longer aims to provide true random data, but rather "just" cryptographically secure random data (which is sufficient for all real-world use cases), reading from it no longer causes the kernel's entropy pool to deplete.  Therefore, <code>/proc/sys/kernel/random/entropy_avail</code> should always contain 256, which is the size of a ChaCha20 key in bits.  Historical documentation that expected larger values in this file, or expected the user to take actions if the value was getting "too low", can be disregarded.
</p>
<h2><span class="mw-headline" id="Alternatives">Alternatives</span></h2>
<p>Applications that do not need cryptographically secure random numbers can simply use a non-cryptographic random number generator, for example <span class="plainlinks archwiki-template-man" title="$ man 3 random"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/random.3">random(3)</a></span>.
</p>
<p>For applications that do need cryptographically secure random numbers, there generally is no need for anything other than the kernel's RNG.  Historically, the kernel's RNG was fairly slow and did not take advantage of as many entropy sources as it could have.  However, it has since been improved to provide ~400 MB/s throughput on x86-64 and to take advantage of more entropy sources.  Even for cases that need fairly high throughput random numbers, such as <a href="../en/Securely_wipe_disk.html" title="Securely wipe disk">securely wiping a disk</a>, simply reading from <code>/dev/urandom</code> works fine.
</p>
<p>Cases where it could make sense to not use the kernel's RNG directly include:
</p>
<ul><li>In rare cases, applications need cryptographically secure random numbers with a <b>very</b> high throughput, or with a very low latency where the overhead of a system call would not be tolerable.  A userspace CRNG can solve this problem.  Userspace CRNGs should be seeded from the kernel's RNG to ensure that they are at least as secure as the kernel's RNG, modulo considerations such as reseeding.</li></ul>
<ul><li>Some applications work in domains where there is already a well-established API for generating cryptographically secure random numbers using a userspace CRNG.  For example, when an application is using <a href="../en/OpenSSL.html" title="OpenSSL">OpenSSL</a>, it may make sense to use OpenSSL's <span class="plainlinks archwiki-template-man" title="$ man 3 RAND_bytes"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/RAND_bytes.3">RAND_bytes(3)</a></span>.  When an application is written in Java, it may make sense to use <a rel="nofollow" class="external text" href="https://docs.oracle.com/javase/8/docs/api/java/security/SecureRandom.html"><code>java.security.SecureRandom</code></a>.  Usually, the userspace CRNGs underlying these APIs are automatically seeded using the kernel's RNG.</li></ul>
<ul><li>If you would like to use additional entropy sources that are not already incorporated into the kernel's RNG, it might make sense to not use the kernel's RNG directly.  For example, <a href="../en/Haveged.html" title="Haveged">Haveged</a> can provide random data generated using jitterentropy.  If possible, additional entropy sources should not replace the kernel's RNG, but rather be used in conjunction with it by seeding a userspace CRNG from both the additional entropy source and the kernel's RNG.  It is also possible to write additional entropy to <code>/dev/random</code> to cause it to be incorporated into the kernel's RNG, though it may take up to 60 seconds for this to take effect due to the kernel's CRNG reseeding schedule.  Note: the kernel already uses <a href="https://en.wikipedia.org/wiki/RDRAND" class="extiw" title="wikipedia:RDRAND">RDSEED</a> and other hardware random number generators as entropy sources.</li></ul>
<h2><span class="mw-headline" id="See_also">See also</span></h2>
<ul>
<li>Kernel RNG improvements:
<ul>
<li>
<a rel="nofollow" class="external text" href="https://git.kernel.org/linus/e192be9d9a30555a">random: replace non-blocking pool with a Chacha20-based CRNG</a> - introduced the ChaCha20 CRNG (2016)</li>
<li>
<a rel="nofollow" class="external text" href="https://git.kernel.org/linus/50ee7529ec4500c8">random: try to actively add entropy rather than passively wait for it</a> - made CPU-based jitterentropy be used as a fallback (2019)</li>
<li>
<a rel="nofollow" class="external text" href="https://lwn.net/Articles/808575/">Removing the Linux /dev/random blocking pool</a> - made <code>/dev/random</code> use a CRNG, just like <code>/dev/urandom</code>, and not try to provide "true" randomness (2020)</li>
<li>
<a rel="nofollow" class="external text" href="https://www.zx2c4.com/projects/linux-rng-5.17-5.18/">Random number generator enhancements for Linux 5.17 and 5.18</a> (2022)</li>
<li>
<a rel="nofollow" class="external text" href="https://git.kernel.org/linus/186873c549df11b6">random: use simpler fast key erasure flow on per-cpu keys</a> - simplified and optimized the CRNG design (2022)</li>
<li>
<a rel="nofollow" class="external text" href="https://git.kernel.org/linus/e85c0fc1d94c5248">random: do not pretend to handle premature next security model</a> - made new entropy be used more quickly (2022)</li>
<li>
<a rel="nofollow" class="external text" href="https://git.kernel.org/linus/48bff1053c172e6c">random: opportunistically initialize on /dev/urandom reads</a> - made <code>/dev/urandom</code> as safe as <code>/dev/random</code> on x86 (2022)</li>
</ul>
</li>
<li>
<a rel="nofollow" class="external text" href="https://www.random.org/randomness/">Randomness</a> - A popular science article explaining different RNGs</li>
<li>
<a rel="nofollow" class="external text" href="https://www.fourmilab.ch/random/">ENT</a> - A simple program for testing random sequences (entropy, Chi square test, Monte Carlo, correlation, etc.)</li>
<li>
<a rel="nofollow" class="external text" href="https://eprint.iacr.org/2016/367">An Analysis of OpenSSL's Random Number Generator</a> - Paper on RNG reseeding risks in OpenSSL functionality</li>
</ul>
</div>
</div>
					<div id="catlinks" class="catlinks" data-mw="interface"><div id="mw-normal-catlinks" class="mw-normal-catlinks">
<a href="../Special:Categories.html" title="Special:Categories">Category</a>: <ul><li><a href="../en/Category:Cryptography.html" title="Category:Cryptography">Cryptography</a></li></ul>
</div></div>
				</div>
			</main>
			
		</div>
		<div class="mw-footer-container">
			
<footer id="footer" class="mw-footer" role="contentinfo" style="margin: 0">
	<ul id="footer-info">
	<li data-nosnippet="">Retrieved from "<a dir="ltr" href="https://wiki.archlinux.org/index.php?title=Random_number_generation&amp;oldid=786165">https://wiki.archlinux.org/index.php?title=Random_number_generation&amp;oldid=786165</a>"</li>
<li id="footer-info-lastmod"> This page was last edited on 25 August 2023, at 15:28.</li>
	<li id="footer-info-copyright">Content is available under <a class="external" rel="nofollow" href="https://www.gnu.org/copyleft/fdl.html">GNU Free Documentation License 1.3 or later</a> unless otherwise noted.</li>
<br>
</ul>

	<ul id="footer-places">
	<li id="footer-places-privacy"><a href="https://terms.archlinux.org/docs/privacy-policy/">Privacy policy</a></li>
	<li id="footer-places-about"><a href="../en/ArchWiki:About.html">About ArchWiki</a></li>
	<li id="footer-places-disclaimer"><a href="../en/ArchWiki:General_disclaimer.html">Disclaimers</a></li>
</ul>

	
</footer>

		</div>
	</div> 
</div> 

</body>
</html>
