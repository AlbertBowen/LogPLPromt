<!DOCTYPE html>
<html class="client-nojs" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<title>uWSGI - ArchWiki</title>
<link rel="stylesheet" href="../ArchWikiOffline.css">
<meta name="ResourceLoaderDynamicStyles" content="">
<meta name="generator" content="MediaWiki 1.39.4">
<meta name="referrer" content="no-referrer-when-downgrade">
<meta name="format-detection" content="telephone=no">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes, minimum-scale=0.25, maximum-scale=5.0">
<link rel="icon" href="/favicon.ico">
<link rel="search" type="application/opensearchdescription+xml" href="/opensearch_desc.php" title="ArchWiki (en)">
<link rel="EditURI" type="application/rsd+xml" href="https://wiki.archlinux.org/api.php?action=rsd">
<link rel="license" href="https://www.gnu.org/copyleft/fdl.html">
<link rel="alternate" type="application/atom+xml" title="ArchWiki Atom feed" href="/index.php?title=Special:RecentChanges&amp;feed=atom">
</head>
<body class="skin-vector skin-vector-search-vue mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-UWSGI rootpage-UWSGI skin-vector-2022 action-view skin--responsive vector-feature-language-in-header-enabled vector-feature-language-in-main-page-header-disabled vector-feature-language-alert-in-sidebar-disabled vector-feature-sticky-header-disabled vector-feature-sticky-header-edit-disabled vector-feature-table-of-contents-disabled vector-feature-visual-enhancement-next-disabled">
<div class="mw-page-container">
	<span id="top-page"></span>
	<a class="mw-jump-link" href="#content">Jump to content</a>
	<div class="mw-page-container-inner">
		<input type="checkbox" id="mw-sidebar-checkbox" class="mw-checkbox-hack-checkbox">
		<div class="vector-sidebar-container ">
			</div>
		<div class="vector-sitenotice-container">
			<div id="siteNotice"></div>
		</div>
		<input type="checkbox" id="vector-toc-collapsed-checkbox" class="mw-checkbox-hack-checkbox">
		<div class="mw-table-of-contents-container">
			<div class="vector-sticky-toc-container mw-sticky-header-element">
				<nav id="mw-panel-toc" class="sidebar-toc" role="navigation" aria-labelledby="sidebar-toc-label" data-event-name="ui.sidebar-toc">
	<div id="sidebar-toc-label" class="sidebar-toc-header">
		<p class="sidebar-toc-title">
		Contents
		<button class="vector-toc-uncollapse-button">move to sidebar</button>
		<button class="vector-toc-collapse-button">hide</button>
		</p>
	</div>
	<ul class="sidebar-toc-contents" id="mw-panel-toc-list">
		<li id="toc-mw-content-text" class="sidebar-toc-list-item sidebar-toc-level-1">
			<a href="#top-page" class="sidebar-toc-link">
				<div class="sidebar-toc-text">Beginning</div>
			</a>
		</li>
		<li id="toc-Installation" class="sidebar-toc-list-item sidebar-toc-level-1 sidebar-toc-list-item-expanded">
			<a class="sidebar-toc-link" href="#Installation">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">1</span>Installation</div>
			</a>
			
			<ul id="toc-Installation-sublist" class="sidebar-toc-list">
			</ul>
		</li>
		<li id="toc-Configuration" class="sidebar-toc-list-item sidebar-toc-level-1 sidebar-toc-list-item-expanded">
			<a class="sidebar-toc-link" href="#Configuration">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">2</span>Configuration</div>
			</a>
			
				<button aria-controls="toc-Configuration-sublist" class="mw-ui-icon mw-ui-icon-wikimedia-expand mw-ui-icon-small sidebar-toc-toggle">
					Toggle Configuration subsection
				</button>
			
			<ul id="toc-Configuration-sublist" class="sidebar-toc-list">
				<li id="toc-Web_applications" class="sidebar-toc-list-item sidebar-toc-level-2">
			<a class="sidebar-toc-link" href="#Web_applications">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">2.1</span>Web applications</div>
			</a>
			
			<ul id="toc-Web_applications-sublist" class="sidebar-toc-list">
				<li id="toc-Python" class="sidebar-toc-list-item sidebar-toc-level-3">
			<a class="sidebar-toc-link" href="#Python">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">2.1.1</span>Python</div>
			</a>
			
			<ul id="toc-Python-sublist" class="sidebar-toc-list">
			</ul>
		</li>
		<li id="toc-PHP" class="sidebar-toc-list-item sidebar-toc-level-3">
			<a class="sidebar-toc-link" href="#PHP">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">2.1.2</span>PHP</div>
			</a>
			
			<ul id="toc-PHP-sublist" class="sidebar-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id="toc-Web_server" class="sidebar-toc-list-item sidebar-toc-level-2">
			<a class="sidebar-toc-link" href="#Web_server">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">2.2</span>Web server</div>
			</a>
			
			<ul id="toc-Web_server-sublist" class="sidebar-toc-list">
				<li id="toc-Nginx" class="sidebar-toc-list-item sidebar-toc-level-3">
			<a class="sidebar-toc-link" href="#Nginx">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">2.2.1</span>Nginx</div>
			</a>
			
			<ul id="toc-Nginx-sublist" class="sidebar-toc-list">
			</ul>
		</li>
		<li id="toc-Nginx_(in_chroot)" class="sidebar-toc-list-item sidebar-toc-level-3">
			<a class="sidebar-toc-link" href="#Nginx_(in_chroot)">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">2.2.2</span>Nginx (in chroot)</div>
			</a>
			
			<ul id="toc-Nginx_(in_chroot)-sublist" class="sidebar-toc-list">
			</ul>
		</li>
	</ul>
		</li>
	</ul>
		</li>
		<li id="toc-Running_uWSGI" class="sidebar-toc-list-item sidebar-toc-level-1 sidebar-toc-list-item-expanded">
			<a class="sidebar-toc-link" href="#Running_uWSGI">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">3</span>Running uWSGI</div>
			</a>
			
			<ul id="toc-Running_uWSGI-sublist" class="sidebar-toc-list">
			</ul>
		</li>
		<li id="toc-Tips_and_tricks" class="sidebar-toc-list-item sidebar-toc-level-1 sidebar-toc-list-item-expanded">
			<a class="sidebar-toc-link" href="#Tips_and_tricks">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">4</span>Tips and tricks</div>
			</a>
			
				<button aria-controls="toc-Tips_and_tricks-sublist" class="mw-ui-icon mw-ui-icon-wikimedia-expand mw-ui-icon-small sidebar-toc-toggle">
					Toggle Tips and tricks subsection
				</button>
			
			<ul id="toc-Tips_and_tricks-sublist" class="sidebar-toc-list">
				<li id="toc-Socket_activation" class="sidebar-toc-list-item sidebar-toc-level-2">
			<a class="sidebar-toc-link" href="#Socket_activation">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">4.1</span>Socket activation</div>
			</a>
			
			<ul id="toc-Socket_activation-sublist" class="sidebar-toc-list">
			</ul>
		</li>
		<li id="toc-Hardening_uWSGI_service" class="sidebar-toc-list-item sidebar-toc-level-2">
			<a class="sidebar-toc-link" href="#Hardening_uWSGI_service">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">4.2</span>Hardening uWSGI service</div>
			</a>
			
			<ul id="toc-Hardening_uWSGI_service-sublist" class="sidebar-toc-list">
			</ul>
		</li>
		<li id="toc-Accessibility_of_uWSGI_socket" class="sidebar-toc-list-item sidebar-toc-level-2">
			<a class="sidebar-toc-link" href="#Accessibility_of_uWSGI_socket">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">4.3</span>Accessibility of uWSGI socket</div>
			</a>
			
			<ul id="toc-Accessibility_of_uWSGI_socket-sublist" class="sidebar-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id="toc-Troubleshooting" class="sidebar-toc-list-item sidebar-toc-level-1 sidebar-toc-list-item-expanded">
			<a class="sidebar-toc-link" href="#Troubleshooting">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">5</span>Troubleshooting</div>
			</a>
			
				<button aria-controls="toc-Troubleshooting-sublist" class="mw-ui-icon mw-ui-icon-wikimedia-expand mw-ui-icon-small sidebar-toc-toggle">
					Toggle Troubleshooting subsection
				</button>
			
			<ul id="toc-Troubleshooting-sublist" class="sidebar-toc-list">
				<li id="toc-Apache_httpd" class="sidebar-toc-list-item sidebar-toc-level-2">
			<a class="sidebar-toc-link" href="#Apache_httpd">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">5.1</span>Apache httpd</div>
			</a>
			
			<ul id="toc-Apache_httpd-sublist" class="sidebar-toc-list">
				<li id="toc-AH00957:_uwsgi:_attempt_to_connect_to_127.0.0.1:0_(*)_failed" class="sidebar-toc-list-item sidebar-toc-level-3">
			<a class="sidebar-toc-link" href="#AH00957:_uwsgi:_attempt_to_connect_to_127.0.0.1:0_(*)_failed">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">5.1.1</span>AH00957: uwsgi: attempt to connect to 127.0.0.1:0 (*) failed</div>
			</a>
			
			<ul id="toc-AH00957:_uwsgi:_attempt_to_connect_to_127.0.0.1:0_(*)_failed-sublist" class="sidebar-toc-list">
			</ul>
		</li>
	</ul>
		</li>
	</ul>
		</li>
		<li id="toc-See_also" class="sidebar-toc-list-item sidebar-toc-level-1 sidebar-toc-list-item-expanded">
			<a class="sidebar-toc-link" href="#See_also">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">6</span>See also</div>
			</a>
			
			<ul id="toc-See_also-sublist" class="sidebar-toc-list">
			</ul>
		</li>
	</ul>
</nav>

			</div>
		</div>
		<div class="mw-content-container">
			<main id="content" class="mw-body" role="main" style="margin: 0">
				<a id="top"></a>
				<nav class="vector-article-toolbar" aria-label="Tools" role="navigation">
					<div class="mw-article-toolbar-container">
						<div id="left-navigation">
							

<div id="p-associated-pages" class="vector-menu mw-portlet mw-portlet-associated-pages vector-menu-tabs">
	<div class="vector-menu-content">
		
		<ul class="vector-menu-content-list">
<li id="ca-nstab-main" class="selected mw-list-item"><a href="../en/UWSGI.html" title="View the content page [c]" accesskey="c"><span>Page</span></a></li>
<li id="ca-talk" class="mw-list-item"><a href="../en/Talk:UWSGI.html" rel="discussion" title="Discussion about the content page [t]" accesskey="t"><span>Discussion</span></a></li>
</ul>
		
	</div>
</div>

							

<div id="p-variants" class="vector-menu mw-portlet mw-portlet-variants emptyPortlet vector-menu-dropdown">
	<input type="checkbox" id="p-variants-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-p-variants" class="vector-menu-checkbox" aria-label="Change language variant">
	<label id="p-variants-label" for="p-variants-checkbox" class="vector-menu-heading ">
		<span class="vector-menu-heading-label">English</span>
	</label>
	<div class="vector-menu-content">
		
		<ul class="vector-menu-content-list"></ul>
		
	</div>
</div>

						</div>
						<div id="right-navigation" class="vector-collapsible ">
							

<div id="p-views" class="vector-menu mw-portlet mw-portlet-views vector-menu-tabs">
	<div class="vector-menu-content">
		
		<ul class="vector-menu-content-list">
<li id="ca-view" class="selected mw-list-item"><a href="../en/UWSGI.html"><span>Read</span></a></li>
<li id="ca-viewsource" class="mw-list-item"><a href="/index.php?title=UWSGI&amp;action=edit" title="This page is protected.
You can view its source [e]" accesskey="e"><span>View source</span></a></li>
<li id="ca-history" class="mw-list-item"><a href="/index.php?title=UWSGI&amp;action=history" title="Past revisions of this page [h]" accesskey="h"><span>View history</span></a></li>
</ul>
		
	</div>
</div>

							

<div id="p-cactions" class="vector-menu mw-portlet mw-portlet-cactions emptyPortlet vector-menu-dropdown vector-has-collapsible-items" title="More options">
	<input type="checkbox" id="p-cactions-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-p-cactions" class="vector-menu-checkbox">
	<label id="p-cactions-label" for="p-cactions-checkbox" class="vector-menu-heading ">
		<span class="vector-menu-heading-label">More</span>
	</label>
	<div class="vector-menu-content">
		
		<ul class="vector-menu-content-list">
<li id="ca-more-view" class="selected vector-more-collapsible-item mw-list-item"><a href="../en/UWSGI.html"><span>Read</span></a></li>
<li id="ca-more-viewsource" class="vector-more-collapsible-item mw-list-item"><a href="/index.php?title=UWSGI&amp;action=edit"><span>View source</span></a></li>
<li id="ca-more-history" class="vector-more-collapsible-item mw-list-item"><a href="/index.php?title=UWSGI&amp;action=history"><span>View history</span></a></li>
</ul>
		
	</div>
</div>

						</div>
					</div>
				</nav>
				<div id="bodyContent" class="vector-body" data-mw-ve-target-container>
					<div class="mw-body-subheader">
					        <div class="mw-indicators">
        </div>

					    <div id="siteSub" class="noprint">From ArchWiki</div>
					</div>
					
					
					
					<div id="mw-content-text" class="mw-body-content mw-content-ltr" lang="en" dir="ltr">
<div class="mw-parser-output">
<p><span>
</span>
<a rel="nofollow" class="external text" href="https://uwsgi-docs.readthedocs.io/en/latest/">uWSGI</a> is a fast, self-healing and developer/sysadmin-friendly application container server coded in pure C.
</p>
<p>There are alternatives written in Python such as <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=gunicorn">gunicorn</a></span>.
</p>
<mw:tocplace></mw:tocplace>
<h2><span class="mw-headline" id="Installation">Installation</span></h2>
<p><a href="../en/Help:Reading.html#Installation_of_packages" class="mw-redirect" title="Install">Install</a> the <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=uwsgi">uwsgi</a></span> package. Plugins need to be installed separately (their package names start with <code>uwsgi-plugin-</code>).
</p>
<h2><span class="mw-headline" id="Configuration">Configuration</span></h2>
<p><a href="../en/Category:Web_applications.html" class="mw-redirect" title="Web applications">Web applications</a> served by uWSGI are configured in <code>/etc/uwsgi/</code>, where each of them requires its own configuration file (ini-style). Details can be found <a rel="nofollow" class="external text" href="https://uwsgi-docs.readthedocs.org/en/latest/">in the uWSGI documentation</a>.
</p>
<p>Alternatively, you can run uWSGI in <a rel="nofollow" class="external text" href="https://uwsgi-docs.readthedocs.org/en/latest/Emperor.html">Emperor mode</a> (configured in <code>/etc/uwsgi/emperor.ini</code>). It enables a single uWSGI instance to run a set of different apps (called vassals) using a single main supervisor (called emperor).
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> The plugins must be explicitly loaded before their options can be used, otherwise the options will not be recognized. This can be done with the <code>--plugins</code> command-line option or with the <code>plugins</code> variable in the configuration file.</div>
<h3><span class="mw-headline" id="Web_applications">Web applications</span></h3>
<p>uWSGI supports many different languages and thus also many web applications.
As an example the configuration file <code>/etc/uwsgi/example.ini</code> and the prior installation of the plugin needed for your web application is assumed.
</p>
<h4><span class="mw-headline" id="Python">Python</span></h4>
<p>The following is a simple example for a <a href="../en/Python.html" title="Python">Python</a> application.
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/uwsgi/example.ini</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[uwsgi]
chdir = /srv/http/example
module = example
plugins = python</pre>
<p>It is also possible to run uWSGI separately with the following syntax for instance:
</p>
<pre>$ uwsgi --socket 127.0.0.1:3031 --plugin python2 --wsgi-file ~/foo.py --master --processes 4 --threads 2 --stats 127.0.0.1:9191 --uid --gid
</pre>
<p>You should avoid running this command as root.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> Pay attention to operational mode in use, preforking without --lazy-apps may cause non-obvious behavior. By default the Python plugin does not initialize the GIL. This means your app-generated threads will not run. If you need threads, remember to enable them with enable-threads. Running uWSGI in multithreading mode (with the threads options) will automatically enable threading support. This "strange" default behaviour is for performance reasons, no shame in that. <a rel="nofollow" class="external autonumber" href="https://uwsgi-docs.readthedocs.io/en/latest/ThingsToKnow.html">[1]</a>
</div>
<h4><span class="mw-headline" id="PHP">PHP</span></h4>
<p>The following is a simple example for a <a href="../en/PHP.html" title="PHP">PHP</a> based website.
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/uwsgi/example.ini</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[uwsgi]
; maximum number of worker processes
processes = 4
; the user and group id of the process once it’s started
uid = http
gid = http
socket = /run/uwsgi/%n.sock
master = true
chdir = /srv/http/%n
; php
plugins = php
; jail our php environment
php-docroot = /srv/http/%n
php-index = index.php
; clear environment on exit
vacuum = true</pre>
<h3><span class="mw-headline" id="Web_server">Web server</span></h3>
<p>uWSGI can be the backend to many web servers, that support the forwarding of access. The following are examples for configurations.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> It is recommended to read through the uWSGI documentation to understand the configuration from both performance and security point of view.</div>
<h4><span class="mw-headline" id="Nginx">Nginx</span></h4>
<p><a href="../en/Nginx.html" title="Nginx">nginx</a> can redirect access towards unix sockets or ports (on localhost or remote machine), depending on your web application.
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/nginx/example.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;"># ...
# forward all access to / towards 
location / {
  root /usr/share/nginx/html;
  index index.html index.htm;
  include uwsgi_params;
  # this is the correct uwsgi_modifier1 parameter for a php based application
  uwsgi_modifier1 14;
  # uncomment the following if you want to use the unix socket instead
  # uwsgi_pass unix:/var/run/uwsgi/example.sock;
  # access is redirected to localhost:3031
  uwsgi_pass 127.0.0.1:3031;
}
# ...
</pre>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip:</strong> Have a look at <a rel="nofollow" class="external text" href="https://uwsgi-docs.readthedocs.io/en/latest/Protocol.html#packet-descriptions">the documentation</a> for the list of <code>uwsgi_modifier1</code> parameters fitting to your web application.</div>
<h4>
<span id="Nginx_.28in_chroot.29"></span><span class="mw-headline" id="Nginx_(in_chroot)">Nginx (in chroot)</span>
</h4>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> This section assumes that you have deployed Nginx as described in <a href="../en/Nginx.html#Installation_in_a_chroot" title="Nginx">Nginx#Installation in a chroot</a>. It is assumed that the Nginx chroot is located in <code>/srv/http</code>.</div>
<p>First create ini file that will point to your application:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/uwsgi/application1.ini</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[uwsgi]
chroot = /srv/http
chdir = /www/application1
wsgi-file = application1.py
plugins = python
socket = /run/application1.sock
uid = http
gid = http
threads = 2
stats = 127.0.0.1:9191
vacuum = true
</pre>
<p>Since we are chrooting to <code>/srv/http</code> above configuration will result in following unix socket being created <code>/srv/http/run/application1.sock</code>
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> 
<ul>
<li>Your application must be placed within <code>/srv/http/www/application1</code> before service is started. Depending on configuration your application may be cached so you may need to restart the service when you modify it.</li>
<li>If you are deploying python application you may need to copy standard python libraries - if you develop under python 3 then you can copy them from <code>/usr/lib/python3.6</code> to <code>/srv/http/lib/python3.6</code>.</li>
</ul>
<p>You can try to run following:
</p>
<pre># cp -r -p /usr/lib/python3.6 /srv/http/lib
# cp -r -p /usr/lib/*python*so /srv/http/lib
</pre>
</div>
<p>You will need to disable notifications within your service file:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/systemd/system/multi-user.target.wants/uwsgi\@application1.service</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[Unit]
Description=uWSGI service unit
After=syslog.target

[Service]
PIDFile=/run/%I.pid
RemainAfterExit=yes
ExecStart=/usr/bin/uwsgi --ini /etc/uwsgi/%I.ini
ExecReload=/bin/kill -HUP $MAINPID
ExecStop=/bin/kill -INT $MAINPID
Restart=always
StandardError=syslog
KillSignal=SIGQUIT

[Install]
WantedBy=multi-user.target
</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> PID file will be created within <code>/run</code> rather than <code>/srv/http/run</code>
</div>
<p>After modification make sure to <a href="../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Reload">reload</a> to incorporate the new or changed units.
</p>
<p>You are then free to <a href="../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Enable">enable</a> and <a href="../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Start">start</a> <code>uwsgi@application1.service</code>. 
</p>
<p>Edit <code>/srv/http/etc/nginx/nginx.conf</code> and add new <code>server</code> section within it that would contain at least following:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/srv/http/etc/nginx/nginx.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">...
    server
    {
        listen       80;
        server_name  127.0.0.1;
        location /
        {
            root   /www/application1;
            include uwsgi_params;
            uwsgi_pass unix:/run/application1.sock;
        }

        error_page   500 502 503 504  /50x.html;
        location = /50x.html
        {
            root   /usr/share/nginx/html;
        }
    }
...
</pre>
<p>Make sure to now <a href="../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Restart">restart</a> <code>nginx.service</code> to have your <code>application1</code> be served at <code>127.0.0.1</code>.
</p>
<h2><span class="mw-headline" id="Running_uWSGI">Running uWSGI</span></h2>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> This assumes the used web application has been properly configured, is being served by your web server, which redirects towards the socket or port it is using and was configured in <code>/etc/uwsgi/</code>. For simplicity, the configuration file names should contain only alphanumeric characters and <code>_</code> to avoid problems with escaping, see <span class="plainlinks archwiki-template-man" title="$ man 5 systemd.unit"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/systemd.unit.5#STRING_ESCAPING_FOR_INCLUSION_IN_UNIT_NAMES">systemd.unit(5) § STRING ESCAPING FOR INCLUSION IN UNIT NAMES</a></span>.</div>
<p>If you plan on using a web application all the time (without it being activated on demand), you can simply <a href="../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Start">start</a> and <a href="../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Enable">enable</a> <code>uwsgi@example</code>.
</p>
<p>If you plan on having your web application be started on demand you can <a href="../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Start">start</a> and <a href="../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Enable">enable</a> <code>uwsgi@example.socket</code>.
</p>
<p>To use the Emperor mode, <a href="../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Start">start</a> and <a href="../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Enable">enable</a> <code>emperor.uwsgi.service</code>.
</p>
<p>To use socket activation of this mode <a href="../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Start">start</a> and <a href="../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Enable">enable</a> <code>emperor.uwsgi.socket</code>.
</p>
<h2><span class="mw-headline" id="Tips_and_tricks">Tips and tricks</span></h2>
<p>Some functionality, that uWSGI offers is not accessible by using the <a href="../en/Systemd.html" title="Systemd">systemd</a> service files provided in the <a href="../en/Official_repositories.html" title="Official repositories">official repositories</a>.
Changes to them are explained in the following sections. For further information see <a rel="nofollow" class="external autonumber" href="https://sleepmap.de/2016/securely-serving-webapps-using-uwsgi/">[2]</a>.
</p>
<h3><span class="mw-headline" id="Socket_activation">Socket activation</span></h3>
<p>Using socket activation, you want to
</p>
<ul>
<li>direct your web server to a unix socket and thereby start your uWSGI instance running the application</li>
<li>you most likely want to have the application be closed by uWSGI after a certain idle time</li>
<li>you want your web server be able to start the application again, once it is accessed</li>
</ul>
<p>uWSGI offers settings, with which you can have the instance close the application:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/uwsgi/example.ini</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[uwsgi]
# ...

# set idle time in seconds
idle = 600
# kill the application after idle time was reached
die-on-idle = true

# ...
</pre>
<p>The current <code>uwsgi@.service</code> file however does not allow this, because <a href="../en/Systemd.html" title="Systemd">systemd</a> treats non-zero exit codes as failure and thereby marking the unit as failed and additionally the <code>Restart=always</code> directive makes a closing after idle time useless.
A fix for this is to add the exit codes, that uWSGI may provide after closing an application by itself to a list, that <a href="../en/Systemd.html" title="Systemd">systemd</a> will treat as success by using the <code>SuccessExitStatus</code> directive (for further information see <a rel="nofollow" class="external autonumber" href="https://sleepmap.de/2016/securely-serving-webapps-using-uwsgi/">[3]</a>).
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/systemd/system/uwsgi-socket@.service</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[Unit]
Description=uWSGI service unit
After=syslog.target

[Service]
ExecStart=/usr/bin/uwsgi --ini /etc/uwsgi/%I.ini
ExecReload=/bin/kill -HUP $MAINPID
ExecStop=/bin/kill -INT $MAINPID
Type=notify
SuccessExitStatus=15 17 29 30
StandardError=syslog
NotifyAccess=all
KillSignal=SIGQUIT

[Install]
WantedBy=multi-user.target
</pre>
<p>This will allow for proper socket activation with kill-after-idle functionality.
</p>
<h3><span class="mw-headline" id="Hardening_uWSGI_service">Hardening uWSGI service</span></h3>
<p>Web applications are exposed to the wild and depending on their quality and the security of their underlying languages, some are more dangerous to run, than others.
A good way to start dealing with possible unsafe web applications is to jail them. <a href="../en/Systemd.html" title="Systemd">systemd</a> has some functionality, that can be put to use.
Have a look at the following example (and for further information see <span class="plainlinks archwiki-template-man" title="$ man 5 systemd.exec"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/systemd.exec.5">systemd.exec(5)</a></span> and <a rel="nofollow" class="external autonumber" href="https://sleepmap.de/2016/securely-serving-webapps-using-uwsgi/">[4]</a>):
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/systemd/system/uwsgi-secure@.service</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[Unit]
Description=uWSGI service unit
After=syslog.target

[Service]
ExecStart=/usr/bin/uwsgi --ini /etc/uwsgi/%I.ini
ExecReload=/bin/kill -HUP $MAINPID
ExecStop=/bin/kill -INT $MAINPID
Type=notify
SuccessExitStatus=15 17 29 30
StandardError=syslog
NotifyAccess=all
KillSignal=SIGQUIT
PrivateDevices=yes
PrivateTmp=yes
ProtectSystem=full
ReadWritePaths=/etc/webapps /var/lib/
ProtectHome=yes
NoNewPrivileges=yes

[Install]
WantedBy=multi-user.target
</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> 
<ul>
<li>Using <code>NoNewPrivileges=yes</code> does not work with <a href="../en/Mailman.html" title="Mailman">Mailman</a>'s cgi frontend! Remove this setting, if you want to use it in conjunction with it.</li>
<li>If you want further hardening, the use of namespaces is advisable. You can get a first glance on that topic in the <a rel="nofollow" class="external text" href="https://uwsgi-docs.readthedocs.io/en/latest/Namespaces.html">uWSGI namespaces documentation</a>.</li>
</ul>
</div>
<h3><span class="mw-headline" id="Accessibility_of_uWSGI_socket">Accessibility of uWSGI socket</span></h3>
<p>The default (per application) socket unit (<code>uwsgi@.socket</code>) in <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=uwsgi">uwsgi</a></span> allows read and write access to any user on the system.
However, systemd allows for a more finely granulated access management (see <span class="plainlinks archwiki-template-man" title="$ man 5 systemd.socket"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/systemd.socket.5">systemd.socket(5)</a></span>), with which the access to a unix socket can be made more restrictive.
</p>
<p>By creating it below a webapp specific directory below <code>/run</code> (needs to be created using <a href="../en/Systemd.html#systemd-tmpfiles_-_temporary_files" class="mw-redirect" title="Tmpfiles">tmpfiles</a> beforehand - for reference see <a href="../en/Web_application_package_guidelines.html" title="Web application package guidelines">Web application package guidelines</a>) and modifying its <a href="../en/Group.html" title="Group">group</a> and file <a href="../en/File_permissions_and_attributes.html" class="mw-redirect" title="Permissions">permissions</a>, the socket is only accessible to <a href="../en/Root.html" title="Root">root</a> and the <a href="../en/List_of_applications/Internet.html#Web_servers" class="mw-redirect" title="Web server">web server</a> and allows the web application to run as its own user:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/systemd/system/uwsgi-secure@.socket</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[Unit]
Description=Socket for uWSGI %I

[Socket]
ListenStream=/run/%I/%I.sock
SocketGroup=http
SocketMode=0660

[Install]
WantedBy=sockets.target
</pre>
<h2><span class="mw-headline" id="Troubleshooting">Troubleshooting</span></h2>
<h3><span class="mw-headline" id="Apache_httpd">Apache httpd</span></h3>
<h4>
<span id="AH00957:_uwsgi:_attempt_to_connect_to_127.0.0.1:0_.28.2A.29_failed"></span><span class="mw-headline" id="AH00957:_uwsgi:_attempt_to_connect_to_127.0.0.1:0_(*)_failed">AH00957: uwsgi: attempt to connect to 127.0.0.1:0 (*) failed</span>
</h4>
<p>The default uWSGI port (3031) does not work (currently?) with Apache httpd server. See <a rel="nofollow" class="external autonumber" href="https://github.com/unbit/uwsgi/issues/1491">[5]</a> for details.
</p>
<h2><span class="mw-headline" id="See_also">See also</span></h2>
<ul>
<li><a rel="nofollow" class="external text" href="https://uwsgi-docs.readthedocs.org/en/latest">Official Documentation</a></li>
<li><a rel="nofollow" class="external text" href="https://github.com/unbit/uwsgi-docs">uWSGI Github</a></li>
<li><a rel="nofollow" class="external text" href="https://sleepmap.de/2016/securely-serving-webapps-using-uwsgi/">Securely serving webapps using uWSGI</a></li>
<li><a rel="nofollow" class="external text" href="https://blog.kgriffs.com/">Fluffy White Stuff Benchmark</a></li>
<li><a rel="nofollow" class="external text" href="http://flask.pocoo.org/docs/deploying/uwsgi/">Flask uWSGI deploying</a></li>
<li><a rel="nofollow" class="external text" href="https://docs.djangoproject.com/en/dev/howto/deployment/wsgi/uwsgi/">Django and uWSGI</a></li>
<li><a rel="nofollow" class="external text" href="https://uwsgi-docs.readthedocs.org/en/latest/Apache.html">Apache and uWSGI</a></li>
</ul>
</div>
</div>
					<div id="catlinks" class="catlinks" data-mw="interface"><div id="mw-normal-catlinks" class="mw-normal-catlinks">
<a href="../Special:Categories.html" title="Special:Categories">Category</a>: <ul><li><a href="../en/Category:Web_server.html" title="Category:Web server">Web server</a></li></ul>
</div></div>
				</div>
			</main>
			
		</div>
		<div class="mw-footer-container">
			
<footer id="footer" class="mw-footer" role="contentinfo" style="margin: 0">
	<ul id="footer-info">
	<li data-nosnippet="">Retrieved from "<a dir="ltr" href="https://wiki.archlinux.org/index.php?title=UWSGI&amp;oldid=721001">https://wiki.archlinux.org/index.php?title=UWSGI&amp;oldid=721001</a>"</li>
<li id="footer-info-lastmod"> This page was last edited on 3 March 2022, at 09:25.</li>
	<li id="footer-info-copyright">Content is available under <a class="external" rel="nofollow" href="https://www.gnu.org/copyleft/fdl.html">GNU Free Documentation License 1.3 or later</a> unless otherwise noted.</li>
<br>
</ul>

	<ul id="footer-places">
	<li id="footer-places-privacy"><a href="https://terms.archlinux.org/docs/privacy-policy/">Privacy policy</a></li>
	<li id="footer-places-about"><a href="../en/ArchWiki:About.html">About ArchWiki</a></li>
	<li id="footer-places-disclaimer"><a href="../en/ArchWiki:General_disclaimer.html">Disclaimers</a></li>
</ul>

	
</footer>

		</div>
	</div> 
</div> 

</body>
</html>
