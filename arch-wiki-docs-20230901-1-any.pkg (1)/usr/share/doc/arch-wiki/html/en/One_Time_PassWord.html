<!DOCTYPE html>
<html class="client-nojs" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<title>One Time PassWord - ArchWiki</title>
<link rel="stylesheet" href="../ArchWikiOffline.css">
<meta name="ResourceLoaderDynamicStyles" content="">
<meta name="generator" content="MediaWiki 1.39.4">
<meta name="referrer" content="no-referrer-when-downgrade">
<meta name="format-detection" content="telephone=no">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes, minimum-scale=0.25, maximum-scale=5.0">
<link rel="icon" href="/favicon.ico">
<link rel="search" type="application/opensearchdescription+xml" href="/opensearch_desc.php" title="ArchWiki (en)">
<link rel="EditURI" type="application/rsd+xml" href="https://wiki.archlinux.org/api.php?action=rsd">
<link rel="license" href="https://www.gnu.org/copyleft/fdl.html">
<link rel="alternate" type="application/atom+xml" title="ArchWiki Atom feed" href="/index.php?title=Special:RecentChanges&amp;feed=atom">
</head>
<body class="skin-vector skin-vector-search-vue mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-One_Time_PassWord rootpage-One_Time_PassWord skin-vector-2022 action-view skin--responsive vector-feature-language-in-header-enabled vector-feature-language-in-main-page-header-disabled vector-feature-language-alert-in-sidebar-disabled vector-feature-sticky-header-disabled vector-feature-sticky-header-edit-disabled vector-feature-table-of-contents-disabled vector-feature-visual-enhancement-next-disabled">
<div class="mw-page-container">
	<span id="top-page"></span>
	<a class="mw-jump-link" href="#content">Jump to content</a>
	<div class="mw-page-container-inner">
		<input type="checkbox" id="mw-sidebar-checkbox" class="mw-checkbox-hack-checkbox">
		<div class="vector-sidebar-container ">
			</div>
		<div class="vector-sitenotice-container">
			<div id="siteNotice"></div>
		</div>
		<input type="checkbox" id="vector-toc-collapsed-checkbox" class="mw-checkbox-hack-checkbox">
		<div class="mw-table-of-contents-container">
			<div class="vector-sticky-toc-container mw-sticky-header-element">
				<nav id="mw-panel-toc" class="sidebar-toc" role="navigation" aria-labelledby="sidebar-toc-label" data-event-name="ui.sidebar-toc">
	<div id="sidebar-toc-label" class="sidebar-toc-header">
		<p class="sidebar-toc-title">
		Contents
		<button class="vector-toc-uncollapse-button">move to sidebar</button>
		<button class="vector-toc-collapse-button">hide</button>
		</p>
	</div>
	<ul class="sidebar-toc-contents" id="mw-panel-toc-list">
		<li id="toc-mw-content-text" class="sidebar-toc-list-item sidebar-toc-level-1">
			<a href="#top-page" class="sidebar-toc-link">
				<div class="sidebar-toc-text">Beginning</div>
			</a>
		</li>
		<li id="toc-Installation" class="sidebar-toc-list-item sidebar-toc-level-1 sidebar-toc-list-item-expanded">
			<a class="sidebar-toc-link" href="#Installation">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">1</span>Installation</div>
			</a>
			
			<ul id="toc-Installation-sublist" class="sidebar-toc-list">
			</ul>
		</li>
		<li id="toc-Configuration_for_SSH_logins" class="sidebar-toc-list-item sidebar-toc-level-1 sidebar-toc-list-item-expanded">
			<a class="sidebar-toc-link" href="#Configuration_for_SSH_logins">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">2</span>Configuration for SSH logins</div>
			</a>
			
				<button aria-controls="toc-Configuration_for_SSH_logins-sublist" class="mw-ui-icon mw-ui-icon-wikimedia-expand mw-ui-icon-small sidebar-toc-toggle">
					Toggle Configuration for SSH logins subsection
				</button>
			
			<ul id="toc-Configuration_for_SSH_logins-sublist" class="sidebar-toc-list">
				<li id="toc-PAM_configuration" class="sidebar-toc-list-item sidebar-toc-level-2">
			<a class="sidebar-toc-link" href="#PAM_configuration">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">2.1</span>PAM configuration</div>
			</a>
			
			<ul id="toc-PAM_configuration-sublist" class="sidebar-toc-list">
			</ul>
		</li>
		<li id="toc-sshd_configuration" class="sidebar-toc-list-item sidebar-toc-level-2">
			<a class="sidebar-toc-link" href="#sshd_configuration">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">2.2</span>sshd configuration</div>
			</a>
			
			<ul id="toc-sshd_configuration-sublist" class="sidebar-toc-list">
			</ul>
		</li>
		<li id="toc-OTPW_configuration" class="sidebar-toc-list-item sidebar-toc-level-2">
			<a class="sidebar-toc-link" href="#OTPW_configuration">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">2.3</span>OTPW configuration</div>
			</a>
			
			<ul id="toc-OTPW_configuration-sublist" class="sidebar-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id="toc-Usage" class="sidebar-toc-list-item sidebar-toc-level-1 sidebar-toc-list-item-expanded">
			<a class="sidebar-toc-link" href="#Usage">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">3</span>Usage</div>
			</a>
			
			<ul id="toc-Usage-sublist" class="sidebar-toc-list">
			</ul>
		</li>
	</ul>
</nav>

			</div>
		</div>
		<div class="mw-content-container">
			<main id="content" class="mw-body" role="main" style="margin: 0">
				<a id="top"></a>
				<nav class="vector-article-toolbar" aria-label="Tools" role="navigation">
					<div class="mw-article-toolbar-container">
						<div id="left-navigation">
							

<div id="p-associated-pages" class="vector-menu mw-portlet mw-portlet-associated-pages vector-menu-tabs">
	<div class="vector-menu-content">
		
		<ul class="vector-menu-content-list">
<li id="ca-nstab-main" class="selected mw-list-item"><a href="../en/One_Time_PassWord.html" title="View the content page [c]" accesskey="c"><span>Page</span></a></li>
<li id="ca-talk" class="new mw-list-item"><a href="/index.php?title=Talk:One_Time_PassWord&amp;action=edit&amp;redlink=1" rel="discussion" title="Discussion about the content page (page does not exist) [t]" accesskey="t"><span>Discussion</span></a></li>
</ul>
		
	</div>
</div>

							

<div id="p-variants" class="vector-menu mw-portlet mw-portlet-variants emptyPortlet vector-menu-dropdown">
	<input type="checkbox" id="p-variants-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-p-variants" class="vector-menu-checkbox" aria-label="Change language variant">
	<label id="p-variants-label" for="p-variants-checkbox" class="vector-menu-heading ">
		<span class="vector-menu-heading-label">English</span>
	</label>
	<div class="vector-menu-content">
		
		<ul class="vector-menu-content-list"></ul>
		
	</div>
</div>

						</div>
						<div id="right-navigation" class="vector-collapsible ">
							

<div id="p-views" class="vector-menu mw-portlet mw-portlet-views vector-menu-tabs">
	<div class="vector-menu-content">
		
		<ul class="vector-menu-content-list">
<li id="ca-view" class="selected mw-list-item"><a href="../en/One_Time_PassWord.html"><span>Read</span></a></li>
<li id="ca-viewsource" class="mw-list-item"><a href="/index.php?title=One_Time_PassWord&amp;action=edit" title="This page is protected.
You can view its source [e]" accesskey="e"><span>View source</span></a></li>
<li id="ca-history" class="mw-list-item"><a href="/index.php?title=One_Time_PassWord&amp;action=history" title="Past revisions of this page [h]" accesskey="h"><span>View history</span></a></li>
</ul>
		
	</div>
</div>

							

<div id="p-cactions" class="vector-menu mw-portlet mw-portlet-cactions emptyPortlet vector-menu-dropdown vector-has-collapsible-items" title="More options">
	<input type="checkbox" id="p-cactions-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-p-cactions" class="vector-menu-checkbox">
	<label id="p-cactions-label" for="p-cactions-checkbox" class="vector-menu-heading ">
		<span class="vector-menu-heading-label">More</span>
	</label>
	<div class="vector-menu-content">
		
		<ul class="vector-menu-content-list">
<li id="ca-more-view" class="selected vector-more-collapsible-item mw-list-item"><a href="../en/One_Time_PassWord.html"><span>Read</span></a></li>
<li id="ca-more-viewsource" class="vector-more-collapsible-item mw-list-item"><a href="/index.php?title=One_Time_PassWord&amp;action=edit"><span>View source</span></a></li>
<li id="ca-more-history" class="vector-more-collapsible-item mw-list-item"><a href="/index.php?title=One_Time_PassWord&amp;action=history"><span>View history</span></a></li>
</ul>
		
	</div>
</div>

						</div>
					</div>
				</nav>
				<div id="bodyContent" class="vector-body" data-mw-ve-target-container>
					<div class="mw-body-subheader">
					        <div class="mw-indicators">
        </div>

					    <div id="siteSub" class="noprint">From ArchWiki</div>
					</div>
					
					
					
					<div id="mw-content-text" class="mw-body-content mw-content-ltr" lang="en" dir="ltr">
<div class="mw-parser-output">
<div class="archwiki-template-meta-related-articles-start">
<p class="mw-no-invert">Related articles</p>
<ul>
<li><a href="../en/Secure_Shell.html" title="Secure Shell">Secure Shell</a></li>
<li><a href="../en/Pam_abl.html" title="Pam abl">Pam abl</a></li>
<li><a href="../en/Google_Authenticator.html" title="Google Authenticator">Google Authenticator</a></li>
</ul>
</div>
<p><b>One Time PassWord</b> (<b>OTPW</b>) is a <a href="../en/PAM.html" title="PAM">PAM</a> module allowing single-use passwords to login to a system. This is especially useful in the context of <a href="../en/Secure_Shell.html" title="Secure Shell">Secure Shell</a>, allowing a user to login from a public or shared computer using a single-use password which will never work again.
</p>
<p>Instructions for installing OTPW and configuring SSH to allow OTPW logins are below.
</p>
<mw:tocplace></mw:tocplace>
<h2><span class="mw-headline" id="Installation">Installation</span></h2>
<p>Install the <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/otpw/">otpw</a></span><sup><small>AUR</small></sup> package.
</p>
<h2><span class="mw-headline" id="Configuration_for_SSH_logins">Configuration for SSH logins</span></h2>
<h3><span class="mw-headline" id="PAM_configuration">PAM configuration</span></h3>
<p>Create a PAM configuration file for otpw:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/pam.d/ssh-otpw</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">auth sufficient pam_otpw.so
session optional pam_otpw.so
</pre>
<p>Next, modify sshd's PAM configuration to include otpw. If you are disabling static password auth, comment out the 2nd bold line. Here is the modified <code>/etc/pam.d/sshd</code> for reference:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/pam.d/sshd</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">#%PAM-1.0
#auth     required  pam_securetty.so     #disable remote root

<b>auth      include   ssh-otpw</b>
<b>#auth      include   system-remote-login #NOTE: This must be disabled to completely disable password logins.</b>
account   include   system-remote-login
password  include   system-remote-login
session   include   system-remote-login
</pre>
<h3><span class="mw-headline" id="sshd_configuration">sshd configuration</span></h3>
<p>OTPW uses Keyboard-Interactive logins for SSH sessions, which are enabled by adding these lines:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/ssh/sshd_config</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">UsePAM yes
KbdInteractiveAuthentication yes
</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> Make sure not to add redundant or conflicting configuration lines to <code>/etc/ssh/sshd_config</code>! For instance, make sure there are not two UsePAM lines, etc.</div>
<p>If you wish to allow static password logins as well, ensure <code>/etc/ssh/sshd_config</code> contains a line like this:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/ssh/sshd_config</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">PasswordAuthentication yes</pre>
<p>Otherwise, set it to <b>no</b>. See the above info on editing <code>/etc/pam.d/sshd</code> to fully disable static password auth, as PAM will otherwise allow a static password if OTPW fails (e.g. when a user runs out of passwords). 
</p>
<p>If you allow password authentication, then after failing one authentication method, ssh clients will fall back to the other. Note that by default, ssh allows you three attempts at a password per login method.
</p>
<h3><span class="mw-headline" id="OTPW_configuration">OTPW configuration</span></h3>
<p>OTPW is configured independently for each user account. If a given account does not have OTPW configured, that account will simply use a static password as usual. To configure OTPW for an account, run as that user:
</p>
<pre>$ otpw-gen &gt; ~/otpw_passwords
</pre>
<p><code>otpw-gen</code> will ask for a password prefix, which must be typed at the beginning of all otpw passwords. This is to ensure that if someone else gets your OTPW list, they cannot use it to login to your account without knowing your prefix.
</p>
<p>After running the above command, there should be a file in the user's home directory called <code>otpw_passwords</code> which contains all of the user's OTPW passwords. There will also be a file <code>~/.otpw</code> which contains the password hashes. <code>otpw_passwords</code> can be printed and referenced when logging in.
</p>
<h2><span class="mw-headline" id="Usage">Usage</span></h2>
<p>After completing the configuration above, ssh should use OTPW automatically for users who have it configured. An OTPW login prompt looks like so:
</p>
<pre>Password 041:
</pre>
<p>To log in, simply look up password 41 in your <code>otpw_passwords</code> list, for example:
</p>
<pre>041 lYr0 g7QR
</pre>
<p>And type in your prefix followed by both halves of the password. The space is provided for readability and may or may not be included in the typed password. Do not enter a space between the prefix and the single-use password.
</p>
<p>To specify to the ssh client which login method you would like to use, add <code>-o PreferredAuthentication=keyboard-interactive</code> to use OTPW, or <code>-o PreferredAuthentication=password</code> for static passwords. These options can also be specified in <code>~/.ssh/config</code> per-server.
</p>
<p>To prevent someone from shoulder-surfing your OTPW and quickly using it to login to your account before you login, OTPW requires a concurrent login to enter three passwords instead of just one. This will usually not be an issue, but if OTPW should give a prompt like this:
</p>
<pre>Password 072/251/152:
</pre>
<p>Then simply enter your prefix, and the three requested passwords in the order they are requested in. When a login is initiated, OTPW creates a file <code>~/.otpw.lock</code> to detect concurrent logins. If a second login is initiated when this file exists, OTPW will request the three passwords.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> Due to a <a rel="nofollow" class="external text" href="https://bugzilla.mindrot.org/show_bug.cgi?id=632">bug</a> in the way OpenSSH calls PAM, the <code>~/.otpw.lock</code> file will not be deleted if the user cancels an SSH login using <code>Ctrl+c</code> or the like, and OTPW will always ask for triple passwords after this. The bug is marked as fixed, but it still affects me. As a workaround, one may simply delete the lock file manually, and OTPW will resume normal single-password requests.</div>
</div>
</div>
					<div id="catlinks" class="catlinks" data-mw="interface"><div id="mw-normal-catlinks" class="mw-normal-catlinks">
<a href="../Special:Categories.html" title="Special:Categories">Category</a>: <ul><li><a href="../en/Category:Secure_Shell.html" title="Category:Secure Shell">Secure Shell</a></li></ul>
</div></div>
				</div>
			</main>
			
		</div>
		<div class="mw-footer-container">
			
<footer id="footer" class="mw-footer" role="contentinfo" style="margin: 0">
	<ul id="footer-info">
	<li data-nosnippet="">Retrieved from "<a dir="ltr" href="https://wiki.archlinux.org/index.php?title=One_Time_PassWord&amp;oldid=744003">https://wiki.archlinux.org/index.php?title=One_Time_PassWord&amp;oldid=744003</a>"</li>
<li id="footer-info-lastmod"> This page was last edited on 31 August 2022, at 00:06.</li>
	<li id="footer-info-copyright">Content is available under <a class="external" rel="nofollow" href="https://www.gnu.org/copyleft/fdl.html">GNU Free Documentation License 1.3 or later</a> unless otherwise noted.</li>
<br>
</ul>

	<ul id="footer-places">
	<li id="footer-places-privacy"><a href="https://terms.archlinux.org/docs/privacy-policy/">Privacy policy</a></li>
	<li id="footer-places-about"><a href="../en/ArchWiki:About.html">About ArchWiki</a></li>
	<li id="footer-places-disclaimer"><a href="../en/ArchWiki:General_disclaimer.html">Disclaimers</a></li>
</ul>

	
</footer>

		</div>
	</div> 
</div> 

</body>
</html>
