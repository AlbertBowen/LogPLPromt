<!DOCTYPE html>
<html class="client-nojs" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<title>NVIDIA/Tips and tricks - ArchWiki</title>
<link rel="stylesheet" href="../../ArchWikiOffline.css">
<meta name="ResourceLoaderDynamicStyles" content="">
<meta name="generator" content="MediaWiki 1.39.4">
<meta name="referrer" content="no-referrer-when-downgrade">
<meta name="format-detection" content="telephone=no">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes, minimum-scale=0.25, maximum-scale=5.0">
<link rel="icon" href="/favicon.ico">
<link rel="search" type="application/opensearchdescription+xml" href="/opensearch_desc.php" title="ArchWiki (en)">
<link rel="EditURI" type="application/rsd+xml" href="https://wiki.archlinux.org/api.php?action=rsd">
<link rel="license" href="https://www.gnu.org/copyleft/fdl.html">
<link rel="alternate" type="application/atom+xml" title="ArchWiki Atom feed" href="/index.php?title=Special:RecentChanges&amp;feed=atom">
</head>
<body class="skin-vector skin-vector-search-vue mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-NVIDIA_Tips_and_tricks rootpage-NVIDIA skin-vector-2022 action-view skin--responsive vector-feature-language-in-header-enabled vector-feature-language-in-main-page-header-disabled vector-feature-language-alert-in-sidebar-disabled vector-feature-sticky-header-disabled vector-feature-sticky-header-edit-disabled vector-feature-table-of-contents-disabled vector-feature-visual-enhancement-next-disabled">
<div class="mw-page-container">
	<span id="top-page"></span>
	<a class="mw-jump-link" href="#content">Jump to content</a>
	<div class="mw-page-container-inner">
		<input type="checkbox" id="mw-sidebar-checkbox" class="mw-checkbox-hack-checkbox">
		<div class="vector-sidebar-container ">
			</div>
		<div class="vector-sitenotice-container">
			<div id="siteNotice"></div>
		</div>
		<input type="checkbox" id="vector-toc-collapsed-checkbox" class="mw-checkbox-hack-checkbox">
		<div class="mw-table-of-contents-container">
			<div class="vector-sticky-toc-container mw-sticky-header-element">
				<nav id="mw-panel-toc" class="sidebar-toc" role="navigation" aria-labelledby="sidebar-toc-label" data-event-name="ui.sidebar-toc">
	<div id="sidebar-toc-label" class="sidebar-toc-header">
		<p class="sidebar-toc-title">
		Contents
		<button class="vector-toc-uncollapse-button">move to sidebar</button>
		<button class="vector-toc-collapse-button">hide</button>
		</p>
	</div>
	<ul class="sidebar-toc-contents" id="mw-panel-toc-list">
		<li id="toc-mw-content-text" class="sidebar-toc-list-item sidebar-toc-level-1">
			<a href="#top-page" class="sidebar-toc-link">
				<div class="sidebar-toc-text">Beginning</div>
			</a>
		</li>
		<li id="toc-Fixing_terminal_resolution" class="sidebar-toc-list-item sidebar-toc-level-1">
			<a class="sidebar-toc-link" href="#Fixing_terminal_resolution">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">1</span>Fixing terminal resolution</div>
			</a>
			
			<ul id="toc-Fixing_terminal_resolution-sublist" class="sidebar-toc-list">
			</ul>
		</li>
		<li id="toc-Using_TV-out" class="sidebar-toc-list-item sidebar-toc-level-1">
			<a class="sidebar-toc-link" href="#Using_TV-out">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">2</span>Using TV-out</div>
			</a>
			
			<ul id="toc-Using_TV-out-sublist" class="sidebar-toc-list">
			</ul>
		</li>
		<li id="toc-X_with_a_TV_(DFP)_as_the_only_display" class="sidebar-toc-list-item sidebar-toc-level-1">
			<a class="sidebar-toc-link" href="#X_with_a_TV_(DFP)_as_the_only_display">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">3</span>X with a TV (DFP) as the only display</div>
			</a>
			
			<ul id="toc-X_with_a_TV_(DFP)_as_the_only_display-sublist" class="sidebar-toc-list">
			</ul>
		</li>
		<li id="toc-Headless_(no_monitor)_resolution" class="sidebar-toc-list-item sidebar-toc-level-1">
			<a class="sidebar-toc-link" href="#Headless_(no_monitor)_resolution">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">4</span>Headless (no monitor) resolution</div>
			</a>
			
			<ul id="toc-Headless_(no_monitor)_resolution-sublist" class="sidebar-toc-list">
			</ul>
		</li>
		<li id="toc-Check_the_power_source" class="sidebar-toc-list-item sidebar-toc-level-1">
			<a class="sidebar-toc-link" href="#Check_the_power_source">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">5</span>Check the power source</div>
			</a>
			
			<ul id="toc-Check_the_power_source-sublist" class="sidebar-toc-list">
			</ul>
		</li>
		<li id="toc-Listening_to_ACPI_events" class="sidebar-toc-list-item sidebar-toc-level-1">
			<a class="sidebar-toc-link" href="#Listening_to_ACPI_events">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">6</span>Listening to ACPI events</div>
			</a>
			
			<ul id="toc-Listening_to_ACPI_events-sublist" class="sidebar-toc-list">
			</ul>
		</li>
		<li id="toc-Displaying_GPU_temperature_in_the_shell" class="sidebar-toc-list-item sidebar-toc-level-1">
			<a class="sidebar-toc-link" href="#Displaying_GPU_temperature_in_the_shell">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">7</span>Displaying GPU temperature in the shell</div>
			</a>
			
				<button aria-controls="toc-Displaying_GPU_temperature_in_the_shell-sublist" class="mw-ui-icon mw-ui-icon-wikimedia-expand mw-ui-icon-small sidebar-toc-toggle">
					Toggle Displaying GPU temperature in the shell subsection
				</button>
			
			<ul id="toc-Displaying_GPU_temperature_in_the_shell-sublist" class="sidebar-toc-list">
				<li id="toc-nvidia-settings" class="sidebar-toc-list-item sidebar-toc-level-2">
			<a class="sidebar-toc-link" href="#nvidia-settings">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">7.1</span>nvidia-settings</div>
			</a>
			
			<ul id="toc-nvidia-settings-sublist" class="sidebar-toc-list">
			</ul>
		</li>
		<li id="toc-nvidia-smi" class="sidebar-toc-list-item sidebar-toc-level-2">
			<a class="sidebar-toc-link" href="#nvidia-smi">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">7.2</span>nvidia-smi</div>
			</a>
			
			<ul id="toc-nvidia-smi-sublist" class="sidebar-toc-list">
			</ul>
		</li>
		<li id="toc-nvclock" class="sidebar-toc-list-item sidebar-toc-level-2">
			<a class="sidebar-toc-link" href="#nvclock">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">7.3</span>nvclock</div>
			</a>
			
			<ul id="toc-nvclock-sublist" class="sidebar-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id="toc-Overclocking_and_cooling" class="sidebar-toc-list-item sidebar-toc-level-1">
			<a class="sidebar-toc-link" href="#Overclocking_and_cooling">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">8</span>Overclocking and cooling</div>
			</a>
			
				<button aria-controls="toc-Overclocking_and_cooling-sublist" class="mw-ui-icon mw-ui-icon-wikimedia-expand mw-ui-icon-small sidebar-toc-toggle">
					Toggle Overclocking and cooling subsection
				</button>
			
			<ul id="toc-Overclocking_and_cooling-sublist" class="sidebar-toc-list">
				<li id="toc-Enabling_overclocking" class="sidebar-toc-list-item sidebar-toc-level-2">
			<a class="sidebar-toc-link" href="#Enabling_overclocking">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">8.1</span>Enabling overclocking</div>
			</a>
			
			<ul id="toc-Enabling_overclocking-sublist" class="sidebar-toc-list">
				<li id="toc-Setting_static_2D/3D_clocks" class="sidebar-toc-list-item sidebar-toc-level-3">
			<a class="sidebar-toc-link" href="#Setting_static_2D/3D_clocks">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">8.1.1</span>Setting static 2D/3D clocks</div>
			</a>
			
			<ul id="toc-Setting_static_2D/3D_clocks-sublist" class="sidebar-toc-list">
			</ul>
		</li>
		<li id="toc-Allow_change_to_highest_performance_mode" class="sidebar-toc-list-item sidebar-toc-level-3">
			<a class="sidebar-toc-link" href="#Allow_change_to_highest_performance_mode">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">8.1.2</span>Allow change to highest performance mode</div>
			</a>
			
			<ul id="toc-Allow_change_to_highest_performance_mode-sublist" class="sidebar-toc-list">
			</ul>
		</li>
		<li id="toc-Saving_overclocking_settings" class="sidebar-toc-list-item sidebar-toc-level-3">
			<a class="sidebar-toc-link" href="#Saving_overclocking_settings">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">8.1.3</span>Saving overclocking settings</div>
			</a>
			
			<ul id="toc-Saving_overclocking_settings-sublist" class="sidebar-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id="toc-Custom_TDP_Limit" class="sidebar-toc-list-item sidebar-toc-level-2">
			<a class="sidebar-toc-link" href="#Custom_TDP_Limit">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">8.2</span>Custom TDP Limit</div>
			</a>
			
			<ul id="toc-Custom_TDP_Limit-sublist" class="sidebar-toc-list">
			</ul>
		</li>
		<li id="toc-Set_fan_speed_at_login" class="sidebar-toc-list-item sidebar-toc-level-2">
			<a class="sidebar-toc-link" href="#Set_fan_speed_at_login">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">8.3</span>Set fan speed at login</div>
			</a>
			
			<ul id="toc-Set_fan_speed_at_login-sublist" class="sidebar-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id="toc-Kernel_module_parameters" class="sidebar-toc-list-item sidebar-toc-level-1">
			<a class="sidebar-toc-link" href="#Kernel_module_parameters">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">9</span>Kernel module parameters</div>
			</a>
			
			<ul id="toc-Kernel_module_parameters-sublist" class="sidebar-toc-list">
			</ul>
		</li>
		<li id="toc-Preserve_video_memory_after_suspend" class="sidebar-toc-list-item sidebar-toc-level-1">
			<a class="sidebar-toc-link" href="#Preserve_video_memory_after_suspend">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">10</span>Preserve video memory after suspend</div>
			</a>
			
			<ul id="toc-Preserve_video_memory_after_suspend-sublist" class="sidebar-toc-list">
			</ul>
		</li>
		<li id="toc-Driver_persistence" class="sidebar-toc-list-item sidebar-toc-level-1">
			<a class="sidebar-toc-link" href="#Driver_persistence">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">11</span>Driver persistence</div>
			</a>
			
			<ul id="toc-Driver_persistence-sublist" class="sidebar-toc-list">
			</ul>
		</li>
	</ul>
</nav>

			</div>
		</div>
		<div class="mw-content-container">
			<main id="content" class="mw-body" role="main" style="margin: 0">
				<a id="top"></a>
				<nav class="vector-article-toolbar" aria-label="Tools" role="navigation">
					<div class="mw-article-toolbar-container">
						<div id="left-navigation">
							

<div id="p-associated-pages" class="vector-menu mw-portlet mw-portlet-associated-pages vector-menu-tabs">
	<div class="vector-menu-content">
		
		<ul class="vector-menu-content-list">
<li id="ca-nstab-main" class="selected mw-list-item"><a href="../../en/NVIDIA/Tips_and_tricks.html" title="View the content page [c]" accesskey="c"><span>Page</span></a></li>
<li id="ca-talk" class="mw-list-item"><a href="../../en/Talk:NVIDIA/Tips_and_tricks.html" rel="discussion" title="Discussion about the content page [t]" accesskey="t"><span>Discussion</span></a></li>
</ul>
		
	</div>
</div>

							

<div id="p-variants" class="vector-menu mw-portlet mw-portlet-variants emptyPortlet vector-menu-dropdown">
	<input type="checkbox" id="p-variants-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-p-variants" class="vector-menu-checkbox" aria-label="Change language variant">
	<label id="p-variants-label" for="p-variants-checkbox" class="vector-menu-heading ">
		<span class="vector-menu-heading-label">English</span>
	</label>
	<div class="vector-menu-content">
		
		<ul class="vector-menu-content-list"></ul>
		
	</div>
</div>

						</div>
						<div id="right-navigation" class="vector-collapsible ">
							

<div id="p-views" class="vector-menu mw-portlet mw-portlet-views vector-menu-tabs">
	<div class="vector-menu-content">
		
		<ul class="vector-menu-content-list">
<li id="ca-view" class="selected mw-list-item"><a href="../../en/NVIDIA/Tips_and_tricks.html"><span>Read</span></a></li>
<li id="ca-viewsource" class="mw-list-item"><a href="/index.php?title=NVIDIA/Tips_and_tricks&amp;action=edit" title="This page is protected.
You can view its source [e]" accesskey="e"><span>View source</span></a></li>
<li id="ca-history" class="mw-list-item"><a href="/index.php?title=NVIDIA/Tips_and_tricks&amp;action=history" title="Past revisions of this page [h]" accesskey="h"><span>View history</span></a></li>
</ul>
		
	</div>
</div>

							

<div id="p-cactions" class="vector-menu mw-portlet mw-portlet-cactions emptyPortlet vector-menu-dropdown vector-has-collapsible-items" title="More options">
	<input type="checkbox" id="p-cactions-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-p-cactions" class="vector-menu-checkbox">
	<label id="p-cactions-label" for="p-cactions-checkbox" class="vector-menu-heading ">
		<span class="vector-menu-heading-label">More</span>
	</label>
	<div class="vector-menu-content">
		
		<ul class="vector-menu-content-list">
<li id="ca-more-view" class="selected vector-more-collapsible-item mw-list-item"><a href="../../en/NVIDIA/Tips_and_tricks.html"><span>Read</span></a></li>
<li id="ca-more-viewsource" class="vector-more-collapsible-item mw-list-item"><a href="/index.php?title=NVIDIA/Tips_and_tricks&amp;action=edit"><span>View source</span></a></li>
<li id="ca-more-history" class="vector-more-collapsible-item mw-list-item"><a href="/index.php?title=NVIDIA/Tips_and_tricks&amp;action=history"><span>View history</span></a></li>
</ul>
		
	</div>
</div>

						</div>
					</div>
				</nav>
				<div id="bodyContent" class="vector-body" data-mw-ve-target-container>
					<div class="mw-body-subheader">
					        <div class="mw-indicators">
        </div>

					    <div id="siteSub" class="noprint">From ArchWiki</div>
					</div>
					<div id="contentSub"><span class="subpages">&lt; <a href="../../en/NVIDIA.html" title="NVIDIA">NVIDIA</a></span></div>
					
					
					<div id="mw-content-text" class="mw-body-content mw-content-ltr" lang="en" dir="ltr">
<div class="mw-parser-output">
<mw:tocplace></mw:tocplace>
<h2><span class="mw-headline" id="Fixing_terminal_resolution">Fixing terminal resolution</span></h2>
<p>Transitioning from nouveau may cause your startup terminal to display at a lower resolution.
</p>
<p>For GRUB, see <a href="../../en/GRUB/Tips_and_tricks.html#Setting_the_framebuffer_resolution" title="GRUB/Tips and tricks">GRUB/Tips and tricks#Setting the framebuffer resolution</a> for details. <a rel="nofollow" class="external autonumber" href="https://forums.fedoraforum.org/showthread.php?t=306271">[1]</a> <a rel="nofollow" class="external autonumber" href="https://web.archive.org/web/20170405115954/https://www.reddit.com/r/archlinux/comments/4gwukx/nvidia_drivers_and_high_resolution_tty_possible/">[2]</a>
</p>
<p>For <a href="../../en/Systemd-boot.html" title="Systemd-boot">systemd-boot</a>, set <code>console-mode</code> in <code><i>esp</i>/EFI/loader/loader.conf</code>. See <a href="../../en/Systemd-boot.html#Loader_configuration" title="Systemd-boot">systemd-boot#Loader configuration</a> for details.
</p>
<p>For <a href="../../en/REFInd.html" title="REFInd">rEFInd</a>, add to <code><i>esp</i>/EFI/refind/refind.conf</code> and <code>/etc/refind.d/refind.conf</code> (latter file is optional but recommended): <a rel="nofollow" class="external autonumber" href="https://www.reddit.com/r/archlinux/comments/86lqc5/tty_resolution_nvidia_psaish/">[3]</a>
</p>
<pre>use_graphics_for linux
</pre>
<p>A small caveat is that this will hide the kernel parameters from being shown during boot.
</p>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip:</strong> If the above methods do not fix your terminal resolution, it may be necessary to disable Legacy BIOS mode entirely (often referred to as Compatibility Support Module, CSM, or Legacy Boot) in your UEFI settings. Before proceeding, make sure that all of your devices are configured to use UEFI boot.</div>
<h2><span class="mw-headline" id="Using_TV-out">Using TV-out</span></h2>
<p>See <a href="https://en.wikibooks.org/wiki/NVIDIA/TV-OUT" class="extiw" title="wikibooks:NVIDIA/TV-OUT">Wikibooks:NVIDIA/TV-OUT</a>.
</p>
<h2>
<span id="X_with_a_TV_.28DFP.29_as_the_only_display"></span><span class="mw-headline" id="X_with_a_TV_(DFP)_as_the_only_display">X with a TV (DFP) as the only display</span>
</h2>
<p>The X server falls back to CRT-0 if no monitor is automatically detected. This can be a problem when using a DVI connected TV as the main display, and X is started while the TV is turned off or otherwise disconnected.
</p>
<p>To force NVIDIA to use DFP, store a copy of the EDID somewhere in the filesystem so that X can parse the file instead of reading EDID from the TV/DFP.
</p>
<p>To acquire the EDID, start nvidia-settings. It will show some information in tree format, ignore the rest of the settings for now and select the GPU (the corresponding entry should be titled "GPU-0" or similar), click the <code>DFP</code> section (again, <code>DFP-0</code> or similar), click on the <code>Acquire Edid</code> Button and store it somewhere, for example, <code>/etc/X11/dfp0.edid</code>.
</p>
<p>If in the front-end mouse and keyboard are not attached, the EDID can be acquired using only the command line. Run an X server with enough verbosity to print out the EDID block:
</p>
<pre>$ startx -- -logverbose 6
</pre>
<p>After the X Server has finished initializing, close it and your log file will probably be in <code>/var/log/Xorg.0.log</code>. Extract the EDID block using nvidia-xconfig:
</p>
<pre>$ nvidia-xconfig --extract-edids-from-file=/var/log/Xorg.0.log --extract-edids-output-file=/etc/X11/dfp0.bin
</pre>
<p>Edit <code>xorg.conf</code> by adding to the <code>Device</code> section:
</p>
<pre>Option "ConnectedMonitor" "DFP"
Option "CustomEDID" "DFP-0:/etc/X11/dfp0.bin"
</pre>
<p>The <code>ConnectedMonitor</code> option forces the driver to recognize the DFP as if it were connected. The <code>CustomEDID</code> provides EDID data for the device, meaning that it will start up just as if the TV/DFP was connected during X the process.
</p>
<p>This way, one can automatically start a display manager at boot time and still have a working and properly configured X screen by the time the TV gets powered on.
</p>
<p>If the above changes did not work, in the <code>xorg.conf</code> under <code>Device</code> section you can try to remove the <code>Option "ConnectedMonitor" "DFP"</code> and add the following lines:
</p>
<pre>Option "ModeValidation" "NoDFPNativeResolutionCheck"
Option "ConnectedMonitor" "DFP-0"
</pre>
<p>The <code>NoDFPNativeResolutionCheck</code> prevents NVIDIA driver from disabling all the modes that do not fit in the native resolution.
</p>
<h2>
<span id="Headless_.28no_monitor.29_resolution"></span><span class="mw-headline" id="Headless_(no_monitor)_resolution">Headless (no monitor) resolution</span>
</h2>
<p>In headless mode, resolution falls back to 640x480, which is used by VNC or Steam Link. To start in a higher resolution <i>e.g.</i> 1920x1080, specify a <code>Virtual</code> entry under the <code>Screen</code> subsection in <code>xorg.conf</code>:
</p>
<pre>Section "Screen"
   [...]
   SubSection     "Display"
       Depth       24
       Virtual     1920 1080
   EndSubSection
EndSection
</pre>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip:</strong> Using headless mode may be tricky and prone to error. For instance, in headless mode, desktop environments and <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=nvidia-utils">nvidia-utils</a></span> do not provide a graphical way to change resolution. To facilitate setting up resolution one can use a DP or an HDMI dummy adapter which simulates the presence of a monitor attached to that port. Then resolution change can be done normally using a remote session such as VNC or Steam Link.</div>
<h2><span class="mw-headline" id="Check_the_power_source">Check the power source</span></h2>
<p>The NVIDIA X.org driver can also be used to detect the GPU's current source of power. To see the current power source, check the 'GPUPowerSource' read-only parameter (0 - AC, 1 - battery):
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">$ nvidia-settings -q GPUPowerSource -t</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">1</pre>
<h2><span class="mw-headline" id="Listening_to_ACPI_events">Listening to ACPI events</span></h2>
<p>NVIDIA drivers automatically try to connect to the <a href="../../en/Acpid.html" title="Acpid">acpid</a> daemon and listen to ACPI events such as battery power, docking, some hotkeys, etc. If connection fails, X.org will output the following warning:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">~/.local/share/xorg/Xorg.0.log</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">NVIDIA(0): ACPI: failed to connect to the ACPI event daemon; the daemon
NVIDIA(0):     may not be running or the "AcpidSocketPath" X
NVIDIA(0):     configuration option may not be set correctly.  When the
NVIDIA(0):     ACPI event daemon is available, the NVIDIA X driver will
NVIDIA(0):     try to use it to receive ACPI event notifications.  For
NVIDIA(0):     details, please see the "ConnectToAcpid" and
NVIDIA(0):     "AcpidSocketPath" X configuration options in Appendix B: X
NVIDIA(0):     Config Options in the README.
</pre>
<p>While completely harmless, you may get rid of this message by disabling the <code>ConnectToAcpid</code> option in your <code>/etc/X11/xorg.conf.d/20-nvidia.conf</code>:
</p>
<pre>Section "Device"
  ...
  Driver "nvidia"
  Option "ConnectToAcpid" "0"
  ...
EndSection
</pre>
<p>If you are on laptop, it might be a good idea to install and enable the <a href="../../en/Acpid.html" title="Acpid">acpid</a> daemon instead.
</p>
<h2><span class="mw-headline" id="Displaying_GPU_temperature_in_the_shell">Displaying GPU temperature in the shell</span></h2>
<p>There are three methods to query the GPU temperature. <i>nvidia-settings</i> requires that you are using X, <i>nvidia-smi</i> or <i>nvclock</i> do not. Also note that <i>nvclock</i> currently does not work with newer NVIDIA cards such as GeForce 200 series cards as well as embedded GPUs such as the Zotac IONITX's 8800GS.
</p>
<h3><span class="mw-headline" id="nvidia-settings">nvidia-settings</span></h3>
<p>To display the GPU temp in the shell, use <i>nvidia-settings</i> as follows:
</p>
<pre>$ nvidia-settings -q gpucoretemp
</pre>
<p>This will output something similar to the following:
</p>
<pre>Attribute 'GPUCoreTemp' (hostname:0.0): 41.
'GPUCoreTemp' is an integer attribute.
'GPUCoreTemp' is a read-only attribute.
'GPUCoreTemp' can use the following target types: X Screen, GPU.
</pre>
<p>The GPU temps of this board is 41 C.
</p>
<p>In order to get just the temperature for use in utilities such as <i>rrdtool</i> or <i>conky</i>:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">$ nvidia-settings -q gpucoretemp -t</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">41</pre>
<h3><span class="mw-headline" id="nvidia-smi">nvidia-smi</span></h3>
<p>Use <i>nvidia-smi</i> which can read temps directly from the GPU without the need to use X at all, e.g. when running Wayland or on a headless server. 
To display the GPU temperature in the shell, use <i>nvidia-smi</i> as follows:
</p>
<pre>$ nvidia-smi
</pre>
<p>This should output something similar to the following:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">$ nvidia-smi</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">Fri Jan  6 18:53:54 2012       
+------------------------------------------------------+                       
| NVIDIA-SMI 2.290.10   Driver Version: 290.10         |                       
|-------------------------------+----------------------+----------------------+
| Nb.  Name                     | Bus Id        Disp.  | Volatile ECC SB / DB |
| Fan   Temp   Power Usage /Cap | Memory Usage         | GPU Util. Compute M. |
|===============================+======================+======================|
| 0.  GeForce 8500 GT           | 0000:01:00.0  N/A    |       N/A        N/A |
|  30%   62 C  N/A   N/A /  N/A |  17%   42MB /  255MB |  N/A      Default    |
|-------------------------------+----------------------+----------------------|
| Compute processes:                                               GPU Memory |
|  GPU  PID     Process name                                       Usage      |
|=============================================================================|
|  0.           ERROR: Not Supported                                          |
+-----------------------------------------------------------------------------+
</pre>
<p>Only for temperature:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">$ nvidia-smi -q -d TEMPERATURE</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">

====NVSMI LOG====

Timestamp                           : Sun Apr 12 08:49:10 2015
Driver Version                      : 346.59

Attached GPUs                       : 1
GPU 0000:01:00.0
    Temperature
        GPU Current Temp            : 52 C
        GPU Shutdown Temp           : N/A
        GPU Slowdown Temp           : N/A

</pre>
<p>In order to get just the temperature for use in utilities such as <i>rrdtool</i> or <i>conky</i>:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">$ nvidia-smi --query-gpu=temperature.gpu --format=csv,noheader,nounits</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">52</pre>
<p>Reference: <a rel="nofollow" class="external free" href="https://www.question-defense.com/2010/03/22/gpu-linux-shell-temp-get-nvidia-gpu-temperatures-via-linux-cli">https://www.question-defense.com/2010/03/22/gpu-linux-shell-temp-get-nvidia-gpu-temperatures-via-linux-cli</a><sup title="Last check status: domain name not resolved">[<a href="https://en.wikipedia.org/wiki/Wikipedia:Link_rot" class="extiw" title="wikipedia:Wikipedia:Link rot">dead link</a> 2023-05-07 ⓘ]</sup>.
</p>
<h3><span class="mw-headline" id="nvclock">nvclock</span></h3>
<p><a href="../../en/Help:Reading.html#Installation_of_packages" class="mw-redirect" title="Install">Install</a> the <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/nvclock/">nvclock</a></span><sup><small>AUR</small></sup> package.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> <i>nvclock</i> cannot access thermal sensors on newer NVIDIA cards such as Geforce 200 series cards.</div>
<p>There can be significant differences between the temperatures reported by <i>nvclock</i> and <i>nvidia-settings</i>/<i>nv-control</i>. According to <a rel="nofollow" class="external text" href="https://sourceforge.net/projects/nvclock/forums/forum/67426/topic/1906899">this post</a> by the author (thunderbird) of <i>nvclock</i>, the <i>nvclock</i> values should be more accurate.
</p>
<h2><span class="mw-headline" id="Overclocking_and_cooling">Overclocking and cooling</span></h2>
<h3><span class="mw-headline" id="Enabling_overclocking">Enabling overclocking</span></h3>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Warning:</strong> Overclocking might permanently damage your hardware. You have been warned.</div>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> 
<ul>
<li>Overclocking settings cannot be applied if the Xorg server is running in rootless mode. Consider <a href="../../en/Xorg.html#Xorg_as_Root" title="Xorg">running Xorg as root</a>.</li>
<li>Enabling DRM kernel mode setting may cause overclocking to become unavailable, regardless of the Coolbits value.</li>
</ul>
</div>
<p>Overclocking is controlled via <i>Coolbits</i> option in the <code>Device</code> section, which enables various unsupported features:
</p>
<pre>Option "Coolbits" "<i>value</i>"
</pre>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip:</strong> The <i>Coolbits</i> option can be easily controlled with the <i>nvidia-xconfig</i>, which manipulates the Xorg configuration files: <pre># nvidia-xconfig --cool-bits=<i>value</i></pre>
</div>
<p>The <i>Coolbits</i> value is the sum of its component bits in the binary numeral system. The component bits are:
</p>
<ul>
<li>
<code>1</code> (bit 0) - Enables overclocking of older (pre-Fermi) cores on the <i>Clock Frequencies</i> page in <i>nvidia-settings</i>.</li>
<li>
<code>2</code> (bit 1) - When this bit is set, the driver will "attempt to initialize SLI when using GPUs with different amounts of video memory".</li>
<li>
<code>4</code> (bit 2) - Enables manual configuration of GPU fan speed on the <i>Thermal Monitor</i> page in <i>nvidia-settings</i>.</li>
<li>
<code>8</code> (bit 3) - Enables overclocking on the <i>PowerMizer</i> page in <i>nvidia-settings</i>. Available since version 337.12 for the Fermi architecture and newer.<a rel="nofollow" class="external autonumber" href="https://www.phoronix.com/scan.php?px=MTY1OTM&amp;page=news_item">[4]</a>
</li>
<li>
<code>16</code> (bit 4) - Enables overvoltage using <i>nvidia-settings</i> CLI options. Available since version 346.16 for the Fermi architecture and newer.<a rel="nofollow" class="external autonumber" href="https://www.phoronix.com/scan.php?page=news_item&amp;px=MTg0MDI">[5]</a>
</li>
</ul>
<p>To enable multiple features, add the <i>Coolbits</i> values together. For example, to enable overclocking and overvoltage of Fermi cores, set <code>Option "Coolbits" "24"</code>.
</p>
<p>The documentation of <i>Coolbits</i> can be found in <code>/usr/share/doc/nvidia/html/xconfigoptions.html</code> and <a rel="nofollow" class="external text" href="https://download.nvidia.com/XFree86/Linux-x86_64/430.14/README/xconfigoptions.html#Coolbits">here</a>.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> An alternative is to edit and reflash the GPU BIOS either under DOS (preferred), or within a Win32 environment by way of <a rel="nofollow" class="external text" href="https://www.techpowerup.com/download/nvidia-nvflash/">nvflash</a> and <a rel="nofollow" class="external text" href="https://www.guru3d.com/files-details/nvidia-bios-editor-download-nibitor.html">NiBiTor 6.0</a>. The advantage of BIOS flashing is that not only can voltage limits be raised, but stability is generally improved over software overclocking methods such as Coolbits. <a rel="nofollow" class="external text" href="https://ivanvojtko.blogspot.sk/2014/03/how-to-overclock-geforce-460gtx-fermi.html">Fermi BIOS modification tutorial</a>
</div>
<h4>
<span id="Setting_static_2D.2F3D_clocks"></span><span class="mw-headline" id="Setting_static_2D/3D_clocks">Setting static 2D/3D clocks</span>
</h4>
<div class="noprint archwiki-template-message">
<p><a href="../../File:Tango-view-refresh-red.png" class="image"><img alt="Tango-view-refresh-red.png" src="../../File:Tango-view-refresh-red.png" decoding="async" width="48" height="48"></a><b>This article or section is out of date.</b><a href="../../File:Tango-view-refresh-red.png" class="image"><img alt="Tango-view-refresh-red.png" src="../../File:Tango-view-refresh-red.png" decoding="async" width="48" height="48"></a></p>
<div>
<b>Reason:</b> RegistryDwords gets ignored in Xorg configuration files now, please update this and add a method that works. (Discuss in <a rel="nofollow" class="external text" href="https://wiki.archlinux.org/title/Talk:NVIDIA/Tips_and_tricks">Talk:NVIDIA/Tips and tricks</a>)</div>
</div>
<p>Set the following string in the <code>Device</code> section to enable PowerMizer at its maximum performance level (VSync will not work without this line):
</p>
<pre>Option "RegistryDwords" "PerfLevelSrc=0x2222"
</pre>
<h4><span class="mw-headline" id="Allow_change_to_highest_performance_mode">Allow change to highest performance mode</span></h4>
<div class="noprint archwiki-template-message">
<p><a href="../../File:Tango-inaccurate.png" class="image"><img alt="Tango-inaccurate.png" src="../../File:Tango-inaccurate.png" decoding="async" width="48" height="48"></a><b>The factual accuracy of this article or section is disputed.</b><a href="../../File:Tango-inaccurate.png" class="image"><img alt="Tango-inaccurate.png" src="../../File:Tango-inaccurate.png" decoding="async" width="48" height="48"></a></p>
<div>
<b>Reason:</b> This section refers to the limits for <a href="https://en.wikipedia.org/wiki/Kepler_(microarchitecture)#GPU_Boost" class="extiw" title="wikipedia:Kepler (microarchitecture)">GPU boost</a>, which is unrelated to overclocking discussed above. The <code>nvidia-smi(1)</code> man page says that it is "For Tesla devices from the Kepler+ family and Maxwell-based GeForce Titan." And as far as <a href="../../User:Lahwaacz.html" title="User:Lahwaacz">Lahwaacz</a> is aware, the only GPU which supports this and does not have the default clocks equal to the maximum, is Tesla K40 <a rel="nofollow" class="external autonumber" href="https://www.nvidia.com/content/PDF/kepler/nvidia-gpu-boost-tesla-k40-06767-001-v02.pdf">[6]</a>. Since the Pascal architecture, <a rel="nofollow" class="external text" href="https://www.anandtech.com/show/10325/the-nvidia-geforce-gtx-1080-and-1070-founders-edition-review/15">Boost 3.0</a> handles automatic clocking even differently. (Discuss in <a rel="nofollow" class="external text" href="https://wiki.archlinux.org/title/Talk:NVIDIA/Tips_and_tricks">Talk:NVIDIA/Tips and tricks</a>)</div>
</div>
<p>Since changing performance mode and overclocking memory rate has little to no effect in <i>nvidia-settings</i>, try this:
</p>
<ul>
<li>Setting Coolbits to 24 or 28 and remove Powermizer RegistryDwords -&gt; Restart X</li>
<li>find out max. Clock and Memory rate. (this can be LOWER than what your gfx card reports after booting!): <pre>$ nvidia-smi -q -d SUPPORTED_CLOCKS</pre>
</li>
<li>set rates for GPU 0: <pre># nvidia-smi -i 0 -ac memratemax,clockratemax</pre>
</li>
</ul>
<p>After setting the rates the max. performance mode works in <i>nvidia-settings</i> and you can overclock graphics-clock and memory transfer rate.
</p>
<h4><span class="mw-headline" id="Saving_overclocking_settings">Saving overclocking settings</span></h4>
<p>Typically, clock and voltage offsets inserted in the <i>nvidia-settings</i> interface are not saved, being lost after a reboot.
Fortunately, there are tools that offer an interface for overclocking under the proprietary driver, able to save the user's overclocking
preferences and automatically applying them on boot. 
Some of them are:
</p>
<ul>
<li>
<span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/gwe/">gwe</a></span><sup><small>AUR</small></sup> - graphical, applies settings on desktop session start</li>
<li>
<span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/nvclock/">nvclock</a></span><sup><small>AUR</small></sup> and <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/systemd-nvclock-unit/">systemd-nvclock-unit</a></span><sup><small>AUR</small></sup> - graphical, applies settings on system boot</li>
<li>
<span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/nvoc/">nvoc</a></span><sup><small>AUR</small></sup> - text based, profiles are configuration files in <code>/etc/nvoc.d/</code>, applies settings on desktop session start</li>
</ul>
<p>Otherwise, <code>GPUGraphicsClockOffset</code> and <code>GPUMemoryTransferRateOffset</code> attributes can be set in the command-line interface of <i>nvidia-settings</i> on <a href="../../en/Autostarting.html" title="Autostarting">startup</a>. For example:
</p>
<pre>$ nvidia-settings -a "GPUGraphicsClockOffset[<i>performance_level</i>]=<i>offset</i>"
$ nvidia-settings -a "GPUMemoryTransferRateOffset[<i>performance_level</i>]=<i>offset</i>"
</pre>
<p>Where <code><i>performance_level</i></code> is the number of the highest performance level. If there are multiple GPUs on the machine, the GPU ID should be specified: <code>[gpu:<i>gpu_id</i>]GPUGraphicsClockOffset[<i>performance_level</i>]=<i>offset</i></code>.
</p>
<h3><span class="mw-headline" id="Custom_TDP_Limit">Custom TDP Limit</span></h3>
<p>Modern NVIDIA graphics cards throttle frequency to stay in their TDP and temperature limits. To increase performance it is possible to change the TDP limit, which will result in higher temperatures and higher power consumption. 
</p>
<p>For example, to set the power limit to 160.30W:
</p>
<pre># nvidia-smi -pl 160.30
</pre>
<p>To set the power limit on boot (without driver persistence):
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/systemd/system/nvidia-tdp.timer</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[Unit]
Description=Set NVIDIA power limit on boot

[Timer]
OnBootSec=5

[Install]
WantedBy=timers.target</pre>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/systemd/system/nvidia-tdp.service</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[Unit]
Description=Set NVIDIA power limit

[Service]
Type=oneshot
ExecStart=/usr/bin/nvidia-smi -pl 160.30</pre>
<p>Now <a href="../../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Enable">enable</a> the <code>nvidia-tdp.timer</code>.
</p>
<h3><span class="mw-headline" id="Set_fan_speed_at_login">Set fan speed at login</span></h3>
<div class="noprint archwiki-template-message">
<p><a href="../../File:Tango-edit-clear.png" class="image"><img alt="Tango-edit-clear.png" src="../../File:Tango-edit-clear.png" decoding="async" width="48" height="48"></a><b>This article or section needs language, wiki syntax or style improvements. See <a href="../../en/Help:Style.html" title="Help:Style">Help:Style</a> for reference.</b><a href="../../File:Tango-edit-clear.png" class="image"><img alt="Tango-edit-clear.png" src="../../File:Tango-edit-clear.png" decoding="async" width="48" height="48"></a></p>
<div>
<b>Reason:</b> Refer to <a href="#Enabling_overclocking">#Enabling overclocking</a> for description of <i>Coolbits</i>. (Discuss in <a rel="nofollow" class="external text" href="https://wiki.archlinux.org/title/Talk:NVIDIA/Tips_and_tricks">Talk:NVIDIA/Tips and tricks</a>)</div>
</div>
<p>You can adjust the fan speed on your graphics card with <i>nvidia-settings'</i> console interface. First ensure that your Xorg configuration has enabled the bit 2 in the <a href="#Enabling_overclocking">Coolbits</a> option.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> GeForce 400/500 series cards cannot currently set fan speeds at login using this method. This method only allows for the setting of fan speeds within the current X session by way of <i>nvidia-settings</i>.</div>
<p>Place the following line in your <a href="../../en/Xinit.html#xinitrc" class="mw-redirect" title="Xinitrc">xinitrc</a> file to adjust the fan when you launch Xorg. Replace <code><i>n</i></code> with the fan speed percentage you want to set.
</p>
<pre>nvidia-settings -a "[gpu:0]/GPUFanControlState=1" -a "[fan:0]/GPUTargetFanSpeed=<i>n</i>"
</pre>
<p>You can also configure a second GPU by incrementing the GPU and fan number.
</p>
<pre>nvidia-settings -a "[gpu:0]/GPUFanControlState=1" -a "[fan:0]/GPUTargetFanSpeed=<i>n</i>" \
                -a "[gpu:1]/GPUFanControlState=1" -a  [fan:1]/GPUTargetFanSpeed=<i>n</i>" &amp;
</pre>
<p>If you use a login manager such as <a href="../../en/GDM.html" title="GDM">GDM</a> or <a href="../../en/SDDM.html" title="SDDM">SDDM</a>, you can create a desktop entry file to process this setting. Create <code>~/.config/autostart/nvidia-fan-speed.desktop</code> and place this text inside it. Again, change <code><i>n</i></code> to the speed percentage you want.
</p>
<pre>[Desktop Entry]
Type=Application
Exec=nvidia-settings -a "[gpu:0]/GPUFanControlState=1" -a "[fan:0]/GPUTargetFanSpeed=<i>n</i>"
X-GNOME-Autostart-enabled=true
Name=nvidia-fan-speed
</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> Before driver version 349.16, <code>GPUCurrentFanSpeed</code> was used instead of <code>GPUTargetFanSpeed</code>.<a rel="nofollow" class="external autonumber" href="https://devtalk.nvidia.com/default/topic/821563/linux/can-t-control-fan-speed-with-beta-driver-349-12/post/4526208/#4526208">[7]</a>
</div>
<p>To make it possible to adjust the fanspeed of more than one graphics card, run:
</p>
<pre>$ nvidia-xconfig --enable-all-gpus
$ nvidia-xconfig --cool-bits=4
</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> On some laptops (including the ThinkPad <a rel="nofollow" class="external text" href="https://devtalk.nvidia.com/default/topic/1052110/linux/can-t-control-gtx-1050-ti-max-q-fan-on-thinkpad-x1-extreme-laptop/post/5340658/#5340658">X1 Extreme</a> and <a rel="nofollow" class="external text" href="https://devtalk.nvidia.com/default/topic/1048624/linux/how-to-set-gpu-fan-speed/post/5321818/#5321818">P51/P52</a>), there are two fans, but neither are controlled by nvidia.</div>
<h2><span class="mw-headline" id="Kernel_module_parameters">Kernel module parameters</span></h2>
<div class="noprint archwiki-template-message">
<p><a href="../../File:Tango-edit-clear.png" class="image"><img alt="Tango-edit-clear.png" src="../../File:Tango-edit-clear.png" decoding="async" width="48" height="48"></a><b>This article or section needs language, wiki syntax or style improvements. See <a href="../../en/Help:Style.html" title="Help:Style">Help:Style</a> for reference.</b><a href="../../File:Tango-edit-clear.png" class="image"><img alt="Tango-edit-clear.png" src="../../File:Tango-edit-clear.png" decoding="async" width="48" height="48"></a></p>
<div>
<b>Reason:</b> Giving advanced examples without explaining what they do is pointless. (Discuss in <a rel="nofollow" class="external text" href="https://wiki.archlinux.org/title/Talk:NVIDIA/Tips_and_tricks">Talk:NVIDIA/Tips and tricks</a>)</div>
</div>
<p>Some options can be set as kernel module parameters, a full list can be obtained by running <code>modinfo nvidia</code> or looking at <code>nv-reg.h</code>. See <a href="https://wiki.gentoo.org/wiki/NVidia/nvidia-drivers#Kernel_module_parameters" class="extiw" title="gentoo:NVidia/nvidia-drivers">Gentoo:NVidia/nvidia-drivers#Kernel module parameters</a> as well.
</p>
<p>For example, enabling the following will turn on kernel mode setting (see above) and enable the PAT feature <a rel="nofollow" class="external autonumber" href="https://docs.kernel.org/arch/x86/pat.html">[8]</a>, which affects how memory is allocated. PAT was first introduced in Pentium III <a rel="nofollow" class="external autonumber" href="https://www.kernel.org/doc/ols/2008/ols2008v2-pages-135-144.pdf">[9]</a> and is supported by most newer CPUs (see <a href="https://en.wikipedia.org/wiki/Page_attribute_table#Processors" class="extiw" title="wikipedia:Page attribute table">wikipedia:Page attribute table#Processors</a>). If your system can support this feature, it should improve performance.
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/modprobe.d/nvidia.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">options nvidia-drm modeset=1 
options nvidia NVreg_UsePageAttributeTable=1</pre>
<p>On some notebooks, to enable any NVIDIA settings tweaking you must include this option, otherwise it responds with "Setting applications clocks is not supported" etc.
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/modprobe.d/nvidia.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">options nvidia NVreg_RegistryDwords="OverrideMaxPerf=0x1"</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> As per <a href="../../en/Kernel_module.html#Using_files_in_/etc/modprobe.d/" title="Kernel module">Kernel module#Using files in /etc/modprobe.d/</a>, you will need to <a href="../../en/Mkinitcpio.html#Image_creation_and_activation" class="mw-redirect" title="Regenerate the initramfs">regenerate the initramfs</a> if using <a href="../../en/NVIDIA.html#DRM_kernel_mode_setting" title="NVIDIA">early KMS</a>.</div>
<h2><span class="mw-headline" id="Preserve_video_memory_after_suspend">Preserve video memory after suspend</span></h2>
<p>By default the NVIDIA Linux drivers save and restore only essential video memory allocations on system suspend and resume. Quoting NVIDIA (<a rel="nofollow" class="external autonumber" href="https://download.nvidia.com/XFree86/Linux-x86_64/515.65.01/README/powermanagement.html">[10]</a>, also available with the <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=nvidia-utils">nvidia-utils</a></span> package in <code>/usr/share/doc/nvidia/html/powermanagement.html</code>): 
</p>
<dl><dd>The resulting loss of video memory contents is partially compensated for by the user-space NVIDIA drivers, and by some applications, but can lead to failures such as rendering corruption and application crashes upon exit from power management cycles.</dd></dl>
<p>The <b>still experimental</b> system enables saving all video memory (given enough space on disk or main RAM). The interface is through the <code>/proc/driver/nvidia/suspend</code> file as follows: 
</p>
<ul>
<li>write "suspend" (or "hibernate") to <code>/proc/driver/nvidia/suspend</code> immediately before writing to the usual Linux <code>/sys/power/state</code> file</li>
<li>write "resume" to <code>/proc/driver/nvidia/suspend</code> immediately after waking up, or after an unsuccessful attempt to suspend or hibernate.</li>
</ul>
<p>To save and restore all video memory contents, <a href="../../en/Kernel_module.html#Setting_module_options" class="mw-redirect" title="Kernel modules">load</a> the <code>nvidia</code> kernel module with the <code>NVreg_PreserveVideoMemoryAllocations=1</code> option and <a href="../../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Enable">enable</a> <code>nvidia-suspend.service</code> and <code>nvidia-hibernate.service</code>. 
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> 
<ul>
<li>The video memory contents are saved by default to <code>/tmp</code>, which is a <a href="../../en/Tmpfs.html" title="Tmpfs">tmpfs</a>. <a rel="nofollow" class="external text" href="https://download.nvidia.com/XFree86/Linux-x86_64/515.65.01/README/powermanagement.html#PreserveAllVide719f0">NVIDIA recommends</a> using an other filesystem to achieve the best performance. This is also required if the size is not sufficient for the amount of memory: point to a different location with the <code>NVreg_TemporaryFilePath</code> option, (e.g. <code>NVreg_TemporaryFilePath=/var/tmp</code>).</li>
<li>The chosen file system containing the file needs to support unnamed temporary files (e.g. ext4 or XFS) and have sufficient capacity for storing the video memory allocations (i.e. at least 5 percent more than the sum of the memory capacities of all NVIDIA GPUs). Use the command <code>nvidia-smi --query-gpu=memory.total --format=csv,noheader,nounits</code> to list the memory capacities of all GPUs in the system.</li>
</ul>
</div>
<p>To make the changes permanent, <a href="../../en/Help:Reading.html#Append,_add,_create,_edit" class="mw-redirect" title="Create">create</a> the following: 
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/modprobe.d/nvidia-power-management.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">options nvidia NVreg_PreserveVideoMemoryAllocations=1 NVreg_TemporaryFilePath=<i>/path/to/tmp-nvidia</i></pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> As per <a href="../../en/Kernel_module.html#Using_files_in_/etc/modprobe.d/" title="Kernel module">Kernel module#Using files in /etc/modprobe.d/</a>, you will need to <a href="../../en/Mkinitcpio.html#Image_creation_and_activation" class="mw-redirect" title="Regenerate the initramfs">regenerate the initramfs</a> if using <a href="../../en/NVIDIA.html#DRM_kernel_mode_setting" title="NVIDIA">early KMS</a>.</div>
<p>The interaction with <code>/proc/driver/nvidia/suspend</code> is handled by the simple Unix shell script at <code>/usr/bin/nvidia-sleep.sh</code>, which will itself be called by <a href="../../en/Systemd.html" title="Systemd">systemd</a> or other tools. The <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=nvidia-utils">nvidia-utils</a></span> package ships with the following services (which essentially just call <code>nvidia-sleep.sh</code>): <code>nvidia-suspend.service</code>, <code>nvidia-hibernate.service</code>, <code>nvidia-resume.service</code>. 
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> Contrary to NVIDIA's instructions, it is currently not necessary to enable <code>nvidia-resume.service</code> (and it is in fact probably not a good idea to enable it), because the <code>/usr/lib/systemd/system-sleep/nvidia</code> script does the same thing as the service (but slightly earlier), and it is enabled by default (systemd calls it after waking up from a suspend). Only <a href="../../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Enable">enable</a> <code>nvidia-suspend.service</code> and/or <code>nvidia-hibernate.service</code>, unless you are using <a rel="nofollow" class="external text" href="https://gitlab.gnome.org/GNOME/gdm/-/issues/784">GDM with Wayland</a> which requires <code>nvidia-resume.service</code> too.</div>
<h2><span class="mw-headline" id="Driver_persistence">Driver persistence</span></h2>
<p>NVIDIA has a daemon that can be optionally run at boot. In a standard single-GPU X desktop environment the persistence daemon is not needed and can actually create issues <a rel="nofollow" class="external autonumber" href="https://devtalk.nvidia.com/default/topic/1044421/linux/nvidia-persistenced-causing-60-second-reboot-delays">[11]</a>. See the <a rel="nofollow" class="external text" href="https://docs.nvidia.com/deploy/driver-persistence/index.html#persistence-daemon">Driver Persistence</a> section of the NVIDIA documentation for more details.
</p>
<p>To start the persistence daemon at boot, <a href="../../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Enable">enable</a> the <code>nvidia-persistenced.service</code>. For manual usage see the <a rel="nofollow" class="external text" href="https://docs.nvidia.com/deploy/driver-persistence/index.html#usage">upstream documentation</a>.
</p>
</div>
</div>
					<div id="catlinks" class="catlinks" data-mw="interface">
<div id="mw-normal-catlinks" class="mw-normal-catlinks">
<a href="../../Special:Categories.html" title="Special:Categories">Categories</a>: <ul>
<li><a href="../../en/Category:Graphics.html" title="Category:Graphics">Graphics</a></li>
<li><a href="../../en/Category:X_server.html" title="Category:X server">X server</a></li>
</ul>
</div>
<div id="mw-hidden-catlinks" class="mw-hidden-catlinks mw-hidden-cats-hidden">Hidden categories: <ul>
<li><a href="../../en/Category:Pages_with_dead_links.html" title="Category:Pages with dead links">Pages with dead links</a></li>
<li><a href="../../en/Category:Pages_or_sections_flagged_with_Template:Out_of_date.html" title="Category:Pages or sections flagged with Template:Out of date">Pages or sections flagged with Template:Out of date</a></li>
<li><a href="../../en/Category:Pages_or_sections_flagged_with_Template:Accuracy.html" title="Category:Pages or sections flagged with Template:Accuracy">Pages or sections flagged with Template:Accuracy</a></li>
<li><a href="../../en/Category:Pages_or_sections_flagged_with_Template:Style.html" title="Category:Pages or sections flagged with Template:Style">Pages or sections flagged with Template:Style</a></li>
</ul>
</div>
</div>
				</div>
			</main>
			
		</div>
		<div class="mw-footer-container">
			
<footer id="footer" class="mw-footer" role="contentinfo" style="margin: 0">
	<ul id="footer-info">
	<li data-nosnippet="">Retrieved from "<a dir="ltr" href="https://wiki.archlinux.org/index.php?title=NVIDIA/Tips_and_tricks&amp;oldid=783081">https://wiki.archlinux.org/index.php?title=NVIDIA/Tips_and_tricks&amp;oldid=783081</a>"</li>
<li id="footer-info-lastmod"> This page was last edited on 13 July 2023, at 13:43.</li>
	<li id="footer-info-copyright">Content is available under <a class="external" rel="nofollow" href="https://www.gnu.org/copyleft/fdl.html">GNU Free Documentation License 1.3 or later</a> unless otherwise noted.</li>
<br>
</ul>

	<ul id="footer-places">
	<li id="footer-places-privacy"><a href="https://terms.archlinux.org/docs/privacy-policy/">Privacy policy</a></li>
	<li id="footer-places-about"><a href="../../en/ArchWiki:About.html">About ArchWiki</a></li>
	<li id="footer-places-disclaimer"><a href="../../en/ArchWiki:General_disclaimer.html">Disclaimers</a></li>
</ul>

	
</footer>

		</div>
	</div> 
</div> 

</body>
</html>
