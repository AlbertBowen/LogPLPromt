<!DOCTYPE html>
<html class="client-nojs" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<title>Profile-sync-daemon - ArchWiki</title>
<link rel="stylesheet" href="../ArchWikiOffline.css">
<meta name="ResourceLoaderDynamicStyles" content="">
<meta name="generator" content="MediaWiki 1.39.4">
<meta name="referrer" content="no-referrer-when-downgrade">
<meta name="format-detection" content="telephone=no">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes, minimum-scale=0.25, maximum-scale=5.0">
<link rel="icon" href="/favicon.ico">
<link rel="search" type="application/opensearchdescription+xml" href="/opensearch_desc.php" title="ArchWiki (en)">
<link rel="EditURI" type="application/rsd+xml" href="https://wiki.archlinux.org/api.php?action=rsd">
<link rel="license" href="https://www.gnu.org/copyleft/fdl.html">
<link rel="alternate" type="application/atom+xml" title="ArchWiki Atom feed" href="/index.php?title=Special:RecentChanges&amp;feed=atom">
</head>
<body class="skin-vector skin-vector-search-vue mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-Profile-sync-daemon rootpage-Profile-sync-daemon skin-vector-2022 action-view skin--responsive vector-feature-language-in-header-enabled vector-feature-language-in-main-page-header-disabled vector-feature-language-alert-in-sidebar-disabled vector-feature-sticky-header-disabled vector-feature-sticky-header-edit-disabled vector-feature-table-of-contents-disabled vector-feature-visual-enhancement-next-disabled">
<div class="mw-page-container">
	<span id="top-page"></span>
	<a class="mw-jump-link" href="#content">Jump to content</a>
	<div class="mw-page-container-inner">
		<input type="checkbox" id="mw-sidebar-checkbox" class="mw-checkbox-hack-checkbox">
		<div class="vector-sidebar-container ">
			</div>
		<div class="vector-sitenotice-container">
			<div id="siteNotice"></div>
		</div>
		<input type="checkbox" id="vector-toc-collapsed-checkbox" class="mw-checkbox-hack-checkbox">
		<div class="mw-table-of-contents-container">
			<div class="vector-sticky-toc-container mw-sticky-header-element">
				<nav id="mw-panel-toc" class="sidebar-toc" role="navigation" aria-labelledby="sidebar-toc-label" data-event-name="ui.sidebar-toc">
	<div id="sidebar-toc-label" class="sidebar-toc-header">
		<p class="sidebar-toc-title">
		Contents
		<button class="vector-toc-uncollapse-button">move to sidebar</button>
		<button class="vector-toc-collapse-button">hide</button>
		</p>
	</div>
	<ul class="sidebar-toc-contents" id="mw-panel-toc-list">
		<li id="toc-mw-content-text" class="sidebar-toc-list-item sidebar-toc-level-1">
			<a href="#top-page" class="sidebar-toc-link">
				<div class="sidebar-toc-text">Beginning</div>
			</a>
		</li>
		<li id="toc-Installation" class="sidebar-toc-list-item sidebar-toc-level-1 sidebar-toc-list-item-expanded">
			<a class="sidebar-toc-link" href="#Installation">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">1</span>Installation</div>
			</a>
			
			<ul id="toc-Installation-sublist" class="sidebar-toc-list">
			</ul>
		</li>
		<li id="toc-Configuration" class="sidebar-toc-list-item sidebar-toc-level-1 sidebar-toc-list-item-expanded">
			<a class="sidebar-toc-link" href="#Configuration">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">2</span>Configuration</div>
			</a>
			
				<button aria-controls="toc-Configuration-sublist" class="mw-ui-icon mw-ui-icon-wikimedia-expand mw-ui-icon-small sidebar-toc-toggle">
					Toggle Configuration subsection
				</button>
			
			<ul id="toc-Configuration-sublist" class="sidebar-toc-list">
				<li id="toc-Supported_browsers" class="sidebar-toc-list-item sidebar-toc-level-2">
			<a class="sidebar-toc-link" href="#Supported_browsers">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">2.1</span>Supported browsers</div>
			</a>
			
			<ul id="toc-Supported_browsers-sublist" class="sidebar-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id="toc-Usage" class="sidebar-toc-list-item sidebar-toc-level-1 sidebar-toc-list-item-expanded">
			<a class="sidebar-toc-link" href="#Usage">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">3</span>Usage</div>
			</a>
			
				<button aria-controls="toc-Usage-sublist" class="mw-ui-icon mw-ui-icon-wikimedia-expand mw-ui-icon-small sidebar-toc-toggle">
					Toggle Usage subsection
				</button>
			
			<ul id="toc-Usage-sublist" class="sidebar-toc-list">
				<li id="toc-Preview_(parse)_mode" class="sidebar-toc-list-item sidebar-toc-level-2">
			<a class="sidebar-toc-link" href="#Preview_(parse)_mode">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">3.1</span>Preview (parse) mode</div>
			</a>
			
			<ul id="toc-Preview_(parse)_mode-sublist" class="sidebar-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id="toc-Tips_and_tricks" class="sidebar-toc-list-item sidebar-toc-level-1 sidebar-toc-list-item-expanded">
			<a class="sidebar-toc-link" href="#Tips_and_tricks">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">4</span>Tips and tricks</div>
			</a>
			
				<button aria-controls="toc-Tips_and_tricks-sublist" class="mw-ui-icon mw-ui-icon-wikimedia-expand mw-ui-icon-small sidebar-toc-toggle">
					Toggle Tips and tricks subsection
				</button>
			
			<ul id="toc-Tips_and_tricks-sublist" class="sidebar-toc-list">
				<li id="toc-Sync_at_more_frequent_intervals" class="sidebar-toc-list-item sidebar-toc-level-2">
			<a class="sidebar-toc-link" href="#Sync_at_more_frequent_intervals">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">4.1</span>Sync at more frequent intervals</div>
			</a>
			
			<ul id="toc-Sync_at_more_frequent_intervals-sublist" class="sidebar-toc-list">
			</ul>
		</li>
		<li id="toc-Overlayfs_mode" class="sidebar-toc-list-item sidebar-toc-level-2">
			<a class="sidebar-toc-link" href="#Overlayfs_mode">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">4.2</span>Overlayfs mode</div>
			</a>
			
			<ul id="toc-Overlayfs_mode-sublist" class="sidebar-toc-list">
			</ul>
		</li>
		<li id="toc-Allocate_more_memory_to_accommodate_profiles_in_/run/user/xxxx" class="sidebar-toc-list-item sidebar-toc-level-2">
			<a class="sidebar-toc-link" href="#Allocate_more_memory_to_accommodate_profiles_in_/run/user/xxxx">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">4.3</span>Allocate more memory to accommodate profiles in /run/user/xxxx</div>
			</a>
			
			<ul id="toc-Allocate_more_memory_to_accommodate_profiles_in_/run/user/xxxx-sublist" class="sidebar-toc-list">
			</ul>
		</li>
		<li id="toc-Snapshots" class="sidebar-toc-list-item sidebar-toc-level-2">
			<a class="sidebar-toc-link" href="#Snapshots">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">4.4</span>Snapshots</div>
			</a>
			
			<ul id="toc-Snapshots-sublist" class="sidebar-toc-list">
				<li id="toc-Clean_all_the_snapshot_with_the_clean_mode" class="sidebar-toc-list-item sidebar-toc-level-3">
			<a class="sidebar-toc-link" href="#Clean_all_the_snapshot_with_the_clean_mode">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">4.4.1</span>Clean all the snapshot with the clean mode</div>
			</a>
			
			<ul id="toc-Clean_all_the_snapshot_with_the_clean_mode-sublist" class="sidebar-toc-list">
			</ul>
		</li>
	</ul>
		</li>
	</ul>
		</li>
		<li id="toc-Support" class="sidebar-toc-list-item sidebar-toc-level-1 sidebar-toc-list-item-expanded">
			<a class="sidebar-toc-link" href="#Support">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">5</span>Support</div>
			</a>
			
			<ul id="toc-Support-sublist" class="sidebar-toc-list">
			</ul>
		</li>
		<li id="toc-See_also" class="sidebar-toc-list-item sidebar-toc-level-1 sidebar-toc-list-item-expanded">
			<a class="sidebar-toc-link" href="#See_also">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">6</span>See also</div>
			</a>
			
			<ul id="toc-See_also-sublist" class="sidebar-toc-list">
			</ul>
		</li>
	</ul>
</nav>

			</div>
		</div>
		<div class="mw-content-container">
			<main id="content" class="mw-body" role="main" style="margin: 0">
				<a id="top"></a>
				<nav class="vector-article-toolbar" aria-label="Tools" role="navigation">
					<div class="mw-article-toolbar-container">
						<div id="left-navigation">
							

<div id="p-associated-pages" class="vector-menu mw-portlet mw-portlet-associated-pages vector-menu-tabs">
	<div class="vector-menu-content">
		
		<ul class="vector-menu-content-list">
<li id="ca-nstab-main" class="selected mw-list-item"><a href="../en/Profile-sync-daemon.html" title="View the content page [c]" accesskey="c"><span>Page</span></a></li>
<li id="ca-talk" class="mw-list-item"><a href="../en/Talk:Profile-sync-daemon.html" rel="discussion" title="Discussion about the content page [t]" accesskey="t"><span>Discussion</span></a></li>
</ul>
		
	</div>
</div>

							

<div id="p-variants" class="vector-menu mw-portlet mw-portlet-variants emptyPortlet vector-menu-dropdown">
	<input type="checkbox" id="p-variants-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-p-variants" class="vector-menu-checkbox" aria-label="Change language variant">
	<label id="p-variants-label" for="p-variants-checkbox" class="vector-menu-heading ">
		<span class="vector-menu-heading-label">English</span>
	</label>
	<div class="vector-menu-content">
		
		<ul class="vector-menu-content-list"></ul>
		
	</div>
</div>

						</div>
						<div id="right-navigation" class="vector-collapsible ">
							

<div id="p-views" class="vector-menu mw-portlet mw-portlet-views vector-menu-tabs">
	<div class="vector-menu-content">
		
		<ul class="vector-menu-content-list">
<li id="ca-view" class="selected mw-list-item"><a href="../en/Profile-sync-daemon.html"><span>Read</span></a></li>
<li id="ca-viewsource" class="mw-list-item"><a href="/index.php?title=Profile-sync-daemon&amp;action=edit" title="This page is protected.
You can view its source [e]" accesskey="e"><span>View source</span></a></li>
<li id="ca-history" class="mw-list-item"><a href="/index.php?title=Profile-sync-daemon&amp;action=history" title="Past revisions of this page [h]" accesskey="h"><span>View history</span></a></li>
</ul>
		
	</div>
</div>

							

<div id="p-cactions" class="vector-menu mw-portlet mw-portlet-cactions emptyPortlet vector-menu-dropdown vector-has-collapsible-items" title="More options">
	<input type="checkbox" id="p-cactions-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-p-cactions" class="vector-menu-checkbox">
	<label id="p-cactions-label" for="p-cactions-checkbox" class="vector-menu-heading ">
		<span class="vector-menu-heading-label">More</span>
	</label>
	<div class="vector-menu-content">
		
		<ul class="vector-menu-content-list">
<li id="ca-more-view" class="selected vector-more-collapsible-item mw-list-item"><a href="../en/Profile-sync-daemon.html"><span>Read</span></a></li>
<li id="ca-more-viewsource" class="vector-more-collapsible-item mw-list-item"><a href="/index.php?title=Profile-sync-daemon&amp;action=edit"><span>View source</span></a></li>
<li id="ca-more-history" class="vector-more-collapsible-item mw-list-item"><a href="/index.php?title=Profile-sync-daemon&amp;action=history"><span>View history</span></a></li>
</ul>
		
	</div>
</div>

						</div>
					</div>
				</nav>
				<div id="bodyContent" class="vector-body" data-mw-ve-target-container>
					<div class="mw-body-subheader">
					        <div class="mw-indicators">
        </div>

					    <div id="siteSub" class="noprint">From ArchWiki</div>
					</div>
					
					
					
					<div id="mw-content-text" class="mw-body-content mw-content-ltr" lang="en" dir="ltr">
<div class="mw-parser-output">
<div class="archwiki-template-meta-related-articles-start">
<p class="mw-no-invert">Related articles</p>
<ul>
<li><a href="../en/Anything-sync-daemon.html" title="Anything-sync-daemon">Anything-sync-daemon</a></li>
<li><a href="../en/Firefox.html" title="Firefox">Firefox</a></li>
<li><a href="../en/Chromium.html" title="Chromium">Chromium</a></li>
<li><a href="../en/Pdnsd.html" title="Pdnsd">Pdnsd</a></li>
<li><a href="../en/Solid_state_drive.html" class="mw-redirect" title="SSD">SSD</a></li>
</ul>
</div>
<p><span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=profile-sync-daemon">profile-sync-daemon</a></span> (psd) is a tiny pseudo-daemon designed to manage browser profile(s) in tmpfs and to periodically sync back to the physical disc (HDD/SSD). This is accomplished by an innovative use of <a href="../en/Rsync.html" title="Rsync">rsync</a> to maintain synchronization between a tmpfs copy and media-bound backup of the browser profile(s). Additionally, psd features several crash recovery features.
</p>
<p>The design goals and benefits of psd are:
</p>
<ol>
<li>Transparent user experience</li>
<li>Reduced wear to physical drives</li>
<li>Speed</li>
</ol>
<p>Since the profile(s), browser cache, etc. are relocated into <a href="../en/Tmpfs.html" title="Tmpfs">tmpfs</a> (RAM disk), the corresponding I/O associated with using the browser is also redirected from the physical drive to RAM, thus reducing wear to the physical drive and also greatly improving browser speed and responsiveness.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> 
<ul>
<li>Some browsers such as Chrome/Chromium or Firefox (since v21) actually keep their cache directories <b>separately</b> from their profile directory. It is not within the scope of profile-sync-daemon to modify this behavior; users are encouraged to refer to the <a href="../en/Chromium.html#Cache_in_tmpfs" class="mw-redirect" title="Chromium tweaks">Chromium tweaks#Cache in tmpfs</a> section for Chromium and to the <a href="../en/Firefox/Profile_on_RAM.html" class="mw-redirect" title="Firefox on RAM">Firefox on RAM</a> article for several workarounds.</li>
<li>Occasionally, updates/changes are made to the default configuration file <code>/usr/share/psd/psd.conf</code> upstream. The user copy <code>$XDG_CONFIG_HOME/psd/psd.conf</code> will need to be diffed against it. On Arch Linux, pacman should notify the user to do this.</li>
<li>psd can slow down <a rel="nofollow" class="external text" href="https://www.reddit.com/r/archlinux/comments/4l7gvm/very_slow_when_login/d3lrx9y/">login</a>, as that is when it copies your browser cache to RAM.</li>
</ul>
</div>
<mw:tocplace></mw:tocplace>
<h2><span class="mw-headline" id="Installation">Installation</span></h2>
<p><a href="../en/Help:Reading.html#Installation_of_packages" class="mw-redirect" title="Install">Install</a> the <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=profile-sync-daemon">profile-sync-daemon</a></span> package.
</p>
<h2><span class="mw-headline" id="Configuration">Configuration</span></h2>
<p>When you run psd for the first time, it will create <code>$XDG_CONFIG_HOME/psd/psd.conf</code> (referred to hereafter as the configuration file) which contains all settings. You can run the <code>psd</code> command before using <code>psd.service</code> to create this file without starting synchronization.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> Any edits made to this file while psd is active will be applied only after <code>psd.service</code> has been <a href="../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Restart">restarted</a>.</div>
<ul>
<li>Optionally enable the use of overlayfs to improve sync speed and to use a smaller memory footprint. Do this in the <code>USE_OVERLAYFS</code> variable. The user will require sudo rights to <code>/usr/bin/psd-overlay-helper</code> to use this option and the kernel must support overlayfs version 22 or higher. See <a href="#Overlayfs_mode">#Overlayfs mode</a> for additional details.</li>
<li>Optionally define which browsers are to be managed in the <code>BROWSERS</code> array. If none are defined, the default is all detected browsers.</li>
<li>Optionally disable the use of crash-recovery snapshots (not recommended). Do this in the <code>USE_BACKUPS</code> variable.</li>
<li>Optionally define the number of crash-recovery snapshots to keep. Do this in the <code>BACKUP_LIMIT</code> variable.</li>
</ul>
<p>Example: Let us say that Chromium, Opera and Firefox are installed but only Chromium and Opera are to be sync'ed to tmpfs since the user keeps Firefox as a backup browser and it is seldom used:
</p>
<pre>BROWSERS=(chromium opera)
</pre>
<p>Beginning with version 5.54 of psd, native support for <a href="#Overlayfs_mode">overlayfs</a> is included. This feature requires at least a Linux kernel version of 3.18.0 or greater.
</p>
<h3><span class="mw-headline" id="Supported_browsers">Supported browsers</span></h3>
<p>Currently, the following browsers are auto-detected and managed:
</p>
<ul>
<li><a href="../en/Chromium.html" title="Chromium">Chromium</a></li>
<li>
<span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/chromium-dev/">chromium-dev</a></span><sup><small>AUR</small></sup>
</li>
<li>
<span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/conkeror-git/">conkeror-git</a></span><sup><small>AUR</small></sup>
</li>
<li><a href="../en/GNOME/Web.html" class="mw-redirect" title="Epiphany">Epiphany</a></li>
<li><span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=falkon">falkon</a></span></li>
<li>
<a href="../en/Firefox.html" title="Firefox">Firefox</a> (all flavors including stable, beta, and nightly)</li>
<li>
<span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/google-chrome/">google-chrome</a></span><sup><small>AUR</small></sup>
</li>
<li>
<span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/google-chrome-beta/">google-chrome-beta</a></span><sup><small>AUR</small></sup>
</li>
<li>
<span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/google-chrome-dev/">google-chrome-dev</a></span><sup><small>AUR</small></sup>
</li>
<li>
<a rel="nofollow" class="external text" href="https://bbs.archlinux.org/viewtopic.php?id=117157">heftig's version of Aurora</a>: An Arch Linux-only browser</li>
<li>
<span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/icecat/">icecat</a></span><sup><small>AUR</small></sup>
</li>
<li><a href="../en/Luakit.html" title="Luakit">Luakit</a></li>
<li><a href="../en/List_of_applications/Internet.html#Proprietary_chromium_spin-offs" class="mw-redirect" title="Opera">Opera</a></li>
<li><a href="../en/Otter_Browser.html" title="Otter Browser">Otter Browser</a></li>
<li>
<span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/palemoon/">palemoon</a></span><sup><small>AUR</small></sup>
</li>
<li><a href="../en/Qutebrowser.html" title="Qutebrowser">Qutebrowser</a></li>
<li>
<span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/seamonkey/">seamonkey</a></span><sup><small>AUR</small></sup>
</li>
<li>
<span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/surf/">surf</a></span><sup><small>AUR</small></sup>
</li>
<li><span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=vivaldi">vivaldi</a></span></li>
</ul>
<h2><span class="mw-headline" id="Usage">Usage</span></h2>
<p><a href="../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Start/enable">Start/enable</a> the <code>psd.service</code> <a href="../en/Systemd/User.html" class="mw-redirect" title="User unit">user unit</a>. Additionally, a provided resync-timer will run an hourly resync from tmpfs back to the disk. The resync-timer is started automatically with <code>psd.service</code> so there is no need to manually start the timer.
</p>
<h3>
<span id="Preview_.28parse.29_mode"></span><span class="mw-headline" id="Preview_(parse)_mode">Preview (parse) mode</span>
</h3>
<p>Run <code>psd parse</code> to view what psd will do/is doing based on <code>$XDG_CONFIG_HOME/psd/psd.conf</code>. It will also provide useful information such as profile size, paths, and if any recovery snapshots have been created.
</p>
<h2><span class="mw-headline" id="Tips_and_tricks">Tips and tricks</span></h2>
<h3><span class="mw-headline" id="Sync_at_more_frequent_intervals">Sync at more frequent intervals</span></h3>
<p>The package provided re-sync timer triggers once per hour. Users may optionally redefine this behavior simply by <a href="../en/Systemd.html#Editing_provided_units" title="Systemd">extending the systemd unit</a>. The example below changes the timer to sync once every ten minutes (note that <code>OnUnitActiveSec</code> needs to be cleared before being re-assigned <a rel="nofollow" class="external autonumber" href="https://bugzilla.redhat.com/show_bug.cgi?id=756787#c9">[1]</a>):
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">~/.config/systemd/user/psd-resync.timer.d/frequency.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[Unit]
Description=Timer for Profile-sync-daemon - 10min

[Timer]
OnUnitActiveSec=
OnUnitActiveSec=10min</pre>
<p>See <span class="plainlinks archwiki-template-man" title="$ man 5 systemd.timer"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/systemd.timer.5">systemd.timer(5)</a></span> for additional options.
</p>
<h3><span class="mw-headline" id="Overlayfs_mode">Overlayfs mode</span></h3>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> There are several versions of overlayfs available to the Linux kernel in production in various distributions. Versions 22 and lower have a module called 'overlayfs' while newer versions (23 and higher) have a module called 'overlay' -- note the lack of the 'fs' in the newer version. Psd will automatically detect the overlayfs available to your kernel if it is configured to use one of them.</div>
<p>Overlayfs is a simple union file-system mainlined in the Linux kernel version 3.18.0. Starting with psd version 5.54, overlayfs can be used to reduce the memory footprint of psd's tmpfs space and to speed up sync and unsync operations. The magic is in how the overlay mount only writes out data that has changed rather than the entire profile. The same recovery features psd uses in its default mode are also active when running in overlayfs mode. Overlayfs mode is enabled by uncommenting the <code>USE_OVERLAYFS="yes"</code> line in <code>$XDG_CONFIG_HOME/psd/psd.conf</code> followed by a <a href="../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Restart">restart</a> of the daemon.
</p>
<p>Since version 6.05 of psd, users wanting to take advantage of this mode MUST have <a href="../en/Sudo.html" title="Sudo">sudo</a> rights (without password prompt) to <code>/usr/bin/psd-overlay-helper</code> or global sudo rights. The following line in <code>/etc/sudoers</code> will supply a <a href="../en/Users_and_groups.html" class="mw-redirect" title="User">user</a> with these rights. Add it using <a href="../en/Sudo.html#Using_visudo" class="mw-redirect" title="Visudo">visudo</a>:
</p>
<pre><i>username</i> ALL=(ALL) NOPASSWD: /usr/bin/psd-overlay-helper
</pre>
<p>See the example in the PREVIEW MODE section above which shows a system using overlayfs to illustrate the memory savings that can be achieved. Note the "overlayfs size" report compared to the total "profile size" report for each profile. Be aware that these numbers will change depending on how much data is written to the profile, but in common use cases the overlayfs size will always be less than the profile size.
</p>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Warning:</strong> Usage of psd in overlayfs mode (in particular, <i>psd-overlay-helper</i>) may lead to privilege escalation. <a rel="nofollow" class="external autonumber" href="https://github.com/graysky2/profile-sync-daemon/issues/235">[2]</a>
</div>
<p>The way overlayfs works is to mount a read-only base copy (browser-back-ovfs) of the profile, and manage the new data on top of that. In order to avoid resyncing to the read-only file system, a copy is used instead. So using overlayfs is a trade off: faster initial sync times and less memory usage vs. disk space in the home dir.
</p>
<h3>
<span id="Allocate_more_memory_to_accommodate_profiles_in_.2Frun.2Fuser.2Fxxxx"></span><span class="mw-headline" id="Allocate_more_memory_to_accommodate_profiles_in_/run/user/xxxx">Allocate more memory to accommodate profiles in /run/user/xxxx</span>
</h3>
<p>The standard way of controlling the size of <code>/run/user</code> is the RuntimeDirectorySize directive in <code>/etc/systemd/logind.conf</code> (see <span class="plainlinks archwiki-template-man" title="$ man 5 logind.conf"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/logind.conf.5">logind.conf(5)</a></span> for more). By default, 10% of physical memory is used but one can increase it safely. Remember that tmpfs only consumes what is actually used; the number specified here is just a maximum allowed.
</p>
<h3><span class="mw-headline" id="Snapshots">Snapshots</span></h3>
<p>Odds are the "last good" backup of your browser profiles is just fine still sitting happily on your filesystem. Upon restarting psd (on a reboot for example), a check is performed to see if the symlink to the tmpfs copy of your profile is valid. If it is invalid, psd will snapshot the "last good" backup before it rotates it back into place. This is more for a sanity check that psd did no harm and that any data loss was a function of something else.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> Users can disable the snapshot/backup feature entirely by uncommenting and setting the <code>USE_BACKUPS</code> variable to <code>"no"</code> in <code>$XDG_CONFIG_HOME/psd/psd.conf</code> if desired.</div>
<p>You will find the snapshot in the same directory as the browser profile and it will contain a date-time-stamp that corresponds to the time at which the recovery took place. For example, chromium will be <code>~/.config/chromium-backup-crashrecovery-20130912_153310</code> -- of course, the date_time suffix will be different for you.
</p>
<p>To restore your snapshots:
</p>
<ul>
<li>
<a href="../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Stop">Stop</a> the <code>psd.service</code> <a href="../en/Systemd/User.html" class="mw-redirect" title="User unit">user unit</a>.</li>
<li>Confirm that there is no symlink to the tmpfs browser profile directory. If there is, psd did not stop correctly for other reasons.</li>
<li>Move the "bad" copy of the profile to a backup (do not blindly delete anything).</li>
<li>Copy the snapshot directory to the name that browser expects.</li>
</ul>
<p>Example using Chromium:
</p>
<pre>$ mv ~/.config/chromium ~/.config/chromium-bad
$ cp -a ~/.config/chromium-backup-crashrecovery-20130912_153310 ~/.config/chromium
</pre>
<p>At this point you can launch chromium which will use the backup snapshot you just copied into place. If all is well, close the browser and restart psd. You may safely delete <code>~/.config/chromium-backup-crashrecovery-20130912_153310</code> at this point.
</p>
<h4><span class="mw-headline" id="Clean_all_the_snapshot_with_the_clean_mode">Clean all the snapshot with the clean mode</span></h4>
<p>Running <code>psd clean</code> will delete ALL recovery snapshots that have accumulated. Run this only if you are sure that you want to delete them.
</p>
<h2><span class="mw-headline" id="Support">Support</span></h2>
<p>Post in the <a rel="nofollow" class="external text" href="https://bbs.archlinux.org/viewtopic.php?pid=1026974">discussion thread</a> with comments or concerns.
</p>
<h2><span class="mw-headline" id="See_also">See also</span></h2>
<ul>
<li><a rel="nofollow" class="external text" href="http://www.webupd8.org/2013/02/keep-your-browser-profiles-in-tmpfs-ram.html">Web Upd8 - Keep Your Browser Profiles In tmpfs (RAM) For Reduced Disk Writes And Increased Performance With Profile Sync Daemon</a></li>
<li><a rel="nofollow" class="external text" href="https://web.archive.org/web/20220516124034/http://www.bernaerts-nicolas.fr/linux/74-ubuntu/250-ubuntu-tweaks-ssd">Nicolas Bernaerts - Tweaks for SSD drive</a></li>
</ul>
</div>
</div>
					<div id="catlinks" class="catlinks" data-mw="interface"><div id="mw-normal-catlinks" class="mw-normal-catlinks">
<a href="../Special:Categories.html" title="Special:Categories">Category</a>: <ul><li><a href="../en/Category:Web_browser.html" title="Category:Web browser">Web browser</a></li></ul>
</div></div>
				</div>
			</main>
			
		</div>
		<div class="mw-footer-container">
			
<footer id="footer" class="mw-footer" role="contentinfo" style="margin: 0">
	<ul id="footer-info">
	<li data-nosnippet="">Retrieved from "<a dir="ltr" href="https://wiki.archlinux.org/index.php?title=Profile-sync-daemon&amp;oldid=785087">https://wiki.archlinux.org/index.php?title=Profile-sync-daemon&amp;oldid=785087</a>"</li>
<li id="footer-info-lastmod"> This page was last edited on 11 August 2023, at 06:14.</li>
	<li id="footer-info-copyright">Content is available under <a class="external" rel="nofollow" href="https://www.gnu.org/copyleft/fdl.html">GNU Free Documentation License 1.3 or later</a> unless otherwise noted.</li>
<br>
</ul>

	<ul id="footer-places">
	<li id="footer-places-privacy"><a href="https://terms.archlinux.org/docs/privacy-policy/">Privacy policy</a></li>
	<li id="footer-places-about"><a href="../en/ArchWiki:About.html">About ArchWiki</a></li>
	<li id="footer-places-disclaimer"><a href="../en/ArchWiki:General_disclaimer.html">Disclaimers</a></li>
</ul>

	
</footer>

		</div>
	</div> 
</div> 

</body>
</html>
