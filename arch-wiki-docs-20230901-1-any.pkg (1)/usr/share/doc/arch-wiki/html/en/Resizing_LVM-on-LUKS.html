<!DOCTYPE html>
<html class="client-nojs" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<title>Resizing LVM-on-LUKS - ArchWiki</title>
<link rel="stylesheet" href="../ArchWikiOffline.css">
<meta name="ResourceLoaderDynamicStyles" content="">
<meta name="generator" content="MediaWiki 1.39.4">
<meta name="referrer" content="no-referrer-when-downgrade">
<meta name="format-detection" content="telephone=no">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes, minimum-scale=0.25, maximum-scale=5.0">
<link rel="icon" href="/favicon.ico">
<link rel="search" type="application/opensearchdescription+xml" href="/opensearch_desc.php" title="ArchWiki (en)">
<link rel="EditURI" type="application/rsd+xml" href="https://wiki.archlinux.org/api.php?action=rsd">
<link rel="license" href="https://www.gnu.org/copyleft/fdl.html">
<link rel="alternate" type="application/atom+xml" title="ArchWiki Atom feed" href="/index.php?title=Special:RecentChanges&amp;feed=atom">
</head>
<body class="skin-vector skin-vector-search-vue mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-Resizing_LVM-on-LUKS rootpage-Resizing_LVM-on-LUKS skin-vector-2022 action-view skin--responsive vector-feature-language-in-header-enabled vector-feature-language-in-main-page-header-disabled vector-feature-language-alert-in-sidebar-disabled vector-feature-sticky-header-disabled vector-feature-sticky-header-edit-disabled vector-feature-table-of-contents-disabled vector-feature-visual-enhancement-next-disabled">
<div class="mw-page-container">
	<span id="top-page"></span>
	<a class="mw-jump-link" href="#content">Jump to content</a>
	<div class="mw-page-container-inner">
		<input type="checkbox" id="mw-sidebar-checkbox" class="mw-checkbox-hack-checkbox">
		<div class="vector-sidebar-container ">
			</div>
		<div class="vector-sitenotice-container">
			<div id="siteNotice"></div>
		</div>
		<input type="checkbox" id="vector-toc-collapsed-checkbox" class="mw-checkbox-hack-checkbox">
		<div class="mw-table-of-contents-container">
			<div class="vector-sticky-toc-container mw-sticky-header-element">
				<nav id="mw-panel-toc" class="sidebar-toc" role="navigation" aria-labelledby="sidebar-toc-label" data-event-name="ui.sidebar-toc">
	<div id="sidebar-toc-label" class="sidebar-toc-header">
		<p class="sidebar-toc-title">
		Contents
		<button class="vector-toc-uncollapse-button">move to sidebar</button>
		<button class="vector-toc-collapse-button">hide</button>
		</p>
	</div>
	<ul class="sidebar-toc-contents" id="mw-panel-toc-list">
		<li id="toc-mw-content-text" class="sidebar-toc-list-item sidebar-toc-level-1">
			<a href="#top-page" class="sidebar-toc-link">
				<div class="sidebar-toc-text">Beginning</div>
			</a>
		</li>
		<li id="toc-Method" class="sidebar-toc-list-item sidebar-toc-level-1 sidebar-toc-list-item-expanded">
			<a class="sidebar-toc-link" href="#Method">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">1</span>Method</div>
			</a>
			
			<ul id="toc-Method-sublist" class="sidebar-toc-list">
			</ul>
		</li>
		<li id="toc-Process" class="sidebar-toc-list-item sidebar-toc-level-1 sidebar-toc-list-item-expanded">
			<a class="sidebar-toc-link" href="#Process">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">2</span>Process</div>
			</a>
			
			<ul id="toc-Process-sublist" class="sidebar-toc-list">
			</ul>
		</li>
		<li id="toc-Shrink_LVM-on-LUKS" class="sidebar-toc-list-item sidebar-toc-level-1 sidebar-toc-list-item-expanded">
			<a class="sidebar-toc-link" href="#Shrink_LVM-on-LUKS">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">3</span>Shrink LVM-on-LUKS</div>
			</a>
			
				<button aria-controls="toc-Shrink_LVM-on-LUKS-sublist" class="mw-ui-icon mw-ui-icon-wikimedia-expand mw-ui-icon-small sidebar-toc-toggle">
					Toggle Shrink LVM-on-LUKS subsection
				</button>
			
			<ul id="toc-Shrink_LVM-on-LUKS-sublist" class="sidebar-toc-list">
				<li id="toc-Boot_and_setup" class="sidebar-toc-list-item sidebar-toc-level-2">
			<a class="sidebar-toc-link" href="#Boot_and_setup">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">3.1</span>Boot and setup</div>
			</a>
			
			<ul id="toc-Boot_and_setup-sublist" class="sidebar-toc-list">
			</ul>
		</li>
		<li id="toc-Resize_filesystem_and_LVM_logical_volume" class="sidebar-toc-list-item sidebar-toc-level-2">
			<a class="sidebar-toc-link" href="#Resize_filesystem_and_LVM_logical_volume">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">3.2</span>Resize filesystem and LVM logical volume</div>
			</a>
			
			<ul id="toc-Resize_filesystem_and_LVM_logical_volume-sublist" class="sidebar-toc-list">
			</ul>
		</li>
		<li id="toc-Resize_LVM_physical_Volume" class="sidebar-toc-list-item sidebar-toc-level-2">
			<a class="sidebar-toc-link" href="#Resize_LVM_physical_Volume">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">3.3</span>Resize LVM physical Volume</div>
			</a>
			
			<ul id="toc-Resize_LVM_physical_Volume-sublist" class="sidebar-toc-list">
			</ul>
		</li>
		<li id="toc-Resize_LUKS_volume" class="sidebar-toc-list-item sidebar-toc-level-2">
			<a class="sidebar-toc-link" href="#Resize_LUKS_volume">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">3.4</span>Resize LUKS volume</div>
			</a>
			
			<ul id="toc-Resize_LUKS_volume-sublist" class="sidebar-toc-list">
			</ul>
		</li>
		<li id="toc-Resize_the_partition" class="sidebar-toc-list-item sidebar-toc-level-2">
			<a class="sidebar-toc-link" href="#Resize_the_partition">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">3.5</span>Resize the partition</div>
			</a>
			
			<ul id="toc-Resize_the_partition-sublist" class="sidebar-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id="toc-Enlarge_LVM_on_LUKS" class="sidebar-toc-list-item sidebar-toc-level-1 sidebar-toc-list-item-expanded">
			<a class="sidebar-toc-link" href="#Enlarge_LVM_on_LUKS">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">4</span>Enlarge LVM on LUKS</div>
			</a>
			
				<button aria-controls="toc-Enlarge_LVM_on_LUKS-sublist" class="mw-ui-icon mw-ui-icon-wikimedia-expand mw-ui-icon-small sidebar-toc-toggle">
					Toggle Enlarge LVM on LUKS subsection
				</button>
			
			<ul id="toc-Enlarge_LVM_on_LUKS-sublist" class="sidebar-toc-list">
				<li id="toc-Preparation" class="sidebar-toc-list-item sidebar-toc-level-2">
			<a class="sidebar-toc-link" href="#Preparation">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">4.1</span>Preparation</div>
			</a>
			
			<ul id="toc-Preparation-sublist" class="sidebar-toc-list">
			</ul>
		</li>
		<li id="toc-Extending_the_physical_segments_of_the_cryptdevice" class="sidebar-toc-list-item sidebar-toc-level-2">
			<a class="sidebar-toc-link" href="#Extending_the_physical_segments_of_the_cryptdevice">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">4.2</span>Extending the physical segments of the cryptdevice</div>
			</a>
			
			<ul id="toc-Extending_the_physical_segments_of_the_cryptdevice-sublist" class="sidebar-toc-list">
			</ul>
		</li>
		<li id="toc-Resizing_the_logical_volume" class="sidebar-toc-list-item sidebar-toc-level-2">
			<a class="sidebar-toc-link" href="#Resizing_the_logical_volume">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">4.3</span>Resizing the logical volume</div>
			</a>
			
			<ul id="toc-Resizing_the_logical_volume-sublist" class="sidebar-toc-list">
			</ul>
		</li>
		<li id="toc-Resizing_the_encrypted_volume" class="sidebar-toc-list-item sidebar-toc-level-2">
			<a class="sidebar-toc-link" href="#Resizing_the_encrypted_volume">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">4.4</span>Resizing the encrypted volume</div>
			</a>
			
			<ul id="toc-Resizing_the_encrypted_volume-sublist" class="sidebar-toc-list">
			</ul>
		</li>
	</ul>
		</li>
	</ul>
</nav>

			</div>
		</div>
		<div class="mw-content-container">
			<main id="content" class="mw-body" role="main" style="margin: 0">
				<a id="top"></a>
				<nav class="vector-article-toolbar" aria-label="Tools" role="navigation">
					<div class="mw-article-toolbar-container">
						<div id="left-navigation">
							

<div id="p-associated-pages" class="vector-menu mw-portlet mw-portlet-associated-pages vector-menu-tabs">
	<div class="vector-menu-content">
		
		<ul class="vector-menu-content-list">
<li id="ca-nstab-main" class="selected mw-list-item"><a href="../en/Resizing_LVM-on-LUKS.html" title="View the content page [c]" accesskey="c"><span>Page</span></a></li>
<li id="ca-talk" class="mw-list-item"><a href="../en/Talk:Resizing_LVM-on-LUKS.html" rel="discussion" title="Discussion about the content page [t]" accesskey="t"><span>Discussion</span></a></li>
</ul>
		
	</div>
</div>

							

<div id="p-variants" class="vector-menu mw-portlet mw-portlet-variants emptyPortlet vector-menu-dropdown">
	<input type="checkbox" id="p-variants-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-p-variants" class="vector-menu-checkbox" aria-label="Change language variant">
	<label id="p-variants-label" for="p-variants-checkbox" class="vector-menu-heading ">
		<span class="vector-menu-heading-label">English</span>
	</label>
	<div class="vector-menu-content">
		
		<ul class="vector-menu-content-list"></ul>
		
	</div>
</div>

						</div>
						<div id="right-navigation" class="vector-collapsible ">
							

<div id="p-views" class="vector-menu mw-portlet mw-portlet-views vector-menu-tabs">
	<div class="vector-menu-content">
		
		<ul class="vector-menu-content-list">
<li id="ca-view" class="selected mw-list-item"><a href="../en/Resizing_LVM-on-LUKS.html"><span>Read</span></a></li>
<li id="ca-viewsource" class="mw-list-item"><a href="/index.php?title=Resizing_LVM-on-LUKS&amp;action=edit" title="This page is protected.
You can view its source [e]" accesskey="e"><span>View source</span></a></li>
<li id="ca-history" class="mw-list-item"><a href="/index.php?title=Resizing_LVM-on-LUKS&amp;action=history" title="Past revisions of this page [h]" accesskey="h"><span>View history</span></a></li>
</ul>
		
	</div>
</div>

							

<div id="p-cactions" class="vector-menu mw-portlet mw-portlet-cactions emptyPortlet vector-menu-dropdown vector-has-collapsible-items" title="More options">
	<input type="checkbox" id="p-cactions-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-p-cactions" class="vector-menu-checkbox">
	<label id="p-cactions-label" for="p-cactions-checkbox" class="vector-menu-heading ">
		<span class="vector-menu-heading-label">More</span>
	</label>
	<div class="vector-menu-content">
		
		<ul class="vector-menu-content-list">
<li id="ca-more-view" class="selected vector-more-collapsible-item mw-list-item"><a href="../en/Resizing_LVM-on-LUKS.html"><span>Read</span></a></li>
<li id="ca-more-viewsource" class="vector-more-collapsible-item mw-list-item"><a href="/index.php?title=Resizing_LVM-on-LUKS&amp;action=edit"><span>View source</span></a></li>
<li id="ca-more-history" class="vector-more-collapsible-item mw-list-item"><a href="/index.php?title=Resizing_LVM-on-LUKS&amp;action=history"><span>View history</span></a></li>
</ul>
		
	</div>
</div>

						</div>
					</div>
				</nav>
				<div id="bodyContent" class="vector-body" data-mw-ve-target-container>
					<div class="mw-body-subheader">
					        <div class="mw-indicators">
        </div>

					    <div id="siteSub" class="noprint">From ArchWiki</div>
					</div>
					
					
					
					<div id="mw-content-text" class="mw-body-content mw-content-ltr" lang="en" dir="ltr">
<div class="mw-parser-output">
<div class="noprint archwiki-template-message">
<p><a href="../File:Merge-arrows-2.png" class="image"><img alt="Merge-arrows-2.png" src="../File:Merge-arrows-2.png" decoding="async" width="48" height="48"></a><b>This article or section is a candidate for merging with <a href="../en/LVM.html#Shrink_logical_volume" title="LVM">LVM#Shrink logical volume</a>.</b><a href="../File:Merge-arrows-2.png" class="image"><img alt="Merge-arrows-2.png" src="../File:Merge-arrows-2.png" decoding="async" width="48" height="48"></a></p>
<div>
<b>Notes:</b> This howto only aggregates information from other articles (thus duplicating it) for a too specific case: if some explanations are clearer here, they should be merged into <a href="../en/LVM.html#Shrink_logical_volume" title="LVM">LVM#Shrink logical volume</a>, and then the little remaining wrapping part about dm-crypt should be merged into <a href="../en/Dm-crypt/Specialties.html" title="Dm-crypt/Specialties">Dm-crypt/Specialties</a> with a link to <a href="../en/LVM.html#Shrink_logical_volume" title="LVM">LVM#Shrink logical volume</a> for the LVM resizing. (Discuss in <a rel="nofollow" class="external text" href="https://wiki.archlinux.org/title/Talk:Resizing_LVM-on-LUKS">Talk:Resizing LVM-on-LUKS</a>)</div>
</div>
<p>This article follows the process of resizing and shrinking an LVM-on-LUKS-on-GPT partition, such that an extra (plain) partition can be added in the unused space cleared up on the end of the hard drive. You can also use <a href="../en/Parted.html" class="mw-redirect" title="GParted">GParted</a> GUI tool to resize LUKS partition, which may be easier and quicker for beginners.
</p>
<mw:tocplace></mw:tocplace>
<h2><span class="mw-headline" id="Method">Method</span></h2>
<p>We do all the resizes from the innermost partition to the outermost on, keeping 1G buffers along the way on each step. It is possible to keep smaller buffers, but that should be done carefully, especially where there are manual calculations.
</p>
<p>The filesystem we work on will have the following strucure:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;"># lsblk</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">NAME                MAJ:MIN RM   SIZE RO TYPE  MOUNTPOINT
sda                   8:0    0 111.8G  0 disk
├─sda1                8:1    0    99M  0 part  /boot
└─sda2                8:2    0 111.7G  0 part
  └─vgroup          254:0    0 111.7G  0 crypt
    ├─vgroup-lvroot 254:1    0    30G  0 lvm   /
    └─vgroup-lvhome 254:2    0  81.7G  0 lvm   /home
</pre>
<p>The goal is to clear up unused space and create a new partition, <code>sda3</code>, without any data loss. All filesystems are assumed to be <code>ext4</code>.
</p>
<p>The entire process should run from a live USB Arch system to avoid any filesystem corruption.
</p>
<h2><span class="mw-headline" id="Process">Process</span></h2>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Warning:</strong> <b>Do not</b> run any of this code by copy-pasting, you need to adapt all these commands to your specific setup.</div>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> It is highly recommended to check your work after each step by checking the filesystem, LVM, and/or LUKS volume integrity.</div>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> It is highly recommended to write out the exact transition plan so that at each step you know exactly which partition size you are going to need.</div>
<h2><span class="mw-headline" id="Shrink_LVM-on-LUKS">Shrink LVM-on-LUKS</span></h2>
<h3><span class="mw-headline" id="Boot_and_setup">Boot and setup</span></h3>
<p>Boot into your live <a href="../en/USB_flash_installation_medium.html" class="mw-redirect" title="USB flash installation media">USB flash installation media</a>.
</p>
<p>Decrypt the LUKS volume:
</p>
<pre># cryptsetup luksOpen /dev/sda2 cryptdisk
</pre>
<h3><span class="mw-headline" id="Resize_filesystem_and_LVM_logical_volume">Resize filesystem and LVM logical volume</span></h3>
<p>Follow <a href="../en/LVM.html#Resizing_the_logical_volume_and_file_system_in_one_go" title="LVM">these instructions</a>.
</p>
<p>You can run a <code>fsck</code> just to make sure nothing broke:
</p>
<pre># e2fsck -f /dev/vgroup/lvhome
</pre>
<h3><span class="mw-headline" id="Resize_LVM_physical_Volume">Resize LVM physical Volume</span></h3>
<p>To calculate the new LVM physical volume size, use a simple formula: <code>NEW_VOLUME_BYTES = PE_SIZE * PE_COUNT + UNUSABLE_SIZE</code>:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">pvdisplay /dev/mapper/cryptdisk</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">...
PV Size               950.05 GiB / not usable 4.00 MiB
...
PE Size               4.00 MiB
...
Allocated PE          116303
...
</pre>
<p>Using the formula above: <code>(116303 * 4 MiB + 4 MiB) in Bytes = 487814332416</code>.
</p>
<p>Resize the volume. This command is safe since it will exit early if the new size would not fit all the existing extents:
</p>
<pre># pvresize --setphysicalvolumesize 487814332416B /dev/mapper/cryptdisk
</pre>
<h3><span class="mw-headline" id="Resize_LUKS_volume">Resize LUKS volume</span></h3>
<p>To calculate the new LUKS volume size, use a simple formula: <code>NEW_LUKS_SECTOR_COUNT = PV_EXTENT_COUNT * PV_EXTENT_SIZE <b>IN BYTES</b> / LUKS_SECTOR_SIZE</code>
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;"># pvdisplay /dev/mapper/cryptdisk</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">...
PV Size               454.31 GiB / not usable 3.00 MiB
...
PE Size               4.00 MiB
Total PE              116303
...
</pre>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;"># cryptsetup status cryptdisk</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">...
sector size:  512
...
</pre>
<pre>(116303 extents + 1 unusable extent) * 4194304 B/extent / 512 B/sector = 952762368 sectors
</pre>
<p>Resize the LUKS volume:
</p>
<pre># cryptsetup -b $NEW_LUKS_SECTOR_COUNT resize cryptdisk
</pre>
<h3><span class="mw-headline" id="Resize_the_partition">Resize the partition</span></h3>
<p>To calculate the new partition size, use a simple formula: <code>NEW_PARTITION_SECTOR_END = PARTITION_SECTOR_START + (LUKS_SIZE_SECTORS + LUKS_OFFSET_SECTORS) - 1</code>. The <code>- 1</code> is because parted takes an inclusive sector end parameter.
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;"># cryptsetup status cryptdisk</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">...
offset:  4096 sectors
size:    952762368 sectors
</pre>
<p>Close the LUKS volume to resize offline. You will probably need to deactivate LVM volumes on the cryptdisk or it will not close.
</p>
<pre># vgchange -a n vgroup
# cryptsetup close cryptdisk
</pre>
<p>Use <code>parted</code> to resize the partition:
</p>
<pre># parted /dev/sda
 (parted) unit
 Unit?  [compact]? s
 (parted) p
 ...
  2      8003584s  2000408575s  1992404992s
</pre>
<p>Using the formula above returns: <code>8003584 + (952762368 + 4096) - 1 = 960770047</code>
</p>
<pre>(parted) resizepart 2 960770047
 Warning: Shrinking a partition can cause data loss, are you sure you want to continue?
 Yes/No? y
 (parted) q
</pre>
<p>At this point you can reopen the LUKS volume and remount partitions. You will need to manually reactive the LVM partitions since if you manually deactivated them above.
</p>
<pre># cryptsetup luksOpen /dev/sda2 cryptdisk
# vgchange -a y vgroup
</pre>
<h2><span class="mw-headline" id="Enlarge_LVM_on_LUKS">Enlarge LVM on LUKS</span></h2>
<p>Enlarging a LVM-on-LUKS logical partition, for instance after migrating to a larger hard disk, is done in the opposite way - from the outermost to the innermost partition:
</p>
<pre>primary partition(LUKS device{volume group[(logical partition1)(logical partition2--&gt;)]})
</pre>
<h3><span class="mw-headline" id="Preparation">Preparation</span></h3>
<p>Create a new partition on the new hard disk of wanted size, f.i. by using <a href="../en/Parted.html" class="mw-redirect" title="GNU Parted">GNU Parted</a>, and clone the old partition <code>sdX1</code>, containing your LUKS container, into the new partition <code>sdY1</code>:
</p>
<pre># dd if=/dev/sdX1 of=/dev/sdY1 bs=4M
</pre>
<h3><span class="mw-headline" id="Extending_the_physical_segments_of_the_cryptdevice">Extending the physical segments of the cryptdevice</span></h3>
<p>Now, open the cryptdevice <code>CryptDisk</code> on the new hard disk:
</p>
<pre># cryptsetup open /dev/sdY1 CryptDisk
</pre>
<p>Take a look at your current physical volume. In this example, we have a cryptdevice <code>CryptDisk</code> containing a volume group <code>CryptVolumeGroup</code> of two partitions <code>root</code> and <code>home</code>:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;"># pvdisplay -m</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;"> --- Physical volume ---
 PV Name               /dev/mapper/CryptDisk
 VG Name               CryptVolumeGroup
 PV Size               &lt;118.75 GiB / not usable 3.00 MiB
 Allocatable           yes (but full)
 PE Size               4.00 MiB
 Total PE              30399
 Free PE               0
 Allocated PE          30399
 PV UUID               hu0iA9-i8fv-2SC1-C6ys-LQCz-sptQ-RSOUE5

 --- Physical Segments ---
 Physical extent 0 to 6399:
   Logical volume      /dev/CryptVolumeGroup/root
   Logical extents     0 to 6399
 Physical extent 6400 to 30398:
   Logical volume      /dev/CryptVolumeGroup/home
   Logical extents     0 to 23998
</pre>
<p>By taking the total physical extents (PE) times the PE's size, we get the total size of the physical volume (PV), in this case 118.75 GiB. Although pvdisplay does not show the free extents, we can enlarge the PV to use all the available remaining space of the partition:
</p>
<pre># pvresize /dev/mapper/CryptDisk
</pre>
<p>Now we get:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;"># pvdisplay -m</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">...
 --- Physical Segments ---
 Physical extent 0 to 6399:
   Logical volume      /dev/CryptVolumeGroup/root
   Logical extents     0 to 6399
 Physical extent 6400 to 30398:
   Logical volume      /dev/CryptVolumeGroup/home
   Logical extents     0 to 23998
 Physical extent 30399 to 60922:
   FREE
</pre>
<p>Note the free extents at the end of the PV. Calculate the size difference by taking the free physical extends times PE size - in that case (60922-30399)*4 MiB = 119.2 GiB.
</p>
<h3><span class="mw-headline" id="Resizing_the_logical_volume">Resizing the logical volume</span></h3>
<p>Now we are going to resize the second logical volume (LV), in this case containing the /home partition, by the size of the free physical extents minus some safety space:
</p>
<pre># lvresize -L +119G /dev/CryptVolumeGroup/home
</pre>
<p>Note the new size of the second logical volume. Calculate its total size by taking the total logical extends time the PE size - in that case 53438 * 4 MiB = 208.7 GiB:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;"># pvdisplay -m</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">...
 --- Physical Segments ---
 Physical extent 0 to 6399:
   Logical volume      /dev/CryptVolumeGroup/root
   Logical extents     0 to 6399
 Physical extent 6400 to 59838:
   Logical volume      /dev/CryptVolumeGroup/home
   Logical extents     0 to 53438
 Physical extent 59839 to 60922:
   FREE
</pre>
<h3><span class="mw-headline" id="Resizing_the_encrypted_volume">Resizing the encrypted volume</span></h3>
<p>Now we are going to resize the encrypted volume itself. By taking in account the total size of the logical volume minus some safety space:
</p>
<pre># resize2fs -p /dev/CryptVolumeGroup/Home 208G
</pre>
<p>Execute e2fsck, if asked. That's it.
</p>
</div>
</div>
					<div id="catlinks" class="catlinks" data-mw="interface">
<div id="mw-normal-catlinks" class="mw-normal-catlinks">
<a href="../Special:Categories.html" title="Special:Categories">Category</a>: <ul><li><a href="../en/Category:Storage_virtualization.html" title="Category:Storage virtualization">Storage virtualization</a></li></ul>
</div>
<div id="mw-hidden-catlinks" class="mw-hidden-catlinks mw-hidden-cats-hidden">Hidden category: <ul><li><a href="../en/Category:Pages_or_sections_flagged_with_Template:Merge.html" title="Category:Pages or sections flagged with Template:Merge">Pages or sections flagged with Template:Merge</a></li></ul>
</div>
</div>
				</div>
			</main>
			
		</div>
		<div class="mw-footer-container">
			
<footer id="footer" class="mw-footer" role="contentinfo" style="margin: 0">
	<ul id="footer-info">
	<li data-nosnippet="">Retrieved from "<a dir="ltr" href="https://wiki.archlinux.org/index.php?title=Resizing_LVM-on-LUKS&amp;oldid=734648">https://wiki.archlinux.org/index.php?title=Resizing_LVM-on-LUKS&amp;oldid=734648</a>"</li>
<li id="footer-info-lastmod"> This page was last edited on 25 June 2022, at 18:01.</li>
	<li id="footer-info-copyright">Content is available under <a class="external" rel="nofollow" href="https://www.gnu.org/copyleft/fdl.html">GNU Free Documentation License 1.3 or later</a> unless otherwise noted.</li>
<br>
</ul>

	<ul id="footer-places">
	<li id="footer-places-privacy"><a href="https://terms.archlinux.org/docs/privacy-policy/">Privacy policy</a></li>
	<li id="footer-places-about"><a href="../en/ArchWiki:About.html">About ArchWiki</a></li>
	<li id="footer-places-disclaimer"><a href="../en/ArchWiki:General_disclaimer.html">Disclaimers</a></li>
</ul>

	
</footer>

		</div>
	</div> 
</div> 

</body>
</html>
