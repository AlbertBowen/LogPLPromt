<!DOCTYPE html>
<html class="client-nojs" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<title>Self-encrypting drives - ArchWiki</title>
<link rel="stylesheet" href="../ArchWikiOffline.css">
<meta name="ResourceLoaderDynamicStyles" content="">
<meta name="generator" content="MediaWiki 1.39.4">
<meta name="referrer" content="no-referrer-when-downgrade">
<meta name="format-detection" content="telephone=no">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes, minimum-scale=0.25, maximum-scale=5.0">
<link rel="icon" href="/favicon.ico">
<link rel="search" type="application/opensearchdescription+xml" href="/opensearch_desc.php" title="ArchWiki (en)">
<link rel="EditURI" type="application/rsd+xml" href="https://wiki.archlinux.org/api.php?action=rsd">
<link rel="license" href="https://www.gnu.org/copyleft/fdl.html">
<link rel="alternate" type="application/atom+xml" title="ArchWiki Atom feed" href="/index.php?title=Special:RecentChanges&amp;feed=atom">
</head>
<body class="skin-vector skin-vector-search-vue mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-Self-encrypting_drives rootpage-Self-encrypting_drives skin-vector-2022 action-view skin--responsive vector-feature-language-in-header-enabled vector-feature-language-in-main-page-header-disabled vector-feature-language-alert-in-sidebar-disabled vector-feature-sticky-header-disabled vector-feature-sticky-header-edit-disabled vector-feature-table-of-contents-disabled vector-feature-visual-enhancement-next-disabled">
<div class="mw-page-container">
	<span id="top-page"></span>
	<a class="mw-jump-link" href="#content">Jump to content</a>
	<div class="mw-page-container-inner">
		<input type="checkbox" id="mw-sidebar-checkbox" class="mw-checkbox-hack-checkbox">
		<div class="vector-sidebar-container ">
			</div>
		<div class="vector-sitenotice-container">
			<div id="siteNotice"></div>
		</div>
		<input type="checkbox" id="vector-toc-collapsed-checkbox" class="mw-checkbox-hack-checkbox">
		<div class="mw-table-of-contents-container">
			<div class="vector-sticky-toc-container mw-sticky-header-element">
				<nav id="mw-panel-toc" class="sidebar-toc" role="navigation" aria-labelledby="sidebar-toc-label" data-event-name="ui.sidebar-toc">
	<div id="sidebar-toc-label" class="sidebar-toc-header">
		<p class="sidebar-toc-title">
		Contents
		<button class="vector-toc-uncollapse-button">move to sidebar</button>
		<button class="vector-toc-collapse-button">hide</button>
		</p>
	</div>
	<ul class="sidebar-toc-contents" id="mw-panel-toc-list">
		<li id="toc-mw-content-text" class="sidebar-toc-list-item sidebar-toc-level-1">
			<a href="#top-page" class="sidebar-toc-link">
				<div class="sidebar-toc-text">Beginning</div>
			</a>
		</li>
		<li id="toc-Overview" class="sidebar-toc-list-item sidebar-toc-level-1">
			<a class="sidebar-toc-link" href="#Overview">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">1</span>Overview</div>
			</a>
			
				<button aria-controls="toc-Overview-sublist" class="mw-ui-icon mw-ui-icon-wikimedia-expand mw-ui-icon-small sidebar-toc-toggle">
					Toggle Overview subsection
				</button>
			
			<ul id="toc-Overview-sublist" class="sidebar-toc-list">
				<li id="toc-Key_management_technical_implementation" class="sidebar-toc-list-item sidebar-toc-level-2">
			<a class="sidebar-toc-link" href="#Key_management_technical_implementation">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">1.1</span>Key management technical implementation</div>
			</a>
			
			<ul id="toc-Key_management_technical_implementation-sublist" class="sidebar-toc-list">
			</ul>
		</li>
		<li id="toc-Advantages" class="sidebar-toc-list-item sidebar-toc-level-2">
			<a class="sidebar-toc-link" href="#Advantages">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">1.2</span>Advantages</div>
			</a>
			
			<ul id="toc-Advantages-sublist" class="sidebar-toc-list">
			</ul>
		</li>
		<li id="toc-Disadvantages" class="sidebar-toc-list-item sidebar-toc-level-2">
			<a class="sidebar-toc-link" href="#Disadvantages">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">1.3</span>Disadvantages</div>
			</a>
			
			<ul id="toc-Disadvantages-sublist" class="sidebar-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id="toc-Linux_support" class="sidebar-toc-list-item sidebar-toc-level-1">
			<a class="sidebar-toc-link" href="#Linux_support">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">2</span>Linux support</div>
			</a>
			
			<ul id="toc-Linux_support-sublist" class="sidebar-toc-list">
			</ul>
		</li>
		<li id="toc-Encrypting_the_root_(boot)_drive" class="sidebar-toc-list-item sidebar-toc-level-1">
			<a class="sidebar-toc-link" href="#Encrypting_the_root_(boot)_drive">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">3</span>Encrypting the root (boot) drive</div>
			</a>
			
				<button aria-controls="toc-Encrypting_the_root_(boot)_drive-sublist" class="mw-ui-icon mw-ui-icon-wikimedia-expand mw-ui-icon-small sidebar-toc-toggle">
					Toggle Encrypting the root (boot) drive subsection
				</button>
			
			<ul id="toc-Encrypting_the_root_(boot)_drive-sublist" class="sidebar-toc-list">
				<li id="toc-Check_if_your_disk_supports_OPAL" class="sidebar-toc-list-item sidebar-toc-level-2">
			<a class="sidebar-toc-link" href="#Check_if_your_disk_supports_OPAL">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">3.1</span>Check if your disk supports OPAL</div>
			</a>
			
			<ul id="toc-Check_if_your_disk_supports_OPAL-sublist" class="sidebar-toc-list">
			</ul>
		</li>
		<li id="toc-Download_the_rescue_image" class="sidebar-toc-list-item sidebar-toc-level-2">
			<a class="sidebar-toc-link" href="#Download_the_rescue_image">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">3.2</span>Download the rescue image</div>
			</a>
			
			<ul id="toc-Download_the_rescue_image-sublist" class="sidebar-toc-list">
				<li id="toc-Create_a_bootable_drive" class="sidebar-toc-list-item sidebar-toc-level-3">
			<a class="sidebar-toc-link" href="#Create_a_bootable_drive">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">3.2.1</span>Create a bootable drive</div>
			</a>
			
			<ul id="toc-Create_a_bootable_drive-sublist" class="sidebar-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id="toc-Using_Pre-boot_Authorisation_(PBA)" class="sidebar-toc-list-item sidebar-toc-level-2">
			<a class="sidebar-toc-link" href="#Using_Pre-boot_Authorisation_(PBA)">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">3.3</span>Using Pre-boot Authorisation (PBA)</div>
			</a>
			
			<ul id="toc-Using_Pre-boot_Authorisation_(PBA)-sublist" class="sidebar-toc-list">
				<li id="toc-Encrypting_your_drive" class="sidebar-toc-list-item sidebar-toc-level-3">
			<a class="sidebar-toc-link" href="#Encrypting_your_drive">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">3.3.1</span>Encrypting your drive</div>
			</a>
			
			<ul id="toc-Encrypting_your_drive-sublist" class="sidebar-toc-list">
				<li id="toc-Enable_locking" class="sidebar-toc-list-item sidebar-toc-level-4">
			<a class="sidebar-toc-link" href="#Enable_locking">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">3.3.1.1</span>Enable locking</div>
			</a>
			
			<ul id="toc-Enable_locking-sublist" class="sidebar-toc-list">
			</ul>
		</li>
		<li id="toc-Set_a_password" class="sidebar-toc-list-item sidebar-toc-level-4">
			<a class="sidebar-toc-link" href="#Set_a_password">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">3.3.1.2</span>Set a password</div>
			</a>
			
			<ul id="toc-Set_a_password-sublist" class="sidebar-toc-list">
			</ul>
		</li>
		<li id="toc-Install_the_Pre-boot_Authorisation" class="sidebar-toc-list-item sidebar-toc-level-4">
			<a class="sidebar-toc-link" href="#Install_the_Pre-boot_Authorisation">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">3.3.1.3</span>Install the Pre-boot Authorisation</div>
			</a>
			
			<ul id="toc-Install_the_Pre-boot_Authorisation-sublist" class="sidebar-toc-list">
			</ul>
		</li>
	</ul>
		</li>
	</ul>
		</li>
		<li id="toc-Using_a_mkinitcpio_hook" class="sidebar-toc-list-item sidebar-toc-level-2">
			<a class="sidebar-toc-link" href="#Using_a_mkinitcpio_hook">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">3.4</span>Using a mkinitcpio hook</div>
			</a>
			
			<ul id="toc-Using_a_mkinitcpio_hook-sublist" class="sidebar-toc-list">
				<li id="toc-Encrypting_your_drive_2" class="sidebar-toc-list-item sidebar-toc-level-3">
			<a class="sidebar-toc-link" href="#Encrypting_your_drive_2">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">3.4.1</span>Encrypting your drive</div>
			</a>
			
			<ul id="toc-Encrypting_your_drive_2-sublist" class="sidebar-toc-list">
			</ul>
		</li>
		<li id="toc-Partition_the_drive" class="sidebar-toc-list-item sidebar-toc-level-3">
			<a class="sidebar-toc-link" href="#Partition_the_drive">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">3.4.2</span>Partition the drive</div>
			</a>
			
			<ul id="toc-Partition_the_drive-sublist" class="sidebar-toc-list">
			</ul>
		</li>
		<li id="toc-Enable_locking_2" class="sidebar-toc-list-item sidebar-toc-level-3">
			<a class="sidebar-toc-link" href="#Enable_locking_2">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">3.4.3</span>Enable locking</div>
			</a>
			
			<ul id="toc-Enable_locking_2-sublist" class="sidebar-toc-list">
				<li id="toc-Lock_boot_partition_as_read-only_(optional)" class="sidebar-toc-list-item sidebar-toc-level-4">
			<a class="sidebar-toc-link" href="#Lock_boot_partition_as_read-only_(optional)">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">3.4.3.1</span>Lock boot partition as read-only (optional)</div>
			</a>
			
			<ul id="toc-Lock_boot_partition_as_read-only_(optional)-sublist" class="sidebar-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id="toc-Install_OS" class="sidebar-toc-list-item sidebar-toc-level-3">
			<a class="sidebar-toc-link" href="#Install_OS">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">3.4.4</span>Install OS</div>
			</a>
			
			<ul id="toc-Install_OS-sublist" class="sidebar-toc-list">
			</ul>
		</li>
		<li id="toc-Setup_mkinitcpio" class="sidebar-toc-list-item sidebar-toc-level-3">
			<a class="sidebar-toc-link" href="#Setup_mkinitcpio">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">3.4.5</span>Setup mkinitcpio</div>
			</a>
			
			<ul id="toc-Setup_mkinitcpio-sublist" class="sidebar-toc-list">
				<li id="toc-Custom_mkinitcpio_hook" class="sidebar-toc-list-item sidebar-toc-level-4">
			<a class="sidebar-toc-link" href="#Custom_mkinitcpio_hook">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">3.4.5.1</span>Custom mkinitcpio hook</div>
			</a>
			
			<ul id="toc-Custom_mkinitcpio_hook-sublist" class="sidebar-toc-list">
			</ul>
		</li>
		<li id="toc-Custom_hook_in_mkinitcpio_config" class="sidebar-toc-list-item sidebar-toc-level-4">
			<a class="sidebar-toc-link" href="#Custom_hook_in_mkinitcpio_config">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">3.4.5.2</span>Custom hook in mkinitcpio config</div>
			</a>
			
			<ul id="toc-Custom_hook_in_mkinitcpio_config-sublist" class="sidebar-toc-list">
			</ul>
		</li>
		<li id="toc-Regenerate_mkinitcpio_image" class="sidebar-toc-list-item sidebar-toc-level-4">
			<a class="sidebar-toc-link" href="#Regenerate_mkinitcpio_image">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">3.4.5.3</span>Regenerate mkinitcpio image</div>
			</a>
			
			<ul id="toc-Regenerate_mkinitcpio_image-sublist" class="sidebar-toc-list">
			</ul>
		</li>
	</ul>
		</li>
	</ul>
		</li>
		<li id="toc-Accessing_the_drive_from_a_live_distribution" class="sidebar-toc-list-item sidebar-toc-level-2">
			<a class="sidebar-toc-link" href="#Accessing_the_drive_from_a_live_distribution">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">3.5</span>Accessing the drive from a live distribution</div>
			</a>
			
			<ul id="toc-Accessing_the_drive_from_a_live_distribution-sublist" class="sidebar-toc-list">
			</ul>
		</li>
		<li id="toc-Disable_locking" class="sidebar-toc-list-item sidebar-toc-level-2">
			<a class="sidebar-toc-link" href="#Disable_locking">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">3.6</span>Disable locking</div>
			</a>
			
			<ul id="toc-Disable_locking-sublist" class="sidebar-toc-list">
			</ul>
		</li>
		<li id="toc-Re-enable_locking_and_the_PBA" class="sidebar-toc-list-item sidebar-toc-level-2">
			<a class="sidebar-toc-link" href="#Re-enable_locking_and_the_PBA">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">3.7</span>Re-enable locking and the PBA</div>
			</a>
			
			<ul id="toc-Re-enable_locking_and_the_PBA-sublist" class="sidebar-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id="toc-Encrypting_a_non-root_drive" class="sidebar-toc-list-item sidebar-toc-level-1">
			<a class="sidebar-toc-link" href="#Encrypting_a_non-root_drive">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">4</span>Encrypting a non-root drive</div>
			</a>
			
			<ul id="toc-Encrypting_a_non-root_drive-sublist" class="sidebar-toc-list">
			</ul>
		</li>
		<li id="toc-Changing_the_passphrase" class="sidebar-toc-list-item sidebar-toc-level-1">
			<a class="sidebar-toc-link" href="#Changing_the_passphrase">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">5</span>Changing the passphrase</div>
			</a>
			
			<ul id="toc-Changing_the_passphrase-sublist" class="sidebar-toc-list">
			</ul>
		</li>
		<li id="toc-Waking_up_from_suspend" class="sidebar-toc-list-item sidebar-toc-level-1">
			<a class="sidebar-toc-link" href="#Waking_up_from_suspend">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">6</span>Waking up from suspend</div>
			</a>
			
				<button aria-controls="toc-Waking_up_from_suspend-sublist" class="mw-ui-icon mw-ui-icon-wikimedia-expand mw-ui-icon-small sidebar-toc-toggle">
					Toggle Waking up from suspend subsection
				</button>
			
			<ul id="toc-Waking_up_from_suspend-sublist" class="sidebar-toc-list">
				<li id="toc-Preparing_drive_for_sleep" class="sidebar-toc-list-item sidebar-toc-level-2">
			<a class="sidebar-toc-link" href="#Preparing_drive_for_sleep">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">6.1</span>Preparing drive for sleep</div>
			</a>
			
			<ul id="toc-Preparing_drive_for_sleep-sublist" class="sidebar-toc-list">
				<li id="toc-With_mkinitcpio_hook" class="sidebar-toc-list-item sidebar-toc-level-3">
			<a class="sidebar-toc-link" href="#With_mkinitcpio_hook">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">6.1.1</span>With mkinitcpio hook</div>
			</a>
			
			<ul id="toc-With_mkinitcpio_hook-sublist" class="sidebar-toc-list">
			</ul>
		</li>
		<li id="toc-With_systemd_service" class="sidebar-toc-list-item sidebar-toc-level-3">
			<a class="sidebar-toc-link" href="#With_systemd_service">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">6.1.2</span>With systemd service</div>
			</a>
			
			<ul id="toc-With_systemd_service-sublist" class="sidebar-toc-list">
			</ul>
		</li>
	</ul>
		</li>
	</ul>
		</li>
		<li id="toc-Secure_disk_erasure" class="sidebar-toc-list-item sidebar-toc-level-1">
			<a class="sidebar-toc-link" href="#Secure_disk_erasure">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">7</span>Secure disk erasure</div>
			</a>
			
			<ul id="toc-Secure_disk_erasure-sublist" class="sidebar-toc-list">
			</ul>
		</li>
		<li id="toc-BIOS_based_ATA-password" class="sidebar-toc-list-item sidebar-toc-level-1">
			<a class="sidebar-toc-link" href="#BIOS_based_ATA-password">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">8</span>BIOS based ATA-password</div>
			</a>
			
			<ul id="toc-BIOS_based_ATA-password-sublist" class="sidebar-toc-list">
			</ul>
		</li>
		<li id="toc-See_also" class="sidebar-toc-list-item sidebar-toc-level-1">
			<a class="sidebar-toc-link" href="#See_also">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">9</span>See also</div>
			</a>
			
			<ul id="toc-See_also-sublist" class="sidebar-toc-list">
			</ul>
		</li>
	</ul>
</nav>

			</div>
		</div>
		<div class="mw-content-container">
			<main id="content" class="mw-body" role="main" style="margin: 0">
				<a id="top"></a>
				<nav class="vector-article-toolbar" aria-label="Tools" role="navigation">
					<div class="mw-article-toolbar-container">
						<div id="left-navigation">
							

<div id="p-associated-pages" class="vector-menu mw-portlet mw-portlet-associated-pages vector-menu-tabs">
	<div class="vector-menu-content">
		
		<ul class="vector-menu-content-list">
<li id="ca-nstab-main" class="selected mw-list-item"><a href="../en/Self-encrypting_drives.html" title="View the content page [c]" accesskey="c"><span>Page</span></a></li>
<li id="ca-talk" class="mw-list-item"><a href="../en/Talk:Self-encrypting_drives.html" rel="discussion" title="Discussion about the content page [t]" accesskey="t"><span>Discussion</span></a></li>
</ul>
		
	</div>
</div>

							

<div id="p-variants" class="vector-menu mw-portlet mw-portlet-variants emptyPortlet vector-menu-dropdown">
	<input type="checkbox" id="p-variants-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-p-variants" class="vector-menu-checkbox" aria-label="Change language variant">
	<label id="p-variants-label" for="p-variants-checkbox" class="vector-menu-heading ">
		<span class="vector-menu-heading-label">English</span>
	</label>
	<div class="vector-menu-content">
		
		<ul class="vector-menu-content-list"></ul>
		
	</div>
</div>

						</div>
						<div id="right-navigation" class="vector-collapsible ">
							

<div id="p-views" class="vector-menu mw-portlet mw-portlet-views vector-menu-tabs">
	<div class="vector-menu-content">
		
		<ul class="vector-menu-content-list">
<li id="ca-view" class="selected mw-list-item"><a href="../en/Self-encrypting_drives.html"><span>Read</span></a></li>
<li id="ca-viewsource" class="mw-list-item"><a href="/index.php?title=Self-encrypting_drives&amp;action=edit" title="This page is protected.
You can view its source [e]" accesskey="e"><span>View source</span></a></li>
<li id="ca-history" class="mw-list-item"><a href="/index.php?title=Self-encrypting_drives&amp;action=history" title="Past revisions of this page [h]" accesskey="h"><span>View history</span></a></li>
</ul>
		
	</div>
</div>

							

<div id="p-cactions" class="vector-menu mw-portlet mw-portlet-cactions emptyPortlet vector-menu-dropdown vector-has-collapsible-items" title="More options">
	<input type="checkbox" id="p-cactions-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-p-cactions" class="vector-menu-checkbox">
	<label id="p-cactions-label" for="p-cactions-checkbox" class="vector-menu-heading ">
		<span class="vector-menu-heading-label">More</span>
	</label>
	<div class="vector-menu-content">
		
		<ul class="vector-menu-content-list">
<li id="ca-more-view" class="selected vector-more-collapsible-item mw-list-item"><a href="../en/Self-encrypting_drives.html"><span>Read</span></a></li>
<li id="ca-more-viewsource" class="vector-more-collapsible-item mw-list-item"><a href="/index.php?title=Self-encrypting_drives&amp;action=edit"><span>View source</span></a></li>
<li id="ca-more-history" class="vector-more-collapsible-item mw-list-item"><a href="/index.php?title=Self-encrypting_drives&amp;action=history"><span>View history</span></a></li>
</ul>
		
	</div>
</div>

						</div>
					</div>
				</nav>
				<div id="bodyContent" class="vector-body" data-mw-ve-target-container>
					<div class="mw-body-subheader">
					        <div class="mw-indicators">
        </div>

					    <div id="siteSub" class="noprint">From ArchWiki</div>
					</div>
					
					
					
					<div id="mw-content-text" class="mw-body-content mw-content-ltr" lang="en" dir="ltr">
<div class="mw-parser-output">
<div class="archwiki-template-meta-related-articles-start">
<p class="mw-no-invert">Related articles</p>
<ul>
<li><a href="../en/Data-at-rest_encryption.html" title="Data-at-rest encryption">Data-at-rest encryption</a></li>
<li><a href="../en/Trusted_Platform_Module.html" title="Trusted Platform Module">Trusted Platform Module</a></li>
<li><a href="../en/Dm-crypt/Encrypting_an_entire_system.html" title="Dm-crypt/Encrypting an entire system">dm-crypt/Encrypting an entire system</a></li>
</ul>
</div>
<p><a href="https://en.wikipedia.org/wiki/Hardware-based_full_disk_encryption" class="extiw" title="wikipedia:Hardware-based full disk encryption">Hardware-based full-disk encryption</a> (FDE) is now available from many hard disk (HDD) vendors, becoming increasingly common especially for <a href="../en/Solid_state_drive.html" title="Solid state drive">solid state drives</a>. The term "self-encrypting drive" (SED) is now common when referring to HDDs or SSDs with built-in full-disk encryption. <a href="https://en.wikipedia.org/wiki/Opal_Storage_Specification" class="extiw" title="wikipedia:Opal Storage Specification">OPAL</a> is a set of specifications for self-encrypting drives developed by the Trusted Computing Group.
</p>
<mw:tocplace></mw:tocplace>
<h2><span class="mw-headline" id="Overview">Overview</span></h2>
<p>Many self-encrypting drives available today implement the <a rel="nofollow" class="external text" href="https://trustedcomputinggroup.org/resource/storage-work-group-storage-security-subsystem-class-opal/">OPAL</a> and <a rel="nofollow" class="external text" href="https://trustedcomputinggroup.org/resource/storage-work-group-storage-security-subsystem-class-enterprise-specification/">Enterprise</a> standards developed by the Trusted Computing Group (TCG). Enterprise SAS versions of the TCG standard are called "TCG Enterprise" drives. Other standards such as Opalite and Pyrite only offer a subset of the functionalities offered by OPAL, and might not even offer any actual encryption of data at rest <a rel="nofollow" class="external autonumber" href="https://winmagic.com/en/opalite-pyrite-sed-specifications-simplified/">[1]</a>. The hardware manufactured according to the standards is <a rel="nofollow" class="external text" href="http://www.wavesys.com/self-encrypting-drive-compatibility-list">labeled</a> accordingly. 
</p>
<p>Unlocking of the drive can be done during operating system runtime using software utilities, in a pre-boot authentication environment, or with a <a href="#BIOS_based_ATA-password">#BIOS based ATA-password</a> on power up.
</p>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip:</strong> "Encryption" in the context of this page refers to hardware-based encryption. See <a href="../en/Data-at-rest_encryption.html#Block_device_encryption" title="Data-at-rest encryption">Data-at-rest encryption#Block device encryption</a> and <a href="../en/Data-at-rest_encryption.html#Stacked_filesystem_encryption" title="Data-at-rest encryption">Data-at-rest encryption#Stacked filesystem encryption</a> for software-based encryption.</div>
<p>Refer to the <a href="#Advantages">#Advantages</a> and <a href="#Disadvantages">#Disadvantages</a> sections to better understand and decide if hardware-based full-disk encryption is what you want.
</p>
<h3><span class="mw-headline" id="Key_management_technical_implementation">Key management technical implementation</span></h3>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip:</strong> This section is important to understand the core concepts behind effective key management, and secure erasure of the disk.</div>
<p>Key management takes place within the disk controller and encryption keys are usually 128 or 256 bit Advanced Encryption Standard (AES).
</p>
<div class="noprint archwiki-template-message">
<p><a href="../File:Tango-view-fullscreen.png" class="image"><img alt="Tango-view-fullscreen.png" src="../File:Tango-view-fullscreen.png" decoding="async" width="48" height="48"></a><b>This article or section needs expansion.</b><a href="../File:Tango-view-fullscreen.png" class="image"><img alt="Tango-view-fullscreen.png" src="../File:Tango-view-fullscreen.png" decoding="async" width="48" height="48"></a></p>
<div>
<b>Reason:</b> The Opal standards are full of acronyms. The sedutil refers to them in the <a rel="nofollow" class="external text" href="https://github.com/Drive-Trust-Alliance/sedutil/wiki/FAQ">FAQ</a> and <a rel="nofollow" class="external text" href="https://github.com/Drive-Trust-Alliance/sedutil/wiki/Command-Syntax">command syntax</a>. It would be useful to name the important acronyms (e.g. SID, MSID, locking SP, admin SP) in this section, because they are intrinsic to the key-management defined per standard. (See also <a href="https://en.wikipedia.org/wiki/Key_escrow" class="extiw" title="w:Key escrow">w:Key escrow</a>). (Discuss in <a rel="nofollow" class="external text" href="https://wiki.archlinux.org/title/Talk:Self-encrypting_drives">Talk:Self-encrypting drives</a>)</div>
</div>
<p>Self-encrypting drives adhering to the TCG OPAL 2.0 standard specification (almost all modern self-encrypting drives) implement key management via an authentication key, and a 2nd-level data encryption key. The data encryption key is the key against which data on the drive is actually encrypted. The authentication key is the user-facing 1st-level passphrase which decrypts the data encryption key (which in turn decrypts the data). This approach has specific advantages:
</p>
<ul>
<li>Allows the user to change the passphrase <i>without</i> losing the existing encrypted data on the disk
<ul><li>This improves security, as it is fast and easy to respond to security threats and revoke a compromised passphrase</li></ul>
</li>
<li>Facilitates near-instant and cryptographically secure full disk erasure.</li>
</ul>
<p>For those who are familiar, this concept is similar to the LUKS key management layer often used in a <a href="../en/Dm-crypt.html" title="Dm-crypt">dm-crypt</a> deployment. Using LUKS, the user can have multiple different keys (passphrases or keyfiles) to decrypt the master-key, which in turn decrypts the underlying data. This approach allows the user to change or revoke these keys as required <i>without</i> needing to re-encrypt the data, as the master 2nd-level encryption key <i>is unchanged</i> (itself being re-encrypted by the new passphrase).
</p>
<p>In fact, in drives featuring full-disk encryption, data is <i>always</i> encrypted with the data encryption key when stored to disk, even if there is no password set (e.g. a new drive). Manufacturers do this to make it easier for users who do not wish to enable the security features of the self-encrypting drive. These self-encrypting drives can be thought of as having a zero-length password by default that <i>always</i> transparently encrypts the data  (similar to how passwordless SSH keys can provide somewhat secure access without user intervention).
</p>
<p>If a user wishes to "enable" encryption at a later stage, they are able to configure an authentication key (such as a passphrase) which encrypts the existing data encryption key. The user will then be prompted for their passphrase when decrypting the data encryption key in the future. Crucially, because the existing data encryption key is not regenerated, setting a passphrase allows for the drive to be locked while preserving existing encrypted data on the disk, avoiding the need for the drive to be re-encrypted.
</p>
<h3><span class="mw-headline" id="Advantages">Advantages</span></h3>
<ul>
<li>Easier to setup (compared to software-based encryption)</li>
<li>Notably transparent to the user, except for initial bootup authentication</li>
<li>Data-at-Rest protection</li>
<li>Increased performance (CPU is freed up from calculations to encrypt and decrypt)</li>
<li>The main CPU and RAM are eliminated as possible attack targets</li>
<li>Optimally fast and <a href="#Secure_disk_erasure">#Secure disk erasure</a> (sanitation) (regardless of disk size)</li>
<li>Protection from alternative boot methods due to the possibility to encrypt the MBR, rendering the drive inaccessible before pre-boot authentication</li>
</ul>
<h3><span class="mw-headline" id="Disadvantages">Disadvantages</span></h3>
<ul><li>Constant-power exploits</li></ul>
<dl><dd>Typical self-encrypting drives, once unlocked, will remain unlocked as long as power is provided. This vulnerability can be exploited by means of altering the environment external to the drive, without cutting power, in effect keeping the drive in an unlocked state. For example, it has been shown (by researchers at University of Erlangen-Nuremberg) that it is possible to reboot the computer into an attacker-controlled operating system without cutting power to the drive. The researchers have also demonstrated moving the drive to another computer without cutting power.<a rel="nofollow" class="external autonumber" href="https://www1.cs.fau.de/sed">[2]</a>
</dd></dl>
<ul><li>Key-in-memory exploits</li></ul>
<dl><dd>When the system is powered down into S3 ("sleep") mode, the drive is powered down, but the drive keeps access to the encryption key in its internal memory (NVRAM) to allow for a resume ("wake"). This is necessary because for system booted with an arbitrary operating system there is no standard mechanism to prompt the user to re-enter the pre-boot decryption passphrase again. An attacker (with physical access to the drive) can leverage this to access the drive. Taking together known exploits the researchers summarize "we were able to break hardware-based full-disk encryption on eleven [of twelve] of those systems provided they were running or in standby mode".<a rel="nofollow" class="external autonumber" href="https://www1.cs.fau.de/sed">[3]</a> Note, however, S3 ("sleep") is <b>not</b> currently supported by sedutil (the current available toolset for managing a TCG OPAL 2.0 self-encrypting drives via Linux)</dd></dl>
<ul><li>Compromised firmware</li></ul>
<dl><dd>The firmware of the drive may be compromised (backdoor) and data sent to it thus potentially compromised (decryptable by the malicious third party in question, provided access to physical drive is achievable). A study demonstrated methods for compromising device firmware, as well as applying invalid passwords to access data on OPAL devices.<a rel="nofollow" class="external autonumber" href="https://www.ru.nl/publish/pages/909275/draft-paper_1.pdf">[4]</a> If data is encrypted by the operating system (e.g. dm-crypt), the encryption key is unknown to the compromised drive, thus circumventing this attack vector entirely.</dd></dl>
<h2><span class="mw-headline" id="Linux_support">Linux support</span></h2>
<div class="noprint archwiki-template-message">
<p><a href="../File:Tango-view-fullscreen.png" class="image"><img alt="Tango-view-fullscreen.png" src="../File:Tango-view-fullscreen.png" decoding="async" width="48" height="48"></a><b>This article or section needs expansion.</b><a href="../File:Tango-view-fullscreen.png" class="image"><img alt="Tango-view-fullscreen.png" src="../File:Tango-view-fullscreen.png" decoding="async" width="48" height="48"></a></p>
<div>
<b>Reason:</b> Kernel 4.11 gained <code>BLK_SED_OPAL</code> self-encrypting drives support.<a rel="nofollow" class="external autonumber" href="https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=455a7b238cd6bc68c4a550cbbd37c1e22b64f71c">[5]</a> (Discuss in <a rel="nofollow" class="external text" href="https://wiki.archlinux.org/title/Talk:Self-encrypting_drives">Talk:Self-encrypting drives</a>)</div>
</div>
<p><i>msed</i> and <i>OpalTool</i>, the two known Open Source code bases available for self-encrypting drives support on Linux, have both been retired, and their development efforts officially merged to form <i><a rel="nofollow" class="external text" href="https://github.com/Drive-Trust-Alliance/sedutil">sedutil</a></i>, under the umbrella of The <a rel="nofollow" class="external text" href="https://www.drivetrust.com">Drive Trust Alliance (DTA)</a>. <a rel="nofollow" class="external text" href="https://github.com/Drive-Trust-Alliance/sedutil">sedutil</a> is "an Open Source (GPLv3) effort to make Self Encrypting Drive technology freely available to everyone."
</p>
<p><a href="../en/Help:Reading.html#Installation_of_packages" class="mw-redirect" title="Install">Install</a> the <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/sedutil/">sedutil</a></span><sup><small>AUR</small></sup> package, which contains the <i>sedutil-cli</i> tool, and helper scripts to create a custom pre-boot authorization (PBA) image based off the <i>current</i> OS in use (e.g. for setting a custom console keymap).  Alternatively, you can install <i>sedutil</i> solely for acquiring the <i>sedutil-cli</i> toolset, but download and use the <a rel="nofollow" class="external text" href="https://github.com/Drive-Trust-Alliance/sedutil/wiki/Executable-Distributions">precompiled PBA image (for BIOS or UEFI)</a> provided by the Drive Trust Alliance.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> UEFI support currently requires that Secure Boot be turned off.</div>
<p>For devices connected via <a href="https://en.wikipedia.org/wiki/SATA" class="extiw" title="wikipedia:SATA">SATA</a>, <code>libata.allow_tpm</code> <b>must</b> be set to <code>1</code> (true) in order to use sedutil. Either add <code>libata.allow_tpm=1</code> to the <a href="../en/Kernel_parameters.html" title="Kernel parameters">kernel parameters</a>, or by setting <code>/sys/module/libata/parameters/allow_tpm</code> to <code>1</code> on a running system.
</p>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Warning:</strong> Using <i>sedutil</i> with external drives, even if sedutil claims the drive supports OPAL, has been reported as bricking them. For example, WD My Book external hard drives owners should set up encryption with the <a rel="nofollow" class="external text" href="https://support.wdc.com/downloads.aspx?p=172">WD Security</a> utility in Windows, and then <a rel="nofollow" class="external text" href="https://github.com/geekhaidar/WD-Passport-Unlock-Linux">use sg_raw</a> for unlocking it. There is also a utility that supports setting up and unlocking such drives here: <a rel="nofollow" class="external text" href="https://github.com/0-duke/wdpassport-utils">wdpassport-utils</a>
</div>
<h2>
<span id="Encrypting_the_root_.28boot.29_drive"></span><span class="mw-headline" id="Encrypting_the_root_(boot)_drive">Encrypting the root (boot) drive</span>
</h2>
<p>These instructions assume you have the <i>sedutil-cli</i> tool installed (via the <a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/sedutil">AUR</a>, or by other means)
</p>
<h4><span class="mw-headline" id="Check_if_your_disk_supports_OPAL">Check if your disk supports OPAL</span></h4>
<pre># sedutil-cli --scan
</pre>
<p>If you get something like
</p>
<pre>Scanning for Opal compliant disks
/dev/sda No  LITEONIT LMT-256L9M-11 MSATA 256GB       HM8110B
</pre>
<p>then your disk does not support OPAL. On the contrary, the following output means OPAL standards 1.0 and 2.0 are supported, as the drive has a 2 (or a 12) in the second column indicating OPAL 2 support:
</p>
<pre>/dev/sda 12  Samsung SSD 850 EVO 500GB                EMT02B6Q
</pre>
<p>Windows version of sedutils output:
</p>
<pre>\\.\PhysicalDrive0 12  Samsung SSD 850 PRO 512GB                EXM02B6Q
</pre>
<h4><span class="mw-headline" id="Download_the_rescue_image">Download the rescue image</span></h4>
<p>Download a <a rel="nofollow" class="external text" href="https://github.com/Drive-Trust-Alliance/sedutil/wiki/Executable-Distributions">rescue system</a> for a machine provided by the Drive Trust Alliance, e.g. <code>RESCUE64.img.gz</code>.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> UEFI support currently requires that Secure Boot be turned off.</div>
<h5><span class="mw-headline" id="Create_a_bootable_drive">Create a bootable drive</span></h5>
<p>Decompress the rescue image (if required):
</p>
<pre>$ gunzip RESCUE64.img.gz
</pre>
<p>Create a <a href="../en/USB_flash_installation_medium.html" title="USB flash installation medium">bootable drive</a> using the downloaded rescue image, for example using dd:
</p>
<pre>dd bs=4M if=path/to/RESCUE64.img of=/dev/sdx status=progress conv=fsync oflag=direct
</pre>
<h3>
<span id="Using_Pre-boot_Authorisation_.28PBA.29"></span><span class="mw-headline" id="Using_Pre-boot_Authorisation_(PBA)">Using Pre-boot Authorisation (PBA)</span>
</h3>
<p>The following steps will install a PBA image in your EFI/BIOS which will start before your system and prompt you for a password. If the password is correct, it will unlock the drive and reboot into the normal OS bootloader.
</p>
<h4><span class="mw-headline" id="Encrypting_your_drive">Encrypting your drive</span></h4>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Warning:</strong> These steps must be executed from the rescue system.</div>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Warning:</strong> These steps will enable encryption for the entire drive (locking range 0). Whilst this does not usually delete the data, always make sure to have a backup.</div>
<h5><span class="mw-headline" id="Enable_locking">Enable locking</span></h5>
<p>Boot into the rescue system and use the output of <code>lsblk --fs</code> to help identify the correct drive, e.g. <code>/dev/sdx</code>.
</p>
<p>Setup the drive and enable the global locking range 0 (i.e. the entire drive):
</p>
<pre># sedutil-cli --initialsetup <i>PASSWORD DRIVE</i>
# sedutil-cli --enablelockingrange 0 <i>PASSWORD DRIVE</i>
# sedutil-cli --setmbrdone off <i>PASSWORD DRIVE</i>
</pre>
<h5><span class="mw-headline" id="Set_a_password">Set a password</span></h5>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> The SID and Admin1 passwords do not have to match but it makes things easier.</div>
<p>Set your password:
</p>
<pre># sedutil-cli --setsidpassword <i>PASSWORD PASSWORD DRIVE</i>
# sedutil-cli --setadmin1pwd <i>PASSWORD PASSWORD DRIVE</i>
</pre>
<h5><span class="mw-headline" id="Install_the_Pre-boot_Authorisation">Install the Pre-boot Authorisation</span></h5>
<p>Install the Pre-boot Authorisation (PBA) image:
</p>
<pre># gunzip /usr/sedutil/UEFI64-*.img.gz
# sedutil-cli --loadPBAimage <i>PASSWORD</i> /usr/sedutil/UEFI64-*.img <i>DRIVE</i>
</pre>
<p>Power off the computer to lock the drive.
</p>
<p>When the computer is next powered on, the PBA should ask for your password; then unlock the drive and chain-load the decrypted OS.
</p>
<h3><span class="mw-headline" id="Using_a_mkinitcpio_hook">Using a mkinitcpio hook</span></h3>
<p>Instead of using a PBA, the drive can be setup to only encrypt the root partition whilst leaving the <code>/boot</code> partition accessible. This way, the system can boot and a <code>mkinitcpio</code> hook used to unlock the drive before the rest of the boot sequence is completed. This has the advantage of not needing to install a PBA and reboot, and also allows for easier support of resume from S3 sleep.
</p>
<h4><span class="mw-headline" id="Encrypting_your_drive_2">Encrypting your drive</span></h4>
<p>Follow the steps outlined above to create a rescue system, then boot into it.
</p>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Warning:</strong> These steps must be executed from the rescue system.</div>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Warning:</strong> These steps will destroy all data on the drive. Make sure to have a backup before starting!</div>
<p>The first command will delete everything off of the drive. Omitting it will not save your data because setting up the new locking range will destroy it anyway.
</p>
<pre># sedutil-cli --yesIreallywanttoERASEALLmydatausingthePSID <i>PASSWORD DRIVE</i>
# sedutil-cli --initialsetup <i>PASSWORD DRIVE</i>
# sedutil-cli --setMBREnable off <i>PASSWORD DRIVE</i>
</pre>
<h4><span class="mw-headline" id="Partition_the_drive">Partition the drive</span></h4>
<p><a href="../en/Partitioning.html" title="Partitioning">Partition</a> the drive as desired, making sure the EFI and/or <code>/boot</code> partitions are at the start of the disk, immediately followed by the root partition. For example:
</p>
<ol>
<li>1G, FAT32, <code>/boot</code>
</li>
<li>ext4, <code>/</code>
</li>
</ol>
<p>Or a slightly more complex setup:
</p>
<ol>
<li>100M, FAT32, EFI</li>
<li>2G, ext4, <code>/boot</code>
</li>
<li>ext4, <code>/</code>
</li>
<li>Swap</li>
</ol>
<p>It is important the EFI and/or <code>/boot</code> partitions have enough space to hold all of the kernel images you may want to install. It will not be possible to expand these later without destroying all of the data in the root partition, as the encryption headers would be overwritten.
</p>
<h4><span class="mw-headline" id="Enable_locking_2">Enable locking</span></h4>
<p>Use <code>lsblk --fs</code> to help identify the correct drive, e.g. <code>/dev/sdx</code>, then use <code>lsblk --f DRIVE</code> to find:
</p>
<ul>
<li>RANGE_START = "Start" of the root partition</li>
<li>RANGE_LENGTH = "Sectors" of the root partition</li>
</ul>
<p>In the example below, RANGE_START would be 2097152 and RANGE_LENGTH 974675968. It is important that these numbers are divisible by 8 to work with <code>sedutil-cli</code>, rounding may be necessary.
</p>
<pre>Device       Start       End   Sectors   Size Type
/dev/sda1     2048   2097151   2095104  1023M EFI System
/dev/sda2  2097152 976773119 974675968 464.8G Linux filesystem
</pre>
<p>Create locking range 1 to only cover the root partition (and optionally swap):
</p>
<pre># sedutil-cli --setupLockingRange 1 <i>RANGE_START RANGE_LENGTH PASSWORD DRIVE</i>
# sedutil-cli --enablelockingrange 1 <i>PASSWORD DRIVE</i>
</pre>
<h5>
<span id="Lock_boot_partition_as_read-only_.28optional.29"></span><span class="mw-headline" id="Lock_boot_partition_as_read-only_(optional)">Lock boot partition as read-only (optional)</span>
</h5>
<p>For extra security, the EFI and/or <code>/boot</code> partitions can be locked as read-only. Identify the RANGE_START and RANGE_LENGTH in the same manner as for the root partition, then issue the following commands:
</p>
<pre># sedutil-cli --setupLockingRange 2 <i>RANGE_START RANGE_LENGTH PASSWORD DRIVE</i>
# sedutil-cli --readonlyLockingRange 2 <i>PASSWORD DRIVE</i>
</pre>
<h4><span class="mw-headline" id="Install_OS">Install OS</span></h4>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Warning:</strong> Powering off the system now will cause the drive to become locked. If this happens, boot into the rescue system and use the following command to unlock the range:
<pre># sedutil-cli --setlockingrange 1 rw <i>PASSWORD DRIVE</i>
</pre>
<p>Then proceed to reboot the system without powering off.
</p>
</div>
<p>You may now install the operating system, taking care to use the existing partitions and not alter them in any way. Once done, reboot into the new system without powering off first.
</p>
<h4><span class="mw-headline" id="Setup_mkinitcpio">Setup mkinitcpio</span></h4>
<div class="noprint archwiki-template-message">
<p><a href="../File:Tango-edit-clear.png" class="image"><img alt="Tango-edit-clear.png" src="../File:Tango-edit-clear.png" decoding="async" width="48" height="48"></a><b>This article or section needs language, wiki syntax or style improvements. See <a href="../en/Help:Style.html" title="Help:Style">Help:Style</a> for reference.</b><a href="../File:Tango-edit-clear.png" class="image"><img alt="Tango-edit-clear.png" src="../File:Tango-edit-clear.png" decoding="async" width="48" height="48"></a></p>
<div>
<b>Reason:</b> The wiki is not a code development platform, so this should be moved somewhere else (e.g. AUR). (Discuss in <a rel="nofollow" class="external text" href="https://wiki.archlinux.org/title/Talk:Self-encrypting_drives">Talk:Self-encrypting drives</a>)</div>
</div>
<h5><span class="mw-headline" id="Custom_mkinitcpio_hook">Custom mkinitcpio hook</span></h5>
<p>Create a custom mkinitcpio hook to ask for the drive password on boot:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/initcpio/install/sedutil</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">#!/bin/bash

help() {
    cat &lt;&lt;HELPEOF
Unlock OPAL drives by prompting for password
HELPEOF
}

build() {
    add_binary /usr/bin/sedutil-cli
    add_binary /usr/bin/clear
    add_binary /usr/bin/find
    add_binary /usr/bin/gawk
    add_binary /usr/bin/grep
    add_binary /usr/bin/readlink
    add_binary /usr/bin/stty
    add_binary /usr/bin/xargs
    add_binary /usr/sbin/partprobe

    add_runscript
}
</pre>
<p>The following script also contains code for unlocking the boot range, which can be uncommented if needed.
Additionally, if you need to be able to resume from sleep, you may need to slightly modify the below script. See <a href="#Preparing_drive_for_sleep">#Preparing drive for sleep</a> for more information and caveats about S3 sleep.
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/initcpio/hooks/sedutil</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">#!/usr/bin/ash

run_hook() {
	msg  "OPAL Drives Unlock"

	for block_device in $(list_block_devices) ; do
		if ! is_opal_drive "$block_device" ; then
			continue
		fi
		opal_unlock "$block_device" "$(get_block_device_info $block_device)"
	done
	
	/usr/sbin/partprobe
}

list_block_devices() {
	for glob in 'sd[a-z]' 'nvme[0-9]n[0-9]' 'nvme[0-9][0-9]n[0-9][0-9]' ; do
		/usr/bin/find /dev/ -name "$glob"
	done
	if [ $? != 0 ] ; then
		msg "Unable to list block devices"
	fi
}

is_opal_drive() {
	sedutil-cli --query "$1" &gt; /dev/null 2&gt; /dev/null
	return $?
}

get_block_device_info() {
	sedutil-cli --query "$1" | gawk '/^\//{print;exit}'
	if [ $? != 0 ] ; then
		msg "Unable to query $1"
	fi
}

opal_unlock() {
	while true ; do
		/usr/bin/stty -echo
		echo -n "Password for $2 ($1): "
		read pass
		/usr/bin/stty echo

		# Unlock root range for read/write
		sedutil-cli --setlockingrange 1 rw "$pass" "$1"
        # Uncomment to also unlock boot range
		# sedutil-cli --setlockingrange 2 rw "$pass" "$1"
		if [ $? != 0 ] ; then
			msg "Failed to unlock!"
			continue
		fi
        
		msg  "Unlocked!"
		break
	done
}
</pre>
<h5><span class="mw-headline" id="Custom_hook_in_mkinitcpio_config">Custom hook in mkinitcpio config</span></h5>
<p>Edit you mkinitcpio configuration to add the sedutil hook before udev. It is important the hook runs before udev, otherwise udev will get stuck trying to access the encrypted drive and cause I/O errors.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> It may be necessary to add the keyboard and keymap hooks to have a working keyboard on boot, together with the required kernel modules for your keyboard. See <a href="../en/Mkinitcpio/Minimal_initramfs.html#Keyboard_modules" title="Mkinitcpio/Minimal initramfs">mkinitcpio/Minimal initramfs#Keyboard_modules</a> for more details.</div>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Warning:</strong> It is a good idea to create a separate mkinitcpio config and image as described in <a href="../en/Mkinitcpio.html#Customized_generation" title="Mkinitcpio">Mkinitcpio#Customized_generation</a>, as your system may be unbootable if e.g. the keyboard does not work.</div>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/mkinitcpio.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">HOOKS=(base keyboard keymap sedutil udev autodetect ...)
</pre>
<h5><span class="mw-headline" id="Regenerate_mkinitcpio_image">Regenerate mkinitcpio image</span></h5>
<p>Finally, regenerate your initcpio:
</p>
<pre># mkinitcpio -P
</pre>
<p>Or as follows if using a custom config and image (making sure to have also created a <a href="../en/Arch_boot_process.html#Boot_loader" title="Arch boot process">boot entry</a> using this image):
</p>
<pre># mkinitcpio --config /etc/mkinitcpio-custom.conf --generate /boot/initramfs-custom.img
</pre>
<p>You may now reboot your system. If all goes well, the hook will prompt for a password to unlock your drive and then proceed with the rest of the boot process. If something went wrong, you can boot into the rescue system, manually unlock the drive, then reboot into your normal system using the default initcpio image and proceed to debug your system.
</p>
<h3><span class="mw-headline" id="Accessing_the_drive_from_a_live_distribution">Accessing the drive from a live distribution</span></h3>
<p>The easiest way is to boot the encrypted SSD first, in order to run the shadow MBR. Then press the key that prompts the boot menu and boot whatever device you prefer. Such a way the SED will be completely transparent.
</p>
<p>Another way is to directly boot into the live distribution and use sedutil to unlock the SSD:
</p>
<pre># sedutil-cli --setlockingrange 0 rw <i>password drive</i>
# sedutil-cli --setmbrdone on <i>password drive</i>
# partprobe <i>drive</i>
</pre>
<p>Verify that you followed the instructions after the note in <a href="#Linux_support">#Linux support</a>.
</p>
<h3><span class="mw-headline" id="Disable_locking">Disable locking</span></h3>
<p>If you want to turn off Locking and the PBA:
</p>
<pre># sedutil-cli --disableLockingRange 0 <i>password drive</i>
# sedutil-cli --setMBREnable off <i>password drive</i>
</pre>
<h3><span class="mw-headline" id="Re-enable_locking_and_the_PBA">Re-enable locking and the PBA</span></h3>
<p>You can later re-enable locking and the PBA using this command sequence
</p>
<pre># sedutil-cli --enableLockingRange 0 <i>password drive</i>
# sedutil-cli --setMBREnable on <i>password drive</i>
</pre>
<h2><span class="mw-headline" id="Encrypting_a_non-root_drive">Encrypting a non-root drive</span></h2>
<div class="noprint archwiki-template-message">
<p><a href="../File:Tango-edit-clear.png" class="image"><img alt="Tango-edit-clear.png" src="../File:Tango-edit-clear.png" decoding="async" width="48" height="48"></a><b>This article or section needs language, wiki syntax or style improvements. See <a href="../en/Help:Style.html" title="Help:Style">Help:Style</a> for reference.</b><a href="../File:Tango-edit-clear.png" class="image"><img alt="Tango-edit-clear.png" src="../File:Tango-edit-clear.png" decoding="async" width="48" height="48"></a></p>
<div>
<b>Reason:</b> undefined term: non-root drive (Discuss in <a rel="nofollow" class="external text" href="https://wiki.archlinux.org/title/Talk:Self-encrypting_drives">Talk:Self-encrypting drives</a>)</div>
</div>
<div class="noprint archwiki-template-message">
<p><a href="../File:Tango-view-fullscreen.png" class="image"><img alt="Tango-view-fullscreen.png" src="../File:Tango-view-fullscreen.png" decoding="async" width="48" height="48"></a><b>This article or section needs expansion.</b><a href="../File:Tango-view-fullscreen.png" class="image"><img alt="Tango-view-fullscreen.png" src="../File:Tango-view-fullscreen.png" decoding="async" width="48" height="48"></a></p>
<div>
<b>Reason:</b> How do you unlock the drive during boot (in late userspace), i.e. what is the equivalent of <code>/etc/crypttab</code> for SED? (Discuss in <a rel="nofollow" class="external text" href="https://wiki.archlinux.org/title/Talk:Self-encrypting_drives">Talk:Self-encrypting drives</a>)</div>
</div>
<p>A non-root drive does not require loading a PBA. So, activating the encryption is as simple as running:
</p>
<pre># sedutil-cli --initialsetup <i>password drive</i>
</pre>
<h2><span class="mw-headline" id="Changing_the_passphrase">Changing the passphrase</span></h2>
<p>Changing the passphrase does <i>not</i> lose existing data on the drive, and does not require re-encryption of data.
</p>
<pre># sedutil-cli --setSIDPassword <i>password newpassword device</i>
# sedutil-cli --setAdmin1Pwd <i>password newpassword device</i>
</pre>
<p>Read the <a href="#Key_management_technical_implementation">#Key management technical implementation</a> section above to learn about how this is implemented securely within the drive, and why it is possible to change the passphrase <i>without</i> losing the existing encrypted data on the drive.
</p>
<h2><span class="mw-headline" id="Waking_up_from_suspend">Waking up from suspend</span></h2>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Warning:</strong> Keeping the unlock password or hash on disk and in kernel memory is a requirement.</div>
<p>Suspending the system results in a crash by default, because power is being cut from the drive and that causes it to lock itself. In order to wake up from suspend the kernel should know a hashed password for the disk. This functionality is in-kernel since 4.11, but it is only available via a fork of sedutil, either <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/sedutil-sleep-git/">sedutil-sleep-git</a></span><sup><small>AUR</small></sup> or <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/sedutil-ladar/">sedutil-ladar</a></span><sup><small>AUR</small></sup>. Note the latter has additional features but a slightly different command syntax <a rel="nofollow" class="external autonumber" href="https://github.com/ladar/sedutil">[6]</a>.
</p>
<p>Generate a hashed password for the <a href="../en/Device_file.html#Block_devices" class="mw-redirect" title="Block device">block device</a> specified as <code><i>/dev/device</i></code>:
</p>
<pre># sedutil-sleep --printPasswordHash <i>password /dev/device</i>
</pre>
<h3><span class="mw-headline" id="Preparing_drive_for_sleep">Preparing drive for sleep</span></h3>
<h4><span class="mw-headline" id="With_mkinitcpio_hook">With mkinitcpio hook</span></h4>
<p>If already using a mkinitcpio hook to unlock the drive on boot, then you can simply add code as below to the hook to also prepare the drive for sleep. Make sure this code is placed after the command that unlocks the ranges <code>sedutil-cli --setlockingrange</code>, otherwise it will fail. In this example, <code>$pass</code> is a variable containing the password for unlocking, while <code>$1</code> is a variable containing the device to prepare for sleep, typically the root partition (e.g. <code>/dev/sda1</code>).
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/initcpio/hooks/sedutil</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">sedutil-cli --prepareForS3Sleep 1 "$pass" "$1"
if [ $? != 0 ] ; then
	msg "Prepare for S3 failed for $1"
fi</pre>
<h4><span class="mw-headline" id="With_systemd_service">With systemd service</span></h4>
<p>Create a <a href="../en/Systemd.html" title="Systemd">systemd</a> service, inserting hashes for each device:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/systemd/system/sedutil-sleep.service</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[Unit]
Description=sedutil-sleep

[Service]
Type=oneshot
#Add as many ExecStart lines as needed here
ExecStart=-+/usr/bin/sedutil-sleep -n -x --prepareForS3Sleep 0 <i>hash /dev/device</i>
#ExecStart=-+/usr/bin/sedutil-sleep -n -x --prepareForS3Sleep 0 <i>hash2 /dev/device</i>
RemainAfterExit=true

[Install]
WantedBy=multi-user.target</pre>
<h2><span class="mw-headline" id="Secure_disk_erasure">Secure disk erasure</span></h2>
<p>Whole disk erasure is very fast, and remarkably simple for a self-encrypting drive. Simply passing a cryptographic disk erasure (or crypto erase) command (after providing the correct authentication credentials) will have the drive self-generate a new random data encryption key internally. This will permanently discard the old key, thus rendering the encrypted data irrevocably un-decryptable. The drive will now be in a 'new drive' state.
</p>
<p>Read the <a href="#Key_management_technical_implementation">#Key management technical implementation</a> section above to learn more about how this is implemented securely within the drive.
</p>
<h2><span class="mw-headline" id="BIOS_based_ATA-password">BIOS based ATA-password</span></h2>
<p>Previous to the industry's TCG OPAL 2.0 standard initiative, the relevant <a href="https://en.wikipedia.org/wiki/Parallel_ATA#ATA_standards_versions.2C_transfer_rates.2C_and_features" class="extiw" title="w:Parallel ATA">ATA</a> standard defined an "ATA security feature set" for full-disk encryption using self-encrypting drives. This relies on the PC BIOS, not the drive, to feature an unlocking mechanism utilizing the BIOS to setup the user's encryption passphrase. This legacy BIOS-based (ATA) method was considered more unreliable to setup and prone to error with regard to interoperability between PC vendors.<a rel="nofollow" class="external autonumber" href="https://web.archive.org/web/20200615155842/http://www.t13.org/documents/UploadedDocuments/docs2006/e05179r4-ACS-SecurityClarifications.pdf">[7]</a> Typical errors include, for example, inabilities to unlock a device once it is plugged into a system from a different hardware vendor. Hence, the availability of BIOS support for the legacy password mechanism decreases in availability, particularly for consumer hardware. 
</p>
<p>See <a href="../en/Solid_state_drive.html#Security" title="Solid state drive">Solid state drive#Security</a> for more information.
</p>
<h2><span class="mw-headline" id="See_also">See also</span></h2>
<ul>
<li><a rel="nofollow" class="external text" href="https://github.com/Drive-Trust-Alliance/sedutil">sedutil (github)</a></li>
<li><a rel="nofollow" class="external text" href="https://github.com/Drive-Trust-Alliance/sedutil/wiki">sedutil official docs</a></li>
<li><a rel="nofollow" class="external text" href="https://github.com/Drive-Trust-Alliance/sedutil/wiki/Command-Syntax">sedutil-cli commands usage</a></li>
<li><a rel="nofollow" class="external text" href="https://github.com/Drive-Trust-Alliance/sedutil/issues/90">sedutil-sleep</a></li>
</ul>
</div>
</div>
					<div id="catlinks" class="catlinks" data-mw="interface">
<div id="mw-normal-catlinks" class="mw-normal-catlinks">
<a href="../Special:Categories.html" title="Special:Categories">Categories</a>: <ul>
<li><a href="../en/Category:Storage.html" title="Category:Storage">Storage</a></li>
<li><a href="../en/Category:Data-at-rest_encryption.html" title="Category:Data-at-rest encryption">Data-at-rest encryption</a></li>
</ul>
</div>
<div id="mw-hidden-catlinks" class="mw-hidden-catlinks mw-hidden-cats-hidden">Hidden categories: <ul>
<li><a href="../en/Category:Pages_or_sections_flagged_with_Template:Expansion.html" title="Category:Pages or sections flagged with Template:Expansion">Pages or sections flagged with Template:Expansion</a></li>
<li><a href="../en/Category:Pages_or_sections_flagged_with_Template:Style.html" title="Category:Pages or sections flagged with Template:Style">Pages or sections flagged with Template:Style</a></li>
</ul>
</div>
</div>
				</div>
			</main>
			
		</div>
		<div class="mw-footer-container">
			
<footer id="footer" class="mw-footer" role="contentinfo" style="margin: 0">
	<ul id="footer-info">
	<li data-nosnippet="">Retrieved from "<a dir="ltr" href="https://wiki.archlinux.org/index.php?title=Self-encrypting_drives&amp;oldid=786315">https://wiki.archlinux.org/index.php?title=Self-encrypting_drives&amp;oldid=786315</a>"</li>
<li id="footer-info-lastmod"> This page was last edited on 27 August 2023, at 14:38.</li>
	<li id="footer-info-copyright">Content is available under <a class="external" rel="nofollow" href="https://www.gnu.org/copyleft/fdl.html">GNU Free Documentation License 1.3 or later</a> unless otherwise noted.</li>
<br>
</ul>

	<ul id="footer-places">
	<li id="footer-places-privacy"><a href="https://terms.archlinux.org/docs/privacy-policy/">Privacy policy</a></li>
	<li id="footer-places-about"><a href="../en/ArchWiki:About.html">About ArchWiki</a></li>
	<li id="footer-places-disclaimer"><a href="../en/ArchWiki:General_disclaimer.html">Disclaimers</a></li>
</ul>

	
</footer>

		</div>
	</div> 
</div> 

</body>
</html>
