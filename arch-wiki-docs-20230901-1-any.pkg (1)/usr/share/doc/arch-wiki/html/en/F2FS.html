<!DOCTYPE html>
<html class="client-nojs" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<title>F2FS - ArchWiki</title>
<link rel="stylesheet" href="../ArchWikiOffline.css">
<meta name="ResourceLoaderDynamicStyles" content="">
<meta name="generator" content="MediaWiki 1.39.4">
<meta name="referrer" content="no-referrer-when-downgrade">
<meta name="format-detection" content="telephone=no">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes, minimum-scale=0.25, maximum-scale=5.0">
<link rel="icon" href="/favicon.ico">
<link rel="search" type="application/opensearchdescription+xml" href="/opensearch_desc.php" title="ArchWiki (en)">
<link rel="EditURI" type="application/rsd+xml" href="https://wiki.archlinux.org/api.php?action=rsd">
<link rel="license" href="https://www.gnu.org/copyleft/fdl.html">
<link rel="alternate" type="application/atom+xml" title="ArchWiki Atom feed" href="/index.php?title=Special:RecentChanges&amp;feed=atom">
</head>
<body class="skin-vector skin-vector-search-vue mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-F2FS rootpage-F2FS skin-vector-2022 action-view skin--responsive vector-feature-language-in-header-enabled vector-feature-language-in-main-page-header-disabled vector-feature-language-alert-in-sidebar-disabled vector-feature-sticky-header-disabled vector-feature-sticky-header-edit-disabled vector-feature-table-of-contents-disabled vector-feature-visual-enhancement-next-disabled">
<div class="mw-page-container">
	<span id="top-page"></span>
	<a class="mw-jump-link" href="#content">Jump to content</a>
	<div class="mw-page-container-inner">
		<input type="checkbox" id="mw-sidebar-checkbox" class="mw-checkbox-hack-checkbox">
		<div class="vector-sidebar-container ">
			</div>
		<div class="vector-sitenotice-container">
			<div id="siteNotice"></div>
		</div>
		<input type="checkbox" id="vector-toc-collapsed-checkbox" class="mw-checkbox-hack-checkbox">
		<div class="mw-table-of-contents-container">
			<div class="vector-sticky-toc-container mw-sticky-header-element">
				<nav id="mw-panel-toc" class="sidebar-toc" role="navigation" aria-labelledby="sidebar-toc-label" data-event-name="ui.sidebar-toc">
	<div id="sidebar-toc-label" class="sidebar-toc-header">
		<p class="sidebar-toc-title">
		Contents
		<button class="vector-toc-uncollapse-button">move to sidebar</button>
		<button class="vector-toc-collapse-button">hide</button>
		</p>
	</div>
	<ul class="sidebar-toc-contents" id="mw-panel-toc-list">
		<li id="toc-mw-content-text" class="sidebar-toc-list-item sidebar-toc-level-1">
			<a href="#top-page" class="sidebar-toc-link">
				<div class="sidebar-toc-text">Beginning</div>
			</a>
		</li>
		<li id="toc-Known_issues" class="sidebar-toc-list-item sidebar-toc-level-1 sidebar-toc-list-item-expanded">
			<a class="sidebar-toc-link" href="#Known_issues">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">1</span>Known issues</div>
			</a>
			
				<button aria-controls="toc-Known_issues-sublist" class="mw-ui-icon mw-ui-icon-wikimedia-expand mw-ui-icon-small sidebar-toc-toggle">
					Toggle Known issues subsection
				</button>
			
			<ul id="toc-Known_issues-sublist" class="sidebar-toc-list">
				<li id="toc-fsck_failures" class="sidebar-toc-list-item sidebar-toc-level-2">
			<a class="sidebar-toc-link" href="#fsck_failures">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">1.1</span>fsck failures</div>
			</a>
			
			<ul id="toc-fsck_failures-sublist" class="sidebar-toc-list">
			</ul>
		</li>
		<li id="toc-Long_running_fsck_delays_boot" class="sidebar-toc-list-item sidebar-toc-level-2">
			<a class="sidebar-toc-link" href="#Long_running_fsck_delays_boot">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">1.2</span>Long running fsck delays boot</div>
			</a>
			
			<ul id="toc-Long_running_fsck_delays_boot-sublist" class="sidebar-toc-list">
			</ul>
		</li>
		<li id="toc-GRUB_support" class="sidebar-toc-list-item sidebar-toc-level-2">
			<a class="sidebar-toc-link" href="#GRUB_support">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">1.3</span>GRUB support</div>
			</a>
			
			<ul id="toc-GRUB_support-sublist" class="sidebar-toc-list">
			</ul>
		</li>
		<li id="toc-Cannot_set_file_attributes_for_'/var/log/journal'" class="sidebar-toc-list-item sidebar-toc-level-2">
			<a class="sidebar-toc-link" href="#Cannot_set_file_attributes_for_'/var/log/journal'">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">1.4</span>Cannot set file attributes for '/var/log/journal'</div>
			</a>
			
			<ul id="toc-Cannot_set_file_attributes_for_'/var/log/journal'-sublist" class="sidebar-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id="toc-Creating_a_F2FS_file_system" class="sidebar-toc-list-item sidebar-toc-level-1 sidebar-toc-list-item-expanded">
			<a class="sidebar-toc-link" href="#Creating_a_F2FS_file_system">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">2</span>Creating a F2FS file system</div>
			</a>
			
				<button aria-controls="toc-Creating_a_F2FS_file_system-sublist" class="mw-ui-icon mw-ui-icon-wikimedia-expand mw-ui-icon-small sidebar-toc-toggle">
					Toggle Creating a F2FS file system subsection
				</button>
			
			<ul id="toc-Creating_a_F2FS_file_system-sublist" class="sidebar-toc-list">
				<li id="toc-Compression" class="sidebar-toc-list-item sidebar-toc-level-2">
			<a class="sidebar-toc-link" href="#Compression">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">2.1</span>Compression</div>
			</a>
			
			<ul id="toc-Compression-sublist" class="sidebar-toc-list">
			</ul>
		</li>
		<li id="toc-File-based_encryption_support" class="sidebar-toc-list-item sidebar-toc-level-2">
			<a class="sidebar-toc-link" href="#File-based_encryption_support">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">2.2</span>File-based encryption support</div>
			</a>
			
			<ul id="toc-File-based_encryption_support-sublist" class="sidebar-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id="toc-Mounting_a_F2FS_file_system" class="sidebar-toc-list-item sidebar-toc-level-1 sidebar-toc-list-item-expanded">
			<a class="sidebar-toc-link" href="#Mounting_a_F2FS_file_system">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">3</span>Mounting a F2FS file system</div>
			</a>
			
				<button aria-controls="toc-Mounting_a_F2FS_file_system-sublist" class="mw-ui-icon mw-ui-icon-wikimedia-expand mw-ui-icon-small sidebar-toc-toggle">
					Toggle Mounting a F2FS file system subsection
				</button>
			
			<ul id="toc-Mounting_a_F2FS_file_system-sublist" class="sidebar-toc-list">
				<li id="toc-Recommended_mount_options" class="sidebar-toc-list-item sidebar-toc-level-2">
			<a class="sidebar-toc-link" href="#Recommended_mount_options">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">3.1</span>Recommended mount options</div>
			</a>
			
			<ul id="toc-Recommended_mount_options-sublist" class="sidebar-toc-list">
			</ul>
		</li>
		<li id="toc-Implementation_of_discard" class="sidebar-toc-list-item sidebar-toc-level-2">
			<a class="sidebar-toc-link" href="#Implementation_of_discard">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">3.2</span>Implementation of discard</div>
			</a>
			
			<ul id="toc-Implementation_of_discard-sublist" class="sidebar-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id="toc-Checking_and_repair" class="sidebar-toc-list-item sidebar-toc-level-1 sidebar-toc-list-item-expanded">
			<a class="sidebar-toc-link" href="#Checking_and_repair">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">4</span>Checking and repair</div>
			</a>
			
			<ul id="toc-Checking_and_repair-sublist" class="sidebar-toc-list">
			</ul>
		</li>
		<li id="toc-Grow_an_F2FS_file_system" class="sidebar-toc-list-item sidebar-toc-level-1 sidebar-toc-list-item-expanded">
			<a class="sidebar-toc-link" href="#Grow_an_F2FS_file_system">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">5</span>Grow an F2FS file system</div>
			</a>
			
			<ul id="toc-Grow_an_F2FS_file_system-sublist" class="sidebar-toc-list">
			</ul>
		</li>
		<li id="toc-Troubleshooting" class="sidebar-toc-list-item sidebar-toc-level-1 sidebar-toc-list-item-expanded">
			<a class="sidebar-toc-link" href="#Troubleshooting">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">6</span>Troubleshooting</div>
			</a>
			
				<button aria-controls="toc-Troubleshooting-sublist" class="mw-ui-icon mw-ui-icon-wikimedia-expand mw-ui-icon-small sidebar-toc-toggle">
					Toggle Troubleshooting subsection
				</button>
			
			<ul id="toc-Troubleshooting-sublist" class="sidebar-toc-list">
				<li id="toc-Remounting_impossible_with_some_options" class="sidebar-toc-list-item sidebar-toc-level-2">
			<a class="sidebar-toc-link" href="#Remounting_impossible_with_some_options">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">6.1</span>Remounting impossible with some options</div>
			</a>
			
			<ul id="toc-Remounting_impossible_with_some_options-sublist" class="sidebar-toc-list">
			</ul>
		</li>
	</ul>
		</li>
	</ul>
</nav>

			</div>
		</div>
		<div class="mw-content-container">
			<main id="content" class="mw-body" role="main" style="margin: 0">
				<a id="top"></a>
				<nav class="vector-article-toolbar" aria-label="Tools" role="navigation">
					<div class="mw-article-toolbar-container">
						<div id="left-navigation">
							

<div id="p-associated-pages" class="vector-menu mw-portlet mw-portlet-associated-pages vector-menu-tabs">
	<div class="vector-menu-content">
		
		<ul class="vector-menu-content-list">
<li id="ca-nstab-main" class="selected mw-list-item"><a href="../en/F2FS.html" title="View the content page [c]" accesskey="c"><span>Page</span></a></li>
<li id="ca-talk" class="mw-list-item"><a href="../en/Talk:F2FS.html" rel="discussion" title="Discussion about the content page [t]" accesskey="t"><span>Discussion</span></a></li>
</ul>
		
	</div>
</div>

							

<div id="p-variants" class="vector-menu mw-portlet mw-portlet-variants emptyPortlet vector-menu-dropdown">
	<input type="checkbox" id="p-variants-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-p-variants" class="vector-menu-checkbox" aria-label="Change language variant">
	<label id="p-variants-label" for="p-variants-checkbox" class="vector-menu-heading ">
		<span class="vector-menu-heading-label">English</span>
	</label>
	<div class="vector-menu-content">
		
		<ul class="vector-menu-content-list"></ul>
		
	</div>
</div>

						</div>
						<div id="right-navigation" class="vector-collapsible ">
							

<div id="p-views" class="vector-menu mw-portlet mw-portlet-views vector-menu-tabs">
	<div class="vector-menu-content">
		
		<ul class="vector-menu-content-list">
<li id="ca-view" class="selected mw-list-item"><a href="../en/F2FS.html"><span>Read</span></a></li>
<li id="ca-viewsource" class="mw-list-item"><a href="/index.php?title=F2FS&amp;action=edit" title="This page is protected.
You can view its source [e]" accesskey="e"><span>View source</span></a></li>
<li id="ca-history" class="mw-list-item"><a href="/index.php?title=F2FS&amp;action=history" title="Past revisions of this page [h]" accesskey="h"><span>View history</span></a></li>
</ul>
		
	</div>
</div>

							

<div id="p-cactions" class="vector-menu mw-portlet mw-portlet-cactions emptyPortlet vector-menu-dropdown vector-has-collapsible-items" title="More options">
	<input type="checkbox" id="p-cactions-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-p-cactions" class="vector-menu-checkbox">
	<label id="p-cactions-label" for="p-cactions-checkbox" class="vector-menu-heading ">
		<span class="vector-menu-heading-label">More</span>
	</label>
	<div class="vector-menu-content">
		
		<ul class="vector-menu-content-list">
<li id="ca-more-view" class="selected vector-more-collapsible-item mw-list-item"><a href="../en/F2FS.html"><span>Read</span></a></li>
<li id="ca-more-viewsource" class="vector-more-collapsible-item mw-list-item"><a href="/index.php?title=F2FS&amp;action=edit"><span>View source</span></a></li>
<li id="ca-more-history" class="vector-more-collapsible-item mw-list-item"><a href="/index.php?title=F2FS&amp;action=history"><span>View history</span></a></li>
</ul>
		
	</div>
</div>

						</div>
					</div>
				</nav>
				<div id="bodyContent" class="vector-body" data-mw-ve-target-container>
					<div class="mw-body-subheader">
					        <div class="mw-indicators">
        </div>

					    <div id="siteSub" class="noprint">From ArchWiki</div>
					</div>
					
					
					
					<div id="mw-content-text" class="mw-body-content mw-content-ltr" lang="en" dir="ltr">
<div class="mw-parser-output">
<div class="archwiki-template-meta-related-articles-start">
<p class="mw-no-invert">Related articles</p>
<ul>
<li><a href="../en/File_systems.html" title="File systems">File systems</a></li>
</ul>
</div>
<p><a href="https://en.wikipedia.org/wiki/F2FS" class="extiw" title="wikipedia:F2FS">F2FS</a> (Flash-Friendly File System) is a file system intended for NAND-based flash memory equipped with Flash Translation Layer. Unlike JFFS or UBIFS it relies on FTL to handle write distribution. It is supported from kernel 3.8 onwards.
</p>
<p>An FTL is found in all flash memory with a SCSI/SATA/PCIe/NVMe interface <a rel="nofollow" class="external autonumber" href="https://accelazh.github.io/ssd/A-Summary-On-SSD-And-FTL">[1]</a>, opposed to bare NAND Flash and SmartMediaCards <a rel="nofollow" class="external autonumber" href="http://www.linux-mtd.infradead.org/archive/tech/nand.html">[2]</a>.
</p>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Warning:</strong> The data contained on F2FS partitions can become unusable if the kernel version on the running machine is <i>older</i> than the kernel version used to create the partition.  For example, this limitation can manifest if the F2FS partition was created on a mainline kernel provided by <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=linux">linux</a></span> yet the system has a need to downgrade to an older series of kernels provided by <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=linux-lts">linux-lts</a></span>.  See <a rel="nofollow" class="external text" href="https://bugs.archlinux.org/task/69363">FS#69363</a>.</div>
<div class="noprint archwiki-template-message">
<p><a href="../File:Tango-view-fullscreen.png" class="image"><img alt="Tango-view-fullscreen.png" src="../File:Tango-view-fullscreen.png" decoding="async" width="48" height="48"></a><b>This article or section needs expansion.</b><a href="../File:Tango-view-fullscreen.png" class="image"><img alt="Tango-view-fullscreen.png" src="../File:Tango-view-fullscreen.png" decoding="async" width="48" height="48"></a></p>
<div>
<b>Reason:</b> What advantages f2fs has over other fs, such as ext4? Is it recommended for being used inside lvm? (Discuss in <a rel="nofollow" class="external text" href="https://wiki.archlinux.org/title/Talk:F2FS">Talk:F2FS</a>)</div>
</div>
<mw:tocplace></mw:tocplace>
<h2><span class="mw-headline" id="Known_issues">Known issues</span></h2>
<h3><span class="mw-headline" id="fsck_failures">fsck failures</span></h3>
<p>F2FS has a weak fsck that can lead to data loss in case of a sudden power loss <a rel="nofollow" class="external autonumber" href="https://www.usenix.org/system/files/atc19-jaffer.pdf">[3]</a><a rel="nofollow" class="external autonumber" href="https://web.archive.org/web/20200925120546/https://archived.forum.manjaro.org/t/record-fsync-data-failed-on-f2fs-file-system-how-to-fix-foregt-the-help-i-reinstalled-its-just-easier/121051">[4]</a>.
</p>
<p>If power losses are frequent, consider an alternative <a href="../en/File_systems.html" class="mw-redirect" title="File system">file system</a>.
</p>
<h3><span class="mw-headline" id="Long_running_fsck_delays_boot">Long running fsck delays boot</span></h3>
<div class="noprint archwiki-template-message">
<p><a href="../File:Tango-view-refresh-red.png" class="image"><img alt="Tango-view-refresh-red.png" src="../File:Tango-view-refresh-red.png" decoding="async" width="48" height="48"></a><b>This article or section is out of date.</b><a href="../File:Tango-view-refresh-red.png" class="image"><img alt="Tango-view-refresh-red.png" src="../File:Tango-view-refresh-red.png" decoding="async" width="48" height="48"></a></p>
<div>
<b>Reason:</b> The <a rel="nofollow" class="external text" href="https://git.kernel.org/pub/scm/linux/kernel/git/jaegeuk/f2fs-tools.git/commit/?id=0d0158cf23c50d130c3ce3b7b024868a029ab60e">commit</a> is in <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=f2fs-tools">f2fs-tools</a></span> 1.14.0. What is the status of the issue now? (Discuss in <a rel="nofollow" class="external text" href="https://wiki.archlinux.org/title/Talk:F2FS">Talk:F2FS</a>)</div>
</div>
<p>If the kernel version has changed between boots, the <i>fsck.f2fs</i> utility will perform a full file system check which will take longer to finish<a rel="nofollow" class="external autonumber" href="https://bbs.archlinux.org/viewtopic.php?id=245702">[5]</a>.
</p>
<p>This may be mitigated in the future thanks to a recent commit <a rel="nofollow" class="external autonumber" href="https://lore.kernel.org/linux-f2fs-devel/20200619184346.56536-1-jaegeuk@kernel.org/">[6]</a>.
</p>
<h3><span class="mw-headline" id="GRUB_support">GRUB support</span></h3>
<p>While GRUB supports F2FS since version 2.0.4, it cannot correctly read its boot files from an F2FS partition that was created with the <code>extra_attr</code> flag enabled (for more details, see <a href="../en/GRUB.html#Unsupported_file_systems" title="GRUB">GRUB#Unsupported file systems</a>).
</p>
<h3>
<span id="Cannot_set_file_attributes_for_.27.2Fvar.2Flog.2Fjournal.27"></span><span class="mw-headline" id="Cannot_set_file_attributes_for_'/var/log/journal'">Cannot set file attributes for '/var/log/journal'</span>
</h3>
<p>If the error: 
</p>
<pre>Cannot set file attributes for '/var/log/journal', maybe due to incompatibility in specified attributes, previous=0x10001000, current=0x10001000, expected=0x10801000, ignoring.
</pre>
<p>is present in your <a href="../en/Systemd/Journal.html" class="mw-redirect" title="Journal">journal</a>, it can be <a rel="nofollow" class="external text" href="https://github.com/systemd/systemd/issues/26318">safely ignored</a>: it is due to <a href="../en/Systemd.html#systemd-tmpfiles_-_temporary_files" class="mw-redirect" title="Systemd-tmpfiles">systemd-tmpfiles</a> trying to use an file system feature that is not supported by F2FS.
</p>
<h2><span class="mw-headline" id="Creating_a_F2FS_file_system">Creating a F2FS file system</span></h2>
<p>This article assumes the device has <a href="../en/Partitioning.html" class="mw-redirect" title="Partitions">partitions</a> already setup.  <a href="../en/Help:Reading.html#Installation_of_packages" class="mw-redirect" title="Install">Install</a> <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=f2fs-tools">f2fs-tools</a></span>.  Use <code>mkfs.f2fs</code> to format the target partition referred to as <code><i>/dev/sdxY</i></code>:
</p>
<pre># mkfs.f2fs -l mylabel -O extra_attr,inode_checksum,sb_checksum <i>/dev/sdxY</i>
</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> The example above is a minimum recommended set of options which help <code>f2fs.fsck</code> to detect and to fix some types of filesystem corruption. See <span class="plainlinks archwiki-template-man" title="$ man 8 mkfs.f2fs"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/mkfs.f2fs.8">mkfs.f2fs(8)</a></span> for all available options.</div>
<h3><span class="mw-headline" id="Compression">Compression</span></h3>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> Unlike other filesystems with inline compression, f2fs compression does not expose additional freespace by default and instead reserves the same number of blocks regardless of whether compression is enabled or not. The primary goal is reducing writes to extend flash lifetime, and potentially, <a rel="nofollow" class="external text" href="https://lz4.github.io/lz4/">an small increase in performance</a>. See <a rel="nofollow" class="external text" href="https://docs.kernel.org/filesystems/f2fs.html#compression-implementation">Compression Implementation</a> in the kernel docs. <code>F2FS_IOC_RELEASE_COMPRESS_BLOCKS</code> can be used to expose unused space on a per-file basis, but it makes the file immutable in the process.</div>
<p>To use compression, include the <code>compression</code> option. Example:
</p>
<pre># mkfs.f2fs -l mylabel -O extra_attr,inode_checksum,sb_checksum,<b>compression</b> <i>/dev/sdxY</i>
</pre>
<p>When mounting the filesystem, specify <code>compress_algorithm=(lzo|lz4|zstd|lzo-rle)</code>. Using <code>compress_extension=txt</code> will cause all txt files to be compressed by default.
</p>
<p>In order to tell F2FS to compress a file or a directory, use :
</p>
<pre>$ chattr -R +c [FOLDER]
</pre>
<h3><span class="mw-headline" id="File-based_encryption_support">File-based encryption support</span></h3>
<p>Since Linux 4.2, F2FS natively supports file encryption.  Encryption is applied at the directory level, and different directories can use different encryption keys.  This is different from both <a href="../en/Dm-crypt.html" title="Dm-crypt">dm-crypt</a>, which is block-device level encryption, and from <a href="../en/ECryptfs.html" title="ECryptfs">eCryptfs</a>, which is a stacked cryptographic filesystem.  To use F2FS's native encryption support, see the <a href="../en/Fscrypt.html" title="Fscrypt">fscrypt</a> article.  Create the file system with
</p>
<pre> # mkfs.f2fs -l mylabel -O extra_attr,inode_checksum,sb_checksum,<b>encrypt</b> <i>/dev/sdxY</i>
</pre>
<p>or add encryption capability at a later time with <code>fsck.f2fs -O encrypt /dev/sdxY</code>.
</p>
<h2><span class="mw-headline" id="Mounting_a_F2FS_file_system">Mounting a F2FS file system</span></h2>
<p>The file system can then be mounted manually or via other mechanisms:
</p>
<pre># mount /dev/sdxY /mnt/foo
</pre>
<h3><span class="mw-headline" id="Recommended_mount_options">Recommended mount options</span></h3>
<p>Since F2FS is designed to be used on flash devices, compression is a good idea. You have to enable it at <code>mkfs.f2fs</code> time.
A few mount options can be used to improve things slightly.
</p>
<pre># mount -o compress_algorithm=zstd:6,compress_chksum,atgc,gc_merge,lazytime /dev/sd<i>xY</i> /mnt/<i>mountpoint</i>
</pre>
<ul>
<li>
<code>compress_algorithm=zstd:6</code> tells F2FS to use <a href="https://en.wikipedia.org/wiki/Zstandard" class="extiw" title="w:Zstandard">zstd</a> for compression at level 6, which should give pretty good compression ratio.</li>
<li>
<code>compress_chksum</code> tells the filesystem to verify compressed blocks with a checksum (to avoid corruption)</li>
<li>
<code>atgc,gc_merge</code> Enable better garbage collector, and enable some foreground garbage collections to be asynchronous.</li>
</ul>
<dl><dd><div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> See <a href="#Remounting_impossible_with_some_options">#Remounting impossible with some options</a>.</div></dd></dl>
<ul><li>
<code>lazytime</code> Do not synchronously update access or modification times. Improves IO performance and flash durability.</li></ul>
<h3><span class="mw-headline" id="Implementation_of_discard">Implementation of discard</span></h3>
<p>By default, F2FS is mounted using a hybrid TRIM mode which behaves as <a href="../en/Solid_state_drive.html#Continuous_TRIM" title="Solid state drive">continuous TRIM</a>.  This implementation creates asynchronous discard threads to alleviate long discarding latency among RW IOs.  It keeps candidates in memory, and the thread issues them in idle time <a rel="nofollow" class="external autonumber" href="https://sourceforge.net/p/linux-f2fs/mailman/message/36957687">[7]</a>.  As a result of this, users wanting <a href="../en/Solid_state_drive.html#Periodic_TRIM" title="Solid state drive">periodic TRIM</a> will need to implicitly set the <code>nodiscard</code> mount option in <code>/etc/fstab</code> or pass it to <a href="../en/File_systems.html#Mount_a_file_system" class="mw-redirect" title="Mount">mount</a> if mounting manually.
</p>
<h2><span class="mw-headline" id="Checking_and_repair">Checking and repair</span></h2>
<p>Checking and repairs to F2FS file systems are accomplished with <code>fsck.f2fs</code> provided by <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=f2fs-tools">f2fs-tools</a></span>. To check a file system, execute
</p>
<pre># fsck.f2fs <i>/dev/sdxY</i>
</pre>
<p>Depending on the result, see <span class="plainlinks archwiki-template-man" title="$ man 8 fsck.f2fs"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/fsck.f2fs.8">fsck.f2fs(8)</a></span> for available switches to repair inconsistencies. For example:
</p>
<pre># fsck.f2fs -f <i>/dev/sdxY</i>
</pre>
<h2><span class="mw-headline" id="Grow_an_F2FS_file_system">Grow an F2FS file system</span></h2>
<p>When the filesystem is unmounted, it can be grown if the partition is expanded. <a rel="nofollow" class="external text" href="https://lore.kernel.org/linux-f2fs-devel/1461630518-16944-1-git-send-email-jaegeuk@kernel.org/">Shrinking is not currently supported</a>.
</p>
<p>First use a <a href="../en/Partitioning.html#Partitioning_tools" title="Partitioning">partition tool</a> to resize the partition: for example, suppose the output of the <code>print</code> command in the <code>parted</code> console is the following:
</p>
<pre>Number  Start   End     Size        File system     Name                  Flag
 1      1049kB  106MB   105MB       fat32           EFI system partition  boot, esp
 2      106MB   11,0GB  10,9GB      ext4
 3      11,0GB  12,3GB  1322MB      f2fs
 4      31,0GB  31,3GB  261MB       ext4
</pre>
<p>To resize the <code>f2fs</code> partition to occupy all the space up to the fourth one, just give <code>resizepart 3 31GB</code> and <code>exit</code>. Now expand the filesystem to fill the new partition using:
</p>
<pre># resize.f2fs <i>/dev/sdxY</i>
</pre>
<p>where <code><i>/dev/sdxY</i></code> is the target F2FS volume to grow. See <span class="plainlinks archwiki-template-man" title="$ man 8 resize.f2fs"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/resize.f2fs.8">resize.f2fs(8)</a></span> for supported options.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> If using GPT, the partition's GUID (seen in <code>/dev/disk/by-partuuid/</code>) might change, but the filesystem UUID (seen in <code>/dev/disk/by-uuid/</code>) should stay the same.</div>
<h2><span class="mw-headline" id="Troubleshooting">Troubleshooting</span></h2>
<h3><span class="mw-headline" id="Remounting_impossible_with_some_options">Remounting impossible with some options</span></h3>
<p>As alluded to in <a href="../en/Fsck.html#Boot_time_checking" title="Fsck">Fsck#Boot time checking</a>, the kernel keeps file systems in a read-only state by default, and it is either explicitly needed to pass the <code>rw</code> <a href="../en/Kernel_parameters.html" class="mw-redirect" title="Kernel parameter">kernel parameter</a> or have systemd remounting the filesystems as read-write with the <code>systemd-remount-fs.service</code>. 
</p>
<p>When remounting the file system from a read-only state to a read-write state, the <code>mount -o remount,... /</code> steps can fail for multiple reasons, which will either leave the root file system read-only or make the system unable to boot with the error message: 
</p>
<pre>Failed to start Remount Root and Kernel File Systems.
</pre>
<p>If the <code>atgc</code> option is specified in the fstab file but has not been passed as a kernel parameter, the F2FS kernel module will not permit re-mounting with an added or cleared <code>atgc</code> option<a rel="nofollow" class="external autonumber" href="https://github.com/systemd/systemd/issues/22982">[8]</a><a rel="nofollow" class="external autonumber" href="https://github.com/systemd/systemd/issues/26763">[9]</a>, either:
</p>
<ul>
<li>add the <a href="../en/Kernel_parameters.html" class="mw-redirect" title="Kernel parameter">kernel parameter</a> <code>rootflags=atgc</code> to your boot loader configuration,</li>
<li>add the <a href="../en/Kernel_parameters.html" class="mw-redirect" title="Kernel parameter">kernel parameter</a> <code>rw</code> to your boot loader configuration,</li>
<li>remove the <code>atgc</code> mount option from the fstab.</li>
</ul>
<p>Since <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=linux">linux</a></span> 6.2, a <a rel="nofollow" class="external text" href="https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=967eaad1fed5f6335ea97a47d45214744dc57925">check</a> is made in the kernel to disable <code>flush_merge</code> when the file system is read-only, but it is the state of the file system before remounting that is checked. As explained in <a rel="nofollow" class="external text" href="https://bugs.archlinux.org/task/77596">FS#77596</a>, either: 
</p>
<ul>
<li>add the <a href="../en/Kernel_parameters.html" class="mw-redirect" title="Kernel parameter">kernel parameter</a> <code>rw</code> to your boot loader configuration,</li>
<li>remove the <code>flush_merge</code> mount option from the fstab.</li>
</ul>
</div>
</div>
					<div id="catlinks" class="catlinks" data-mw="interface">
<div id="mw-normal-catlinks" class="mw-normal-catlinks">
<a href="../Special:Categories.html" title="Special:Categories">Category</a>: <ul><li><a href="../en/Category:File_systems.html" title="Category:File systems">File systems</a></li></ul>
</div>
<div id="mw-hidden-catlinks" class="mw-hidden-catlinks mw-hidden-cats-hidden">Hidden categories: <ul>
<li><a href="../en/Category:Pages_or_sections_flagged_with_Template:Expansion.html" title="Category:Pages or sections flagged with Template:Expansion">Pages or sections flagged with Template:Expansion</a></li>
<li><a href="../en/Category:Pages_or_sections_flagged_with_Template:Out_of_date.html" title="Category:Pages or sections flagged with Template:Out of date">Pages or sections flagged with Template:Out of date</a></li>
</ul>
</div>
</div>
				</div>
			</main>
			
		</div>
		<div class="mw-footer-container">
			
<footer id="footer" class="mw-footer" role="contentinfo" style="margin: 0">
	<ul id="footer-info">
	<li data-nosnippet="">Retrieved from "<a dir="ltr" href="https://wiki.archlinux.org/index.php?title=F2FS&amp;oldid=780295">https://wiki.archlinux.org/index.php?title=F2FS&amp;oldid=780295</a>"</li>
<li id="footer-info-lastmod"> This page was last edited on 4 June 2023, at 09:16.</li>
	<li id="footer-info-copyright">Content is available under <a class="external" rel="nofollow" href="https://www.gnu.org/copyleft/fdl.html">GNU Free Documentation License 1.3 or later</a> unless otherwise noted.</li>
<br>
</ul>

	<ul id="footer-places">
	<li id="footer-places-privacy"><a href="https://terms.archlinux.org/docs/privacy-policy/">Privacy policy</a></li>
	<li id="footer-places-about"><a href="../en/ArchWiki:About.html">About ArchWiki</a></li>
	<li id="footer-places-disclaimer"><a href="../en/ArchWiki:General_disclaimer.html">Disclaimers</a></li>
</ul>

	
</footer>

		</div>
	</div> 
</div> 

</body>
</html>
