<!DOCTYPE html>
<html class="client-nojs" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<title>ipset - ArchWiki</title>
<link rel="stylesheet" href="../ArchWikiOffline.css">
<meta name="ResourceLoaderDynamicStyles" content="">
<meta name="generator" content="MediaWiki 1.39.4">
<meta name="referrer" content="no-referrer-when-downgrade">
<meta name="format-detection" content="telephone=no">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes, minimum-scale=0.25, maximum-scale=5.0">
<link rel="icon" href="/favicon.ico">
<link rel="search" type="application/opensearchdescription+xml" href="/opensearch_desc.php" title="ArchWiki (en)">
<link rel="EditURI" type="application/rsd+xml" href="https://wiki.archlinux.org/api.php?action=rsd">
<link rel="license" href="https://www.gnu.org/copyleft/fdl.html">
<link rel="alternate" type="application/atom+xml" title="ArchWiki Atom feed" href="/index.php?title=Special:RecentChanges&amp;feed=atom">
</head>
<body class="skin-vector skin-vector-search-vue mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-Ipset rootpage-Ipset skin-vector-2022 action-view skin--responsive vector-feature-language-in-header-enabled vector-feature-language-in-main-page-header-disabled vector-feature-language-alert-in-sidebar-disabled vector-feature-sticky-header-disabled vector-feature-sticky-header-edit-disabled vector-feature-table-of-contents-disabled vector-feature-visual-enhancement-next-disabled">
<div class="mw-page-container">
	<span id="top-page"></span>
	<a class="mw-jump-link" href="#content">Jump to content</a>
	<div class="mw-page-container-inner">
		<input type="checkbox" id="mw-sidebar-checkbox" class="mw-checkbox-hack-checkbox">
		<div class="vector-sidebar-container ">
			</div>
		<div class="vector-sitenotice-container">
			<div id="siteNotice"></div>
		</div>
		<input type="checkbox" id="vector-toc-collapsed-checkbox" class="mw-checkbox-hack-checkbox">
		<div class="mw-table-of-contents-container">
			<div class="vector-sticky-toc-container mw-sticky-header-element">
				<nav id="mw-panel-toc" class="sidebar-toc" role="navigation" aria-labelledby="sidebar-toc-label" data-event-name="ui.sidebar-toc">
	<div id="sidebar-toc-label" class="sidebar-toc-header">
		<p class="sidebar-toc-title">
		Contents
		<button class="vector-toc-uncollapse-button">move to sidebar</button>
		<button class="vector-toc-collapse-button">hide</button>
		</p>
	</div>
	<ul class="sidebar-toc-contents" id="mw-panel-toc-list">
		<li id="toc-mw-content-text" class="sidebar-toc-list-item sidebar-toc-level-1">
			<a href="#top-page" class="sidebar-toc-link">
				<div class="sidebar-toc-text">Beginning</div>
			</a>
		</li>
		<li id="toc-Installation" class="sidebar-toc-list-item sidebar-toc-level-1 sidebar-toc-list-item-expanded">
			<a class="sidebar-toc-link" href="#Installation">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">1</span>Installation</div>
			</a>
			
			<ul id="toc-Installation-sublist" class="sidebar-toc-list">
			</ul>
		</li>
		<li id="toc-Configuration" class="sidebar-toc-list-item sidebar-toc-level-1 sidebar-toc-list-item-expanded">
			<a class="sidebar-toc-link" href="#Configuration">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">2</span>Configuration</div>
			</a>
			
				<button aria-controls="toc-Configuration-sublist" class="mw-ui-icon mw-ui-icon-wikimedia-expand mw-ui-icon-small sidebar-toc-toggle">
					Toggle Configuration subsection
				</button>
			
			<ul id="toc-Configuration-sublist" class="sidebar-toc-list">
				<li id="toc-Blocking_a_list_of_network" class="sidebar-toc-list-item sidebar-toc-level-2">
			<a class="sidebar-toc-link" href="#Blocking_a_list_of_network">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">2.1</span>Blocking a list of network</div>
			</a>
			
			<ul id="toc-Blocking_a_list_of_network-sublist" class="sidebar-toc-list">
			</ul>
		</li>
		<li id="toc-Blocking_a_list_of_IP_addresses" class="sidebar-toc-list-item sidebar-toc-level-2">
			<a class="sidebar-toc-link" href="#Blocking_a_list_of_IP_addresses">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">2.2</span>Blocking a list of IP addresses</div>
			</a>
			
			<ul id="toc-Blocking_a_list_of_IP_addresses-sublist" class="sidebar-toc-list">
			</ul>
		</li>
		<li id="toc-Making_ipset_persistent" class="sidebar-toc-list-item sidebar-toc-level-2">
			<a class="sidebar-toc-link" href="#Making_ipset_persistent">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">2.3</span>Making ipset persistent</div>
			</a>
			
			<ul id="toc-Making_ipset_persistent-sublist" class="sidebar-toc-list">
			</ul>
		</li>
		<li id="toc-Blocking_with_PeerGuardian_and_other_blocklists" class="sidebar-toc-list-item sidebar-toc-level-2">
			<a class="sidebar-toc-link" href="#Blocking_with_PeerGuardian_and_other_blocklists">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">2.4</span>Blocking with PeerGuardian and other blocklists</div>
			</a>
			
			<ul id="toc-Blocking_with_PeerGuardian_and_other_blocklists-sublist" class="sidebar-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id="toc-Other_commands" class="sidebar-toc-list-item sidebar-toc-level-1 sidebar-toc-list-item-expanded">
			<a class="sidebar-toc-link" href="#Other_commands">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">3</span>Other commands</div>
			</a>
			
			<ul id="toc-Other_commands-sublist" class="sidebar-toc-list">
			</ul>
		</li>
		<li id="toc-Optimization" class="sidebar-toc-list-item sidebar-toc-level-1 sidebar-toc-list-item-expanded">
			<a class="sidebar-toc-link" href="#Optimization">
				<div class="sidebar-toc-text">
				<span class="sidebar-toc-numb">4</span>Optimization</div>
			</a>
			
			<ul id="toc-Optimization-sublist" class="sidebar-toc-list">
			</ul>
		</li>
	</ul>
</nav>

			</div>
		</div>
		<div class="mw-content-container">
			<main id="content" class="mw-body" role="main" style="margin: 0">
				<a id="top"></a>
				<nav class="vector-article-toolbar" aria-label="Tools" role="navigation">
					<div class="mw-article-toolbar-container">
						<div id="left-navigation">
							

<div id="p-associated-pages" class="vector-menu mw-portlet mw-portlet-associated-pages vector-menu-tabs">
	<div class="vector-menu-content">
		
		<ul class="vector-menu-content-list">
<li id="ca-nstab-main" class="selected mw-list-item"><a href="../en/Ipset.html" title="View the content page [c]" accesskey="c"><span>Page</span></a></li>
<li id="ca-talk" class="new mw-list-item"><a href="/index.php?title=Talk:Ipset&amp;action=edit&amp;redlink=1" rel="discussion" title="Discussion about the content page (page does not exist) [t]" accesskey="t"><span>Discussion</span></a></li>
</ul>
		
	</div>
</div>

							

<div id="p-variants" class="vector-menu mw-portlet mw-portlet-variants emptyPortlet vector-menu-dropdown">
	<input type="checkbox" id="p-variants-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-p-variants" class="vector-menu-checkbox" aria-label="Change language variant">
	<label id="p-variants-label" for="p-variants-checkbox" class="vector-menu-heading ">
		<span class="vector-menu-heading-label">English</span>
	</label>
	<div class="vector-menu-content">
		
		<ul class="vector-menu-content-list"></ul>
		
	</div>
</div>

						</div>
						<div id="right-navigation" class="vector-collapsible ">
							

<div id="p-views" class="vector-menu mw-portlet mw-portlet-views vector-menu-tabs">
	<div class="vector-menu-content">
		
		<ul class="vector-menu-content-list">
<li id="ca-view" class="selected mw-list-item"><a href="../en/Ipset.html"><span>Read</span></a></li>
<li id="ca-viewsource" class="mw-list-item"><a href="/index.php?title=Ipset&amp;action=edit" title="This page is protected.
You can view its source [e]" accesskey="e"><span>View source</span></a></li>
<li id="ca-history" class="mw-list-item"><a href="/index.php?title=Ipset&amp;action=history" title="Past revisions of this page [h]" accesskey="h"><span>View history</span></a></li>
</ul>
		
	</div>
</div>

							

<div id="p-cactions" class="vector-menu mw-portlet mw-portlet-cactions emptyPortlet vector-menu-dropdown vector-has-collapsible-items" title="More options">
	<input type="checkbox" id="p-cactions-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-p-cactions" class="vector-menu-checkbox">
	<label id="p-cactions-label" for="p-cactions-checkbox" class="vector-menu-heading ">
		<span class="vector-menu-heading-label">More</span>
	</label>
	<div class="vector-menu-content">
		
		<ul class="vector-menu-content-list">
<li id="ca-more-view" class="selected vector-more-collapsible-item mw-list-item"><a href="../en/Ipset.html"><span>Read</span></a></li>
<li id="ca-more-viewsource" class="vector-more-collapsible-item mw-list-item"><a href="/index.php?title=Ipset&amp;action=edit"><span>View source</span></a></li>
<li id="ca-more-history" class="vector-more-collapsible-item mw-list-item"><a href="/index.php?title=Ipset&amp;action=history"><span>View history</span></a></li>
</ul>
		
	</div>
</div>

						</div>
					</div>
				</nav>
				<div id="bodyContent" class="vector-body" data-mw-ve-target-container>
					<div class="mw-body-subheader">
					        <div class="mw-indicators">
        </div>

					    <div id="siteSub" class="noprint">From ArchWiki</div>
					</div>
					
					
					
					<div id="mw-content-text" class="mw-body-content mw-content-ltr" lang="en" dir="ltr">
<div class="mw-parser-output">
<p><span>
</span>
</p>
<div class="archwiki-template-meta-related-articles-start">
<p class="mw-no-invert">Related articles</p>
<ul>
<li><a href="../en/Category:Firewalls.html" class="mw-redirect" title="Firewalls">Firewalls</a></li>
<li><a href="../en/Iptables.html" title="Iptables">Iptables</a></li>
</ul>
</div>
<p><a rel="nofollow" class="external text" href="https://ipset.netfilter.org/">ipset</a> is a companion application for the <a href="../en/Iptables.html" title="Iptables">iptables</a> Linux <a href="../en/Category:Firewalls.html" class="mw-redirect" title="Firewall">firewall</a>. It allows you to setup rules to quickly and easily block a set of IP addresses, among other things.
</p>
<mw:tocplace></mw:tocplace>
<h2><span class="mw-headline" id="Installation">Installation</span></h2>
<p><a href="../en/Help:Reading.html#Installation_of_packages" class="mw-redirect" title="Install">Install</a> the <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=ipset">ipset</a></span> package.
</p>
<h2><span class="mw-headline" id="Configuration">Configuration</span></h2>
<h3><span class="mw-headline" id="Blocking_a_list_of_network">Blocking a list of network</span></h3>
<p>Start by creating a new "set" of network addresses. This creates a new "hash" set of "net" network addresses named "myset".
</p>
<pre># ipset create myset hash:net
</pre>
<p>or 
</p>
<pre># ipset -N myset nethash
</pre>
<p>Add any IP address that you would like to block to the set.
</p>
<pre># ipset add myset 14.144.0.0/12
# ipset add myset 27.8.0.0/13
# ipset add myset 58.16.0.0/15
# ipset add myset 1.1.1.0/24
</pre>
<p>Finally, configure <a href="../en/Iptables.html" title="Iptables">iptables</a> to block any address in that set. This command will add a rule to the top of the "INPUT" chain to "-m" match the set named "myset" from ipset (--match-set) when it is a "src" packet and "DROP", or block, it.
</p>
<pre># iptables -I INPUT -m set --match-set myset src -j DROP
</pre>
<h3><span class="mw-headline" id="Blocking_a_list_of_IP_addresses">Blocking a list of IP addresses</span></h3>
<p>Start by creating a new "set" of ip addresses. This creates a new "hash" set of "ip" addresses named "myset-ip".
</p>
<pre># ipset create myset-ip hash:ip
</pre>
<p>or 
</p>
<pre># ipset -N myset-ip iphash
</pre>
<p>Add any IP address that you would like to block to the set.
</p>
<pre># ipset add myset-ip 1.1.1.1
# ipset add myset-ip 2.2.2.2
</pre>
<p>Finally, configure <a href="../en/Iptables.html" title="Iptables">iptables</a> to block any address in that set.
</p>
<pre># iptables -I INPUT -m set --match-set myset-ip src -j DROP
</pre>
<h3><span class="mw-headline" id="Making_ipset_persistent">Making ipset persistent</span></h3>
<p>The ipset you have created is stored in memory and will be gone after reboot. To make the ipset persistent you have to do the followings:
</p>
<p>First, save the ipset to <code>/etc/ipset.conf</code>:
</p>
<pre># ipset save &gt; /etc/ipset.conf
</pre>
<p>Then <a href="../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Enable">enable</a> <code>ipset.service</code>, which works similarly to <code>iptables.service</code> for restoring <a href="../en/Iptables.html#Configuration_and_usage" title="Iptables">iptables rules</a>.
</p>
<h3><span class="mw-headline" id="Blocking_with_PeerGuardian_and_other_blocklists">Blocking with PeerGuardian and other blocklists</span></h3>
<p>The <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/pg2ipset-git/">pg2ipset-git</a></span><sup><small>AUR</small></sup> tool by the author of Maeyanie.com, coupled with the <a rel="nofollow" class="external text" href="https://github.com/ilikenwf/pg2ipset/blob/master/ipset-update.sh">ipset-update.sh</a> script, can be used with cron to automatically update various blocklists. Currently, by default, blocking of: country, tor exit node and Bluetrack pg2 list are implemented.
</p>
<h2><span class="mw-headline" id="Other_commands">Other commands</span></h2>
<p>To view the sets:
</p>
<pre># ipset list
</pre>
<p>or
</p>
<pre># ipset -L
</pre>
<p>To delete a set:
</p>
<pre># ipset destroy <i>myset</i>
</pre>
<p>or 
</p>
<pre># ipset -X <i>myset</i>
</pre>
<p>To delete all sets:
</p>
<pre># ipset destroy
</pre>
<p>Please see the <span class="plainlinks archwiki-template-man" title="$ man 8 ipset"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/ipset.8">ipset(8)</a></span> for further information.
</p>
<h2><span class="mw-headline" id="Optimization">Optimization</span></h2>
<p>The <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/iprange/">iprange</a></span><sup><small>AUR</small></sup> tool can help to reduce entries in ipset.conf by merging adjacent ranges or eliminating overlapped ranges. This can improve the router/firewall performance if the table size is huge. This tool can also convert a list of hostnames to IPs.
</p>
<p>Although ipset is designed to be able to scale well, that does not mean infinitely. In particular, some nations have very large IP address spaces, which will cause geoblocking to be inefficient.
</p>
</div>
</div>
					<div id="catlinks" class="catlinks" data-mw="interface"><div id="mw-normal-catlinks" class="mw-normal-catlinks">
<a href="../Special:Categories.html" title="Special:Categories">Category</a>: <ul><li><a href="../en/Category:Firewalls.html" title="Category:Firewalls">Firewalls</a></li></ul>
</div></div>
				</div>
			</main>
			
		</div>
		<div class="mw-footer-container">
			
<footer id="footer" class="mw-footer" role="contentinfo" style="margin: 0">
	<ul id="footer-info">
	<li data-nosnippet="">Retrieved from "<a dir="ltr" href="https://wiki.archlinux.org/index.php?title=Ipset&amp;oldid=753904">https://wiki.archlinux.org/index.php?title=Ipset&amp;oldid=753904</a>"</li>
<li id="footer-info-lastmod"> This page was last edited on 20 October 2022, at 15:25.</li>
	<li id="footer-info-copyright">Content is available under <a class="external" rel="nofollow" href="https://www.gnu.org/copyleft/fdl.html">GNU Free Documentation License 1.3 or later</a> unless otherwise noted.</li>
<br>
</ul>

	<ul id="footer-places">
	<li id="footer-places-privacy"><a href="https://terms.archlinux.org/docs/privacy-policy/">Privacy policy</a></li>
	<li id="footer-places-about"><a href="../en/ArchWiki:About.html">About ArchWiki</a></li>
	<li id="footer-places-disclaimer"><a href="../en/ArchWiki:General_disclaimer.html">Disclaimers</a></li>
</ul>

	
</footer>

		</div>
	</div> 
</div> 

</body>
</html>
